import{a as me,r as v,b as de,z as U,n as pe,p as F,f as l,o as p,h as o,c as y,e as s,t as r,k as u,l as _,s as ce,q as fe,ar as B,as as I,Q as D,g as b,j as z,at as G,a4 as q,aA as M,i as ve,aq as ge,x as ye}from"./index-DywPtqBD.js";import{Q as be,a as T}from"./QItem-vYT0oGEd.js";import{Q as j,a as he}from"./QSelect-N7IH0-wA.js";import{Q as we}from"./QPage-ByQ-y1Qk.js";import{C as S}from"./ClosePopup-DzKqc7aP.js";import{u as _e}from"./useGroups-CM2tUhAj.js";import{u as $e}from"./useFriends-BJDuLRcu.js";import{u as Ve}from"./useDummyProfiles-CzJMFbj5.js";import{u as ke}from"./auth-store-CFwI7z_J.js";import{u as Ce}from"./use-quasar-Dhk6w8yX.js";import{u as De}from"./vue-i18n.runtime-DTWan08Y.js";import"./format-D1-ZXYq9.js";import"./position-engine-Bcn4MC3v.js";import"./selection-BlIRqF8l.js";import"./rtl-DFPa-2ov.js";import"./supabase-bByfhSrO.js";const Qe={class:"row items-center justify-between q-mb-md"},Ge={class:"text-h4"},qe={key:0,class:"flex justify-center q-my-lg"},Me={key:1,class:"text-center q-py-lg"},Se={class:"text-h6 q-mt-md"},Pe={class:"text-body2"},Ae={key:2,class:"q-gutter-md q-mt-md"},Ue={class:"text-h6"},Fe={class:"text-body2 text-grey-7"},Be={class:"row items-center no-wrap q-gutter-xs"},Ie={class:"row items-center justify-between q-mb-sm"},ze={class:"text-subtitle2"},Te={class:"row q-col-gutter-sm"},je={key:0,class:"text-grey-6"},xe={class:"text-h6"},Ne={class:"text-h6"},Re={class:"text-h6"},rs=me({__name:"GroupsPage",setup(Oe){const i=Ce(),{t:m}=De(),c=ke(),{groups:Q,isLoading:x,fetchGroups:N,createGroup:R,updateGroup:O,deleteGroup:E,fetchGroupMembers:L,addMemberToGroup:W,removeMemberFromGroup:H,membersByGroup:V}=_e(),{friends:P,fetchFriends:J}=$e(),{fetchManagedDummyProfiles:K,suggestDummyProfileAsFriend:X}=Ve(),$=v(!1),k=v(!1),C=v(!1),h=v(null),f=v(null),n=de({name:"",description:""}),w=v(null),g=v(null),Y=U(()=>(P.value||[]).map(e=>({label:e.name||e.username||e.email,value:e.id}))),Z=e=>{const t=P.value.find(a=>a.id===e);return t?t.name||t.username||t.email:e};pe(async()=>{if(c.user?.id){await N(),await J(c.user.id),await ne();for(const e of Q.value)await L(e.id)}});const ee=e=>{h.value=e.id,n.name=e.name,n.description=e.description||"",$.value=!0},se=e=>{i.dialog({title:m("groups.confirmDelete.title"),message:m("groups.confirmDelete.message",{name:e.name}),cancel:!0,persistent:!0}).onOk(()=>{(async()=>{const t=await E(e.id);t.error?i.notify({type:"negative",message:t.error.message}):i.notify({type:"positive",message:m("groups.messages.deleted")})})()})},te=async()=>{if(c.user?.id){if(!n.name.trim()){i.notify({type:"warning",message:m("groups.validation.nameRequired")});return}if(h.value){const e=await O(h.value,{name:n.name.trim(),description:n.description||null});e.error?i.notify({type:"negative",message:e.error.message}):i.notify({type:"positive",message:m("groups.messages.updated")})}else{const e=await R({name:n.name.trim(),description:n.description||""},c.user.id);e.error?i.notify({type:"negative",message:e.error.message}):i.notify({type:"positive",message:m("groups.messages.created")})}n.name="",n.description="",h.value=null,$.value=!1}},ae=e=>{f.value=e,w.value=null,k.value=!0},le=async()=>{if(!f.value||!w.value)return;const e=await W(f.value.id,w.value);e.error?i.notify({type:"negative",message:e.error.message}):i.notify({type:"positive",message:m("groups.messages.memberAdded")}),k.value=!1},oe=async(e,t)=>{const a=await H(e,t);a.error?i.notify({type:"negative",message:a.error.message}):i.notify({type:"positive",message:m("groups.messages.memberRemoved")})},A=v([]),ie=U(()=>A.value),ne=async()=>{if(!c.user?.id)return;const e=await K(c.user.id);e.data&&(A.value=e.data.map(t=>({id:t.id,label:t.name||t.username||t.email})))},re=e=>{f.value=e,g.value=null,C.value=!0},ue=async()=>{if(!c.user?.id||!f.value||!g.value)return;const e=V.value[f.value.id]||[];let t=0;for(const a of e){if(a.user_id===g.value)continue;const{error:d}=await X(g.value,a.user_id,c.user.id);d||t++}i.notify({type:"positive",message:m("groups.messages.invitationsSent",{count:t})}),C.value=!1};return(e,t)=>(p(),F(we,{class:"q-pa-md"},{default:l(()=>[o("div",Qe,[o("div",Ge,r(e.$t("groups.title")),1),s(u,{color:"primary",icon:"add",label:e.$t("groups.newGroup"),onClick:t[0]||(t[0]=a=>$.value=!0)},null,8,["label"])]),_(x)?(p(),y("div",qe,[s(ce,{size:"lg"})])):_(Q).length===0?(p(),y("div",Me,[s(fe,{name:"groups",size:"4rem",class:"text-grey-6"}),o("div",Se,r(e.$t("groups.emptyTitle")),1),o("div",Pe,r(e.$t("groups.emptyDescription")),1)])):(p(),y("div",Ae,[(p(!0),y(B,null,I(_(Q),a=>(p(),F(D,{key:a.id},{default:l(()=>[s(be,null,{default:l(()=>[s(T,null,{default:l(()=>[o("div",Ue,r(a.name),1),o("div",Fe,r(a.description),1)]),_:2},1024),s(T,{side:""},{default:l(()=>[o("div",Be,[s(u,{flat:"",round:"",icon:"edit",onClick:d=>ee(a)},null,8,["onClick"]),s(u,{flat:"",round:"",icon:"delete",color:"negative",onClick:d=>se(a)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024),s(ve),s(b,null,{default:l(()=>[o("div",Ie,[o("div",ze,r(e.$t("groups.members")),1),o("div",null,[s(u,{size:"sm",flat:"",icon:"group_add",label:e.$t("groups.shareDummyProfile"),class:"q-mr-sm",onClick:d=>re(a)},null,8,["label","onClick"]),s(u,{size:"sm",flat:"",icon:"person_add",label:e.$t("common.add"),onClick:d=>ae(a)},null,8,["label","onClick"])])]),o("div",Te,[(p(!0),y(B,null,I(_(V)[a.id]||[],d=>(p(),y("div",{key:d.id,class:"col-auto"},[s(he,{removable:"",onRemove:Ee=>oe(a.id,d.user_id)},{default:l(()=>[ye(r(Z(d.user_id)),1)]),_:2},1032,["onRemove"])]))),128)),_(V)[a.id]&&_(V)[a.id].length>0?ge("",!0):(p(),y("div",je,r(e.$t("groups.noMembers")),1))])]),_:2},1024)]),_:2},1024))),128))])),s(M,{modelValue:$.value,"onUpdate:modelValue":t[3]||(t[3]=a=>$.value=a)},{default:l(()=>[s(D,{style:{"max-width":"500px",width:"100%"}},{default:l(()=>[s(b,null,{default:l(()=>[o("div",xe,r(h.value?e.$t("groups.editGroup"):e.$t("groups.newGroup")),1)]),_:1}),s(b,{class:"q-gutter-md"},{default:l(()=>[s(z,{modelValue:n.name,"onUpdate:modelValue":t[1]||(t[1]=a=>n.name=a),label:e.$t("groups.form.name"),outlined:""},null,8,["modelValue","label"]),s(z,{modelValue:n.description,"onUpdate:modelValue":t[2]||(t[2]=a=>n.description=a),label:e.$t("groups.form.description"),type:"textarea",outlined:""},null,8,["modelValue","label"])]),_:1}),s(G,{align:"right"},{default:l(()=>[q(s(u,{flat:"",label:e.$t("common.cancel")},null,8,["label"]),[[S]]),s(u,{color:"primary",label:h.value?e.$t("common.save"):e.$t("common.create"),onClick:te},null,8,["label"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(M,{modelValue:k.value,"onUpdate:modelValue":t[5]||(t[5]=a=>k.value=a)},{default:l(()=>[s(D,{style:{"max-width":"520px",width:"100%"}},{default:l(()=>[s(b,null,{default:l(()=>[o("div",Ne,r(e.$t("groups.addMemberTitle",{name:f.value?.name||""})),1)]),_:1}),s(b,null,{default:l(()=>[s(j,{modelValue:w.value,"onUpdate:modelValue":t[4]||(t[4]=a=>w.value=a),options:Y.value,label:e.$t("groups.selectFriend"),outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options","label"])]),_:1}),s(G,{align:"right"},{default:l(()=>[q(s(u,{flat:"",label:e.$t("common.close")},null,8,["label"]),[[S]]),s(u,{color:"primary",label:e.$t("common.add"),disable:!w.value,onClick:le},null,8,["label","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(M,{modelValue:C.value,"onUpdate:modelValue":t[7]||(t[7]=a=>C.value=a)},{default:l(()=>[s(D,{style:{"max-width":"520px",width:"100%"}},{default:l(()=>[s(b,null,{default:l(()=>[o("div",Re,r(e.$t("groups.shareDummyWithGroupTitle",{name:f.value?.name||""})),1)]),_:1}),s(b,null,{default:l(()=>[s(j,{modelValue:g.value,"onUpdate:modelValue":t[6]||(t[6]=a=>g.value=a),options:ie.value,"option-value":"id","option-label":"label",label:e.$t("groups.selectDummyProfile"),outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options","label"])]),_:1}),s(G,{align:"right"},{default:l(()=>[q(s(u,{flat:"",label:e.$t("common.close")},null,8,["label"]),[[S]]),s(u,{color:"primary",label:e.$t("groups.share"),disable:!g.value,onClick:ue},null,8,["label","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{rs as default};
