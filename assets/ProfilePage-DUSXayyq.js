import{r as q,a as W,v as ue,m as X,n as D,o as b,Q as S,w as s,e as a,an as Q,f as V,g as m,t as f,h as R,aw as T,i as P,l as L,j as w,k as U,c as E,ar as me,as as de,p as fe,au as G,aH as ye,aI as ce,ak as J,b as ve,ao as pe}from"./index-Cgi22ZXB.js";import{Q as O}from"./QForm--rsgV37K.js";import{Q as ge}from"./QPage-C23yyevt.js";import{u as Z}from"./use-quasar-CRT8qMdc.js";import{u as x}from"./auth-store-D7lhpq4w.js";import{N as be}from"./NotificationSettings-ByB_HSe5.js";import{Q as _e}from"./QBtnGroup-AuZvELtc.js";import{Q as he,a as Pe,b as K}from"./QItem-DIRnRELz.js";import{Q as $e}from"./QSelect-XdDFBFtJ.js";import{supabase as k}from"./supabase-BZhxi8Vt.js";import{u as Ve}from"./useFriends-BhmZQtkA.js";import{u as ee}from"./vue-i18n.runtime-CXYvB8K5.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QChip-B7g3bgBw.js";import"./usePushNotifications-BnQjUKiS.js";import"./format-BFG-1q1l.js";import"./selection-DbH6C6dD.js";import"./rtl-DFPa-2ov.js";const ke=()=>{const $=q(!1),_=async(c,n)=>{$.value=!0;try{const i=n.email||`dummy-${crypto.randomUUID().slice(0,8)}@dummy.local`,{data:d,error:r}=await k.from("profiles").insert({id:crypto.randomUUID(),email:i,name:n.name,surname:n.surname||null,username:n.username||null,date_of_birth:n.date_of_birth||null,birth_year_visible:n.birth_year_visible??!1,is_dummy:!0}).select().single();if(r||!d)throw r||new Error("Failed to create dummy profile");const{error:u}=await k.from("dummy_profile_managers").insert({dummy_profile_id:d.id,manager_user_id:c});if(u)throw await k.from("profiles").delete().eq("id",d.id),u;const{error:p}=await k.from("friendships").insert({user_id:c,friend_id:d.id,status:"accepted"});if(p)throw await k.from("profiles").delete().eq("id",d.id),p;return{data:d,error:null}}catch(i){return console.error("Error creating dummy profile:",i),{data:null,error:i}}finally{$.value=!1}},v=async c=>{$.value=!0;try{const{data:n,error:i}=await k.from("dummy_profile_managers").select(`
          *,
          profiles!dummy_profile_managers_dummy_profile_id_fkey (*)
        `).eq("manager_user_id",c);if(i)throw i;return{data:n?.map(r=>r.profiles).filter(Boolean)||[],error:null}}catch(n){return console.error("Error fetching managed dummy profiles:",n),{data:null,error:n}}finally{$.value=!1}},y=async(c,n)=>{$.value=!0;try{const{data:i,error:d}=await k.from("profiles").update(n).eq("id",c).eq("is_dummy",!0).select().single();if(d)throw d;return{data:i,error:null}}catch(i){return console.error("Error updating dummy profile:",i),{data:null,error:i}}finally{$.value=!1}},o=async(c,n)=>{$.value=!0;try{const{data:i}=await k.from("dummy_profile_managers").select("id").eq("dummy_profile_id",c).eq("manager_user_id",n).single();if(!i)throw new Error("You do not have permission to delete this dummy profile");const{error:d}=await k.from("profiles").delete().eq("id",c).eq("is_dummy",!0);if(d)throw d;return{error:null}}catch(i){return console.error("Error deleting dummy profile:",i),{error:i}}finally{$.value=!1}},C=async(c,n)=>{try{const{data:i}=await k.from("dummy_profile_managers").select("id").eq("dummy_profile_id",c).eq("manager_user_id",n).single();return!!i}catch{return!1}};return{isLoading:$,createDummyProfile:_,fetchManagedDummyProfiles:v,updateDummyProfile:y,deleteDummyProfile:o,canManageDummyProfile:C,suggestDummyProfileAsFriend:async(c,n,i)=>{$.value=!0;try{if(!await C(c,i))throw new Error("You do not have permission to suggest this dummy profile");const{data:r,error:u}=await k.from("friendships").insert({user_id:c,friend_id:n,status:"pending"}).select().single();if(u)throw u;return{data:r,error:null}}catch(d){return console.error("Error suggesting dummy profile as friend:",d),{data:null,error:d}}finally{$.value=!1}}}},qe={class:"text-h6 q-mb-md"},Ue={class:"text-body2 text-grey-7"},De={class:"text-subtitle1 q-mb-md"},Ce={class:"row q-gutter-sm"},Qe={class:"text-subtitle1 q-mb-md"},Ee={class:"q-gutter-md"},Fe={class:"col"},Se={class:"text-subtitle2"},Be={key:0,class:"text-caption text-grey-7"},Ne={key:1,class:"text-caption text-grey-7"},Ae={key:2,class:"text-caption text-grey-7"},Me={class:"col-auto"},Ie={class:"text-center text-grey-7 q-py-lg"},ze={class:"text-h6"},Le={class:"row q-gutter-sm justify-end"},Oe={class:"text-h6"},je={class:"row q-gutter-sm justify-end q-mt-md"},Ye=W({__name:"DummyProfileManager",setup($){const _=Z(),{t:v}=ee(),y=x(),o=ue(()=>y.user),{isLoading:C,createDummyProfile:N,fetchManagedDummyProfiles:c,updateDummyProfile:n,deleteDummyProfile:i,suggestDummyProfileAsFriend:d}=ke(),{fetchEligibleUsersForDummySuggestion:r}=Ve(),u=q(!1),p=q(!1),B=q(!1),A=q([]),g=q(null),M=q(null),j=q([]),F=q(null),z=q(!1),h=q({name:"",surname:"",username:"",email:"",date_of_birth:"",birth_year_visible:!1}),le=()=>{h.value={name:"",surname:"",username:"",email:"",date_of_birth:"",birth_year_visible:!1}},Y=l=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l),ae=l=>new Date(l).toLocaleDateString(),I=async()=>{if(!o.value?.id)return;const{data:l}=await c(o.value.id);l&&(A.value=l)},te=async()=>{if(!o.value?.id)return;const{data:l,error:t}=await N(o.value.id,h.value);if(t){_.notify({color:"negative",message:v("dummyProfiles.errors.createFailed"),icon:"error"});return}l&&(_.notify({color:"positive",message:v("dummyProfiles.messages.created"),icon:"check"}),le(),u.value=!1,await I())},re=l=>{g.value={...l},p.value=!0},oe=async()=>{if(!g.value)return;const{data:l,error:t}=await n(g.value.id,g.value);if(t){_.notify({color:"negative",message:v("dummyProfiles.errors.updateFailed"),icon:"error"});return}l&&(_.notify({color:"positive",message:v("dummyProfiles.messages.updated"),icon:"check"}),p.value=!1,await I())},se=l=>{_.dialog({title:v("dummyProfiles.confirmDelete.title"),message:v("dummyProfiles.confirmDelete.message",{name:l.name}),cancel:!0,persistent:!0}).onOk(()=>{(async()=>{if(!o.value?.id)return;const{error:t}=await i(l.id,o.value.id);if(t){_.notify({color:"negative",message:v("dummyProfiles.errors.deleteFailed"),icon:"error"});return}_.notify({color:"positive",message:v("dummyProfiles.messages.deleted"),icon:"check"}),await I()})()})},ie=async l=>{if(M.value=l,z.value=!0,B.value=!0,o.value?.id){const{data:t}=await r(l.id,o.value.id);t&&(j.value=t)}z.value=!1},ne=async()=>{if(!o.value?.id||!M.value||!F.value)return;const{error:l}=await d(M.value.id,F.value,o.value.id);if(l){_.notify({color:"negative",message:v("dummyProfiles.errors.suggestionFailed"),icon:"error"});return}_.notify({color:"positive",message:v("dummyProfiles.messages.suggested"),icon:"check"}),B.value=!1,F.value=null,M.value=null};return X(()=>{I()}),(l,t)=>(b(),D(S,{class:"dummy-profile-manager"},{default:s(()=>[a(V,null,{default:s(()=>[m("div",qe,f(l.$t("dummyProfiles.title")),1),m("p",Ue,f(l.$t("dummyProfiles.description")),1)]),_:1}),a(R),u.value?(b(),D(V,{key:0},{default:s(()=>[m("div",De,f(l.$t("dummyProfiles.createNew")),1),a(O,{onSubmit:T(te,["prevent"]),class:"q-gutter-md"},{default:s(()=>[a(P,{modelValue:h.value.name,"onUpdate:modelValue":t[0]||(t[0]=e=>h.value.name=e),label:l.$t("dummyProfiles.form.name"),filled:"",rules:[e=>!!e||l.$t("validation.required")],required:""},null,8,["modelValue","label","rules"]),a(P,{modelValue:h.value.surname,"onUpdate:modelValue":t[1]||(t[1]=e=>h.value.surname=e),label:l.$t("dummyProfiles.form.surname"),filled:""},null,8,["modelValue","label"]),a(P,{modelValue:h.value.username,"onUpdate:modelValue":t[2]||(t[2]=e=>h.value.username=e),label:l.$t("dummyProfiles.form.username"),filled:"",hint:l.$t("dummyProfiles.form.usernameHint")},null,8,["modelValue","label","hint"]),a(P,{modelValue:h.value.email,"onUpdate:modelValue":t[3]||(t[3]=e=>h.value.email=e),label:l.$t("dummyProfiles.form.email"),type:"email",filled:"",hint:l.$t("dummyProfiles.form.emailHint"),rules:[e=>!e||Y(e)||l.$t("validation.invalidEmail")]},null,8,["modelValue","label","hint","rules"]),a(P,{modelValue:h.value.date_of_birth,"onUpdate:modelValue":t[4]||(t[4]=e=>h.value.date_of_birth=e),label:l.$t("dummyProfiles.form.dateOfBirth"),type:"date",filled:""},null,8,["modelValue","label"]),a(L,{modelValue:h.value.birth_year_visible,"onUpdate:modelValue":t[5]||(t[5]=e=>h.value.birth_year_visible=e),label:l.$t("dummyProfiles.form.birthYearVisible")},null,8,["modelValue","label"]),m("div",Ce,[a(w,{type:"submit",color:"primary",label:l.$t("common.create"),loading:U(C)},null,8,["label","loading"]),a(w,{flat:"",label:l.$t("common.cancel"),onClick:t[6]||(t[6]=e=>u.value=!1)},null,8,["label"])])]),_:1})]),_:1})):(b(),D(V,{key:1},{default:s(()=>[a(w,{color:"primary",label:l.$t("dummyProfiles.createNew"),icon:"add",onClick:t[7]||(t[7]=e=>u.value=!0)},null,8,["label"])]),_:1})),A.value.length>0?(b(),D(R,{key:2})):Q("",!0),A.value.length>0?(b(),D(V,{key:3},{default:s(()=>[m("div",Qe,f(l.$t("dummyProfiles.yourProfiles")),1),m("div",Ee,[(b(!0),E(de,null,me(A.value,e=>(b(),D(S,{key:e.id,flat:"",bordered:"",class:"dummy-profile-item"},{default:s(()=>[a(V,{class:"row items-center"},{default:s(()=>[m("div",Fe,[m("div",Se,f(e.name)+" "+f(e.surname),1),e.username?(b(),E("div",Be," @"+f(e.username),1)):Q("",!0),e.email&&!e.email.includes("@dummy.local")?(b(),E("div",Ne,f(e.email),1)):Q("",!0),e.date_of_birth?(b(),E("div",Ae,f(ae(e.date_of_birth)),1)):Q("",!0)]),m("div",Me,[a(_e,{flat:""},{default:s(()=>[a(w,{flat:"",icon:"edit",size:"sm",title:l.$t("common.edit"),onClick:H=>re(e)},null,8,["title","onClick"]),a(w,{flat:"",icon:"share",size:"sm",title:l.$t("dummyProfiles.suggestAsFriend"),onClick:H=>ie(e)},null,8,["title","onClick"]),a(w,{flat:"",icon:"delete",size:"sm",color:"negative",title:l.$t("common.delete"),onClick:H=>se(e)},null,8,["title","onClick"])]),_:2},1024)])]),_:2},1024)]),_:2},1024))),128))])]),_:1})):u.value?Q("",!0):(b(),D(V,{key:4},{default:s(()=>[m("div",Ie,[a(fe,{name:"person_add_disabled",size:"3rem",class:"q-mb-md"}),m("div",null,f(l.$t("dummyProfiles.noProfiles")),1)])]),_:1})),a(G,{modelValue:p.value,"onUpdate:modelValue":t[15]||(t[15]=e=>p.value=e),persistent:""},{default:s(()=>[a(S,{style:{width:"400px"}},{default:s(()=>[a(V,null,{default:s(()=>[m("div",ze,f(l.$t("dummyProfiles.editProfile")),1)]),_:1}),g.value?(b(),D(V,{key:0},{default:s(()=>[a(O,{onSubmit:T(oe,["prevent"]),class:"q-gutter-md"},{default:s(()=>[a(P,{modelValue:g.value.name,"onUpdate:modelValue":t[8]||(t[8]=e=>g.value.name=e),label:l.$t("dummyProfiles.form.name"),filled:"",rules:[e=>!!e||l.$t("validation.required")],required:""},null,8,["modelValue","label","rules"]),a(P,{modelValue:g.value.surname,"onUpdate:modelValue":t[9]||(t[9]=e=>g.value.surname=e),label:l.$t("dummyProfiles.form.surname"),filled:""},null,8,["modelValue","label"]),a(P,{modelValue:g.value.username,"onUpdate:modelValue":t[10]||(t[10]=e=>g.value.username=e),label:l.$t("dummyProfiles.form.username"),filled:""},null,8,["modelValue","label"]),a(P,{modelValue:g.value.email,"onUpdate:modelValue":t[11]||(t[11]=e=>g.value.email=e),label:l.$t("dummyProfiles.form.email"),type:"email",filled:"",hint:l.$t("dummyProfiles.form.emailHint"),rules:[e=>!e||Y(e)||l.$t("validation.invalidEmail")]},null,8,["modelValue","label","hint","rules"]),a(P,{modelValue:g.value.date_of_birth,"onUpdate:modelValue":t[12]||(t[12]=e=>g.value.date_of_birth=e),label:l.$t("dummyProfiles.form.dateOfBirth"),type:"date",filled:""},null,8,["modelValue","label"]),a(L,{modelValue:g.value.birth_year_visible,"onUpdate:modelValue":t[13]||(t[13]=e=>g.value.birth_year_visible=e),label:l.$t("dummyProfiles.form.birthYearVisible")},null,8,["modelValue","label"]),m("div",Le,[a(w,{flat:"",label:l.$t("common.cancel"),onClick:t[14]||(t[14]=e=>p.value=!1)},null,8,["label"]),a(w,{type:"submit",color:"primary",label:l.$t("common.save"),loading:U(C)},null,8,["label","loading"])])]),_:1})]),_:1})):Q("",!0)]),_:1})]),_:1},8,["modelValue"]),a(G,{modelValue:B.value,"onUpdate:modelValue":t[18]||(t[18]=e=>B.value=e),persistent:""},{default:s(()=>[a(S,{style:{width:"400px"}},{default:s(()=>[a(V,null,{default:s(()=>[m("div",Oe,f(l.$t("dummyProfiles.suggestProfile")),1)]),_:1}),a(V,null,{default:s(()=>[a($e,{modelValue:F.value,"onUpdate:modelValue":t[16]||(t[16]=e=>F.value=e),options:j.value,label:l.$t("dummyProfiles.selectFriend"),"option-label":"name","option-value":"id",filled:"","emit-value":"","map-options":"",loading:z.value},{option:s(e=>[a(he,ye(ce(e.itemProps)),{default:s(()=>[a(Pe,null,{default:s(()=>[a(K,null,{default:s(()=>[J(f(e.opt.name)+" "+f(e.opt.surname),1)]),_:2},1024),a(K,{caption:""},{default:s(()=>[J(f(e.opt.email),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","label","loading"]),m("div",je,[a(w,{flat:"",label:l.$t("common.cancel"),onClick:t[17]||(t[17]=e=>B.value=!1)},null,8,["label"]),a(w,{color:"primary",label:l.$t("dummyProfiles.sendSuggestion"),loading:U(C),disable:!F.value,onClick:ne},null,8,["label","loading","disable"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),He=we(Ye,[["__scopeId","data-v-13d2436e"]]),Re={class:"text-h4 q-mb-md"},Te={class:"row justify-center"},Ge={class:"col-12 col-md-6"},Je=["src"],Ke={key:1},We={class:"text-h5 q-mt-md"},Xe={key:0,class:"text-subtitle1 text-grey-6"},Ze={class:"text-body2 text-grey-7"},xe={class:"row justify-end q-gutter-sm"},el={class:"text-h6 q-mb-md"},ll={class:"q-mt-md"},hl=W({__name:"ProfilePage",setup($){const _=Z(),{t:v}=ee(),y=x(),o=ve({name:"",surname:"",username:"",date_of_birth:"",birth_year_visible:!1}),C=r=>r?r.name&&r.surname?`${r.name} ${r.surname}`:r.username||r.email:"",N=r=>r?r.name&&r.surname?`${r.name.charAt(0)}${r.surname.charAt(0)}`:r.username?r.username.charAt(0).toUpperCase():r.email.charAt(0).toUpperCase():"",c=r=>o.username?!0:!!r||v("profile.validationError"),n=r=>o.name&&o.surname?!0:!!r||v("profile.validationError"),i=()=>{y.profile&&(o.name=y.profile.name||"",o.surname=y.profile.surname||"",o.username=y.profile.username||"",o.date_of_birth=y.profile.date_of_birth||"",o.birth_year_visible=y.profile.birth_year_visible??!1)},d=async()=>{if(!o.username&&(!o.name||!o.surname)){_.notify({type:"negative",message:v("profile.validationError")});return}const r={name:o.name||null,surname:o.surname||null,username:o.username||null,date_of_birth:o.date_of_birth||null,birth_year_visible:o.birth_year_visible};await y.updateProfile(r)?_.notify({type:"positive",message:v("profile.updateSuccess")}):_.notify({type:"negative",message:v("profile.updateError")})};return X(()=>{i()}),(r,u)=>(b(),D(ge,{class:"q-pa-md"},{default:s(()=>[m("div",Re,f(r.$t("profile.title")),1),m("div",Te,[m("div",Ge,[a(S,null,{default:s(()=>[a(V,{class:"text-center"},{default:s(()=>[a(pe,{size:"100px",color:"primary","text-color":"white"},{default:s(()=>[U(y).profile?.avatar_url?(b(),E("img",{key:0,src:U(y).profile.avatar_url},null,8,Je)):(b(),E("span",Ke,f(N(U(y).profile)),1))]),_:1}),m("div",We,f(C(U(y).profile)),1),U(y).profile?.username?(b(),E("div",Xe," @"+f(U(y).profile.username),1)):Q("",!0),m("div",Ze,f(U(y).profile?.email),1)]),_:1}),a(V,null,{default:s(()=>[a(O,{onSubmit:d,class:"q-gutter-md"},{default:s(()=>[a(P,{modelValue:o.name,"onUpdate:modelValue":u[0]||(u[0]=p=>o.name=p),label:r.$t("common.name"),outlined:"",rules:[c]},null,8,["modelValue","label","rules"]),a(P,{modelValue:o.surname,"onUpdate:modelValue":u[1]||(u[1]=p=>o.surname=p),label:r.$t("common.surname"),outlined:"",rules:[c]},null,8,["modelValue","label","rules"]),a(P,{modelValue:o.username,"onUpdate:modelValue":u[2]||(u[2]=p=>o.username=p),label:r.$t("common.username"),outlined:"",rules:[n]},null,8,["modelValue","label","rules"]),a(P,{modelValue:o.date_of_birth,"onUpdate:modelValue":u[3]||(u[3]=p=>o.date_of_birth=p),label:r.$t("profile.dateOfBirth"),type:"date",outlined:""},null,8,["modelValue","label"]),a(L,{modelValue:o.birth_year_visible,"onUpdate:modelValue":u[4]||(u[4]=p=>o.birth_year_visible=p),label:r.$t("profile.showBirthYear")},null,8,["modelValue","label"]),m("div",xe,[a(w,{label:r.$t("common.cancel"),color:"grey",flat:"",onClick:i},null,8,["label"]),a(w,{type:"submit",label:r.$t("common.save"),color:"primary",loading:U(y).isLoading},null,8,["label","loading"])])]),_:1})]),_:1})]),_:1}),a(S,{class:"q-mt-md"},{default:s(()=>[a(V,null,{default:s(()=>[m("div",el,f(r.$t("notifications.title")),1),a(be)]),_:1})]),_:1}),m("div",ll,[a(He)])])])]),_:1}))}});export{hl as default};
