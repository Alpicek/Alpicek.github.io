import{a as v}from"./QSelect-j2j_KoaU.js";import{a as H,r as C,n as U,w as $,z as n,p as d,o as i,Q as J,ah as X,f,e as h,h as c,c as w,aq as o,t as g,k as p,aD as m,g as q,a4 as Y,aE as ee,ar as z,as as D,at as se}from"./index-B3spGy88.js";import{Q as ie}from"./QSlideTransition-AYHpTEYA.js";import{u as te}from"./use-quasar-BAGBkhZd.js";import{u as re}from"./useGroups-Dd1QCz73.js";import{u as oe}from"./vue-i18n.runtime-DwBerXon.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"row items-center justify-between"},ne={class:"text-h6 wish-title"},de={class:"row items-center q-gutter-xs"},ue={key:0,class:"text-body2 text-grey-7 q-mt-xs preview-text"},ce={key:0,class:"row q-gutter-xs q-mb-md items-center"},he={key:1,class:"wish-description q-mb-md"},we={class:"text-body2 text-grey-7"},pe={key:2,class:"wish-url q-mb-md"},me={class:"wish-meta"},ve={class:"text-caption text-grey-6"},fe={key:0},ge=H({__name:"WishCard",props:{wish:{},currentUserId:{},expanded:{type:Boolean},highlight:{type:Boolean},refreshKey:{}},emits:["edit","delete","toggleBought","toggleReceived"],setup(G,{emit:R}){const s=G,A=R,E=te(),{t:u}=oe(),a=C(!1),B=()=>{typeof s.expanded=="boolean"&&(a.value=s.expanded)};U(B),$(()=>s.expanded,()=>B());const I=()=>{a.value=!a.value},S=n(()=>{switch(s.wish.visibility){case"public":return"green";case"friends":return"blue";case"private":return"grey";default:return"grey"}}),W=n(()=>{switch(s.wish.visibility){case"public":return u("wishes.visibilityPublic");case"friends":return x.value?u("wishes.form.visibilityFriendsGroups"):u("wishes.visibilityFriends");case"private":return u("wishes.visibilityPrivate");default:return u("common.unknown")}}),L=n(()=>s.wish.created_by_user_id!==s.wish.created_for_user_id&&s.currentUserId!==s.wish.created_for_user_id),V=()=>{const e=s.wish.created_by_user;return e.name&&e.surname?`${e.name} ${e.surname}`:e.name?e.name:e.username?e.username:u("common.unknown")},F=n(()=>s.currentUserId===s.wish.created_by_user_id),M=n(()=>s.currentUserId===s.wish.created_by_user_id),P=n(()=>s.currentUserId!==s.wish.created_for_user_id&&s.currentUserId!==void 0),T=n(()=>s.currentUserId===s.wish.created_for_user_id&&s.currentUserId!==void 0),N=n(()=>s.currentUserId===s.wish.created_by_user_id),{groups:y,fetchGroups:K,fetchWishRules:j}=re(),b=C([]),_=C([]),x=n(()=>b.value.length>0||_.value.length>0),Q=e=>{const r=y.value||[];return e.map(t=>r.find(l=>l.id===t)?.name).filter(t=>!!t)},k=async()=>{if(!N.value||s.wish.visibility!=="friends")return;(!y.value||y.value.length===0)&&await K();const e=await j(s.wish.id);if(!e.error&&e.data){const r=e.data.filter(l=>l.rule_type==="include").map(l=>l.group_id),t=e.data.filter(l=>l.rule_type==="exclude").map(l=>l.group_id);b.value=Q(r),_.value=Q(t)}};$(()=>a.value,e=>{e&&k()}),$(()=>s.refreshKey,()=>{a.value&&k()}),U(()=>{a.value&&k()});const O=e=>new Date(e).toLocaleDateString("cs-CZ"),Z=()=>{E.dialog({title:u("wishes.deleteWish"),message:u("wishes.deleteConfirm"),cancel:!0,persistent:!0}).onOk(()=>{A("delete",s.wish.id)})};return(e,r)=>(i(),d(J,{class:X(["wish-card self-start",{"wish-highlight":e.highlight}]),onClick:I},{default:f(()=>[h(q,{class:"wish-card-header"},{default:f(()=>[c("div",le,[c("div",ne,g(e.wish.name),1),c("div",de,[e.wish.is_bought?(i(),d(v,{key:0,color:"green","text-color":"white",label:e.$t("wishes.bought"),size:"sm"},null,8,["label"])):o("",!0),e.wish.is_received?(i(),d(v,{key:1,color:"purple","text-color":"white",label:e.$t("wishes.received"),size:"sm"},null,8,["label"])):o("",!0),h(p,{flat:"",round:"",dense:"",icon:a.value?"expand_less":"expand_more",onClick:m(I,["stop"])},null,8,["icon"])])]),!a.value&&e.wish.description?(i(),w("div",ue,g(e.wish.description),1)):o("",!0)]),_:1}),h(ie,null,{default:f(()=>[Y(c("div",null,[h(q,{class:"wish-card-details"},{default:f(()=>[N.value?(i(),w("div",ce,[h(v,{color:S.value,"text-color":"white",label:W.value,size:"sm"},null,8,["color","label"]),(i(!0),w(z,null,D(b.value,t=>(i(),d(v,{key:`inc-${t}`,color:"green","text-color":"white",label:t,size:"sm"},null,8,["label"]))),128)),(i(!0),w(z,null,D(_.value,t=>(i(),d(v,{key:`exc-${t}`,color:"red","text-color":"white",label:t,size:"sm"},null,8,["label"]))),128))])):o("",!0),e.wish.description?(i(),w("div",he,[c("div",we,g(e.wish.description),1)])):o("",!0),e.wish.url?(i(),w("div",pe,[h(p,{flat:"",color:"primary",href:e.wish.url,target:"_blank",icon:"open_in_new",label:e.$t("wishes.openLink"),size:"sm",onClick:r[0]||(r[0]=m(()=>{},["stop"]))},null,8,["href","label"])])):o("",!0),c("div",me,[c("div",ve,[L.value?(i(),w("div",fe,g(e.$t("wishes.createdBy",{name:V()})),1)):o("",!0),c("div",null,g(e.wish.created_at?O(e.wish.created_at):"N/A"),1)])])]),_:1}),h(se,{align:"right"},{default:f(()=>[P.value?(i(),d(p,{key:0,color:e.wish.is_bought?"grey":"green",icon:e.wish.is_bought?"shopping_cart":"add_shopping_cart",label:e.wish.is_bought?e.$t("wishes.markAsNotBought"):e.$t("wishes.markAsBought"),flat:"",onClick:r[1]||(r[1]=m(t=>e.$emit("toggleBought",e.wish.id),["stop"]))},null,8,["color","icon","label"])):o("",!0),T.value?(i(),d(p,{key:1,color:e.wish.is_received?"orange":"purple",icon:e.wish.is_received?"undo":"check_circle",label:e.wish.is_received?e.$t("wishes.markAsNotReceived"):e.$t("wishes.markAsReceived"),flat:"",onClick:r[2]||(r[2]=m(t=>e.$emit("toggleReceived",e.wish.id),["stop"]))},null,8,["color","icon","label"])):o("",!0),F.value?(i(),d(p,{key:2,color:"primary",icon:"edit",flat:"",onClick:r[3]||(r[3]=m(t=>e.$emit("edit",e.wish),["stop"]))})):o("",!0),M.value?(i(),d(p,{key:3,color:"negative",icon:"delete",flat:"",onClick:m(Z,["stop"])})):o("",!0)]),_:1})],512),[[ee,a.value]])]),_:1})]),_:1},8,["class"]))}}),Ie=ae(ge,[["__scopeId","data-v-e318d0d5"]]);export{Ie as W};
