import{a as B,u as pe,i as q,o,w as i,e as s,f as p,a5 as j,c as l,t as u,_ as k,j as w,Q as v,m as ve,a1 as se,a4 as V,r as S,h as Y,x as he,C as ye,g as N,k as G,a3 as O,ah as ge,ai as _e}from"./index-DM363yaO.js";import{a as X,Q as $e,c as ee,b as be}from"./QTabPanels-DShpLrHq.js";import{Q as qe}from"./QSeparator-BxjC-NF0.js";import{Q as J,a as z}from"./QCard-vJ8fZqiR.js";import{Q as ke}from"./QInput-D6XrDz3-.js";import{Q as we,a as L,b as te}from"./QItem-HAHwVsGI.js";import{Q as Ce}from"./QList-CFlL7NXt.js";import{Q as M}from"./QCardActions-D3Hvl6Tx.js";import{Q as Qe}from"./QDialog-BKqXAyYc.js";import{Q as Fe}from"./QPage-D5DqF_QK.js";import{u as ae}from"./use-quasar-cnwfguXq.js";import{u as Re}from"./auth-store-C56jhR5j.js";import{u as xe}from"./useFriends-Cd47dJ8i.js";import{u as re}from"./vue-i18n.runtime-BS_NomSs.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./focus-manager-BdHhWq0K.js";import"./selection-CIfLAzmT.js";import"./use-dark-BRxLMK56.js";import"./use-prevent-scroll-C0iKrCcR.js";import"./supabase-DdGcxtya.js";const Ae=["src"],De={key:1},Se={class:"text-h6 q-mt-md friend-name"},Ve={class:"friend-username"},Ie={key:0,class:"text-subtitle2 text-grey-6"},Pe={key:1,class:"text-subtitle2 text-transparent"},Ne={class:"friend-birthdate"},ze={key:0,class:"text-body2 text-grey-7"},Ee={key:1,class:"text-body2 text-transparent"},Te=B({__name:"FriendCard",props:{friend:{},friendshipId:{}},emits:["remove"],setup(I,{emit:m}){const c=I,d=m,y=ae(),C=pe(),{t:r}=re(),f=n=>n.name&&n.surname?`${n.name} ${n.surname}`:n.username||n.email,g=n=>n.name&&n.surname?`${n.name.charAt(0)}${n.surname.charAt(0)}`:n.username?n.username.charAt(0).toUpperCase():n.email.charAt(0).toUpperCase(),_=(n,$)=>{const Q=new Date(n),F=Q.getDate(),R=Q.getMonth()+1,T=Q.getFullYear();return $?`${F}. ${R}. ${T}`:`${F}. ${R}.`},h=()=>{C.push(`/wishes/${c.friend.id}`)},E=()=>{y.dialog({title:r("friends.removeFriend"),message:`Opravdu chcete odebrat ${f(c.friend)} z přátel?`,cancel:!0,persistent:!0}).onOk(()=>{d("remove",c.friendshipId)})};return(n,$)=>(o(),q(J,{class:"friend-card",style:{width:"100%","max-width":"300px",height:"280px"}},{default:i(()=>[s(z,{class:"text-center friend-card-content"},{default:i(()=>[s(j,{size:"80px",color:"primary","text-color":"white"},{default:i(()=>[n.friend.avatar_url?(o(),l("img",{key:0,src:n.friend.avatar_url},null,8,Ae)):(o(),l("span",De,u(g(n.friend)),1))]),_:1}),p("div",Se,u(f(n.friend)),1),p("div",Ve,[n.friend.username?(o(),l("div",Ie,"@"+u(n.friend.username),1)):(o(),l("div",Pe,"@placeholder"))]),p("div",Ne,[n.friend.date_of_birth?(o(),l("div",ze,[s(w,{name:"cake",size:"16px",class:"q-mr-xs"}),k(" "+u(_(n.friend.date_of_birth,n.friend.birth_year_visible)),1)])):(o(),l("div",Ee,[s(w,{name:"cake",size:"16px",class:"q-mr-xs"}),$[0]||($[0]=k(" placeholder date "))]))])]),_:1}),s(M,{align:"center",class:"friend-card-actions"},{default:i(()=>[s(v,{color:"primary",flat:"",icon:"card_giftcard",label:n.$t("wishes.viewWishes"),onClick:h},null,8,["label"]),s(v,{color:"negative",flat:"",icon:"person_remove",onClick:E})]),_:1})]),_:1}))}}),Ue=ne(Te,[["__scopeId","data-v-6b747e33"]]),Oe=["src"],Le={key:1},Be={class:"text-h6 q-mt-md"},je={key:0,class:"text-subtitle2 text-grey-6"},Je={class:"text-body2 text-grey-7 q-mt-sm"},Me={class:"text-caption text-grey-6 q-mt-xs"},Ke=B({__name:"PendingRequestCard",props:{request:{}},emits:["accept","decline","cancel"],setup(I){const m=I,c=ve(()=>m.request.type==="incoming"?m.request.user:m.request.friend),d=r=>r.name&&r.surname?`${r.name} ${r.surname}`:r.username||r.email,y=r=>r.name&&r.surname?`${r.name.charAt(0)}${r.surname.charAt(0)}`:r.username?r.username.charAt(0).toUpperCase():r.email.charAt(0).toUpperCase(),C=r=>{const f=new Date(r),_=Math.abs(new Date().getTime()-f.getTime()),h=Math.ceil(_/(1e3*60*60*24));return h===1?"Dnes":h===2?"Včera":h<7?`Před ${h} dny`:f.toLocaleDateString("cs-CZ")};return(r,f)=>(o(),q(J,{class:"pending-card",style:{width:"100%","max-width":"300px"}},{default:i(()=>[s(z,{class:"text-center"},{default:i(()=>[s(j,{size:"60px",color:"primary","text-color":"white"},{default:i(()=>[c.value.avatar_url?(o(),l("img",{key:0,src:c.value.avatar_url},null,8,Oe)):(o(),l("span",Le,u(y(c.value)),1))]),_:1}),p("div",Be,u(d(c.value)),1),c.value.username?(o(),l("div",je," @"+u(c.value.username),1)):se("",!0),p("div",Je,[s(w,{name:"schedule",size:"16px",class:"q-mr-xs"}),k(" "+u(C(r.request.created_at)),1)]),p("div",Me,u(r.request.type==="incoming"?"Požadavek od uživatele":"Odeslaný požadavek"),1)]),_:1}),s(M,{align:"center"},{default:i(()=>[r.request.type==="incoming"?(o(),l(V,{key:0},[s(v,{color:"positive",flat:"",icon:"check",label:"Přijmout",onClick:f[0]||(f[0]=g=>r.$emit("accept",r.request.id))}),s(v,{color:"negative",flat:"",icon:"close",label:"Odmítnout",onClick:f[1]||(f[1]=g=>r.$emit("decline",r.request.id))})],64)):(o(),l(V,{key:1},[s(v,{color:"grey",flat:"",icon:"schedule",label:"Čeká na odpověď",disabled:""}),s(v,{color:"negative",flat:"",icon:"close",label:"Zrušit",onClick:f[2]||(f[2]=g=>r.$emit("cancel",r.request.id))})],64))]),_:1})]),_:1}))}}),We=ne(Ke,[["__scopeId","data-v-41718614"]]),Ze={class:"row justify-between items-center q-mb-md"},He={class:"text-h4"},Ye={key:0,class:"flex justify-center"},Ge={key:1,class:"text-center text-grey-6 q-py-lg"},Xe={class:"text-h6 q-mt-md"},et={key:2,class:"row q-gutter-md"},tt={key:0,class:"flex justify-center"},st={key:1,class:"text-center text-grey-6 q-py-lg"},at={class:"text-h6 q-mt-md"},rt={key:2,class:"row q-gutter-md"},nt={class:"text-h6"},it={key:0,class:"q-mt-md"},ot={class:"text-subtitle2 q-mb-sm"},Rt=B({__name:"FriendsPage",setup(I){const m=ae(),{t:c}=re(),d=Re(),{friends:y,friendships:C,isLoading:r,sendFriendRequest:f,acceptFriendRequest:g,declineFriendRequest:_,fetchFriends:h,fetchPendingRequests:E,searchUsers:n,removeFriend:$,resetLoadingState:Q,subscribeToFriendships:F,subscribeToPendingRequests:R,unsubscribeFromFriendships:T}=xe(),P=S("friends"),x=S(!1),b=S(""),A=S([]),D=S([]),ie=e=>e.name&&e.surname?`${e.name} ${e.surname}`:e.username||e.email,oe=e=>e.name&&e.surname?`${e.name.charAt(0)}${e.surname.charAt(0)}`:e.username?e.username.charAt(0).toUpperCase():e.email.charAt(0).toUpperCase(),K=()=>{b.value="",A.value=[]},de=e=>d.user&&C.value.find(a=>a.user_id===d.user.id&&a.friend_id===e||a.friend_id===d.user.id&&a.user_id===e)?.id||"",U=async()=>{if(b.value.trim().length<2){A.value=[];return}const e=await n(b.value);if(e.data){const t=y.value.map(a=>a.id);A.value=e.data.filter(a=>a.id!==d.user?.id&&!t.includes(a.id))}},W=async e=>{if(!d.user)return;const t=await f(e,d.user.id);t.error?m.notify({type:"negative",message:c("friends.sendRequestError")+": "+(t.error instanceof Error?t.error.message:JSON.stringify(t.error))}):(m.notify({type:"positive",message:c("friends.sendRequestSuccess")}),x.value=!1,K())},le=async e=>{if(!d.user)return;const t=await g(e,d.user.id);t.error?m.notify({type:"negative",message:c("friends.acceptRequestError")+": "+(t.error instanceof Error?t.error.message:JSON.stringify(t.error))}):m.notify({type:"positive",message:c("friends.acceptRequestSuccess")})},ue=async e=>{const t=await _(e);t.error?m.notify({type:"negative",message:c("friends.declineRequestError")+": "+(t.error instanceof Error?t.error.message:JSON.stringify(t.error))}):m.notify({type:"positive",message:c("friends.declineRequestSuccess")})},ce=async e=>{const t=await _(e);t.error?m.notify({type:"negative",message:"Chyba při rušení požadavku: "+(t.error instanceof Error?t.error.message:JSON.stringify(t.error))}):m.notify({type:"positive",message:"Požadavek byl zrušen."})},me=async e=>{if(!d.user)return;const t=await $(e,d.user.id);t.error?m.notify({type:"negative",message:"Chyba při odstraňování přítele: "+(t.error instanceof Error?t.error.message:JSON.stringify(t.error))}):m.notify({type:"positive",message:"Přítel odstraněn."})},Z=async()=>{if(!d.user)return;const e=await E(d.user.id);e?.data&&(D.value=e.data)};Y(async()=>{if(d.user){const e=y.value.length>0;await h(d.user.id,e),await Z(),F(d.user.id),R(d.user.id,t=>{D.value=t})}}),he(()=>d.user,async(e,t)=>{e&&t&&e.id!==t.id&&(await h(e.id,!0),await Z(),F(e.id),R(e.id,a=>{D.value=a}))});const H=()=>{!document.hidden&&d.user&&r.value&&Q(d.user.id)};return Y(()=>{document.addEventListener("visibilitychange",H)}),ye(()=>{document.removeEventListener("visibilitychange",H),T()}),(e,t)=>(o(),q(Fe,{class:"q-pa-md"},{default:i(()=>[p("div",Ze,[p("div",He,u(e.$t("friends.title")),1),s(v,{color:"primary",icon:"person_add",label:e.$t("friends.addFriend"),onClick:t[0]||(t[0]=a=>x.value=!0)},null,8,["label"])]),s($e,{modelValue:P.value,"onUpdate:modelValue":t[1]||(t[1]=a=>P.value=a),class:"text-primary q-mb-md"},{default:i(()=>[s(X,{name:"friends",label:e.$t("friends.myFriends")},null,8,["label"]),s(X,{name:"pending",label:e.$t("friends.requests")},null,8,["label"])]),_:1},8,["modelValue"]),s(qe),s(be,{modelValue:P.value,"onUpdate:modelValue":t[2]||(t[2]=a=>P.value=a),animated:""},{default:i(()=>[s(ee,{name:"friends"},{default:i(()=>[N(r)?(o(),l("div",Ye,[s(G,{size:"lg"})])):N(y).length===0?(o(),l("div",Ge,[s(w,{name:"people",size:"4rem"}),p("div",Xe,u(e.$t("friends.noFriends")),1),p("div",null,u(e.$t("friends.addFirstFriend")),1)])):(o(),l("div",et,[(o(!0),l(V,null,O(N(y),a=>(o(),q(Ue,{key:a.id,friend:a,"friendship-id":de(a.id),onRemove:me},null,8,["friend","friendship-id"]))),128))]))]),_:1}),s(ee,{name:"pending"},{default:i(()=>[N(r)?(o(),l("div",tt,[s(G,{size:"lg"})])):D.value.length===0?(o(),l("div",st,[s(w,{name:"inbox",size:"4rem"}),p("div",at,u(e.$t("friends.noRequests")),1),p("div",null,u(e.$t("friends.noRequestsDescription")),1)])):(o(),l("div",rt,[(o(!0),l(V,null,O(D.value,a=>(o(),q(We,{key:a.id,request:a,onAccept:le,onDecline:ue,onCancel:ce},null,8,["request"]))),128))]))]),_:1})]),_:1},8,["modelValue"]),s(Qe,{modelValue:x.value,"onUpdate:modelValue":t[5]||(t[5]=a=>x.value=a),onHide:K},{default:i(()=>[s(J,{style:{width:"100%","max-width":"500px"}},{default:i(()=>[s(z,null,{default:i(()=>[p("div",nt,u(e.$t("friends.addFriend")),1)]),_:1}),s(z,null,{default:i(()=>[s(ke,{modelValue:b.value,"onUpdate:modelValue":t[3]||(t[3]=a=>b.value=a),label:e.$t("friends.searchUsers"),outlined:"",placeholder:e.$t("friends.searchPlaceholder"),onInput:U,onKeyup:ge(U,["enter"])},{prepend:i(()=>[s(w,{name:"search"})]),append:i(()=>[s(v,{flat:"",round:"",icon:"search",onClick:U,disabled:b.value.length<2},null,8,["disabled"])]),_:1},8,["modelValue","label","placeholder"]),A.value.length>0?(o(),l("div",it,[p("div",ot,u(e.$t("friends.searchResults"))+":",1),s(Ce,null,{default:i(()=>[(o(!0),l(V,null,O(A.value,a=>(o(),q(we,{key:a.id,clickable:"",onClick:fe=>W(a.id)},{default:i(()=>[s(L,{avatar:""},{default:i(()=>[s(j,{color:"primary","text-color":"white"},{default:i(()=>[k(u(oe(a)),1)]),_:2},1024)]),_:2},1024),s(L,null,{default:i(()=>[s(te,null,{default:i(()=>[k(u(ie(a)),1)]),_:2},1024),s(te,{caption:""},{default:i(()=>[k(u(a.username||a.email),1)]),_:2},1024)]),_:2},1024),s(L,{side:""},{default:i(()=>[s(v,{color:"primary",flat:"",round:"",icon:"person_add",onClick:_e(fe=>W(a.id),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})])):se("",!0)]),_:1}),s(M,{align:"right"},{default:i(()=>[s(v,{label:e.$t("common.cancel"),color:"grey",flat:"",onClick:t[4]||(t[4]=a=>x.value=!1)},null,8,["label"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{Rt as default};
