import{s as ce,v as N,x as me,af as fe,a as E,u as ve,n as p,o as i,Q as L,w as r,e as a,g as f,as as T,c as d,t as u,an as V,f as P,ak as A,p as x,j as y,ar as Q,ap as X,r as w,m as K,E as ge,J as ye,h as he,k as S,q as Z,aq as I,i as pe,av as _e,au as be,aw as qe}from"./index-DXWY3Ptu.js";import{a as H,Q as $e,c as G,b as ke}from"./QTabPanels-Bn014Wv-.js";import{Q as Ce,a as B,b as W}from"./QItem-BiHcezxk.js";import{Q as we}from"./QList-Dq6IlDDb.js";import{Q as Qe}from"./QPage-DDgFohYD.js";import{u as Fe}from"./use-quasar-DQXJwWie.js";import{u as Re}from"./auth-store-CmGdf3qC.js";import{u as Se}from"./useFriends-pnFJUfhU.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Ae}from"./vue-i18n.runtime-6hTAqrqs.js";import"./touch-MMzWyBgm.js";import"./rtl-DFPa-2ov.js";import"./selection-pUBbCuen.js";import"./supabase-DuJsgVtx.js";const xe=["top","middle","bottom"],Ve=ce({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:l=>xe.includes(l)}},setup(l,{slots:m}){const c=N(()=>l.align!==void 0?{verticalAlign:l.align}:null),o=N(()=>{const g=l.outline===!0&&l.color||l.textColor;return`q-badge flex inline items-center no-wrap q-badge--${l.multiLine===!0?"multi":"single"}-line`+(l.outline===!0?" q-badge--outline":l.color!==void 0?` bg-${l.color}`:"")+(g!==void 0?` text-${g}`:"")+(l.floating===!0?" q-badge--floating":"")+(l.rounded===!0?" q-badge--rounded":"")+(l.transparent===!0?" q-badge--transparent":"")});return()=>me("div",{class:o.value,style:c.value,role:"status","aria-label":l.label},fe(m.default,l.label!==void 0?[l.label]:[]))}}),Pe={class:"row items-center q-gutter-md"},De=["src"],Ie={key:1},Be={class:"friend-info flex-1"},Ne={class:"row items-center q-gutter-sm"},Ee={class:"text-h6 friend-name"},Le={key:0,class:"text-subtitle2 text-grey-6"},Te=E({__name:"FriendCard",props:{friend:{},friendshipId:{}},setup(l){const m=l,c=ve(),o=()=>{c.push(`/friend/${m.friend.id}`)},g=e=>e.name&&e.surname?`${e.name} ${e.surname}`:e.username||e.email,b=e=>e.name&&e.surname?`${e.name.charAt(0)}${e.surname.charAt(0)}`:e.username?e.username.charAt(0).toUpperCase():e.email.charAt(0).toUpperCase();return(e,v)=>(i(),p(L,{class:"friend-card",onClick:o},{default:r(()=>[a(P,{class:"friend-card-content"},{default:r(()=>[f("div",Pe,[a(T,{size:"50px",color:"primary","text-color":"white"},{default:r(()=>[e.friend.avatar_url?(i(),d("img",{key:0,src:e.friend.avatar_url},null,8,De)):(i(),d("span",Ie,u(b(e.friend)),1))]),_:1}),f("div",Be,[f("div",Ne,[f("div",Ee,u(g(e.friend)),1),e.friend.is_dummy?(i(),p(Ve,{key:0,color:"orange",label:e.$t("dummyProfiles.dummy"),rounded:""},null,8,["label"])):V("",!0)]),e.friend.username?(i(),d("div",Le," @"+u(e.friend.username),1)):V("",!0)])])]),_:1})]),_:1}))}}),Ue=Y(Te,[["__scopeId","data-v-0e9a8a1e"]]),ze=["src"],Oe={key:1},je={class:"text-h6 q-mt-md"},Je={key:0,class:"text-subtitle2 text-grey-6"},Me={class:"text-body2 text-grey-7 q-mt-sm"},Ke={class:"text-caption text-grey-6 q-mt-xs"},Ze=E({__name:"PendingRequestCard",props:{request:{}},emits:["accept","decline","cancel"],setup(l){const m=l,c=N(()=>m.request.type==="incoming"?m.request.user:m.request.friend),o=e=>e.name&&e.surname?`${e.name} ${e.surname}`:e.username||e.email,g=e=>e.name&&e.surname?`${e.name.charAt(0)}${e.surname.charAt(0)}`:e.username?e.username.charAt(0).toUpperCase():e.email.charAt(0).toUpperCase(),b=e=>{const v=new Date(e),F=Math.abs(new Date().getTime()-v.getTime()),h=Math.ceil(F/(1e3*60*60*24));return h===1?"Dnes":h===2?"Včera":h<7?`Před ${h} dny`:v.toLocaleDateString("cs-CZ")};return(e,v)=>(i(),p(L,{class:"pending-card",style:{width:"100%","max-width":"300px"}},{default:r(()=>[a(P,{class:"text-center"},{default:r(()=>[a(T,{size:"60px",color:"primary","text-color":"white"},{default:r(()=>[c.value.avatar_url?(i(),d("img",{key:0,src:c.value.avatar_url},null,8,ze)):(i(),d("span",Oe,u(g(c.value)),1))]),_:1}),f("div",je,u(o(c.value)),1),c.value.username?(i(),d("div",Je," @"+u(c.value.username),1)):V("",!0),f("div",Me,[a(x,{name:"schedule",size:"16px",class:"q-mr-xs"}),A(" "+u(e.request.created_at?b(e.request.created_at):"N/A"),1)]),f("div",Ke,u(e.request.type==="incoming"?"Požadavek od uživatele":"Odeslaný požadavek"),1)]),_:1}),a(X,{align:"center"},{default:r(()=>[e.request.type==="incoming"?(i(),d(Q,{key:0},[a(y,{color:"positive",flat:"",icon:"check",label:"Přijmout",onClick:v[0]||(v[0]=q=>e.$emit("accept",e.request.id))}),a(y,{color:"negative",flat:"",icon:"close",label:"Odmítnout",onClick:v[1]||(v[1]=q=>e.$emit("decline",e.request.id))})],64)):(i(),d(Q,{key:1},[a(y,{color:"grey",flat:"",icon:"schedule",label:"Čeká na odpověď",disabled:""}),a(y,{color:"negative",flat:"",icon:"close",label:"Zrušit",onClick:v[2]||(v[2]=q=>e.$emit("cancel",e.request.id))})],64))]),_:1})]),_:1}))}}),He=Y(Ze,[["__scopeId","data-v-7b9f5f5e"]]),Ge={class:"row justify-between items-center q-mb-md"},We={class:"text-h4"},Xe={key:0,class:"flex justify-center"},Ye={key:1,class:"text-center text-grey-6 q-py-lg"},et={class:"text-h6 q-mt-md"},tt={key:2,class:"row q-gutter-md"},st={key:0,class:"flex justify-center"},at={key:1,class:"text-center text-grey-6 q-py-lg"},nt={class:"text-h6 q-mt-md"},rt={key:2,class:"row q-gutter-md"},it={class:"text-h6"},lt={key:0,class:"q-mt-md"},ot={class:"text-subtitle2 q-mb-sm"},kt=E({__name:"FriendsPage",setup(l){const m=Fe(),{t:c}=Ae(),o=Re(),{friends:g,friendships:b,isLoading:e,sendFriendRequest:v,acceptFriendRequest:q,declineFriendRequest:F,fetchFriends:h,fetchPendingRequests:ee,searchUsers:te,resetLoadingState:se,subscribeToFriendships:U,subscribeToPendingRequests:z,unsubscribeFromFriendships:ae}=Se(),R=w("friends"),$=w(!1),_=w(""),k=w([]),C=w([]),ne=t=>t.name&&t.surname?`${t.name} ${t.surname}`:t.username||t.email,re=t=>t.name&&t.surname?`${t.name.charAt(0)}${t.surname.charAt(0)}`:t.username?t.username.charAt(0).toUpperCase():t.email.charAt(0).toUpperCase(),O=()=>{_.value="",k.value=[]},ie=t=>o.user&&b.value.find(n=>n.user_id===o.user.id&&n.friend_id===t||n.friend_id===o.user.id&&n.user_id===t)?.id||"",D=async()=>{if(_.value.trim().length<2){k.value=[];return}const t=await te(_.value);if(t.data){const s=g.value.map(n=>n.id);k.value=t.data.filter(n=>n.id!==o.user?.id&&!s.includes(n.id))}},j=async t=>{if(!o.user)return;const s=await v(t,o.user.id);s.error?m.notify({type:"negative",message:c("friends.sendRequestError")+": "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):(m.notify({type:"positive",message:c("friends.sendRequestSuccess")}),$.value=!1,O())},le=async t=>{if(!o.user)return;const s=await q(t,o.user.id);s.error?m.notify({type:"negative",message:c("friends.acceptRequestError")+": "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):m.notify({type:"positive",message:c("friends.acceptRequestSuccess")})},oe=async t=>{const s=await F(t);s.error?m.notify({type:"negative",message:c("friends.declineRequestError")+": "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):m.notify({type:"positive",message:c("friends.declineRequestSuccess")})},de=async t=>{const s=await F(t);s.error?m.notify({type:"negative",message:"Chyba při rušení požadavku: "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):m.notify({type:"positive",message:"Požadavek byl zrušen."})},J=async()=>{if(!o.user)return;const t=await ee(o.user.id);t?.data&&(C.value=t.data)};K(async()=>{if(o.user){const t=g.value.length>0;await h(o.user.id,t),await J(),U(o.user.id),z(o.user.id,s=>{C.value=s})}}),ge(()=>o.user,async(t,s)=>{t&&s&&t.id!==s.id&&(await h(t.id,!0),await J(),U(t.id),z(t.id,n=>{C.value=n}))});const M=()=>{!document.hidden&&o.user&&e.value&&se(o.user.id)};return K(()=>{document.addEventListener("visibilitychange",M)}),ye(()=>{document.removeEventListener("visibilitychange",M),ae()}),(t,s)=>(i(),p(Qe,{class:"q-pa-md"},{default:r(()=>[f("div",Ge,[f("div",We,u(t.$t("friends.title")),1),a(y,{color:"primary",icon:"person_add",label:t.$t("friends.addFriend"),onClick:s[0]||(s[0]=n=>$.value=!0)},null,8,["label"])]),a($e,{modelValue:R.value,"onUpdate:modelValue":s[1]||(s[1]=n=>R.value=n),class:"text-primary q-mb-md"},{default:r(()=>[a(H,{name:"friends",label:t.$t("friends.myFriends")},null,8,["label"]),a(H,{name:"pending",label:t.$t("friends.requests")},null,8,["label"])]),_:1},8,["modelValue"]),a(he),a(ke,{modelValue:R.value,"onUpdate:modelValue":s[2]||(s[2]=n=>R.value=n),animated:""},{default:r(()=>[a(G,{name:"friends"},{default:r(()=>[S(e)?(i(),d("div",Xe,[a(Z,{size:"lg"})])):S(g).length===0?(i(),d("div",Ye,[a(x,{name:"people",size:"4rem"}),f("div",et,u(t.$t("friends.noFriends")),1),f("div",null,u(t.$t("friends.addFirstFriend")),1)])):(i(),d("div",tt,[(i(!0),d(Q,null,I(S(g),n=>(i(),p(Ue,{key:n.id,friend:n,"friendship-id":ie(n.id)},null,8,["friend","friendship-id"]))),128))]))]),_:1}),a(G,{name:"pending"},{default:r(()=>[S(e)?(i(),d("div",st,[a(Z,{size:"lg"})])):C.value.length===0?(i(),d("div",at,[a(x,{name:"inbox",size:"4rem"}),f("div",nt,u(t.$t("friends.noRequests")),1),f("div",null,u(t.$t("friends.noRequestsDescription")),1)])):(i(),d("div",rt,[(i(!0),d(Q,null,I(C.value,n=>(i(),p(He,{key:n.id,request:n,onAccept:le,onDecline:oe,onCancel:de},null,8,["request"]))),128))]))]),_:1})]),_:1},8,["modelValue"]),a(be,{modelValue:$.value,"onUpdate:modelValue":s[5]||(s[5]=n=>$.value=n),onHide:O},{default:r(()=>[a(L,{style:{width:"100%","max-width":"500px"}},{default:r(()=>[a(P,null,{default:r(()=>[f("div",it,u(t.$t("friends.addFriend")),1)]),_:1}),a(P,null,{default:r(()=>[a(pe,{modelValue:_.value,"onUpdate:modelValue":s[3]||(s[3]=n=>_.value=n),label:t.$t("friends.searchUsers"),outlined:"",placeholder:t.$t("friends.searchPlaceholder"),onInput:D,onKeyup:_e(D,["enter"])},{prepend:r(()=>[a(x,{name:"search"})]),append:r(()=>[a(y,{flat:"",round:"",icon:"search",onClick:D,disabled:_.value.length<2},null,8,["disabled"])]),_:1},8,["modelValue","label","placeholder"]),k.value.length>0?(i(),d("div",lt,[f("div",ot,u(t.$t("friends.searchResults"))+":",1),a(we,null,{default:r(()=>[(i(!0),d(Q,null,I(k.value,n=>(i(),p(Ce,{key:n.id,clickable:"",onClick:ue=>j(n.id)},{default:r(()=>[a(B,{avatar:""},{default:r(()=>[a(T,{color:"primary","text-color":"white"},{default:r(()=>[A(u(re(n)),1)]),_:2},1024)]),_:2},1024),a(B,null,{default:r(()=>[a(W,null,{default:r(()=>[A(u(ne(n)),1)]),_:2},1024),a(W,{caption:""},{default:r(()=>[A(u(n.username||n.email),1)]),_:2},1024)]),_:2},1024),a(B,{side:""},{default:r(()=>[a(y,{color:"primary",flat:"",round:"",icon:"person_add",onClick:qe(ue=>j(n.id),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})])):V("",!0)]),_:1}),a(X,{align:"right"},{default:r(()=>[a(y,{label:t.$t("common.cancel"),color:"grey",flat:"",onClick:s[4]||(s[4]=n=>$.value=!1)},null,8,["label"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{kt as default};
