import{y as ge,C as V,Y as pe,a9 as ye,_ as be,E as _e,r as G,z as P,b3 as ke,a0 as we,b4 as Te,a1 as Ce,b5 as xe,w as K,L as Z,O as ee,T as te,aa as Se,A as ae,aG as Pe,B as Ne,X as Qe,a as qe,n as Ae,af as Oe,p as T,f as s,o as r,h as y,at as A,t as b,l as c,k as I,e as o,c as O,s as Ee,q as oe,av as Me,au as De,u as Le,a4 as Be,ak as Re,ax as $e,x as E,aF as He,aB as je}from"./index-BC9OHaAo.js";import{a as U,Q as ze}from"./QTabs-D4YXjPe5.js";import{Q as Ve,a as W,b as F}from"./QItem-DwlaYYkU.js";import{Q as Ie}from"./QBadge-BKBuzhkV.js";import{v as Ue,a as ne,e as We,p as se,b as Fe,c as Ge,d as Xe,r as ie,s as Ye}from"./position-engine-JKk1Ow-u.js";import{c as le}from"./selection-DiPhUAXX.js";import{Q as Je}from"./QList-Cjkoq4jn.js";import{Q as Ke}from"./QPage-CR9ZqGyQ.js";import{u as Ze}from"./useNotifications-C4sXc8vY.js";import{u as et}from"./vue-i18n.runtime-QMuF0HHA.js";import"./QResizeObserver-BKF_HjRr.js";import"./rtl-DFPa-2ov.js";import"./notifications-store-WSZC7kSW.js";import"./supabase-NAtW2SFJ.js";import"./auth-store-GnHU88NU.js";const tt=ge({name:"QTooltip",inheritAttrs:!1,props:{...We,...be,...V,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{...V.transitionShow,default:"jump-down"},transitionHide:{...V.transitionHide,default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:ne},self:{type:String,default:"top middle",validator:ne},offset:{type:Array,default:()=>[14,14],validator:Ue},scrollTarget:ye,delay:{type:Number,default:0},hideDelay:{type:Number,default:0},persistent:Boolean},emits:[...pe],setup(t,{slots:u,emit:N,attrs:l}){let m,h;const _=_e(),{proxy:{$q:i}}=_,v=G(null),k=G(!1),M=P(()=>se(t.anchor,i.lang.rtl)),D=P(()=>se(t.self,i.lang.rtl)),L=P(()=>t.persistent!==!0),{registerTick:B,removeTick:R}=ke(),{registerTimeout:d}=we(),{transitionProps:Q,transitionStyle:$}=Te(t),{localScrollTarget:q,changeScrollEvent:H,unconfigureScrollTarget:j}=Fe(t,Y),{anchorEl:e,canShow:f,anchorEvents:a}=Ge({showing:k,configureAnchorEl:me}),{show:w,hide:g}=Ce({showing:k,canShow:f,handleShow:ce,handleHide:ue,hideOnRouteChange:L,processOnMount:!0});Object.assign(a,{delayShow:de,delayHide:fe});const{showPortal:C,hidePortal:x,renderPortal:re}=xe(_,v,ve,"tooltip");if(i.platform.is.mobile===!0){const n={anchorEl:e,innerRef:v,onClickOutside(p){return g(p),p.target.classList.contains("q-dialog__backdrop")&&Qe(p),!0}},z=P(()=>t.modelValue===null&&t.persistent!==!0&&k.value===!0);K(z,p=>{(p===!0?Xe:ie)(n)}),Z(()=>{ie(n)})}function ce(n){C(),B(()=>{h=new MutationObserver(()=>S()),h.observe(v.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),S(),Y()}),m===void 0&&(m=K(()=>i.screen.width+"|"+i.screen.height+"|"+t.self+"|"+t.anchor+"|"+i.lang.rtl,S)),d(()=>{C(!0),N("show",n)},t.transitionDuration)}function ue(n){R(),x(),X(),d(()=>{x(!0),N("hide",n)},t.transitionDuration)}function X(){h!==void 0&&(h.disconnect(),h=void 0),m!==void 0&&(m(),m=void 0),j(),ee(a,"tooltipTemp")}function S(){Ye({targetEl:v.value,offset:t.offset,anchorEl:e.value,anchorOrigin:M.value,selfOrigin:D.value,maxHeight:t.maxHeight,maxWidth:t.maxWidth})}function de(n){if(i.platform.is.mobile===!0){le(),document.body.classList.add("non-selectable");const z=e.value,p=["touchmove","touchcancel","touchend","click"].map(J=>[z,J,"delayHide","passiveCapture"]);te(a,"tooltipTemp",p)}d(()=>{w(n)},t.delay)}function fe(n){i.platform.is.mobile===!0&&(ee(a,"tooltipTemp"),le(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),d(()=>{g(n)},t.hideDelay)}function me(){if(t.noParentEvent===!0||e.value===null)return;const n=i.platform.is.mobile===!0?[[e.value,"touchstart","delayShow","passive"]]:[[e.value,"mouseenter","delayShow","passive"],[e.value,"mouseleave","delayHide","passive"]];te(a,"anchor",n)}function Y(){if(e.value!==null||t.scrollTarget!==void 0){q.value=Se(e.value,t.scrollTarget);const n=t.noParentEvent===!0?S:g;H(q.value,n)}}function he(){return k.value===!0?ae("div",{...l,ref:v,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",l.class],style:[l.style,$.value],role:"tooltip"},Ne(u.default)):null}function ve(){return ae(Pe,Q.value,he)}return Z(X),Object.assign(_.proxy,{updatePosition:S}),re}}),at={class:"row items-center justify-between q-px-md q-pt-md"},ot={class:"text-h6"},nt={class:"q-px-md q-pt-sm"},st={class:"col q-pa-md"},it={key:0,class:"column items-center justify-center full-height"},lt={class:"q-mt-sm text-grey-6"},rt={key:1,class:"column items-center justify-center full-height"},ct={class:"text-body1 text-grey-6 q-mt-md"},ut={class:"column items-end"},dt={key:3,class:"q-pa-md text-center"},Pt=qe({__name:"NotificationsPage",setup(t){const{t:u}=et(),N=Le(),{notifications:l,unreadCount:m,hasUnread:h,isLoading:_,initialize:i,cleanup:v,markAsRead:k,markAllAsRead:M,handleNotificationClick:D,getNotificationIcon:L,getNotificationColor:B,fetchNotifications:R}=Ze(),d=G("all"),Q=P(()=>{switch(d.value){case"unread":return l.value.filter(e=>!e.is_read);case"read":return l.value.filter(e=>e.is_read);default:return l.value}}),$=()=>{switch(d.value){case"unread":return u("notifications.noUnread");case"read":return u("notifications.noRead");default:return u("notifications.noNotifications")}},q=e=>{if(!e)return"";const f=Date.now(),a=new Date(e).getTime(),w=f-a,g=Math.floor(w/(1e3*60)),C=Math.floor(w/(1e3*60*60)),x=Math.floor(w/(1e3*60*60*24));return g<1?u("notifications.justNow"):g<60?u("notifications.minutesAgo",{count:g}):C<24?u("notifications.hoursAgo",{count:C}):x<7?u("notifications.daysAgo",{count:x}):new Date(e).toLocaleDateString()},H=async e=>{const f=await D(e);await N.push(f)},j=async()=>{await R(l.value.length+20)};return Ae(()=>{i()}),Oe(()=>{v()}),(e,f)=>(r(),T(Ke,{class:"column"},{default:s(()=>[y("div",at,[y("div",ot,b(e.$t("notifications.receivedNotifications")),1),c(h)?(r(),T(I,{key:0,flat:"",dense:"",color:"primary",label:e.$t("notifications.markAllRead"),icon:"done_all",onClick:c(M)},null,8,["label","onClick"])):A("",!0)]),y("div",nt,[o(ze,{modelValue:d.value,"onUpdate:modelValue":f[0]||(f[0]=a=>d.value=a),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"left","narrow-indicator":""},{default:s(()=>[o(U,{name:"all",label:e.$t("notifications.all"),badge:c(l).length||void 0},null,8,["label","badge"]),o(U,{name:"unread",label:e.$t("notifications.unread"),badge:c(m)||void 0},null,8,["label","badge"]),o(U,{name:"read",label:e.$t("notifications.read")},null,8,["label"])]),_:1},8,["modelValue"])]),y("div",st,[c(_)?(r(),O("div",it,[o(Ee,{size:"md",color:"primary"}),y("div",lt,b(e.$t("notifications.loading")),1)])):Q.value.length===0?(r(),O("div",rt,[o(oe,{name:"notifications_none",size:"60px",color:"grey-4"}),y("div",ct,b($()),1)])):(r(),T(Je,{key:2,separator:"",bordered:"",class:"rounded-borders"},{default:s(()=>[(r(!0),O(De,null,Me(Q.value,a=>Be((r(),T(Ve,{key:a.id,clickable:"",class:Re({"bg-blue-1":!a.is_read}),onClick:()=>H(a)},{default:s(()=>[o(W,{avatar:""},{default:s(()=>[o($e,{color:c(B)(a.type),"text-color":"white",icon:c(L)(a.type),size:"40px"},null,8,["color","icon"])]),_:2},1024),o(W,null,{default:s(()=>[o(F,{class:"text-weight-medium"},{default:s(()=>[E(b(a.title),1)]),_:2},1024),o(F,{caption:"",lines:"2",class:"q-mt-xs"},{default:s(()=>[E(b(a.body),1)]),_:2},1024),o(F,{caption:"",class:"text-grey-6 q-mt-xs"},{default:s(()=>[o(oe,{name:"schedule",size:"14px",class:"q-mr-xs"}),E(" "+b(q(a.created_at)),1)]),_:2},1024)]),_:2},1024),o(W,{side:"",top:""},{default:s(()=>[y("div",ut,[a.is_read?A("",!0):(r(),T(Ie,{key:0,color:"primary",rounded:"",class:"q-mb-sm"})),a.is_read?A("",!0):(r(),T(I,{key:1,flat:"",round:"",dense:"",icon:"done",size:"sm",color:"primary",onClick:He(w=>c(k)(a.id),["stop"])},{default:s(()=>[o(tt,null,{default:s(()=>[E(b(e.$t("notifications.markAsRead")),1)]),_:1})]),_:2},1032,["onClick"]))])]),_:2},1024)]),_:2},1032,["class","onClick"])),[[je]])),128))]),_:1})),c(l).length>=20?(r(),O("div",dt,[o(I,{flat:"",color:"primary",label:e.$t("notifications.loadMore"),icon:"expand_more",onClick:j,loading:c(_)},null,8,["label","loading"])])):A("",!0)])]),_:1}))}});export{Pt as default};
