import{l as Ft,I as ul,s as qt,r as M,m as h,x as ge,O as me,a6 as nl,a7 as ol,a8 as rl,a9 as sl,C as Et,n as F,aa as xe,ab as cl,L as Ge,N as Fe,ac as dl,ad as fl,j as Ne,y as qe,Y as vl,X as ml,a as Bt,i as ae,o as q,w as te,e as R,f as j,t as ue,a1 as de,c as X,Q as he,b as hl,h as gl,ae as yl,W as wl,g as ke,k as et,a4 as De,a3 as tt}from"./index-Pn9jnbFE.js";import{r as nt,a as Ct,Q as Sl,c as kt,b as bl}from"./QTabPanels-SI-X_CDo.js";import{Q as pl}from"./QSeparator-Bbkzzv40.js";import{Q as Ot,a as ot}from"./QCard-BCQpJOfr.js";import{u as Tt,a as rt,b as Mt,c as xt,d as Vl,e as Cl,f as _t,g as kl,Q as lt}from"./QInput-C7WvCVR3.js";import{Q as je}from"./QChip-mklSEZmv.js";import{a as _l,b as Al,Q as Il}from"./QItem-4lxtaMjq.js";import{n as At,Q as zl}from"./format-DrpAiO-h.js";import{Q as Dt}from"./QDialog-DAfo0SqQ.js";import{Q as $l}from"./QForm-BHxn8Jph.js";import{Q as Rl}from"./QPage-DWfzfX4w.js";import{u as Fl}from"./useWishes-BeWsm5Nh.js";import{u as ql}from"./auth-store-CJRvYrr9.js";import{u as Wt}from"./use-quasar-H_JTtl5v.js";import{supabase as It}from"./supabase-0ODH-3DI.js";import{Q as El}from"./QCardActions-Bd8qZCxV.js";import{u as Lt}from"./vue-i18n.runtime-yAy4rlbr.js";import{_ as Bl}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./focus-manager-B6BPwZIb.js";import"./selection-Dmk9GaX7.js";import"./use-dark-DBhXlj6i.js";import"./use-prevent-scroll-DRoQfdR0.js";const Ol=Ft({name:"QField",inheritAttrs:!1,props:{...rt,tag:{type:String,default:"label"}},emits:Tt,setup(){return Mt(xt({tagProp:!0}))}}),oe=1e3,Tl=["start","center","end","start-force","center-force","end-force"],Ht=Array.prototype.filter,Ml=window.getComputedStyle(document.body).overflowAnchor===void 0?ul:function(e,f){e!==null&&(e._qOverflowAnimationFrame!==void 0&&cancelAnimationFrame(e._qOverflowAnimationFrame),e._qOverflowAnimationFrame=requestAnimationFrame(()=>{if(e===null)return;e._qOverflowAnimationFrame=void 0;const a=e.children||[];Ht.call(a,v=>v.dataset&&v.dataset.qVsAnchor!==void 0).forEach(v=>{delete v.dataset.qVsAnchor});const g=a[f];g?.dataset&&(g.dataset.qVsAnchor="")}))};function Ee(e,f){return e+f}function it(e,f,a,g,v,u,C,w){const p=e===window?document.scrollingElement||document.documentElement:e,L=v===!0?"offsetWidth":"offsetHeight",m={scrollStart:0,scrollViewSize:-C-w,scrollMaxSize:0,offsetStart:-C,offsetEnd:-w};if(v===!0?(e===window?(m.scrollStart=window.pageXOffset||window.scrollX||document.body.scrollLeft||0,m.scrollViewSize+=document.documentElement.clientWidth):(m.scrollStart=p.scrollLeft,m.scrollViewSize+=p.clientWidth),m.scrollMaxSize=p.scrollWidth,u===!0&&(m.scrollStart=(nt===!0?m.scrollMaxSize-m.scrollViewSize:0)-m.scrollStart)):(e===window?(m.scrollStart=window.pageYOffset||window.scrollY||document.body.scrollTop||0,m.scrollViewSize+=document.documentElement.clientHeight):(m.scrollStart=p.scrollTop,m.scrollViewSize+=p.clientHeight),m.scrollMaxSize=p.scrollHeight),a!==null)for(let A=a.previousElementSibling;A!==null;A=A.previousElementSibling)A.classList.contains("q-virtual-scroll--skip")===!1&&(m.offsetStart+=A[L]);if(g!==null)for(let A=g.nextElementSibling;A!==null;A=A.nextElementSibling)A.classList.contains("q-virtual-scroll--skip")===!1&&(m.offsetEnd+=A[L]);if(f!==e){const A=p.getBoundingClientRect(),k=f.getBoundingClientRect();v===!0?(m.offsetStart+=k.left-A.left,m.offsetEnd-=k.width):(m.offsetStart+=k.top-A.top,m.offsetEnd-=k.height),e!==window&&(m.offsetStart+=m.scrollStart),m.offsetEnd+=m.scrollMaxSize-m.offsetStart}return m}function zt(e,f,a,g){f==="end"&&(f=(e===window?document.body:e)[a===!0?"scrollWidth":"scrollHeight"]),e===window?a===!0?(g===!0&&(f=(nt===!0?document.body.scrollWidth-document.documentElement.clientWidth:0)-f),window.scrollTo(f,window.pageYOffset||window.scrollY||document.body.scrollTop||0)):window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,f):a===!0?(g===!0&&(f=(nt===!0?e.scrollWidth-e.offsetWidth:0)-f),e.scrollLeft=f):e.scrollTop=f}function We(e,f,a,g){if(a>=g)return 0;const v=f.length,u=Math.floor(a/oe),C=Math.floor((g-1)/oe)+1;let w=e.slice(u,C).reduce(Ee,0);return a%oe!==0&&(w-=f.slice(u*oe,a).reduce(Ee,0)),g%oe!==0&&g!==v&&(w-=f.slice(g,C*oe).reduce(Ee,0)),w}const xl={virtualScrollSliceSize:{type:[Number,String],default:10},virtualScrollSliceRatioBefore:{type:[Number,String],default:1},virtualScrollSliceRatioAfter:{type:[Number,String],default:1},virtualScrollItemSize:{type:[Number,String],default:24},virtualScrollStickySizeStart:{type:[Number,String],default:0},virtualScrollStickySizeEnd:{type:[Number,String],default:0},tableColspan:[Number,String]},$t={virtualScrollHorizontal:Boolean,onVirtualScroll:Function,...xl};function Dl({virtualScrollLength:e,getVirtualScrollTarget:f,getVirtualScrollEl:a,virtualScrollItemSizeComputed:g}){const v=qt(),{props:u,emit:C,proxy:w}=v,{$q:p}=w;let L,m,A,k=[],I;const B=M(0),Y=M(0),d=M({}),U=M(null),Z=M(null),T=M(null),z=M({from:0,to:0}),ce=h(()=>u.tableColspan!==void 0?u.tableColspan:100);g===void 0&&(g=h(()=>u.virtualScrollItemSize));const D=h(()=>g.value+";"+u.virtualScrollHorizontal),G=h(()=>D.value+";"+u.virtualScrollSliceRatioBefore+";"+u.virtualScrollSliceRatioAfter);ge(G,()=>{ie()}),ge(D,J);function J(){fe(m,!0)}function le(l){fe(l===void 0?m:l)}function Q(l,n){const S=f();if(S==null||S.nodeType===8)return;const $=it(S,a(),U.value,Z.value,u.virtualScrollHorizontal,p.lang.rtl,u.virtualScrollStickySizeStart,u.virtualScrollStickySizeEnd);A!==$.scrollViewSize&&ie($.scrollViewSize),V(S,$,Math.min(e.value-1,Math.max(0,parseInt(l,10)||0)),0,Tl.indexOf(n)!==-1?n:m!==-1&&l>m?"end":"start")}function ne(){const l=f();if(l==null||l.nodeType===8)return;const n=it(l,a(),U.value,Z.value,u.virtualScrollHorizontal,p.lang.rtl,u.virtualScrollStickySizeStart,u.virtualScrollStickySizeEnd),S=e.value-1,$=n.scrollMaxSize-n.offsetStart-n.offsetEnd-Y.value;if(L===n.scrollStart)return;if(n.scrollMaxSize<=0){V(l,n,0,0);return}A!==n.scrollViewSize&&ie(n.scrollViewSize),ye(z.value.from);const x=Math.floor(n.scrollMaxSize-Math.max(n.scrollViewSize,n.offsetEnd)-Math.min(I[S],n.scrollViewSize/2));if(x>0&&Math.ceil(n.scrollStart)>=x){V(l,n,S,n.scrollMaxSize-n.offsetEnd-k.reduce(Ee,0));return}let _=0,y=n.scrollStart-n.offsetStart,W=y;if(y<=$&&y+n.scrollViewSize>=B.value)y-=B.value,_=z.value.from,W=y;else for(let i=0;y>=k[i]&&_<S;i++)y-=k[i],_+=oe;for(;y>0&&_<S;)y-=I[_],y>-n.scrollViewSize?(_++,W=y):W=I[_]+y;V(l,n,_,W)}function V(l,n,S,$,x){const _=typeof x=="string"&&x.indexOf("-force")!==-1,y=_===!0?x.replace("-force",""):x,W=y!==void 0?y:"start";let i=Math.max(0,S-d.value[W]),o=i+d.value.total;o>e.value&&(o=e.value,i=Math.max(0,o-d.value.total)),L=n.scrollStart;const r=i!==z.value.from||o!==z.value.to;if(r===!1&&y===void 0){ve(S);return}const{activeElement:H}=document,N=T.value;r===!0&&N!==null&&N!==H&&N.contains(H)===!0&&(N.addEventListener("focusout",we),setTimeout(()=>{N?.removeEventListener("focusout",we)})),Ml(N,S-i);const Le=y!==void 0?I.slice(i,S).reduce(Ee,0):0;if(r===!0){const be=o>=z.value.from&&i<=z.value.to?z.value.to:o;z.value={from:i,to:be},B.value=We(k,I,0,i),Y.value=We(k,I,o,e.value),requestAnimationFrame(()=>{z.value.to!==o&&L===n.scrollStart&&(z.value={from:z.value.from,to:o},Y.value=We(k,I,o,e.value))})}requestAnimationFrame(()=>{if(L!==n.scrollStart)return;r===!0&&ye(i);const be=I.slice(i,S).reduce(Ee,0),pe=be+n.offsetStart+B.value,He=pe+I[S];let Oe=pe+$;if(y!==void 0){const Ke=be-Le,Te=n.scrollStart+Ke;Oe=_!==!0&&Te<pe&&He<Te+n.scrollViewSize?Te:y==="end"?He-n.scrollViewSize:pe-(y==="start"?0:Math.round((n.scrollViewSize-I[S])/2))}L=Oe,zt(l,Oe,u.virtualScrollHorizontal,p.lang.rtl),ve(S)})}function ye(l){const n=T.value;if(n){const S=Ht.call(n.children,i=>i.classList&&i.classList.contains("q-virtual-scroll--skip")===!1),$=S.length,x=u.virtualScrollHorizontal===!0?i=>i.getBoundingClientRect().width:i=>i.offsetHeight;let _=l,y,W;for(let i=0;i<$;){for(y=x(S[i]),i++;i<$&&S[i].classList.contains("q-virtual-scroll--with-prev")===!0;)y+=x(S[i]),i++;W=y-I[_],W!==0&&(I[_]+=W,k[Math.floor(_/oe)]+=W),_++}}}function we(){T.value?.focus()}function fe(l,n){const S=1*g.value;(n===!0||Array.isArray(I)===!1)&&(I=[]);const $=I.length;I.length=e.value;for(let _=e.value-1;_>=$;_--)I[_]=S;const x=Math.floor((e.value-1)/oe);k=[];for(let _=0;_<=x;_++){let y=0;const W=Math.min((_+1)*oe,e.value);for(let i=_*oe;i<W;i++)y+=I[i];k.push(y)}m=-1,L=void 0,B.value=We(k,I,0,z.value.from),Y.value=We(k,I,z.value.to,e.value),l>=0?(ye(z.value.from),me(()=>{Q(l)})):re()}function ie(l){if(l===void 0&&typeof window<"u"){const y=f();y!=null&&y.nodeType!==8&&(l=it(y,a(),U.value,Z.value,u.virtualScrollHorizontal,p.lang.rtl,u.virtualScrollStickySizeStart,u.virtualScrollStickySizeEnd).scrollViewSize)}A=l;const n=parseFloat(u.virtualScrollSliceRatioBefore)||0,S=parseFloat(u.virtualScrollSliceRatioAfter)||0,$=1+n+S,x=l===void 0||l<=0?1:Math.ceil(l/g.value),_=Math.max(1,x,Math.ceil((u.virtualScrollSliceSize>0?u.virtualScrollSliceSize:10)/$));d.value={total:Math.ceil(_*$),start:Math.ceil(_*n),center:Math.ceil(_*(.5+n)),end:Math.ceil(_*(1+n)),view:x}}function Be(l,n){const S=u.virtualScrollHorizontal===!0?"width":"height",$={["--q-virtual-scroll-item-"+S]:g.value+"px"};return[l==="tbody"?F(l,{class:"q-virtual-scroll__padding",key:"before",ref:U},[F("tr",[F("td",{style:{[S]:`${B.value}px`,...$},colspan:ce.value})])]):F(l,{class:"q-virtual-scroll__padding",key:"before",ref:U,style:{[S]:`${B.value}px`,...$}}),F(l,{class:"q-virtual-scroll__content",key:"content",ref:T,tabindex:-1},n.flat()),l==="tbody"?F(l,{class:"q-virtual-scroll__padding",key:"after",ref:Z},[F("tr",[F("td",{style:{[S]:`${Y.value}px`,...$},colspan:ce.value})])]):F(l,{class:"q-virtual-scroll__padding",key:"after",ref:Z,style:{[S]:`${Y.value}px`,...$}})]}function ve(l){m!==l&&(u.onVirtualScroll!==void 0&&C("virtualScroll",{index:l,from:z.value.from,to:z.value.to-1,direction:l<m?"decrease":"increase",ref:w}),m=l)}ie();const re=nl(ne,p.platform.is.ios===!0?120:35);ol(()=>{ie()});let Se=!1;return rl(()=>{Se=!0}),sl(()=>{if(Se!==!0)return;const l=f();L!==void 0&&l!==void 0&&l!==null&&l.nodeType!==8?zt(l,L,u.virtualScrollHorizontal,p.lang.rtl):Q(m)}),Et(()=>{re.cancel()}),Object.assign(w,{scrollTo:Q,reset:J,refresh:le}),{virtualScrollSliceRange:z,virtualScrollSliceSizeComputed:d,setVirtualScrollSize:ie,onVirtualScrollEvt:re,localResetVirtualScroll:fe,padVirtualScroll:Be,scrollTo:Q,reset:J,refresh:le}}const Rt=e=>["add","add-unique","toggle"].includes(e),Wl=".*+?^${}()|[]\\",Ll=Object.keys(rt);function at(e,f){if(typeof e=="function")return e;const a=e!==void 0?e:f;return g=>g!==null&&typeof g=="object"&&a in g?g[a]:g}const Hl=Ft({name:"QSelect",inheritAttrs:!1,props:{...$t,...Vl,...rt,modelValue:{required:!0},multiple:Boolean,displayValue:[String,Number],displayValueHtml:Boolean,dropdownIcon:String,options:{type:Array,default:()=>[]},optionValue:[Function,String],optionLabel:[Function,String],optionDisable:[Function,String],hideSelected:Boolean,hideDropdownIcon:Boolean,fillInput:Boolean,maxValues:[Number,String],optionsDense:Boolean,optionsDark:{type:Boolean,default:null},optionsSelectedClass:String,optionsHtml:Boolean,optionsCover:Boolean,menuShrink:Boolean,menuAnchor:String,menuSelf:String,menuOffset:Array,popupContentClass:String,popupContentStyle:[String,Array,Object],popupNoRouteDismiss:Boolean,useInput:Boolean,useChips:Boolean,newValueMode:{type:String,validator:Rt},mapOptions:Boolean,emitValue:Boolean,disableTabSelection:Boolean,inputDebounce:{type:[Number,String],default:500},inputClass:[Array,String,Object],inputStyle:[Array,String,Object],tabindex:{type:[String,Number],default:0},autocomplete:String,transitionShow:{},transitionHide:{},transitionDuration:{},behavior:{type:String,validator:e=>["default","menu","dialog"].includes(e),default:"default"},virtualScrollItemSize:$t.virtualScrollItemSize.type,onNewValue:Function,onFilter:Function},emits:[...Tt,"add","remove","inputValue","keyup","keypress","keydown","popupShow","popupHide","filterAbort"],setup(e,{slots:f,emit:a}){const{proxy:g}=qt(),{$q:v}=g,u=M(!1),C=M(!1),w=M(-1),p=M(""),L=M(!1),m=M(!1);let A=null,k=null,I,B,Y,d=null,U,Z,T,z;const ce=M(null),D=M(null),G=M(null),J=M(null),le=M(null),Q=Cl(e),ne=kl(wt),V=h(()=>Array.isArray(e.options)?e.options.length:0),ye=h(()=>e.virtualScrollItemSize===void 0?e.optionsDense===!0?24:48:e.virtualScrollItemSize),{virtualScrollSliceRange:we,virtualScrollSliceSizeComputed:fe,localResetVirtualScroll:ie,padVirtualScroll:Be,onVirtualScrollEvt:ve,scrollTo:re,setVirtualScrollSize:Se}=Dl({virtualScrollLength:V,getVirtualScrollTarget:Nt,getVirtualScrollEl:gt,virtualScrollItemSizeComputed:ye}),l=xt(),n=h(()=>{const t=e.mapOptions===!0&&e.multiple!==!0,s=e.modelValue!==void 0&&(e.modelValue!==null||t===!0)?e.multiple===!0&&Array.isArray(e.modelValue)?e.modelValue:[e.modelValue]:[];if(e.mapOptions===!0&&Array.isArray(e.options)===!0){const c=e.mapOptions===!0&&I!==void 0?I:[],b=s.map(O=>Ut(O,c));return e.modelValue===null&&t===!0?b.filter(O=>O!==null):b}return s}),S=h(()=>{const t={};return Ll.forEach(s=>{const c=e[s];c!==void 0&&(t[s]=c)}),t}),$=h(()=>e.optionsDark===null?l.isDark.value:e.optionsDark),x=h(()=>_t(n.value)),_=h(()=>{let t="q-field__input q-placeholder col";return e.hideSelected===!0||n.value.length===0?[t,e.inputClass]:(t+=" q-field__input--padding",e.inputClass===void 0?t:[t,e.inputClass])}),y=h(()=>(e.virtualScrollHorizontal===!0?"q-virtual-scroll--horizontal":"")+(e.popupContentClass?" "+e.popupContentClass:"")),W=h(()=>V.value===0),i=h(()=>n.value.map(t=>ee.value(t)).join(", ")),o=h(()=>e.displayValue!==void 0?e.displayValue:i.value),r=h(()=>e.optionsHtml===!0?()=>!0:t=>t?.html===!0),H=h(()=>e.displayValueHtml===!0||e.displayValue===void 0&&(e.optionsHtml===!0||n.value.some(r.value))),N=h(()=>l.focused.value===!0?e.tabindex:-1),Le=h(()=>{const t={tabindex:e.tabindex,role:"combobox","aria-label":e.label,"aria-readonly":e.readonly===!0?"true":"false","aria-autocomplete":e.useInput===!0?"list":"none","aria-expanded":u.value===!0?"true":"false","aria-controls":`${l.targetUid.value}_lb`};return w.value>=0&&(t["aria-activedescendant"]=`${l.targetUid.value}_${w.value}`),t}),be=h(()=>({id:`${l.targetUid.value}_lb`,role:"listbox","aria-multiselectable":e.multiple===!0?"true":"false"})),pe=h(()=>n.value.map((t,s)=>({index:s,opt:t,html:r.value(t),selected:!0,removeAtIndex:Qt,toggleOption:Ve,tabindex:N.value}))),He=h(()=>{if(V.value===0)return[];const{from:t,to:s}=we.value;return e.options.slice(t,s).map((c,b)=>{const O=_e.value(c)===!0,E=Ye(c)===!0,K=t+b,P={clickable:!0,active:E,activeClass:Te.value,manualFocus:!0,focused:!1,disable:O,tabindex:-1,dense:e.optionsDense,dark:$.value,role:"option","aria-selected":E===!0?"true":"false",id:`${l.targetUid.value}_${K}`,onClick:()=>{Ve(c)}};return O!==!0&&(w.value===K&&(P.focused=!0),v.platform.is.desktop===!0&&(P.onMousemove=()=>{u.value===!0&&Ae(K)})),{index:K,opt:c,html:r.value(c),label:ee.value(c),selected:P.active,focused:P.focused,toggleOption:Ve,setOptionIndex:Ae,itemProps:P}})}),Oe=h(()=>e.dropdownIcon!==void 0?e.dropdownIcon:v.iconSet.arrow.dropdown),Ke=h(()=>e.optionsCover===!1&&e.outlined!==!0&&e.standout!==!0&&e.borderless!==!0&&e.rounded!==!0),Te=h(()=>e.optionsSelectedClass!==void 0?e.optionsSelectedClass:e.color!==void 0?`text-${e.color}`:""),se=h(()=>at(e.optionValue,"value")),ee=h(()=>at(e.optionLabel,"label")),_e=h(()=>at(e.optionDisable,"disable")),Pe=h(()=>n.value.map(se.value)),Pt=h(()=>{const t={onInput:wt,onChange:ne,onKeydown:ht,onKeyup:vt,onKeypress:mt,onFocus:dt,onClick(s){B===!0&&qe(s)}};return t.onCompositionstart=t.onCompositionupdate=t.onCompositionend=ne,t});ge(n,t=>{I=t,e.useInput===!0&&e.fillInput===!0&&e.multiple!==!0&&l.innerLoading.value!==!0&&(C.value!==!0&&u.value!==!0||x.value!==!0)&&(Y!==!0&&Re(),(C.value===!0||u.value===!0)&&Ie(""))},{immediate:!0}),ge(()=>e.fillInput,Re),ge(u,Je),ge(V,al);function st(t){return e.emitValue===!0?se.value(t):t}function Xe(t){if(t!==-1&&t<n.value.length)if(e.multiple===!0){const s=e.modelValue.slice();a("remove",{index:t,value:s.splice(t,1)[0]}),a("update:modelValue",s)}else a("update:modelValue",null)}function Qt(t){Xe(t),l.focus()}function ct(t,s){const c=st(t);if(e.multiple!==!0){e.fillInput===!0&&Me(ee.value(t),!0,!0),a("update:modelValue",c);return}if(n.value.length===0){a("add",{index:0,value:c}),a("update:modelValue",e.multiple===!0?[c]:c);return}if(s===!0&&Ye(t)===!0||e.maxValues!==void 0&&e.modelValue.length>=e.maxValues)return;const b=e.modelValue.slice();a("add",{index:b.length,value:c}),b.push(c),a("update:modelValue",b)}function Ve(t,s){if(l.editable.value!==!0||t===void 0||_e.value(t)===!0)return;const c=se.value(t);if(e.multiple!==!0){s!==!0&&(Me(e.fillInput===!0?ee.value(t):"",!0,!0),Ce()),D.value?.focus(),(n.value.length===0||xe(se.value(n.value[0]),c)!==!0)&&a("update:modelValue",e.emitValue===!0?c:t);return}if((B!==!0||L.value===!0)&&l.focus(),dt(),n.value.length===0){const E=e.emitValue===!0?c:t;a("add",{index:0,value:E}),a("update:modelValue",e.multiple===!0?[E]:E);return}const b=e.modelValue.slice(),O=Pe.value.findIndex(E=>xe(E,c));if(O!==-1)a("remove",{index:O,value:b.splice(O,1)[0]});else{if(e.maxValues!==void 0&&b.length>=e.maxValues)return;const E=e.emitValue===!0?c:t;a("add",{index:b.length,value:E}),b.push(E)}a("update:modelValue",b)}function Ae(t){if(v.platform.is.desktop!==!0)return;const s=t!==-1&&t<V.value?t:-1;w.value!==s&&(w.value=s)}function Qe(t=1,s){if(u.value===!0){let c=w.value;do c=At(c+t,-1,V.value-1);while(c!==-1&&c!==w.value&&_e.value(e.options[c])===!0);w.value!==c&&(Ae(c),re(c),s!==!0&&e.useInput===!0&&e.fillInput===!0&&Ue(c>=0?ee.value(e.options[c]):U,!0))}}function Ut(t,s){const c=b=>xe(se.value(b),t);return e.options.find(c)||s.find(c)||t}function Ye(t){const s=se.value(t);return Pe.value.find(c=>xe(c,s))!==void 0}function dt(t){e.useInput===!0&&D.value!==null&&(t===void 0||D.value===t.target&&t.target.value===i.value)&&D.value.select()}function ft(t){vl(t,27)===!0&&u.value===!0&&(qe(t),Ce(),Re()),a("keyup",t)}function vt(t){const{value:s}=t.target;if(t.keyCode!==void 0){ft(t);return}if(t.target.value="",A!==null&&(clearTimeout(A),A=null),k!==null&&(clearTimeout(k),k=null),Re(),typeof s=="string"&&s.length!==0){const c=s.toLocaleLowerCase(),b=E=>{const K=e.options.find(P=>String(E.value(P)).toLocaleLowerCase()===c);return K===void 0?!1:(n.value.indexOf(K)===-1?Ve(K):Ce(),!0)},O=E=>{b(se)!==!0&&E!==!0&&b(ee)!==!0&&Ie(s,!0,()=>O(!0))};O()}else l.clearValue(t)}function mt(t){a("keypress",t)}function ht(t){if(a("keydown",t),cl(t)===!0)return;const s=p.value.length!==0&&(e.newValueMode!==void 0||e.onNewValue!==void 0),c=t.shiftKey!==!0&&e.disableTabSelection!==!0&&e.multiple!==!0&&(w.value!==-1||s===!0);if(t.keyCode===27){Ge(t);return}if(t.keyCode===9&&c===!1){ze();return}if(t.target===void 0||t.target.id!==l.targetUid.value||l.editable.value!==!0)return;if(t.keyCode===40&&l.innerLoading.value!==!0&&u.value===!1){Fe(t),$e();return}if(t.keyCode===8&&(e.useChips===!0||e.clearable===!0)&&e.hideSelected!==!0&&p.value.length===0){e.multiple===!0&&Array.isArray(e.modelValue)===!0?Xe(e.modelValue.length-1):e.multiple!==!0&&e.modelValue!==null&&a("update:modelValue",null);return}(t.keyCode===35||t.keyCode===36)&&(typeof p.value!="string"||p.value.length===0)&&(Fe(t),w.value=-1,Qe(t.keyCode===36?1:-1,e.multiple)),(t.keyCode===33||t.keyCode===34)&&fe.value!==void 0&&(Fe(t),w.value=Math.max(-1,Math.min(V.value,w.value+(t.keyCode===33?-1:1)*fe.value.view)),Qe(t.keyCode===33?1:-1,e.multiple)),(t.keyCode===38||t.keyCode===40)&&(Fe(t),Qe(t.keyCode===38?-1:1,e.multiple));const b=V.value;if((T===void 0||z<Date.now())&&(T=""),b>0&&e.useInput!==!0&&t.key!==void 0&&t.key.length===1&&t.altKey===!1&&t.ctrlKey===!1&&t.metaKey===!1&&(t.keyCode!==32||T.length!==0)){u.value!==!0&&$e(t);const O=t.key.toLocaleLowerCase(),E=T.length===1&&T[0]===O;z=Date.now()+1500,E===!1&&(Fe(t),T+=O);const K=new RegExp("^"+T.split("").map(Ze=>Wl.indexOf(Ze)!==-1?"\\"+Ze:Ze).join(".*"),"i");let P=w.value;if(E===!0||P<0||K.test(ee.value(e.options[P]))!==!0)do P=At(P+1,-1,b-1);while(P!==w.value&&(_e.value(e.options[P])===!0||K.test(ee.value(e.options[P]))!==!0));w.value!==P&&me(()=>{Ae(P),re(P),P>=0&&e.useInput===!0&&e.fillInput===!0&&Ue(ee.value(e.options[P]),!0)});return}if(!(t.keyCode!==13&&(t.keyCode!==32||e.useInput===!0||T!=="")&&(t.keyCode!==9||c===!1))){if(t.keyCode!==9&&Fe(t),w.value!==-1&&w.value<b){Ve(e.options[w.value]);return}if(s===!0){const O=(E,K)=>{if(K){if(Rt(K)!==!0)return}else K=e.newValueMode;if(Me("",e.multiple!==!0,!0),E==null)return;(K==="toggle"?Ve:ct)(E,K==="add-unique"),e.multiple!==!0&&(D.value?.focus(),Ce())};if(e.onNewValue!==void 0?a("newValue",p.value,O):O(p.value),e.multiple!==!0)return}u.value===!0?ze():l.innerLoading.value!==!0&&$e()}}function gt(){return B===!0?le.value:G.value!==null&&G.value.contentEl!==null?G.value.contentEl:void 0}function Nt(){return gt()}function jt(){return e.hideSelected===!0?[]:f["selected-item"]!==void 0?pe.value.map(t=>f["selected-item"](t)).slice():f.selected!==void 0?[].concat(f.selected()):e.useChips===!0?pe.value.map((t,s)=>F(je,{key:"option-"+s,removable:l.editable.value===!0&&_e.value(t.opt)!==!0,dense:!0,textColor:e.color,tabindex:N.value,onRemove(){t.removeAtIndex(s)}},()=>F("span",{class:"ellipsis",[t.html===!0?"innerHTML":"textContent"]:ee.value(t.opt)}))):[F("span",{class:"ellipsis",[H.value===!0?"innerHTML":"textContent"]:o.value})]}function yt(){if(W.value===!0)return f["no-option"]!==void 0?f["no-option"]({inputValue:p.value}):void 0;const t=f.option!==void 0?f.option:c=>F(Il,{key:c.index,...c.itemProps},()=>F(_l,()=>F(Al,()=>F("span",{[c.html===!0?"innerHTML":"textContent"]:c.label}))));let s=Be("div",He.value.map(t));return f["before-options"]!==void 0&&(s=f["before-options"]().concat(s)),ml(f["after-options"],s)}function Kt(t,s){const c=s===!0?{...Le.value,...l.splitAttrs.attributes.value}:void 0,b={ref:s===!0?D:void 0,key:"i_t",class:_.value,style:e.inputStyle,value:p.value!==void 0?p.value:"",type:"search",...c,id:s===!0?l.targetUid.value:void 0,maxlength:e.maxlength,autocomplete:e.autocomplete,"data-autofocus":t===!0||e.autofocus===!0||void 0,disabled:e.disable===!0,readonly:e.readonly===!0,...Pt.value};return t!==!0&&B===!0&&(Array.isArray(b.class)===!0?b.class=[...b.class,"no-pointer-events"]:b.class+=" no-pointer-events"),F("input",b)}function wt(t){A!==null&&(clearTimeout(A),A=null),k!==null&&(clearTimeout(k),k=null),!(t&&t.target&&t.target.qComposing===!0)&&(Ue(t.target.value||""),Y=!0,U=p.value,l.focused.value!==!0&&(B!==!0||L.value===!0)&&l.focus(),e.onFilter!==void 0&&(A=setTimeout(()=>{A=null,Ie(p.value)},e.inputDebounce)))}function Ue(t,s){p.value!==t&&(p.value=t,s===!0||e.inputDebounce===0||e.inputDebounce==="0"?a("inputValue",t):k=setTimeout(()=>{k=null,a("inputValue",t)},e.inputDebounce))}function Me(t,s,c){Y=c!==!0,e.useInput===!0&&(Ue(t,!0),(s===!0||c!==!0)&&(U=t),s!==!0&&Ie(t))}function Ie(t,s,c){if(e.onFilter===void 0||s!==!0&&l.focused.value!==!0)return;l.innerLoading.value===!0?a("filterAbort"):(l.innerLoading.value=!0,m.value=!0),t!==""&&e.multiple!==!0&&n.value.length!==0&&Y!==!0&&t===ee.value(n.value[0])&&(t="");const b=setTimeout(()=>{u.value===!0&&(u.value=!1)},10);d!==null&&clearTimeout(d),d=b,a("filter",t,(O,E)=>{(s===!0||l.focused.value===!0)&&d===b&&(clearTimeout(d),typeof O=="function"&&O(),m.value=!1,me(()=>{l.innerLoading.value=!1,l.editable.value===!0&&(s===!0?u.value===!0&&Ce():u.value===!0?Je(!0):u.value=!0),typeof E=="function"&&me(()=>{E(g)}),typeof c=="function"&&me(()=>{c(g)})}))},()=>{l.focused.value===!0&&d===b&&(clearTimeout(d),l.innerLoading.value=!1,m.value=!1),u.value===!0&&(u.value=!1)})}function Xt(){return F(zl,{ref:G,class:y.value,style:e.popupContentStyle,modelValue:u.value,fit:e.menuShrink!==!0,cover:e.optionsCover===!0&&W.value!==!0&&e.useInput!==!0,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,dark:$.value,noParentEvent:!0,noRefocus:!0,noFocus:!0,noRouteDismiss:e.popupNoRouteDismiss,square:Ke.value,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,separateClosePopup:!0,...be.value,onScrollPassive:ve,onBeforeShow:bt,onBeforeHide:Yt,onShow:Jt},yt)}function Yt(t){pt(t),ze()}function Jt(){Se()}function Zt(t){qe(t),D.value?.focus(),L.value=!0,window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,0)}function Gt(t){qe(t),me(()=>{L.value=!1})}function el(){const t=[F(Ol,{class:`col-auto ${l.fieldClass.value}`,...S.value,for:l.targetUid.value,dark:$.value,square:!0,loading:m.value,itemAligned:!1,filled:!0,stackLabel:p.value.length!==0,...l.splitAttrs.listeners.value,onFocus:Zt,onBlur:Gt},{...f,rawControl:()=>l.getControl(!0),before:void 0,after:void 0})];return u.value===!0&&t.push(F("div",{ref:le,class:y.value+" scroll",style:e.popupContentStyle,...be.value,onClick:Ge,onScrollPassive:ve},yt())),F(Dt,{ref:J,modelValue:C.value,position:e.useInput===!0?"top":void 0,transitionShow:Z,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,noRouteDismiss:e.popupNoRouteDismiss,onBeforeShow:bt,onBeforeHide:tl,onHide:ll,onShow:il},()=>F("div",{class:"q-select__dialog"+($.value===!0?" q-select__dialog--dark q-dark":"")+(L.value===!0?" q-select__dialog--focused":"")},t))}function tl(t){pt(t),J.value!==null&&J.value.__updateRefocusTarget(l.rootRef.value.querySelector(".q-field__native > [tabindex]:last-child")),l.focused.value=!1}function ll(t){Ce(),l.focused.value===!1&&a("blur",t),Re()}function il(){const t=document.activeElement;(t===null||t.id!==l.targetUid.value)&&D.value!==null&&D.value!==t&&D.value.focus(),Se()}function ze(){C.value!==!0&&(w.value=-1,u.value===!0&&(u.value=!1),l.focused.value===!1&&(d!==null&&(clearTimeout(d),d=null),l.innerLoading.value===!0&&(a("filterAbort"),l.innerLoading.value=!1,m.value=!1)))}function $e(t){l.editable.value===!0&&(B===!0?(l.onControlFocusin(t),C.value=!0,me(()=>{l.focus()})):l.focus(),e.onFilter!==void 0?Ie(p.value):(W.value!==!0||f["no-option"]!==void 0)&&(u.value=!0))}function Ce(){C.value=!1,ze()}function Re(){e.useInput===!0&&Me(e.multiple!==!0&&e.fillInput===!0&&n.value.length!==0&&ee.value(n.value[0])||"",!0,!0)}function Je(t){let s=-1;if(t===!0){if(n.value.length!==0){const c=se.value(n.value[0]);s=e.options.findIndex(b=>xe(se.value(b),c))}ie(s)}Ae(s)}function al(t,s){u.value===!0&&l.innerLoading.value===!1&&(ie(-1,!0),me(()=>{u.value===!0&&l.innerLoading.value===!1&&(t>s?ie():Je(!0))}))}function St(){C.value===!1&&G.value!==null&&G.value.updatePosition()}function bt(t){t!==void 0&&qe(t),a("popupShow",t),l.hasPopupOpen=!0,l.onControlFocusin(t)}function pt(t){t!==void 0&&qe(t),a("popupHide",t),l.hasPopupOpen=!1,l.onControlFocusout(t)}function Vt(){B=v.platform.is.mobile!==!0&&e.behavior!=="dialog"?!1:e.behavior!=="menu"&&(e.useInput===!0?f["no-option"]!==void 0||e.onFilter!==void 0||W.value===!1:!0),Z=v.platform.is.ios===!0&&B===!0&&e.useInput===!0?"fade":e.transitionShow}return dl(Vt),fl(St),Vt(),Et(()=>{A!==null&&clearTimeout(A),k!==null&&clearTimeout(k)}),Object.assign(g,{showPopup:$e,hidePopup:Ce,removeAtIndex:Xe,add:ct,toggleOption:Ve,getOptionIndex:()=>w.value,setOptionIndex:Ae,moveOptionSelection:Qe,filter:Ie,updateMenuPosition:St,updateInputValue:Me,isOptionSelected:Ye,getEmittingOptionValue:st,isOptionDisabled:(...t)=>_e.value.apply(null,t)===!0,getOptionValue:(...t)=>se.value.apply(null,t),getOptionLabel:(...t)=>ee.value.apply(null,t)}),Object.assign(l,{innerValue:n,fieldClass:h(()=>`q-select q-field--auto-height q-select--with${e.useInput!==!0?"out":""}-input q-select--with${e.useChips!==!0?"out":""}-chips q-select--${e.multiple===!0?"multiple":"single"}`),inputRef:ce,targetRef:D,hasValue:x,showPopup:$e,floatingLabel:h(()=>e.hideSelected!==!0&&x.value===!0||typeof p.value=="number"||p.value.length!==0||_t(e.displayValue)),getControlChild:()=>{if(l.editable.value!==!1&&(C.value===!0||W.value!==!0||f["no-option"]!==void 0))return B===!0?el():Xt();l.hasPopupOpen===!0&&(l.hasPopupOpen=!1)},controlEvents:{onFocusin(t){l.onControlFocusin(t)},onFocusout(t){l.onControlFocusout(t,()=>{Re(),ze()})},onClick(t){if(Ge(t),B!==!0&&u.value===!0){ze(),D.value?.focus();return}$e(t)}},getControl:t=>{const s=jt(),c=t===!0||C.value!==!0||B!==!0;if(e.useInput===!0)s.push(Kt(t,c));else if(l.editable.value===!0){const O=c===!0?Le.value:void 0;s.push(F("input",{ref:c===!0?D:void 0,key:"d_t",class:"q-select__focus-target",id:c===!0?l.targetUid.value:void 0,value:o.value,readonly:!0,"data-autofocus":t===!0||e.autofocus===!0||void 0,...O,onKeydown:ht,onKeyup:ft,onKeypress:mt})),c===!0&&typeof e.autocomplete=="string"&&e.autocomplete.length!==0&&s.push(F("input",{class:"q-select__autocomplete-input",autocomplete:e.autocomplete,tabindex:-1,onKeyup:vt}))}if(Q.value!==void 0&&e.disable!==!0&&Pe.value.length!==0){const O=Pe.value.map(E=>F("option",{value:E,selected:!0}));s.push(F("select",{class:"hidden",name:Q.value,multiple:e.multiple},O))}const b=e.useInput===!0||c!==!0?void 0:l.splitAttrs.attributes.value;return F("div",{class:"q-field__native row items-center",...b,...l.splitAttrs.listeners.value},s)},getInnerAppend:()=>e.loading!==!0&&m.value!==!0&&e.hideDropdownIcon!==!0?[F(Ne,{class:"q-select__dropdown-icon"+(u.value===!0?" rotate-180":""),name:Oe.value})]:null}),Mt(l)}}),Pl={class:"row items-center justify-between"},Ql={class:"text-h6 wish-title"},Ul={class:"row q-gutter-xs"},Nl={class:"wish-description"},jl={key:0,class:"text-body2 text-grey-7"},Kl={class:"wish-url"},Xl={class:"wish-meta"},Yl={class:"text-caption text-grey-6"},Jl={key:0},Zl=Bt({__name:"WishCard",props:{wish:{},currentUserId:{}},emits:["edit","delete","toggleBought","toggleReceived"],setup(e,{emit:f}){const a=e,g=f,v=Wt(),{t:u}=Lt(),C=h(()=>{switch(a.wish.visibility){case"public":return"green";case"friends":return"blue";case"private":return"grey";default:return"grey"}}),w=h(()=>{switch(a.wish.visibility){case"public":return u("wishes.visibilityPublic");case"friends":return u("wishes.visibilityFriends");case"private":return u("wishes.visibilityPrivate");default:return u("common.unknown")}}),p=h(()=>a.wish.created_by_user_id!==a.wish.created_for_user_id&&a.currentUserId!==a.wish.created_for_user_id),L=()=>{const d=a.wish.created_by_user;return d.name&&d.surname?`${d.name} ${d.surname}`:d.name?d.name:d.username?d.username:u("common.unknown")},m=h(()=>a.currentUserId===a.wish.created_by_user_id),A=h(()=>a.currentUserId===a.wish.created_by_user_id),k=h(()=>a.currentUserId!==a.wish.created_for_user_id&&a.currentUserId!==void 0),I=h(()=>a.currentUserId===a.wish.created_for_user_id&&a.currentUserId!==void 0),B=d=>new Date(d).toLocaleDateString("cs-CZ"),Y=()=>{v.dialog({title:u("wishes.deleteWish"),message:u("wishes.deleteConfirm"),cancel:!0,persistent:!0}).onOk(()=>{g("delete",a.wish.id)})};return(d,U)=>(q(),ae(Ot,{class:"wish-card"},{default:te(()=>[R(ot,{class:"wish-card-content"},{default:te(()=>[j("div",Pl,[j("div",Ql,ue(d.wish.name),1),j("div",Ul,[R(je,{color:C.value,"text-color":"white",label:w.value,size:"sm"},null,8,["color","label"]),d.wish.is_bought?(q(),ae(je,{key:0,color:"green","text-color":"white",label:d.$t("wishes.bought"),size:"sm"},null,8,["label"])):de("",!0),d.wish.is_received?(q(),ae(je,{key:1,color:"purple","text-color":"white",label:d.$t("wishes.received"),size:"sm"},null,8,["label"])):de("",!0)])]),j("div",Nl,[d.wish.description?(q(),X("div",jl,ue(d.wish.description),1)):de("",!0)]),j("div",Kl,[d.wish.url?(q(),ae(he,{key:0,flat:"",color:"primary",href:d.wish.url,target:"_blank",icon:"open_in_new",label:d.$t("wishes.openLink"),size:"sm"},null,8,["href","label"])):de("",!0)]),j("div",Xl,[j("div",Yl,[p.value?(q(),X("div",Jl,ue(d.$t("wishes.createdBy",{name:L()})),1)):de("",!0),j("div",null,ue(B(d.wish.created_at)),1)])])]),_:1}),R(El,{align:"right"},{default:te(()=>[k.value?(q(),ae(he,{key:0,color:d.wish.is_bought?"grey":"green",icon:d.wish.is_bought?"shopping_cart":"add_shopping_cart",label:d.wish.is_bought?d.$t("wishes.markAsNotBought"):d.$t("wishes.markAsBought"),flat:"",onClick:U[0]||(U[0]=Z=>d.$emit("toggleBought",d.wish.id))},null,8,["color","icon","label"])):de("",!0),I.value?(q(),ae(he,{key:1,color:d.wish.is_received?"orange":"purple",icon:d.wish.is_received?"undo":"check_circle",label:d.wish.is_received?d.$t("wishes.markAsNotReceived"):d.$t("wishes.markAsReceived"),flat:"",onClick:U[1]||(U[1]=Z=>d.$emit("toggleReceived",d.wish.id))},null,8,["color","icon","label"])):de("",!0),m.value?(q(),ae(he,{key:2,color:"primary",icon:"edit",flat:"",onClick:U[2]||(U[2]=Z=>d.$emit("edit",d.wish))})):de("",!0),A.value?(q(),ae(he,{key:3,color:"negative",icon:"delete",flat:"",onClick:Y})):de("",!0)]),_:1})]),_:1}))}}),ut=Bl(Zl,[["__scopeId","data-v-ebfc8fd5"]]),Gl={class:"row justify-between items-center q-mb-md"},ei={class:"text-h4"},ti={key:0,class:"flex justify-center"},li={key:1,class:"text-center text-grey-6 q-py-lg"},ii={class:"text-h6 q-mt-md"},ai={key:2,class:"row q-gutter-md"},ui={key:0,class:"flex justify-center"},ni={key:1,class:"text-center text-grey-6 q-py-lg"},oi={class:"text-h6 q-mt-md"},ri={key:2,class:"row q-gutter-md"},si={key:0,class:"flex justify-center"},ci={key:1,class:"text-center text-grey-6 q-py-lg"},di={class:"text-h6 q-mt-md"},fi={key:2,class:"row q-gutter-md"},vi={class:"text-h6"},mi={class:"row justify-end q-gutter-sm"},Mi=Bt({__name:"WishesPage",setup(e){const f=Wt(),{t:a}=Lt(),g=yl(),v=ql(),u=h(()=>g.params.userId),C=h(()=>!!u.value),{isLoading:w,createWish:p,fetchWishes:L,fetchAllWishesForUser:m,fetchReceivedWishes:A,refreshWishes:k,refreshAllWishesForUser:I,refreshReceivedWishes:B,updateWish:Y,deleteWish:d,toggleBought:U,toggleReceived:Z}=Fl(),T=M([]),z=M([]),ce=h(()=>C.value?z.value:T.value);let D=null;const G=M("my-wishes"),J=M(!1),le=M(null),Q=M([]),ne=M(""),V=hl({name:"",description:"",url:"",visibility:"friends"}),ye=[{label:a("wishes.form.visibilityPublic"),value:"public"},{label:a("wishes.form.visibilityFriends"),value:"friends"},{label:a("wishes.form.visibilityPrivate"),value:"private"}],we=()=>{V.name="",V.description="",V.url="",V.visibility="friends",le.value=null},fe=async()=>{if(!v.user)return;const i=C.value?u.value:v.user.id;if(!i)return;const o={name:V.name,...V.description&&{description:V.description},...V.url&&{url:V.url},visibility:V.visibility,created_for_user_id:i,created_by_user_id:v.user.id};let r;if(le.value?r=await Y(le.value,o):r=await p(o),r.error)f.notify({type:"negative",message:a("wishes.saveError")+": "+(r.error instanceof Error?r.error.message:JSON.stringify(r.error))});else if(f.notify({type:"positive",message:le.value?a("wishes.updateSuccess"):a("wishes.createSuccess")}),J.value=!1,we(),C.value){const H=await I(u.value,!0);H?.data&&(z.value=H.data)}else{const H=await k(v.user.id);H?.data&&(T.value=H.data)}},ie=i=>{V.name=i.name,V.description=i.description||"",V.url=i.url||"",V.visibility=i.visibility,le.value=i.id,J.value=!0},Be=async i=>{const o=await d(i);o.error?f.notify({type:"negative",message:a("wishes.deleteError")+": "+(o.error instanceof Error?o.error.message:JSON.stringify(o.error))}):f.notify({type:"positive",message:a("wishes.deleteSuccess")})},ve=async i=>{if(!v.user)return;const o=await U(i,v.user.id);if(o.error)f.notify({type:"negative",message:a("wishes.toggleBoughtError")+": "+(o.error instanceof Error?o.error.message:JSON.stringify(o.error))});else if(C.value){const r=await I(u.value);r?.data&&(z.value=r.data)}else{const r=await k(v.user.id);r?.data&&(T.value=r.data);const H=await B(v.user.id);H?.data&&(Q.value=H.data)}},re=async i=>{if(!v.user)return;const o=await Z(i,v.user.id);if(o.error)f.notify({type:"negative",message:a("wishes.toggleReceivedError")+": "+(typeof o.error=="string"?o.error:JSON.stringify(o.error))});else{if(C.value){const r=await I(u.value);r?.data&&(z.value=r.data)}else{const r=await k(v.user.id);r?.data&&(T.value=r.data);const H=await B(v.user.id);H?.data&&(Q.value=H.data)}f.notify({type:"positive",message:a("wishes.toggleReceivedSuccess")})}},Se=async()=>{if(!v.user)return;const i=await A(v.user.id);i?.data&&(Q.value=i.data)},l=async i=>{try{const{data:o,error:r}=await It.from("profiles").select("name, username").eq("id",i).single();if(r)throw r;ne.value=o.name||o.username||"Unknown"}catch{ne.value="Unknown"}};let n=null;const S=async()=>{!document.hidden&&v.user&&(await $(g.params.userId),x())};gl(async()=>{v.user&&(await $(g.params.userId),x()),n=()=>{S().catch(()=>{})},document.addEventListener("visibilitychange",n)}),wl(()=>{n&&(document.removeEventListener("visibilitychange",n),n=null),W()}),ge(()=>g.params.userId,async(i,o)=>{i!==o&&(ne.value="",await $(i),x())},{immediate:!0}),ge(()=>v.user?.id,async i=>{i?(await $(g.params.userId),x()):W()});const $=async i=>{if(v.user)if(i){T.value=[],z.value=[],Q.value=[],ne.value="",await l(i);const o=await m(i,!0);o?.data&&(z.value=o.data)}else{const o=T.value.length>0;T.value=[],z.value=[],Q.value=[],ne.value="";const r=await L(v.user.id,o,"active");r?.data&&(T.value=r.data),await Se()}},x=()=>{v.user&&(D&&D.unsubscribe(),D=It.channel("wishes_changes").on("postgres_changes",{event:"*",schema:"public",table:"wishes"},i=>{_(i)}).subscribe())},_=async i=>{if(!v.user)return;const{eventType:o,new:r,old:H}=i;if(o==="INSERT"&&r)C.value&&r.created_for_user_id===u.value?await y():!C.value&&r.created_for_user_id===v.user.id&&await y();else if(o==="UPDATE"&&r)if(!C.value&&r.created_for_user_id===v.user.id){await y();const N=await B(v.user.id);N?.data&&(Q.value=N.data)}else C.value&&r.created_for_user_id===u.value&&await y();else o==="DELETE"&&H&&(C.value?z.value=z.value.filter(N=>N.id!==H.id):(T.value=T.value.filter(N=>N.id!==H.id),Q.value=Q.value.filter(N=>N.id!==H.id)))},y=async()=>{if(v.user)if(C.value){const i=await I(u.value,!0);i?.data&&(z.value=i.data)}else{const i=await k(v.user.id);i?.data&&(T.value=i.data);const o=await B(v.user.id);o?.data&&(Q.value=o.data)}},W=()=>{D&&(D.unsubscribe(),D=null)};return(i,o)=>(q(),ae(Rl,{class:"q-pa-md"},{default:te(()=>[j("div",Gl,[j("div",ei,ue(C.value?`${ne.value}'s ${i.$t("wishes.wishes")}`:i.$t("wishes.title")),1),R(he,{color:"primary",icon:"add",label:C.value?i.$t("wishes.addForFriend"):i.$t("wishes.add"),onClick:o[0]||(o[0]=r=>J.value=!0)},null,8,["label"])]),C.value?(q(),X(De,{key:1},[ke(w)?(q(),X("div",si,[R(et,{size:"lg"})])):ce.value.length===0?(q(),X("div",ci,[R(Ne,{name:"card_giftcard",size:"4rem"}),j("div",di,ue(i.$t("wishes.noWishes")),1),j("div",null,ue(i.$t("wishes.friendHasNoWishes")),1)])):(q(),X("div",fi,[(q(!0),X(De,null,tt(ce.value,r=>(q(),ae(ut,{key:r.id,wish:r,"current-user-id":ke(v).user?.id,onToggleBought:ve,onToggleReceived:re},null,8,["wish","current-user-id"]))),128))]))],64)):(q(),X(De,{key:0},[R(Sl,{modelValue:G.value,"onUpdate:modelValue":o[1]||(o[1]=r=>G.value=r),class:"text-primary q-mb-md"},{default:te(()=>[R(Ct,{name:"my-wishes",label:i.$t("wishes.myWishes")},null,8,["label"]),R(Ct,{name:"archive",label:i.$t("wishes.archive")},null,8,["label"])]),_:1},8,["modelValue"]),R(pl),R(bl,{modelValue:G.value,"onUpdate:modelValue":o[2]||(o[2]=r=>G.value=r),animated:""},{default:te(()=>[R(kt,{name:"my-wishes"},{default:te(()=>[ke(w)?(q(),X("div",ti,[R(et,{size:"lg"})])):ce.value.length===0?(q(),X("div",li,[R(Ne,{name:"card_giftcard",size:"4rem"}),j("div",ii,ue(i.$t("wishes.noWishes")),1),j("div",null,ue(i.$t("wishes.addFirstWish")),1)])):(q(),X("div",ai,[(q(!0),X(De,null,tt(ce.value,r=>(q(),ae(ut,{key:r.id,wish:r,"current-user-id":ke(v).user?.id,onEdit:ie,onDelete:Be,onToggleBought:ve,onToggleReceived:re},null,8,["wish","current-user-id"]))),128))]))]),_:1}),R(kt,{name:"archive"},{default:te(()=>[ke(w)?(q(),X("div",ui,[R(et,{size:"lg"})])):Q.value.length===0?(q(),X("div",ni,[R(Ne,{name:"archive",size:"4rem"}),j("div",oi,ue(i.$t("wishes.noArchivedWishes")),1),j("div",null,ue(i.$t("wishes.noArchivedWishesDesc")),1)])):(q(),X("div",ri,[(q(!0),X(De,null,tt(Q.value,r=>(q(),ae(ut,{key:r.id,wish:r,"current-user-id":ke(v).user?.id,onToggleReceived:re},null,8,["wish","current-user-id"]))),128))]))]),_:1})]),_:1},8,["modelValue"])],64)),R(Dt,{modelValue:J.value,"onUpdate:modelValue":o[8]||(o[8]=r=>J.value=r),onHide:we},{default:te(()=>[R(Ot,{style:{width:"100%","max-width":"500px"}},{default:te(()=>[R(ot,null,{default:te(()=>[j("div",vi,ue(le.value?i.$t("wishes.editWish"):i.$t("wishes.addWish")),1)]),_:1}),R(ot,null,{default:te(()=>[R($l,{onSubmit:fe,class:"q-gutter-md"},{default:te(()=>[R(lt,{modelValue:V.name,"onUpdate:modelValue":o[3]||(o[3]=r=>V.name=r),label:i.$t("wishes.form.name"),outlined:"",rules:[r=>!!r||i.$t("wishes.form.nameRequired")]},null,8,["modelValue","label","rules"]),R(lt,{modelValue:V.description,"onUpdate:modelValue":o[4]||(o[4]=r=>V.description=r),label:i.$t("wishes.form.description"),type:"textarea",outlined:"",rows:"3"},null,8,["modelValue","label"]),R(lt,{modelValue:V.url,"onUpdate:modelValue":o[5]||(o[5]=r=>V.url=r),label:i.$t("wishes.form.url"),outlined:"",type:"url"},null,8,["modelValue","label"]),R(Hl,{modelValue:V.visibility,"onUpdate:modelValue":o[6]||(o[6]=r=>V.visibility=r),label:i.$t("wishes.form.visibility"),outlined:"",options:ye,"option-value":"value","option-label":"label","emit-value":"","map-options":""},null,8,["modelValue","label"]),j("div",mi,[R(he,{label:i.$t("common.cancel"),color:"grey",flat:"",onClick:o[7]||(o[7]=r=>J.value=!1)},null,8,["label"]),R(he,{type:"submit",label:i.$t("common.save"),color:"primary",loading:ke(w)},null,8,["label","loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{Mi as default};
