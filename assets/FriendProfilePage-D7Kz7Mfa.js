import{a as ke,u as Fe,C as F,r as g,b as Ve,x as Ce,y as B,h as l,o as n,e as m,f as a,A as T,g as u,z as E,t as c,p as v,ax as q,l as p,ay as We,v as L,az as H,F as S,m as qe,D as Y,Q as N,q as K,aN as Se,ab as Qe,aF as X,n as R,k as xe,aE as Ae,j as Ge,_ as Be}from"./index-DxFtmo9S.js";import{a as Ee,Q as Ne}from"./QSelect-BuQxNv4k.js";import{Q as Re}from"./QForm-DpY_kvLt.js";import{Q as De}from"./QPage-CqgmpTJy.js";import{C as Pe}from"./ClosePopup-ChbyU5jp.js";import{u as ze}from"./auth-store-CGPZAGPF.js";import{u as Ue}from"./useWishes-BytwW-Vn.js";import{supabase as Ie}from"./supabase-CGduY9fb.js";import{W as Me}from"./WishCard-KEpJZ0Q7.js";import{u as je}from"./useGroups-DND6HOqu.js";import"./QItem-MFkUIApp.js";import"./format-CWsRuMk_.js";import"./position-engine-Dork6qO3.js";import"./selection-D1MDbj6s.js";import"./rtl-DFPa-2ov.js";import"./QSlideTransition-oEldau95.js";import"./QBadge-CE-1QddA.js";import"./QTabs-DogQZteY.js";import"./QResizeObserver-DSOizNYj.js";const Oe={key:0,class:"flex justify-center"},Je={key:1,class:"text-center text-grey-6 q-py-lg"},Te={class:"text-h6 q-mt-md"},Le={key:2},He={class:"row items-center justify-between q-mb-md"},Ye={class:"text-h4"},Ke={class:"row items-center q-gutter-lg"},Xe=["src"],Ze={key:1},es={class:"friend-details"},ss={class:"text-h4"},ts={key:0,class:"text-h6 text-grey-6 q-mt-xs"},as={key:1,class:"text-body1 text-grey-7 q-mt-md"},rs={class:"text-grey-7"},os={class:"text-subtitle2"},is={class:"row q-col-gutter-sm"},ls={class:"wishes-section"},ns={class:"text-h5 q-my-md"},us={key:0,class:"flex justify-center"},ds={key:1,class:"text-center text-grey-6 q-py-lg"},ms={class:"text-h6 q-mt-md"},cs={key:2,class:"masonry"},fs={class:"text-h6"},vs={class:"text-h6"},gs={key:0,class:"text-caption text-grey-6"},ps={class:"row justify-end q-gutter-sm"},ys=ke({__name:"FriendProfilePage",setup(hs){const f=xe(),{t:i}=Fe(),D=Ae(),P=Ge(),y=ze(),{groups:h,fetchGroups:z,addMemberToGroup:Z,removeMemberFromGroup:U,fetchGroupMembers:V,membersByGroup:ee}=je(),se=F(()=>h.value.length>0),{fetchWishes:te,toggleBought:ae,toggleReceived:re,createWish:oe,updateWish:ie,deleteWish:le}=Ue(),Q=g(!0),x=g(!1),r=g(null),A=g([]),C=g(!1),W=g([]),ne=F(()=>D.params.id),I=F(()=>D.query.highlight||""),$=e=>e.name&&e.surname?`${e.name} ${e.surname}`:e.username||e.email,ue=e=>e.name&&e.surname?`${e.name.charAt(0)}${e.surname.charAt(0)}`:e.username?e.username.charAt(0).toUpperCase():e.email.charAt(0).toUpperCase(),de=(e,s)=>{const t=new Date(e),d=t.getDate(),_=t.getMonth()+1,$e=t.getFullYear();return s?`${d}. ${_}. ${$e}`:`${d}. ${_}.`},me=async()=>{try{const{data:e,error:s}=await Ie.from("profiles_public").select("*").eq("id",ne.value).single();if(s)throw s;r.value=e}catch(e){console.error("Error loading friend profile:",e),r.value=null}finally{Q.value=!1}},k=async()=>{if(!r.value)return;x.value=!0;const e=await te({userId:r.value.id,context:"all",isBackgroundRefresh:!0,forSelf:!1});e?.data&&(A.value=e.data),x.value=!1},w=g(!1),b=g(null),o=Ve({name:"",description:"",url:"",visibility:"friends"}),ce=[{label:i("wishes.form.visibilityPublic"),value:"public"},{label:i("wishes.form.visibilityFriends"),value:"friends"},{label:i("wishes.form.visibilityPrivate"),value:"private"}],fe=()=>{r.value&&(w.value=!0)},M=()=>{o.name="",o.description="",o.url="",o.visibility="friends",b.value=null},ve=async()=>{if(!y.user||!r.value)return;const e={name:o.name,...o.description&&{description:o.description},...o.url&&{url:o.url},visibility:o.visibility,created_for_user_id:r.value.id,created_by_user_id:y.user.id};let s;b.value?s=await ie(b.value,e):s=await oe(e),s.error?f.notify({type:"negative",message:i("wishes.saveError")+": "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):(f.notify({type:"positive",message:b.value?i("wishes.updateSuccess"):i("wishes.createSuccess")}),w.value=!1,M(),await k())},ge=e=>{o.name=e.name,o.description=e.description||"",o.url=e.url||"",o.visibility=e.visibility,b.value=e.id,w.value=!0},pe=async e=>{const s=await le(e);s.error?f.notify({type:"negative",message:i("wishes.deleteError")+": "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):(f.notify({type:"positive",message:i("wishes.deleteSuccess")}),await k())},ye=()=>{r.value&&f.dialog({title:i("friends.removeFriend"),message:i("friends.removeConfirm",{name:$(r.value)}),cancel:!0,persistent:!0}).onOk(()=>{f.notify({type:"info",message:i("friends.removeNotImplemented")})})},he=async e=>{if(!y.user)return;const s=await ae(e,y.user.id);s.error?f.notify({type:"negative",message:i("wishes.toggleBoughtError")+": "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):await k()},be=async e=>{if(!y.user)return;const s=await re(e,y.user.id);s.error?f.notify({type:"negative",message:i("wishes.toggleReceivedError")+": "+(typeof s.error=="string"?s.error:JSON.stringify(s.error))}):(await k(),f.notify({type:"positive",message:i("wishes.toggleReceivedSuccess")}))},j=()=>{window.history.length>1?P.back():P.push("/app/friends")},G=F(()=>{if(!r.value)return new Set;const e=new Set;for(const s of h.value)(ee.value[s.id]||[]).some(d=>d.user_id===r.value.id)&&e.add(s.id);return e}),O=F(()=>Array.from(G.value).map(e=>{const s=h.value.find(t=>t.id===e);return{id:e,label:s?.name||e}})),J=async()=>{if(r.value){await z();for(const e of h.value)await V(e.id);W.value=Array.from(G.value),C.value=!0}},we=async e=>{if(!r.value)return;const{error:s}=await U(e,r.value.id);if(s){const t=s instanceof Error?s.message:typeof s=="string"?s:i("common.error");f.notify({type:"negative",message:t})}else await V(e),f.notify({type:"positive",message:i("groups.messages.memberRemoved")})},_e=async()=>{if(!r.value)return;const e=new Set(Array.from(G.value)),s=new Set(W.value);for(const t of s)if(!e.has(t)){const{error:d}=await Z(t,r.value.id);if(d){const _=d instanceof Error?d.message:typeof d=="string"?d:i("common.error");f.notify({type:"negative",message:_})}}for(const t of e)if(!s.has(t)){const{error:d}=await U(t,r.value.id);if(d){const _=d instanceof Error?d.message:typeof d=="string"?d:i("common.error");f.notify({type:"negative",message:_})}}for(const t of h.value)await V(t.id);C.value=!1,f.notify({type:"positive",message:i("groups.messages.updated")})};return Ce(async()=>{await me(),r.value&&await k(),await z();for(const e of h.value)await V(e.id)}),(e,s)=>(n(),B(De,{class:"q-pa-md"},{default:l(()=>[Q.value?(n(),m("div",Oe,[a(T,{size:"lg"})])):r.value?(n(),m("div",Le,[u("div",He,[a(v,{flat:"",round:"",icon:"arrow_back",color:"primary",onClick:j}),u("div",Ye,c(e.$t("friends.friendProfile")),1),s[8]||(s[8]=u("div",null,null,-1))]),a(N,{class:"friend-profile-card q-mb-lg"},{default:l(()=>[a(p,null,{default:l(()=>[u("div",Ke,[a(We,{size:"120px",color:"primary","text-color":"white"},{default:l(()=>[r.value.avatar_url?(n(),m("img",{key:0,src:r.value.avatar_url},null,8,Xe)):(n(),m("span",Ze,c(ue(r.value)),1))]),_:1}),u("div",es,[u("div",ss,c($(r.value)),1),r.value.username?(n(),m("div",ts," @"+c(r.value.username),1)):q("",!0),r.value.date_of_birth?(n(),m("div",as,[a(E,{name:"cake",size:"20px",class:"q-mr-xs"}),L(" "+c(de(r.value.date_of_birth,r.value.birth_year_visible??!1)),1)])):q("",!0)])])]),_:1}),a(H,{align:"center",class:"q-gutter-md"},{default:l(()=>[a(v,{color:"primary",icon:"add_circle",label:e.$t("wishes.addForFriend"),onClick:fe},null,8,["label"]),a(v,{color:"negative",outline:"",icon:"person_remove",label:e.$t("friends.removeFriend"),onClick:ye},null,8,["label"])]),_:1}),se.value?(n(),m(S,{key:0},[a(qe),O.value.length===0?(n(),B(p,{key:0,class:"row items-center justify-between"},{default:l(()=>[u("div",rs,c(e.$t("groups.noMemberships")),1),a(v,{size:"sm",flat:"",icon:"group_add",label:e.$t("groups.manage"),onClick:J},null,8,["label"])]),_:1})):(n(),m(S,{key:1},[a(p,{class:"row items-center justify-between"},{default:l(()=>[u("div",os,c(e.$t("groups.memberships")),1),a(v,{size:"sm",flat:"",icon:"group_add",label:e.$t("groups.manage"),onClick:J},null,8,["label"])]),_:1}),a(p,null,{default:l(()=>[u("div",is,[(n(!0),m(S,null,Y(O.value,t=>(n(),B(Ee,{key:t.id,color:"primary","text-color":"white",removable:"",onRemove:d=>we(t.id)},{default:l(()=>[L(c(t.label),1)]),_:2},1032,["onRemove"]))),128))])]),_:1})],64))],64)):q("",!0)]),_:1}),u("div",ls,[u("div",ns,c(e.$t("friends.friendWishes",{name:$(r.value)})),1),x.value?(n(),m("div",us,[a(T,{size:"lg"})])):A.value.length===0?(n(),m("div",ds,[a(E,{name:"card_giftcard",size:"4rem"}),u("div",ms,c(e.$t("wishes.noWishes")),1),u("div",null,c(e.$t("friends.friendHasNoWishes")),1)])):(n(),m("div",cs,[(n(!0),m(S,null,Y(A.value,t=>(n(),m("div",{key:t.id,class:"masonry-item"},[a(Me,{wish:t,"current-user-id":K(y).user?.id,expanded:t.id===I.value,highlight:t.id===I.value,onEdit:ge,onDelete:pe,onToggleBought:he,onToggleReceived:be},null,8,["wish","current-user-id","expanded","highlight"])]))),128))]))])])):(n(),m("div",Je,[a(E,{name:"person_off",size:"4rem"}),u("div",Te,c(e.$t("friends.friendNotFound")),1),u("div",null,c(e.$t("friends.friendNotFoundDesc")),1),a(v,{color:"primary",label:e.$t("common.back"),class:"q-mt-md",onClick:j},null,8,["label"])])),a(X,{modelValue:C.value,"onUpdate:modelValue":s[1]||(s[1]=t=>C.value=t)},{default:l(()=>[a(N,{style:{width:"520px","max-width":"90vw"}},{default:l(()=>[a(p,null,{default:l(()=>[u("div",fs,c(e.$t("groups.manageFor",{name:r.value?$(r.value):""})),1)]),_:1}),a(p,null,{default:l(()=>[a(Se,{modelValue:W.value,"onUpdate:modelValue":s[0]||(s[0]=t=>W.value=t),type:"checkbox",options:K(h).map(t=>({label:t.name,value:t.id}))},null,8,["modelValue","options"])]),_:1}),a(H,{align:"right"},{default:l(()=>[Qe(a(v,{flat:"",label:e.$t("common.cancel")},null,8,["label"]),[[Pe]]),a(v,{color:"primary",label:e.$t("common.save"),onClick:_e},null,8,["label"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(X,{modelValue:w.value,"onUpdate:modelValue":s[7]||(s[7]=t=>w.value=t),onHide:M},{default:l(()=>[a(N,{style:{width:"100%","max-width":"500px"}},{default:l(()=>[a(p,null,{default:l(()=>[u("div",vs,c(b.value?e.$t("wishes.editWish"):e.$t("wishes.addForFriend")),1),r.value?(n(),m("div",gs,c(b.value?e.$t("wishes.editingWish"):e.$t("wishes.addingForUser",{name:$(r.value)})),1)):q("",!0)]),_:1}),a(p,null,{default:l(()=>[a(Re,{onSubmit:ve,class:"q-gutter-md"},{default:l(()=>[a(R,{modelValue:o.name,"onUpdate:modelValue":s[2]||(s[2]=t=>o.name=t),label:e.$t("wishes.form.name"),outlined:"",rules:[t=>!!t||e.$t("wishes.form.nameRequired")]},null,8,["modelValue","label","rules"]),a(R,{modelValue:o.description,"onUpdate:modelValue":s[3]||(s[3]=t=>o.description=t),label:e.$t("wishes.form.description"),type:"textarea",outlined:"",rows:"3"},null,8,["modelValue","label"]),a(R,{modelValue:o.url,"onUpdate:modelValue":s[4]||(s[4]=t=>o.url=t),label:e.$t("wishes.form.url"),outlined:"",type:"url"},null,8,["modelValue","label"]),a(Ne,{modelValue:o.visibility,"onUpdate:modelValue":s[5]||(s[5]=t=>o.visibility=t),label:e.$t("wishes.form.visibility"),outlined:"",options:ce,"option-value":"value","option-label":"label","emit-value":"","map-options":""},null,8,["modelValue","label"]),u("div",ps,[a(v,{label:e.$t("common.cancel"),color:"grey",flat:"",onClick:s[6]||(s[6]=t=>w.value=!1)},null,8,["label"]),a(v,{type:"submit",label:e.$t("common.save"),color:"primary",loading:Q.value},null,8,["label","loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),Ds=Be(ys,[["__scopeId","data-v-999039ce"]]);export{Ds as default};
