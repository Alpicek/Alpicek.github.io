import{a as ie,r as h,z as A,b as re,n as ae,p as D,f as c,o as l,c as u,e as t,s as R,h as n,q as k,t as d,k as p,g as W,ax as oe,at as q,x as le,aw as ne,Q as E,au as ue,av as de,j as F,aD as ce,aC as me,u as ve,l as fe}from"./index-COPe4EcT.js";import{Q as ge}from"./QSelect-Dwy0dFK7.js";import{Q as he}from"./QForm-BUqB0M-v.js";import{Q as pe}from"./QPage-DYRhZ49L.js";import{u as ye}from"./use-quasar-DPWoZfwT.js";import{u as be}from"./auth-store-CTNkRgTD.js";import{u as _e}from"./useWishes-DnAPSs4_.js";import{supabase as we}from"./supabase-BsVPPZc6.js";import{W as $e}from"./WishCard-CIQNuhvb.js";import{u as ke}from"./vue-i18n.runtime-CVW0pg2b.js";import{_ as We}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QItem-DG-oI0NZ.js";import"./format-YjKVRXLa.js";import"./position-engine-CTDbD8h5.js";import"./selection-CTqLNiJL.js";import"./rtl-DFPa-2ov.js";const qe={key:0,class:"flex justify-center"},Fe={key:1,class:"text-center text-grey-6 q-py-lg"},Ve={class:"text-h6 q-mt-md"},Qe={key:2},xe={class:"row items-center justify-between q-mb-lg"},Ce={class:"text-h4"},Se={class:"row items-center q-gutter-lg"},Be=["src"],Ne={key:1},Ae={class:"friend-details"},De={class:"text-h4"},Re={key:0,class:"text-h6 text-grey-6 q-mt-xs"},Ee={key:1,class:"text-body1 text-grey-7 q-mt-md"},Pe={class:"wishes-section"},Ie={class:"text-h5 q-mb-md"},Ue={key:0,class:"flex justify-center"},ze={key:1,class:"text-center text-grey-6 q-py-lg"},Oe={class:"text-h6 q-mt-md"},je={key:2,class:"row q-gutter-md"},Je={class:"text-h6"},Le={key:0,class:"text-caption text-grey-6"},Te={class:"row justify-end q-gutter-sm"},He=ie({__name:"FriendProfilePage",setup(Me){const m=ye(),{t:o}=ke(),V=me(),Q=ve(),v=be(),{fetchWishes:P,toggleBought:I,toggleReceived:U,createWish:z,updateWish:O,deleteWish:j}=_e(),_=h(!0),w=h(!1),i=h(null),$=h([]),J=A(()=>V.params.id),x=A(()=>V.query.highlight||""),b=e=>e.name&&e.surname?`${e.name} ${e.surname}`:e.username||e.email,L=e=>e.name&&e.surname?`${e.name.charAt(0)}${e.surname.charAt(0)}`:e.username?e.username.charAt(0).toUpperCase():e.email.charAt(0).toUpperCase(),T=(e,s)=>{const a=new Date(e),B=a.getDate(),N=a.getMonth()+1,te=a.getFullYear();return s?`${B}. ${N}. ${te}`:`${B}. ${N}.`},H=async()=>{try{const{data:e,error:s}=await we.from("profiles").select("*").eq("id",J.value).single();if(s)throw s;i.value=e}catch(e){console.error("Error loading friend profile:",e),i.value=null}finally{_.value=!1}},y=async()=>{if(!i.value)return;w.value=!0;const e=await P({userId:i.value.id,context:"all",isBackgroundRefresh:!0,forSelf:!1});e?.data&&($.value=e.data),w.value=!1},g=h(!1),f=h(null),r=re({name:"",description:"",url:"",visibility:"friends"}),M=[{label:o("wishes.form.visibilityPublic"),value:"public"},{label:o("wishes.form.visibilityFriends"),value:"friends"},{label:o("wishes.form.visibilityPrivate"),value:"private"}],Y=()=>{i.value&&(g.value=!0)},C=()=>{r.name="",r.description="",r.url="",r.visibility="friends",f.value=null},G=async()=>{if(!v.user||!i.value)return;const e={name:r.name,...r.description&&{description:r.description},...r.url&&{url:r.url},visibility:r.visibility,created_for_user_id:i.value.id,created_by_user_id:v.user.id};let s;f.value?s=await O(f.value,e):s=await z(e),s.error?m.notify({type:"negative",message:o("wishes.saveError")+": "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):(m.notify({type:"positive",message:f.value?o("wishes.updateSuccess"):o("wishes.createSuccess")}),g.value=!1,C(),await y())},K=e=>{r.name=e.name,r.description=e.description||"",r.url=e.url||"",r.visibility=e.visibility,f.value=e.id,g.value=!0},X=async e=>{const s=await j(e);s.error?m.notify({type:"negative",message:o("wishes.deleteError")+": "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):(m.notify({type:"positive",message:o("wishes.deleteSuccess")}),await y())},Z=()=>{i.value&&m.dialog({title:o("friends.removeFriend"),message:o("friends.removeConfirm",{name:b(i.value)}),cancel:!0,persistent:!0}).onOk(()=>{m.notify({type:"info",message:o("friends.removeNotImplemented")})})},ee=async e=>{if(!v.user)return;const s=await I(e,v.user.id);s.error?m.notify({type:"negative",message:o("wishes.toggleBoughtError")+": "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):await y()},se=async e=>{if(!v.user)return;const s=await U(e,v.user.id);s.error?m.notify({type:"negative",message:o("wishes.toggleReceivedError")+": "+(typeof s.error=="string"?s.error:JSON.stringify(s.error))}):(await y(),m.notify({type:"positive",message:o("wishes.toggleReceivedSuccess")}))},S=()=>{window.history.length>1?Q.back():Q.push("/app/friends")};return ae(async()=>{await H(),i.value&&await y()}),(e,s)=>(l(),D(pe,{class:"q-pa-md"},{default:c(()=>[_.value?(l(),u("div",qe,[t(R,{size:"lg"})])):i.value?(l(),u("div",Qe,[n("div",xe,[t(p,{flat:"",round:"",icon:"arrow_back",color:"primary",onClick:S}),n("div",Ce,d(e.$t("friends.friendProfile")),1),s[6]||(s[6]=n("div",null,null,-1))]),t(E,{class:"friend-profile-card q-mb-lg"},{default:c(()=>[t(W,null,{default:c(()=>[n("div",Se,[t(oe,{size:"120px",color:"primary","text-color":"white"},{default:c(()=>[i.value.avatar_url?(l(),u("img",{key:0,src:i.value.avatar_url},null,8,Be)):(l(),u("span",Ne,d(L(i.value)),1))]),_:1}),n("div",Ae,[n("div",De,d(b(i.value)),1),i.value.username?(l(),u("div",Re," @"+d(i.value.username),1)):q("",!0),i.value.date_of_birth?(l(),u("div",Ee,[t(k,{name:"cake",size:"20px",class:"q-mr-xs"}),le(" "+d(T(i.value.date_of_birth,i.value.birth_year_visible??!1)),1)])):q("",!0)])])]),_:1}),t(ne,{align:"center",class:"q-gutter-md"},{default:c(()=>[t(p,{color:"primary",icon:"add_circle",label:e.$t("wishes.addForFriend"),onClick:Y},null,8,["label"]),t(p,{color:"negative",outline:"",icon:"person_remove",label:e.$t("friends.removeFriend"),onClick:Z},null,8,["label"])]),_:1})]),_:1}),n("div",Pe,[n("div",Ie,d(e.$t("friends.friendWishes",{name:b(i.value)})),1),w.value?(l(),u("div",Ue,[t(R,{size:"lg"})])):$.value.length===0?(l(),u("div",ze,[t(k,{name:"card_giftcard",size:"4rem"}),n("div",Oe,d(e.$t("wishes.noWishes")),1),n("div",null,d(e.$t("friends.friendHasNoWishes")),1)])):(l(),u("div",je,[(l(!0),u(ue,null,de($.value,a=>(l(),D($e,{key:a.id,wish:a,"current-user-id":fe(v).user?.id,expanded:a.id===x.value,highlight:a.id===x.value,onEdit:K,onDelete:X,onToggleBought:ee,onToggleReceived:se},null,8,["wish","current-user-id","expanded","highlight"]))),128))]))])])):(l(),u("div",Fe,[t(k,{name:"person_off",size:"4rem"}),n("div",Ve,d(e.$t("friends.friendNotFound")),1),n("div",null,d(e.$t("friends.friendNotFoundDesc")),1),t(p,{color:"primary",label:e.$t("common.back"),class:"q-mt-md",onClick:S},null,8,["label"])])),t(ce,{modelValue:g.value,"onUpdate:modelValue":s[5]||(s[5]=a=>g.value=a),onHide:C},{default:c(()=>[t(E,{style:{width:"100%","max-width":"500px"}},{default:c(()=>[t(W,null,{default:c(()=>[n("div",Je,d(f.value?e.$t("wishes.editWish"):e.$t("wishes.addForFriend")),1),i.value?(l(),u("div",Le,d(f.value?e.$t("wishes.editingWish"):e.$t("wishes.addingForUser",{name:b(i.value)})),1)):q("",!0)]),_:1}),t(W,null,{default:c(()=>[t(he,{onSubmit:G,class:"q-gutter-md"},{default:c(()=>[t(F,{modelValue:r.name,"onUpdate:modelValue":s[0]||(s[0]=a=>r.name=a),label:e.$t("wishes.form.name"),outlined:"",rules:[a=>!!a||e.$t("wishes.form.nameRequired")]},null,8,["modelValue","label","rules"]),t(F,{modelValue:r.description,"onUpdate:modelValue":s[1]||(s[1]=a=>r.description=a),label:e.$t("wishes.form.description"),type:"textarea",outlined:"",rows:"3"},null,8,["modelValue","label"]),t(F,{modelValue:r.url,"onUpdate:modelValue":s[2]||(s[2]=a=>r.url=a),label:e.$t("wishes.form.url"),outlined:"",type:"url"},null,8,["modelValue","label"]),t(ge,{modelValue:r.visibility,"onUpdate:modelValue":s[3]||(s[3]=a=>r.visibility=a),label:e.$t("wishes.form.visibility"),outlined:"",options:M,"option-value":"value","option-label":"label","emit-value":"","map-options":""},null,8,["modelValue","label"]),n("div",Te,[t(p,{label:e.$t("common.cancel"),color:"grey",flat:"",onClick:s[4]||(s[4]=a=>g.value=!1)},null,8,["label"]),t(p,{type:"submit",label:e.$t("common.save"),color:"primary",loading:_.value},null,8,["label","loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),cs=We(He,[["__scopeId","data-v-01614068"]]);export{cs as default};
