import{h as rt,a3 as ul,l as st,a4 as nl,i as h,O as ol,a5 as rl,j as A,s as _e,a6 as sl,L as Ce,G as cl,r as M,p as he,M as ve,a7 as dl,a8 as fl,a9 as vl,aa as ml,A as Ft,ab as Te,ac as hl,J as Ze,ad as gl,ae as yl,v as Be,W as Sl,V as wl,a as xt,X as le,o as B,w as Z,e as $,f as Q,t as ie,_ as ce,c as K,Q as me,b as bl,q as pl,af as Vl,U as kl,g as ke,ag as et,a1 as De,a0 as tt}from"./index-fFjDkX5r.js";import{r as nt,a as _t,Q as Cl,b as _l,d as qt,c as ql}from"./QTabPanels-s-6enFEf.js";import{Q as Et,a as ot}from"./QCard-BUNUv77W.js";import{u as Ot,a as ct,b as Mt,c as Tt,d as Al,e as Il,f as At,g as Rl,Q as lt}from"./QInput-J2-r8M5A.js";import{a as zl,b as $l,u as Bl}from"./useAuth-DWQvxLYB.js";import{a as Fl,b as xl,Q as El}from"./QItem-DWT8Hj2m.js";import{n as It,Q as Ol}from"./format-BOpcCZfB.js";import{Q as Dt,_ as Ml}from"./_plugin-vue_export-helper-BlsDF-ts.js";import{Q as Tl}from"./QForm-BunYafRt.js";import{Q as Dl}from"./QPage-rHJ2nJN6.js";import{u as Ll}from"./useWishes-CDKJNxJz.js";import{u as Lt}from"./use-quasar-Bvrs6rjI.js";import{supabase as Rt}from"./supabase-CzT8qtRc.js";import{Q as Wl}from"./QCardActions-78I1DhQh.js";import{u as Wt}from"./vue-i18n.runtime-BiswryzK.js";import"./selection-HIDmADjc.js";import"./use-prevent-scroll-BlaFays2.js";const Hl=rt({name:"QField",inheritAttrs:!1,props:{...ct,tag:{type:String,default:"label"}},emits:Ot,setup(){return Mt(Tt({tagProp:!0}))}}),Pl={xs:8,sm:10,md:14,lg:20,xl:24},je=rt({name:"QChip",props:{...zl,...ul,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(e,{slots:f,emit:u}){const{proxy:{$q:g}}=st(),v=$l(e,g),r=nl(e,Pl),p=h(()=>e.selected===!0||e.icon!==void 0),y=h(()=>e.selected===!0?e.iconSelected||g.iconSet.chip.selected:e.icon),w=h(()=>e.iconRemove||g.iconSet.chip.remove),O=h(()=>e.disable===!1&&(e.clickable===!0||e.selected!==null)),m=h(()=>{const n=e.outline===!0&&e.color||e.textColor;return"q-chip row inline no-wrap items-center"+(e.outline===!1&&e.color!==void 0?` bg-${e.color}`:"")+(n?` text-${n} q-chip--colored`:"")+(e.disable===!0?" disabled":"")+(e.dense===!0?" q-chip--dense":"")+(e.outline===!0?" q-chip--outline":"")+(e.selected===!0?" q-chip--selected":"")+(O.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(e.square===!0?" q-chip--square":"")+(v.value===!0?" q-chip--dark q-dark":"")}),V=h(()=>{const n=e.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:e.tabindex||0},W={...n,role:"button","aria-hidden":"false","aria-label":e.removeAriaLabel||g.lang.label.remove};return{chip:n,remove:W}});function k(n){n.keyCode===13&&q(n)}function q(n){e.disable||(u("update:selected",!e.selected),u("click",n))}function z(n){(n.keyCode===void 0||n.keyCode===13)&&(Ce(n),e.disable===!1&&(u("update:modelValue",!1),u("remove")))}function U(){const n=[];O.value===!0&&n.push(A("div",{class:"q-focus-helper"})),p.value===!0&&n.push(A(_e,{class:"q-chip__icon q-chip__icon--left",name:y.value}));const W=e.label!==void 0?[A("div",{class:"ellipsis"},[e.label])]:void 0;return n.push(A("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},sl(f.default,W))),e.iconRight&&n.push(A(_e,{class:"q-chip__icon q-chip__icon--right",name:e.iconRight})),e.removable===!0&&n.push(A(_e,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:w.value,...V.value.remove,onClick:z,onKeyup:z})),n}return()=>{if(e.modelValue===!1)return;const n={class:m.value,style:r.value};return O.value===!0&&Object.assign(n,V.value.chip,{onClick:q,onKeyup:k}),ol("div",n,U(),"ripple",e.ripple!==!1&&e.disable!==!0,()=>[[rl,e.ripple]])}}}),ae=1e3,Ql=["start","center","end","start-force","center-force","end-force"],Ht=Array.prototype.filter,Ul=window.getComputedStyle(document.body).overflowAnchor===void 0?cl:function(e,f){e!==null&&(e._qOverflowAnimationFrame!==void 0&&cancelAnimationFrame(e._qOverflowAnimationFrame),e._qOverflowAnimationFrame=requestAnimationFrame(()=>{if(e===null)return;e._qOverflowAnimationFrame=void 0;const u=e.children||[];Ht.call(u,v=>v.dataset&&v.dataset.qVsAnchor!==void 0).forEach(v=>{delete v.dataset.qVsAnchor});const g=u[f];g?.dataset&&(g.dataset.qVsAnchor="")}))};function Fe(e,f){return e+f}function it(e,f,u,g,v,r,p,y){const w=e===window?document.scrollingElement||document.documentElement:e,O=v===!0?"offsetWidth":"offsetHeight",m={scrollStart:0,scrollViewSize:-p-y,scrollMaxSize:0,offsetStart:-p,offsetEnd:-y};if(v===!0?(e===window?(m.scrollStart=window.pageXOffset||window.scrollX||document.body.scrollLeft||0,m.scrollViewSize+=document.documentElement.clientWidth):(m.scrollStart=w.scrollLeft,m.scrollViewSize+=w.clientWidth),m.scrollMaxSize=w.scrollWidth,r===!0&&(m.scrollStart=(nt===!0?m.scrollMaxSize-m.scrollViewSize:0)-m.scrollStart)):(e===window?(m.scrollStart=window.pageYOffset||window.scrollY||document.body.scrollTop||0,m.scrollViewSize+=document.documentElement.clientHeight):(m.scrollStart=w.scrollTop,m.scrollViewSize+=w.clientHeight),m.scrollMaxSize=w.scrollHeight),u!==null)for(let V=u.previousElementSibling;V!==null;V=V.previousElementSibling)V.classList.contains("q-virtual-scroll--skip")===!1&&(m.offsetStart+=V[O]);if(g!==null)for(let V=g.nextElementSibling;V!==null;V=V.nextElementSibling)V.classList.contains("q-virtual-scroll--skip")===!1&&(m.offsetEnd+=V[O]);if(f!==e){const V=w.getBoundingClientRect(),k=f.getBoundingClientRect();v===!0?(m.offsetStart+=k.left-V.left,m.offsetEnd-=k.width):(m.offsetStart+=k.top-V.top,m.offsetEnd-=k.height),e!==window&&(m.offsetStart+=m.scrollStart),m.offsetEnd+=m.scrollMaxSize-m.offsetStart}return m}function zt(e,f,u,g){f==="end"&&(f=(e===window?document.body:e)[u===!0?"scrollWidth":"scrollHeight"]),e===window?u===!0?(g===!0&&(f=(nt===!0?document.body.scrollWidth-document.documentElement.clientWidth:0)-f),window.scrollTo(f,window.pageYOffset||window.scrollY||document.body.scrollTop||0)):window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,f):u===!0?(g===!0&&(f=(nt===!0?e.scrollWidth-e.offsetWidth:0)-f),e.scrollLeft=f):e.scrollTop=f}function Le(e,f,u,g){if(u>=g)return 0;const v=f.length,r=Math.floor(u/ae),p=Math.floor((g-1)/ae)+1;let y=e.slice(r,p).reduce(Fe,0);return u%ae!==0&&(y-=f.slice(r*ae,u).reduce(Fe,0)),g%ae!==0&&g!==v&&(y-=f.slice(g,p*ae).reduce(Fe,0)),y}const Nl={virtualScrollSliceSize:{type:[Number,String],default:10},virtualScrollSliceRatioBefore:{type:[Number,String],default:1},virtualScrollSliceRatioAfter:{type:[Number,String],default:1},virtualScrollItemSize:{type:[Number,String],default:24},virtualScrollStickySizeStart:{type:[Number,String],default:0},virtualScrollStickySizeEnd:{type:[Number,String],default:0},tableColspan:[Number,String]},$t={virtualScrollHorizontal:Boolean,onVirtualScroll:Function,...Nl};function jl({virtualScrollLength:e,getVirtualScrollTarget:f,getVirtualScrollEl:u,virtualScrollItemSizeComputed:g}){const v=st(),{props:r,emit:p,proxy:y}=v,{$q:w}=y;let O,m,V,k=[],q;const z=M(0),U=M(0),n=M({}),W=M(null),J=M(null),D=M(null),I=M({from:0,to:0}),re=h(()=>r.tableColspan!==void 0?r.tableColspan:100);g===void 0&&(g=h(()=>r.virtualScrollItemSize));const L=h(()=>g.value+";"+r.virtualScrollHorizontal),Y=h(()=>L.value+";"+r.virtualScrollSliceRatioBefore+";"+r.virtualScrollSliceRatioAfter);he(Y,()=>{te()}),he(L,X);function X(){de(m,!0)}function ee(l){de(l===void 0?m:l)}function P(l,s){const S=f();if(S==null||S.nodeType===8)return;const F=it(S,u(),W.value,J.value,r.virtualScrollHorizontal,w.lang.rtl,r.virtualScrollStickySizeStart,r.virtualScrollStickySizeEnd);V!==F.scrollViewSize&&te(F.scrollViewSize),C(S,F,Math.min(e.value-1,Math.max(0,parseInt(l,10)||0)),0,Ql.indexOf(s)!==-1?s:m!==-1&&l>m?"end":"start")}function ue(){const l=f();if(l==null||l.nodeType===8)return;const s=it(l,u(),W.value,J.value,r.virtualScrollHorizontal,w.lang.rtl,r.virtualScrollStickySizeStart,r.virtualScrollStickySizeEnd),S=e.value-1,F=s.scrollMaxSize-s.offsetStart-s.offsetEnd-U.value;if(O===s.scrollStart)return;if(s.scrollMaxSize<=0){C(l,s,0,0);return}V!==s.scrollViewSize&&te(s.scrollViewSize),ge(I.value.from);const T=Math.floor(s.scrollMaxSize-Math.max(s.scrollViewSize,s.offsetEnd)-Math.min(q[S],s.scrollViewSize/2));if(T>0&&Math.ceil(s.scrollStart)>=T){C(l,s,S,s.scrollMaxSize-s.offsetEnd-k.reduce(Fe,0));return}let _=0,i=s.scrollStart-s.offsetStart,o=i;if(i<=F&&i+s.scrollViewSize>=z.value)i-=z.value,_=I.value.from,o=i;else for(let a=0;i>=k[a]&&_<S;a++)i-=k[a],_+=ae;for(;i>0&&_<S;)i-=q[_],i>-s.scrollViewSize?(_++,o=i):o=q[_]+i;C(l,s,_,o)}function C(l,s,S,F,T){const _=typeof T=="string"&&T.indexOf("-force")!==-1,i=_===!0?T.replace("-force",""):T,o=i!==void 0?i:"start";let a=Math.max(0,S-n.value[o]),R=a+n.value.total;R>e.value&&(R=e.value,a=Math.max(0,R-n.value.total)),O=s.scrollStart;const N=a!==I.value.from||R!==I.value.to;if(N===!1&&i===void 0){fe(S);return}const{activeElement:We}=document,se=D.value;N===!0&&se!==null&&se!==We&&se.contains(We)===!0&&(se.addEventListener("focusout",ye),setTimeout(()=>{se?.removeEventListener("focusout",ye)})),Ul(se,S-a);const He=i!==void 0?q.slice(a,S).reduce(Fe,0):0;if(N===!0){const we=R>=I.value.from&&a<=I.value.to?I.value.to:R;I.value={from:a,to:we},z.value=Le(k,q,0,a),U.value=Le(k,q,R,e.value),requestAnimationFrame(()=>{I.value.to!==R&&O===s.scrollStart&&(I.value={from:I.value.from,to:R},U.value=Le(k,q,R,e.value))})}requestAnimationFrame(()=>{if(O!==s.scrollStart)return;N===!0&&ge(a);const we=q.slice(a,S).reduce(Fe,0),be=we+s.offsetStart+z.value,Pe=be+q[S];let Ee=be+F;if(i!==void 0){const Ke=we-He,Oe=s.scrollStart+Ke;Ee=_!==!0&&Oe<be&&Pe<Oe+s.scrollViewSize?Oe:i==="end"?Pe-s.scrollViewSize:be-(i==="start"?0:Math.round((s.scrollViewSize-q[S])/2))}O=Ee,zt(l,Ee,r.virtualScrollHorizontal,w.lang.rtl),fe(S)})}function ge(l){const s=D.value;if(s){const S=Ht.call(s.children,a=>a.classList&&a.classList.contains("q-virtual-scroll--skip")===!1),F=S.length,T=r.virtualScrollHorizontal===!0?a=>a.getBoundingClientRect().width:a=>a.offsetHeight;let _=l,i,o;for(let a=0;a<F;){for(i=T(S[a]),a++;a<F&&S[a].classList.contains("q-virtual-scroll--with-prev")===!0;)i+=T(S[a]),a++;o=i-q[_],o!==0&&(q[_]+=o,k[Math.floor(_/ae)]+=o),_++}}}function ye(){D.value?.focus()}function de(l,s){const S=1*g.value;(s===!0||Array.isArray(q)===!1)&&(q=[]);const F=q.length;q.length=e.value;for(let _=e.value-1;_>=F;_--)q[_]=S;const T=Math.floor((e.value-1)/ae);k=[];for(let _=0;_<=T;_++){let i=0;const o=Math.min((_+1)*ae,e.value);for(let a=_*ae;a<o;a++)i+=q[a];k.push(i)}m=-1,O=void 0,z.value=Le(k,q,0,I.value.from),U.value=Le(k,q,I.value.to,e.value),l>=0?(ge(I.value.from),ve(()=>{P(l)})):ne()}function te(l){if(l===void 0&&typeof window<"u"){const i=f();i!=null&&i.nodeType!==8&&(l=it(i,u(),W.value,J.value,r.virtualScrollHorizontal,w.lang.rtl,r.virtualScrollStickySizeStart,r.virtualScrollStickySizeEnd).scrollViewSize)}V=l;const s=parseFloat(r.virtualScrollSliceRatioBefore)||0,S=parseFloat(r.virtualScrollSliceRatioAfter)||0,F=1+s+S,T=l===void 0||l<=0?1:Math.ceil(l/g.value),_=Math.max(1,T,Math.ceil((r.virtualScrollSliceSize>0?r.virtualScrollSliceSize:10)/F));n.value={total:Math.ceil(_*F),start:Math.ceil(_*s),center:Math.ceil(_*(.5+s)),end:Math.ceil(_*(1+s)),view:T}}function xe(l,s){const S=r.virtualScrollHorizontal===!0?"width":"height",F={["--q-virtual-scroll-item-"+S]:g.value+"px"};return[l==="tbody"?A(l,{class:"q-virtual-scroll__padding",key:"before",ref:W},[A("tr",[A("td",{style:{[S]:`${z.value}px`,...F},colspan:re.value})])]):A(l,{class:"q-virtual-scroll__padding",key:"before",ref:W,style:{[S]:`${z.value}px`,...F}}),A(l,{class:"q-virtual-scroll__content",key:"content",ref:D,tabindex:-1},s.flat()),l==="tbody"?A(l,{class:"q-virtual-scroll__padding",key:"after",ref:J},[A("tr",[A("td",{style:{[S]:`${U.value}px`,...F},colspan:re.value})])]):A(l,{class:"q-virtual-scroll__padding",key:"after",ref:J,style:{[S]:`${U.value}px`,...F}})]}function fe(l){m!==l&&(r.onVirtualScroll!==void 0&&p("virtualScroll",{index:l,from:I.value.from,to:I.value.to-1,direction:l<m?"decrease":"increase",ref:y}),m=l)}te();const ne=dl(ue,w.platform.is.ios===!0?120:35);fl(()=>{te()});let Se=!1;return vl(()=>{Se=!0}),ml(()=>{if(Se!==!0)return;const l=f();O!==void 0&&l!==void 0&&l!==null&&l.nodeType!==8?zt(l,O,r.virtualScrollHorizontal,w.lang.rtl):P(m)}),Ft(()=>{ne.cancel()}),Object.assign(y,{scrollTo:P,reset:X,refresh:ee}),{virtualScrollSliceRange:I,virtualScrollSliceSizeComputed:n,setVirtualScrollSize:te,onVirtualScrollEvt:ne,localResetVirtualScroll:de,padVirtualScroll:xe,scrollTo:P,reset:X,refresh:ee}}const Bt=e=>["add","add-unique","toggle"].includes(e),Kl=".*+?^${}()|[]\\",Xl=Object.keys(ct);function at(e,f){if(typeof e=="function")return e;const u=e!==void 0?e:f;return g=>g!==null&&typeof g=="object"&&u in g?g[u]:g}const Jl=rt({name:"QSelect",inheritAttrs:!1,props:{...$t,...Al,...ct,modelValue:{required:!0},multiple:Boolean,displayValue:[String,Number],displayValueHtml:Boolean,dropdownIcon:String,options:{type:Array,default:()=>[]},optionValue:[Function,String],optionLabel:[Function,String],optionDisable:[Function,String],hideSelected:Boolean,hideDropdownIcon:Boolean,fillInput:Boolean,maxValues:[Number,String],optionsDense:Boolean,optionsDark:{type:Boolean,default:null},optionsSelectedClass:String,optionsHtml:Boolean,optionsCover:Boolean,menuShrink:Boolean,menuAnchor:String,menuSelf:String,menuOffset:Array,popupContentClass:String,popupContentStyle:[String,Array,Object],popupNoRouteDismiss:Boolean,useInput:Boolean,useChips:Boolean,newValueMode:{type:String,validator:Bt},mapOptions:Boolean,emitValue:Boolean,disableTabSelection:Boolean,inputDebounce:{type:[Number,String],default:500},inputClass:[Array,String,Object],inputStyle:[Array,String,Object],tabindex:{type:[String,Number],default:0},autocomplete:String,transitionShow:{},transitionHide:{},transitionDuration:{},behavior:{type:String,validator:e=>["default","menu","dialog"].includes(e),default:"default"},virtualScrollItemSize:$t.virtualScrollItemSize.type,onNewValue:Function,onFilter:Function},emits:[...Ot,"add","remove","inputValue","keyup","keypress","keydown","popupShow","popupHide","filterAbort"],setup(e,{slots:f,emit:u}){const{proxy:g}=st(),{$q:v}=g,r=M(!1),p=M(!1),y=M(-1),w=M(""),O=M(!1),m=M(!1);let V=null,k=null,q,z,U,n=null,W,J,D,I;const re=M(null),L=M(null),Y=M(null),X=M(null),ee=M(null),P=Il(e),ue=Rl(bt),C=h(()=>Array.isArray(e.options)?e.options.length:0),ge=h(()=>e.virtualScrollItemSize===void 0?e.optionsDense===!0?24:48:e.virtualScrollItemSize),{virtualScrollSliceRange:ye,virtualScrollSliceSizeComputed:de,localResetVirtualScroll:te,padVirtualScroll:xe,onVirtualScrollEvt:fe,scrollTo:ne,setVirtualScrollSize:Se}=jl({virtualScrollLength:C,getVirtualScrollTarget:Nt,getVirtualScrollEl:St,virtualScrollItemSizeComputed:ge}),l=Tt(),s=h(()=>{const t=e.mapOptions===!0&&e.multiple!==!0,c=e.modelValue!==void 0&&(e.modelValue!==null||t===!0)?e.multiple===!0&&Array.isArray(e.modelValue)?e.modelValue:[e.modelValue]:[];if(e.mapOptions===!0&&Array.isArray(e.options)===!0){const d=e.mapOptions===!0&&q!==void 0?q:[],b=c.map(E=>Ut(E,d));return e.modelValue===null&&t===!0?b.filter(E=>E!==null):b}return c}),S=h(()=>{const t={};return Xl.forEach(c=>{const d=e[c];d!==void 0&&(t[c]=d)}),t}),F=h(()=>e.optionsDark===null?l.isDark.value:e.optionsDark),T=h(()=>At(s.value)),_=h(()=>{let t="q-field__input q-placeholder col";return e.hideSelected===!0||s.value.length===0?[t,e.inputClass]:(t+=" q-field__input--padding",e.inputClass===void 0?t:[t,e.inputClass])}),i=h(()=>(e.virtualScrollHorizontal===!0?"q-virtual-scroll--horizontal":"")+(e.popupContentClass?" "+e.popupContentClass:"")),o=h(()=>C.value===0),a=h(()=>s.value.map(t=>G.value(t)).join(", ")),R=h(()=>e.displayValue!==void 0?e.displayValue:a.value),N=h(()=>e.optionsHtml===!0?()=>!0:t=>t?.html===!0),We=h(()=>e.displayValueHtml===!0||e.displayValue===void 0&&(e.optionsHtml===!0||s.value.some(N.value))),se=h(()=>l.focused.value===!0?e.tabindex:-1),He=h(()=>{const t={tabindex:e.tabindex,role:"combobox","aria-label":e.label,"aria-readonly":e.readonly===!0?"true":"false","aria-autocomplete":e.useInput===!0?"list":"none","aria-expanded":r.value===!0?"true":"false","aria-controls":`${l.targetUid.value}_lb`};return y.value>=0&&(t["aria-activedescendant"]=`${l.targetUid.value}_${y.value}`),t}),we=h(()=>({id:`${l.targetUid.value}_lb`,role:"listbox","aria-multiselectable":e.multiple===!0?"true":"false"})),be=h(()=>s.value.map((t,c)=>({index:c,opt:t,html:N.value(t),selected:!0,removeAtIndex:Qt,toggleOption:pe,tabindex:se.value}))),Pe=h(()=>{if(C.value===0)return[];const{from:t,to:c}=ye.value;return e.options.slice(t,c).map((d,b)=>{const E=qe.value(d)===!0,x=Je(d)===!0,j=t+b,H={clickable:!0,active:x,activeClass:Oe.value,manualFocus:!0,focused:!1,disable:E,tabindex:-1,dense:e.optionsDense,dark:F.value,role:"option","aria-selected":x===!0?"true":"false",id:`${l.targetUid.value}_${j}`,onClick:()=>{pe(d)}};return E!==!0&&(y.value===j&&(H.focused=!0),v.platform.is.desktop===!0&&(H.onMousemove=()=>{r.value===!0&&Ae(j)})),{index:j,opt:d,html:N.value(d),label:G.value(d),selected:H.active,focused:H.focused,toggleOption:pe,setOptionIndex:Ae,itemProps:H}})}),Ee=h(()=>e.dropdownIcon!==void 0?e.dropdownIcon:v.iconSet.arrow.dropdown),Ke=h(()=>e.optionsCover===!1&&e.outlined!==!0&&e.standout!==!0&&e.borderless!==!0&&e.rounded!==!0),Oe=h(()=>e.optionsSelectedClass!==void 0?e.optionsSelectedClass:e.color!==void 0?`text-${e.color}`:""),oe=h(()=>at(e.optionValue,"value")),G=h(()=>at(e.optionLabel,"label")),qe=h(()=>at(e.optionDisable,"disable")),Qe=h(()=>s.value.map(oe.value)),Pt=h(()=>{const t={onInput:bt,onChange:ue,onKeydown:yt,onKeyup:ht,onKeypress:gt,onFocus:vt,onClick(c){z===!0&&Be(c)}};return t.onCompositionstart=t.onCompositionupdate=t.onCompositionend=ue,t});he(s,t=>{q=t,e.useInput===!0&&e.fillInput===!0&&e.multiple!==!0&&l.innerLoading.value!==!0&&(p.value!==!0&&r.value!==!0||T.value!==!0)&&(U!==!0&&$e(),(p.value===!0||r.value===!0)&&Ie(""))},{immediate:!0}),he(()=>e.fillInput,$e),he(r,Ye),he(C,al);function dt(t){return e.emitValue===!0?oe.value(t):t}function Xe(t){if(t!==-1&&t<s.value.length)if(e.multiple===!0){const c=e.modelValue.slice();u("remove",{index:t,value:c.splice(t,1)[0]}),u("update:modelValue",c)}else u("update:modelValue",null)}function Qt(t){Xe(t),l.focus()}function ft(t,c){const d=dt(t);if(e.multiple!==!0){e.fillInput===!0&&Me(G.value(t),!0,!0),u("update:modelValue",d);return}if(s.value.length===0){u("add",{index:0,value:d}),u("update:modelValue",e.multiple===!0?[d]:d);return}if(c===!0&&Je(t)===!0||e.maxValues!==void 0&&e.modelValue.length>=e.maxValues)return;const b=e.modelValue.slice();u("add",{index:b.length,value:d}),b.push(d),u("update:modelValue",b)}function pe(t,c){if(l.editable.value!==!0||t===void 0||qe.value(t)===!0)return;const d=oe.value(t);if(e.multiple!==!0){c!==!0&&(Me(e.fillInput===!0?G.value(t):"",!0,!0),Ve()),L.value?.focus(),(s.value.length===0||Te(oe.value(s.value[0]),d)!==!0)&&u("update:modelValue",e.emitValue===!0?d:t);return}if((z!==!0||O.value===!0)&&l.focus(),vt(),s.value.length===0){const x=e.emitValue===!0?d:t;u("add",{index:0,value:x}),u("update:modelValue",e.multiple===!0?[x]:x);return}const b=e.modelValue.slice(),E=Qe.value.findIndex(x=>Te(x,d));if(E!==-1)u("remove",{index:E,value:b.splice(E,1)[0]});else{if(e.maxValues!==void 0&&b.length>=e.maxValues)return;const x=e.emitValue===!0?d:t;u("add",{index:b.length,value:x}),b.push(x)}u("update:modelValue",b)}function Ae(t){if(v.platform.is.desktop!==!0)return;const c=t!==-1&&t<C.value?t:-1;y.value!==c&&(y.value=c)}function Ue(t=1,c){if(r.value===!0){let d=y.value;do d=It(d+t,-1,C.value-1);while(d!==-1&&d!==y.value&&qe.value(e.options[d])===!0);y.value!==d&&(Ae(d),ne(d),c!==!0&&e.useInput===!0&&e.fillInput===!0&&Ne(d>=0?G.value(e.options[d]):W,!0))}}function Ut(t,c){const d=b=>Te(oe.value(b),t);return e.options.find(d)||c.find(d)||t}function Je(t){const c=oe.value(t);return Qe.value.find(d=>Te(d,c))!==void 0}function vt(t){e.useInput===!0&&L.value!==null&&(t===void 0||L.value===t.target&&t.target.value===a.value)&&L.value.select()}function mt(t){Sl(t,27)===!0&&r.value===!0&&(Be(t),Ve(),$e()),u("keyup",t)}function ht(t){const{value:c}=t.target;if(t.keyCode!==void 0){mt(t);return}if(t.target.value="",V!==null&&(clearTimeout(V),V=null),k!==null&&(clearTimeout(k),k=null),$e(),typeof c=="string"&&c.length!==0){const d=c.toLocaleLowerCase(),b=x=>{const j=e.options.find(H=>String(x.value(H)).toLocaleLowerCase()===d);return j===void 0?!1:(s.value.indexOf(j)===-1?pe(j):Ve(),!0)},E=x=>{b(oe)!==!0&&x!==!0&&b(G)!==!0&&Ie(c,!0,()=>E(!0))};E()}else l.clearValue(t)}function gt(t){u("keypress",t)}function yt(t){if(u("keydown",t),hl(t)===!0)return;const c=w.value.length!==0&&(e.newValueMode!==void 0||e.onNewValue!==void 0),d=t.shiftKey!==!0&&e.disableTabSelection!==!0&&e.multiple!==!0&&(y.value!==-1||c===!0);if(t.keyCode===27){Ze(t);return}if(t.keyCode===9&&d===!1){Re();return}if(t.target===void 0||t.target.id!==l.targetUid.value||l.editable.value!==!0)return;if(t.keyCode===40&&l.innerLoading.value!==!0&&r.value===!1){Ce(t),ze();return}if(t.keyCode===8&&(e.useChips===!0||e.clearable===!0)&&e.hideSelected!==!0&&w.value.length===0){e.multiple===!0&&Array.isArray(e.modelValue)===!0?Xe(e.modelValue.length-1):e.multiple!==!0&&e.modelValue!==null&&u("update:modelValue",null);return}(t.keyCode===35||t.keyCode===36)&&(typeof w.value!="string"||w.value.length===0)&&(Ce(t),y.value=-1,Ue(t.keyCode===36?1:-1,e.multiple)),(t.keyCode===33||t.keyCode===34)&&de.value!==void 0&&(Ce(t),y.value=Math.max(-1,Math.min(C.value,y.value+(t.keyCode===33?-1:1)*de.value.view)),Ue(t.keyCode===33?1:-1,e.multiple)),(t.keyCode===38||t.keyCode===40)&&(Ce(t),Ue(t.keyCode===38?-1:1,e.multiple));const b=C.value;if((D===void 0||I<Date.now())&&(D=""),b>0&&e.useInput!==!0&&t.key!==void 0&&t.key.length===1&&t.altKey===!1&&t.ctrlKey===!1&&t.metaKey===!1&&(t.keyCode!==32||D.length!==0)){r.value!==!0&&ze(t);const E=t.key.toLocaleLowerCase(),x=D.length===1&&D[0]===E;I=Date.now()+1500,x===!1&&(Ce(t),D+=E);const j=new RegExp("^"+D.split("").map(Ge=>Kl.indexOf(Ge)!==-1?"\\"+Ge:Ge).join(".*"),"i");let H=y.value;if(x===!0||H<0||j.test(G.value(e.options[H]))!==!0)do H=It(H+1,-1,b-1);while(H!==y.value&&(qe.value(e.options[H])===!0||j.test(G.value(e.options[H]))!==!0));y.value!==H&&ve(()=>{Ae(H),ne(H),H>=0&&e.useInput===!0&&e.fillInput===!0&&Ne(G.value(e.options[H]),!0)});return}if(!(t.keyCode!==13&&(t.keyCode!==32||e.useInput===!0||D!=="")&&(t.keyCode!==9||d===!1))){if(t.keyCode!==9&&Ce(t),y.value!==-1&&y.value<b){pe(e.options[y.value]);return}if(c===!0){const E=(x,j)=>{if(j){if(Bt(j)!==!0)return}else j=e.newValueMode;if(Me("",e.multiple!==!0,!0),x==null)return;(j==="toggle"?pe:ft)(x,j==="add-unique"),e.multiple!==!0&&(L.value?.focus(),Ve())};if(e.onNewValue!==void 0?u("newValue",w.value,E):E(w.value),e.multiple!==!0)return}r.value===!0?Re():l.innerLoading.value!==!0&&ze()}}function St(){return z===!0?ee.value:Y.value!==null&&Y.value.contentEl!==null?Y.value.contentEl:void 0}function Nt(){return St()}function jt(){return e.hideSelected===!0?[]:f["selected-item"]!==void 0?be.value.map(t=>f["selected-item"](t)).slice():f.selected!==void 0?[].concat(f.selected()):e.useChips===!0?be.value.map((t,c)=>A(je,{key:"option-"+c,removable:l.editable.value===!0&&qe.value(t.opt)!==!0,dense:!0,textColor:e.color,tabindex:se.value,onRemove(){t.removeAtIndex(c)}},()=>A("span",{class:"ellipsis",[t.html===!0?"innerHTML":"textContent"]:G.value(t.opt)}))):[A("span",{class:"ellipsis",[We.value===!0?"innerHTML":"textContent"]:R.value})]}function wt(){if(o.value===!0)return f["no-option"]!==void 0?f["no-option"]({inputValue:w.value}):void 0;const t=f.option!==void 0?f.option:d=>A(El,{key:d.index,...d.itemProps},()=>A(Fl,()=>A(xl,()=>A("span",{[d.html===!0?"innerHTML":"textContent"]:d.label}))));let c=xe("div",Pe.value.map(t));return f["before-options"]!==void 0&&(c=f["before-options"]().concat(c)),wl(f["after-options"],c)}function Kt(t,c){const d=c===!0?{...He.value,...l.splitAttrs.attributes.value}:void 0,b={ref:c===!0?L:void 0,key:"i_t",class:_.value,style:e.inputStyle,value:w.value!==void 0?w.value:"",type:"search",...d,id:c===!0?l.targetUid.value:void 0,maxlength:e.maxlength,autocomplete:e.autocomplete,"data-autofocus":t===!0||e.autofocus===!0||void 0,disabled:e.disable===!0,readonly:e.readonly===!0,...Pt.value};return t!==!0&&z===!0&&(Array.isArray(b.class)===!0?b.class=[...b.class,"no-pointer-events"]:b.class+=" no-pointer-events"),A("input",b)}function bt(t){V!==null&&(clearTimeout(V),V=null),k!==null&&(clearTimeout(k),k=null),!(t&&t.target&&t.target.qComposing===!0)&&(Ne(t.target.value||""),U=!0,W=w.value,l.focused.value!==!0&&(z!==!0||O.value===!0)&&l.focus(),e.onFilter!==void 0&&(V=setTimeout(()=>{V=null,Ie(w.value)},e.inputDebounce)))}function Ne(t,c){w.value!==t&&(w.value=t,c===!0||e.inputDebounce===0||e.inputDebounce==="0"?u("inputValue",t):k=setTimeout(()=>{k=null,u("inputValue",t)},e.inputDebounce))}function Me(t,c,d){U=d!==!0,e.useInput===!0&&(Ne(t,!0),(c===!0||d!==!0)&&(W=t),c!==!0&&Ie(t))}function Ie(t,c,d){if(e.onFilter===void 0||c!==!0&&l.focused.value!==!0)return;l.innerLoading.value===!0?u("filterAbort"):(l.innerLoading.value=!0,m.value=!0),t!==""&&e.multiple!==!0&&s.value.length!==0&&U!==!0&&t===G.value(s.value[0])&&(t="");const b=setTimeout(()=>{r.value===!0&&(r.value=!1)},10);n!==null&&clearTimeout(n),n=b,u("filter",t,(E,x)=>{(c===!0||l.focused.value===!0)&&n===b&&(clearTimeout(n),typeof E=="function"&&E(),m.value=!1,ve(()=>{l.innerLoading.value=!1,l.editable.value===!0&&(c===!0?r.value===!0&&Ve():r.value===!0?Ye(!0):r.value=!0),typeof x=="function"&&ve(()=>{x(g)}),typeof d=="function"&&ve(()=>{d(g)})}))},()=>{l.focused.value===!0&&n===b&&(clearTimeout(n),l.innerLoading.value=!1,m.value=!1),r.value===!0&&(r.value=!1)})}function Xt(){return A(Ol,{ref:Y,class:i.value,style:e.popupContentStyle,modelValue:r.value,fit:e.menuShrink!==!0,cover:e.optionsCover===!0&&o.value!==!0&&e.useInput!==!0,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,dark:F.value,noParentEvent:!0,noRefocus:!0,noFocus:!0,noRouteDismiss:e.popupNoRouteDismiss,square:Ke.value,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,separateClosePopup:!0,...we.value,onScrollPassive:fe,onBeforeShow:Vt,onBeforeHide:Jt,onShow:Yt},wt)}function Jt(t){kt(t),Re()}function Yt(){Se()}function Gt(t){Be(t),L.value?.focus(),O.value=!0,window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,0)}function Zt(t){Be(t),ve(()=>{O.value=!1})}function el(){const t=[A(Hl,{class:`col-auto ${l.fieldClass.value}`,...S.value,for:l.targetUid.value,dark:F.value,square:!0,loading:m.value,itemAligned:!1,filled:!0,stackLabel:w.value.length!==0,...l.splitAttrs.listeners.value,onFocus:Gt,onBlur:Zt},{...f,rawControl:()=>l.getControl(!0),before:void 0,after:void 0})];return r.value===!0&&t.push(A("div",{ref:ee,class:i.value+" scroll",style:e.popupContentStyle,...we.value,onClick:Ze,onScrollPassive:fe},wt())),A(Dt,{ref:X,modelValue:p.value,position:e.useInput===!0?"top":void 0,transitionShow:J,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,noRouteDismiss:e.popupNoRouteDismiss,onBeforeShow:Vt,onBeforeHide:tl,onHide:ll,onShow:il},()=>A("div",{class:"q-select__dialog"+(F.value===!0?" q-select__dialog--dark q-dark":"")+(O.value===!0?" q-select__dialog--focused":"")},t))}function tl(t){kt(t),X.value!==null&&X.value.__updateRefocusTarget(l.rootRef.value.querySelector(".q-field__native > [tabindex]:last-child")),l.focused.value=!1}function ll(t){Ve(),l.focused.value===!1&&u("blur",t),$e()}function il(){const t=document.activeElement;(t===null||t.id!==l.targetUid.value)&&L.value!==null&&L.value!==t&&L.value.focus(),Se()}function Re(){p.value!==!0&&(y.value=-1,r.value===!0&&(r.value=!1),l.focused.value===!1&&(n!==null&&(clearTimeout(n),n=null),l.innerLoading.value===!0&&(u("filterAbort"),l.innerLoading.value=!1,m.value=!1)))}function ze(t){l.editable.value===!0&&(z===!0?(l.onControlFocusin(t),p.value=!0,ve(()=>{l.focus()})):l.focus(),e.onFilter!==void 0?Ie(w.value):(o.value!==!0||f["no-option"]!==void 0)&&(r.value=!0))}function Ve(){p.value=!1,Re()}function $e(){e.useInput===!0&&Me(e.multiple!==!0&&e.fillInput===!0&&s.value.length!==0&&G.value(s.value[0])||"",!0,!0)}function Ye(t){let c=-1;if(t===!0){if(s.value.length!==0){const d=oe.value(s.value[0]);c=e.options.findIndex(b=>Te(oe.value(b),d))}te(c)}Ae(c)}function al(t,c){r.value===!0&&l.innerLoading.value===!1&&(te(-1,!0),ve(()=>{r.value===!0&&l.innerLoading.value===!1&&(t>c?te():Ye(!0))}))}function pt(){p.value===!1&&Y.value!==null&&Y.value.updatePosition()}function Vt(t){t!==void 0&&Be(t),u("popupShow",t),l.hasPopupOpen=!0,l.onControlFocusin(t)}function kt(t){t!==void 0&&Be(t),u("popupHide",t),l.hasPopupOpen=!1,l.onControlFocusout(t)}function Ct(){z=v.platform.is.mobile!==!0&&e.behavior!=="dialog"?!1:e.behavior!=="menu"&&(e.useInput===!0?f["no-option"]!==void 0||e.onFilter!==void 0||o.value===!1:!0),J=v.platform.is.ios===!0&&z===!0&&e.useInput===!0?"fade":e.transitionShow}return gl(Ct),yl(pt),Ct(),Ft(()=>{V!==null&&clearTimeout(V),k!==null&&clearTimeout(k)}),Object.assign(g,{showPopup:ze,hidePopup:Ve,removeAtIndex:Xe,add:ft,toggleOption:pe,getOptionIndex:()=>y.value,setOptionIndex:Ae,moveOptionSelection:Ue,filter:Ie,updateMenuPosition:pt,updateInputValue:Me,isOptionSelected:Je,getEmittingOptionValue:dt,isOptionDisabled:(...t)=>qe.value.apply(null,t)===!0,getOptionValue:(...t)=>oe.value.apply(null,t),getOptionLabel:(...t)=>G.value.apply(null,t)}),Object.assign(l,{innerValue:s,fieldClass:h(()=>`q-select q-field--auto-height q-select--with${e.useInput!==!0?"out":""}-input q-select--with${e.useChips!==!0?"out":""}-chips q-select--${e.multiple===!0?"multiple":"single"}`),inputRef:re,targetRef:L,hasValue:T,showPopup:ze,floatingLabel:h(()=>e.hideSelected!==!0&&T.value===!0||typeof w.value=="number"||w.value.length!==0||At(e.displayValue)),getControlChild:()=>{if(l.editable.value!==!1&&(p.value===!0||o.value!==!0||f["no-option"]!==void 0))return z===!0?el():Xt();l.hasPopupOpen===!0&&(l.hasPopupOpen=!1)},controlEvents:{onFocusin(t){l.onControlFocusin(t)},onFocusout(t){l.onControlFocusout(t,()=>{$e(),Re()})},onClick(t){if(Ze(t),z!==!0&&r.value===!0){Re(),L.value?.focus();return}ze(t)}},getControl:t=>{const c=jt(),d=t===!0||p.value!==!0||z!==!0;if(e.useInput===!0)c.push(Kt(t,d));else if(l.editable.value===!0){const E=d===!0?He.value:void 0;c.push(A("input",{ref:d===!0?L:void 0,key:"d_t",class:"q-select__focus-target",id:d===!0?l.targetUid.value:void 0,value:R.value,readonly:!0,"data-autofocus":t===!0||e.autofocus===!0||void 0,...E,onKeydown:yt,onKeyup:mt,onKeypress:gt})),d===!0&&typeof e.autocomplete=="string"&&e.autocomplete.length!==0&&c.push(A("input",{class:"q-select__autocomplete-input",autocomplete:e.autocomplete,tabindex:-1,onKeyup:ht}))}if(P.value!==void 0&&e.disable!==!0&&Qe.value.length!==0){const E=Qe.value.map(x=>A("option",{value:x,selected:!0}));c.push(A("select",{class:"hidden",name:P.value,multiple:e.multiple},E))}const b=e.useInput===!0||d!==!0?void 0:l.splitAttrs.attributes.value;return A("div",{class:"q-field__native row items-center",...b,...l.splitAttrs.listeners.value},c)},getInnerAppend:()=>e.loading!==!0&&m.value!==!0&&e.hideDropdownIcon!==!0?[A(_e,{class:"q-select__dropdown-icon"+(r.value===!0?" rotate-180":""),name:Ee.value})]:null}),Mt(l)}}),Yl={class:"row items-center justify-between"},Gl={class:"text-h6 wish-title"},Zl={class:"row q-gutter-xs"},ei={class:"wish-description"},ti={key:0,class:"text-body2 text-grey-7"},li={class:"wish-url"},ii={class:"wish-meta"},ai={class:"text-caption text-grey-6"},ui={key:0},ni=xt({__name:"WishCard",props:{wish:{},currentUserId:{}},emits:["edit","delete","toggleBought","toggleReceived"],setup(e,{emit:f}){const u=e,g=f,v=Lt(),{t:r}=Wt(),p=h(()=>{switch(u.wish.visibility){case"public":return"green";case"friends":return"blue";case"private":return"grey";default:return"grey"}}),y=h(()=>{switch(u.wish.visibility){case"public":return r("wishes.visibilityPublic");case"friends":return r("wishes.visibilityFriends");case"private":return r("wishes.visibilityPrivate");default:return r("common.unknown")}}),w=h(()=>u.wish.created_by_user_id!==u.wish.created_for_user_id&&u.currentUserId!==u.wish.created_for_user_id),O=()=>{const n=u.wish.created_by_user;return n.name&&n.surname?`${n.name} ${n.surname}`:n.name?n.name:n.username?n.username:r("common.unknown")},m=h(()=>u.currentUserId===u.wish.created_by_user_id),V=h(()=>u.currentUserId===u.wish.created_by_user_id),k=h(()=>u.currentUserId!==u.wish.created_for_user_id&&u.currentUserId!==void 0),q=h(()=>u.currentUserId===u.wish.created_for_user_id&&u.currentUserId!==void 0),z=n=>new Date(n).toLocaleDateString("cs-CZ"),U=()=>{v.dialog({title:r("wishes.deleteWish"),message:r("wishes.deleteConfirm"),cancel:!0,persistent:!0}).onOk(()=>{g("delete",u.wish.id)})};return(n,W)=>(B(),le(Et,{class:"wish-card"},{default:Z(()=>[$(ot,{class:"wish-card-content"},{default:Z(()=>[Q("div",Yl,[Q("div",Gl,ie(n.wish.name),1),Q("div",Zl,[$(je,{color:p.value,"text-color":"white",label:y.value,size:"sm"},null,8,["color","label"]),n.wish.is_bought?(B(),le(je,{key:0,color:"green","text-color":"white",label:n.$t("wishes.bought"),size:"sm"},null,8,["label"])):ce("",!0),n.wish.is_received?(B(),le(je,{key:1,color:"purple","text-color":"white",label:n.$t("wishes.received"),size:"sm"},null,8,["label"])):ce("",!0)])]),Q("div",ei,[n.wish.description?(B(),K("div",ti,ie(n.wish.description),1)):ce("",!0)]),Q("div",li,[n.wish.url?(B(),le(me,{key:0,flat:"",color:"primary",href:n.wish.url,target:"_blank",icon:"open_in_new",label:n.$t("wishes.openLink"),size:"sm"},null,8,["href","label"])):ce("",!0)]),Q("div",ii,[Q("div",ai,[w.value?(B(),K("div",ui,ie(n.$t("wishes.createdBy",{name:O()})),1)):ce("",!0),Q("div",null,ie(z(n.wish.created_at)),1)])])]),_:1}),$(Wl,{align:"right"},{default:Z(()=>[k.value?(B(),le(me,{key:0,color:n.wish.is_bought?"grey":"green",icon:n.wish.is_bought?"shopping_cart":"add_shopping_cart",label:n.wish.is_bought?n.$t("wishes.markAsNotBought"):n.$t("wishes.markAsBought"),flat:"",onClick:W[0]||(W[0]=J=>n.$emit("toggleBought",n.wish.id))},null,8,["color","icon","label"])):ce("",!0),q.value?(B(),le(me,{key:1,color:n.wish.is_received?"orange":"purple",icon:n.wish.is_received?"undo":"check_circle",label:n.wish.is_received?n.$t("wishes.markAsNotReceived"):n.$t("wishes.markAsReceived"),flat:"",onClick:W[1]||(W[1]=J=>n.$emit("toggleReceived",n.wish.id))},null,8,["color","icon","label"])):ce("",!0),m.value?(B(),le(me,{key:2,color:"primary",icon:"edit",flat:"",onClick:W[2]||(W[2]=J=>n.$emit("edit",n.wish))})):ce("",!0),V.value?(B(),le(me,{key:3,color:"negative",icon:"delete",flat:"",onClick:U})):ce("",!0)]),_:1})]),_:1}))}}),ut=Ml(ni,[["__scopeId","data-v-eed62911"]]),oi={class:"row justify-between items-center q-mb-md"},ri={class:"text-h4"},si={key:0,class:"flex justify-center"},ci={key:1,class:"text-center text-grey-6 q-py-lg"},di={class:"text-h6 q-mt-md"},fi={key:2,class:"row q-gutter-md"},vi={key:0,class:"flex justify-center"},mi={key:1,class:"text-center text-grey-6 q-py-lg"},hi={class:"text-h6 q-mt-md"},gi={key:2,class:"row q-gutter-md"},yi={key:0,class:"flex justify-center"},Si={key:1,class:"text-center text-grey-6 q-py-lg"},wi={class:"text-h6 q-mt-md"},bi={key:2,class:"row q-gutter-md"},pi={class:"text-h6"},Vi={class:"row justify-end q-gutter-sm"},Li=xt({__name:"WishesPage",setup(e){const f=Lt(),{t:u}=Wt(),g=Vl(),{user:v}=Bl(),r=h(()=>g.params.userId),p=h(()=>!!r.value),{isLoading:y,createWish:w,fetchWishes:O,fetchAllWishesForUser:m,fetchReceivedWishes:V,refreshWishes:k,refreshAllWishesForUser:q,refreshReceivedWishes:z,updateWish:U,deleteWish:n,toggleBought:W,toggleReceived:J}=Ll(),D=M([]),I=M([]),re=h(()=>p.value?I.value:D.value);let L=null;const Y=M("my-wishes"),X=M(!1),ee=M(null),P=M([]),ue=M(""),C=bl({name:"",description:"",url:"",visibility:"friends"}),ge=[{label:u("wishes.form.visibilityPublic"),value:"public"},{label:u("wishes.form.visibilityFriends"),value:"friends"},{label:u("wishes.form.visibilityPrivate"),value:"private"}],ye=()=>{C.name="",C.description="",C.url="",C.visibility="friends",ee.value=null},de=async()=>{if(!v.value)return;const i=p.value?r.value:v.value.id;if(!i)return;const o={name:C.name,...C.description&&{description:C.description},...C.url&&{url:C.url},visibility:C.visibility,created_for_user_id:i,created_by_user_id:v.value.id};let a;if(ee.value?a=await U(ee.value,o):a=await w(o),a.error)f.notify({type:"negative",message:u("wishes.saveError")+": "+(a.error instanceof Error?a.error.message:JSON.stringify(a.error))});else if(f.notify({type:"positive",message:ee.value?u("wishes.updateSuccess"):u("wishes.createSuccess")}),X.value=!1,ye(),p.value){const R=await q(r.value,!0);R?.data&&(I.value=R.data)}else{const R=await k(v.value.id);R?.data&&(D.value=R.data)}},te=i=>{C.name=i.name,C.description=i.description||"",C.url=i.url||"",C.visibility=i.visibility,ee.value=i.id,X.value=!0},xe=async i=>{const o=await n(i);o.error?f.notify({type:"negative",message:u("wishes.deleteError")+": "+(o.error instanceof Error?o.error.message:JSON.stringify(o.error))}):f.notify({type:"positive",message:u("wishes.deleteSuccess")})},fe=async i=>{if(!v.value)return;const o=await W(i,v.value.id);if(o.error)f.notify({type:"negative",message:u("wishes.toggleBoughtError")+": "+(o.error instanceof Error?o.error.message:JSON.stringify(o.error))});else if(p.value){const a=await q(r.value,!0);a?.data&&(I.value=a.data)}else{const a=await k(v.value.id);a?.data&&(D.value=a.data);const R=await z(v.value.id);R?.data&&(P.value=R.data)}},ne=async i=>{if(!v.value)return;const o=await J(i,v.value.id);if(o.error)f.notify({type:"negative",message:u("wishes.toggleReceivedError")+": "+(o.error instanceof Error?o.error.message:JSON.stringify(o.error))});else{if(p.value){const a=await q(r.value,!0);a?.data&&(I.value=a.data)}else{const a=await k(v.value.id);a?.data&&(D.value=a.data);const R=await z(v.value.id);R?.data&&(P.value=R.data)}f.notify({type:"positive",message:u("wishes.toggleReceivedSuccess")})}},Se=async()=>{if(!v.value)return;const i=await V(v.value.id);i?.data&&(P.value=i.data)},l=async i=>{try{const{data:o,error:a}=await Rt.from("profiles").select("name, username").eq("id",i).single();if(a)throw a;ue.value=o.name||o.username||"Unknown"}catch(o){console.error("Error fetching friend profile:",o),ue.value="Unknown"}};pl(async()=>{v.value&&(await s(g.params.userId),S())}),kl(()=>{_()}),he(()=>g.params.userId,async(i,o)=>{i!==o&&(ue.value="",await s(i),S())},{immediate:!0}),he(()=>v.value?.id,async i=>{i?(await s(g.params.userId),S()):_()});const s=async i=>{if(v.value)if(D.value=[],I.value=[],P.value=[],ue.value="",i){await l(i);const o=await m(i,!0);o?.data&&(I.value=o.data)}else{const o=await O(v.value.id);o?.data&&(D.value=o.data),await Se()}},S=()=>{v.value&&(L&&L.unsubscribe(),L=Rt.channel("wishes_changes").on("postgres_changes",{event:"*",schema:"public",table:"wishes"},i=>{F(i)}).subscribe())},F=async i=>{if(!v.value)return;const{eventType:o,new:a,old:R}=i;if(o==="INSERT"&&a)p.value&&a.created_for_user_id===r.value?await T():!p.value&&a.created_for_user_id===v.value.id&&await T();else if(o==="UPDATE"&&a)if(!p.value&&a.created_for_user_id===v.value.id){await T();const N=await z(v.value.id);N?.data&&(P.value=N.data)}else p.value&&a.created_for_user_id===r.value&&await T();else o==="DELETE"&&R&&(p.value?I.value=I.value.filter(N=>N.id!==R.id):(D.value=D.value.filter(N=>N.id!==R.id),P.value=P.value.filter(N=>N.id!==R.id)))},T=async()=>{if(v.value)if(p.value){const i=await q(r.value,!0);i?.data&&(I.value=i.data)}else{const i=await k(v.value.id);i?.data&&(D.value=i.data);const o=await z(v.value.id);o?.data&&(P.value=o.data)}},_=()=>{L&&(L.unsubscribe(),L=null)};return(i,o)=>(B(),le(Dl,{class:"q-pa-md"},{default:Z(()=>[Q("div",oi,[Q("div",ri,ie(p.value?`${ue.value}'s ${i.$t("wishes.wishes")}`:i.$t("wishes.title")),1),$(me,{color:"primary",icon:"add",label:p.value?i.$t("wishes.addForFriend"):i.$t("wishes.add"),onClick:o[0]||(o[0]=a=>X.value=!0)},null,8,["label"])]),p.value?(B(),K(De,{key:1},[ke(y)?(B(),K("div",yi,[$(et,{size:"lg"})])):re.value.length===0?(B(),K("div",Si,[$(_e,{name:"card_giftcard",size:"4rem"}),Q("div",wi,ie(i.$t("wishes.noWishes")),1),Q("div",null,ie(i.$t("wishes.friendHasNoWishes")),1)])):(B(),K("div",bi,[(B(!0),K(De,null,tt(re.value,a=>(B(),le(ut,{key:a.id,wish:a,"current-user-id":ke(v)?.id,onToggleBought:fe,onToggleReceived:ne},null,8,["wish","current-user-id"]))),128))]))],64)):(B(),K(De,{key:0},[$(Cl,{modelValue:Y.value,"onUpdate:modelValue":o[1]||(o[1]=a=>Y.value=a),class:"text-primary q-mb-md"},{default:Z(()=>[$(_t,{name:"my-wishes",label:i.$t("wishes.myWishes")},null,8,["label"]),$(_t,{name:"archive",label:i.$t("wishes.archive")},null,8,["label"])]),_:1},8,["modelValue"]),$(_l),$(ql,{modelValue:Y.value,"onUpdate:modelValue":o[2]||(o[2]=a=>Y.value=a),animated:""},{default:Z(()=>[$(qt,{name:"my-wishes"},{default:Z(()=>[ke(y)?(B(),K("div",si,[$(et,{size:"lg"})])):re.value.length===0?(B(),K("div",ci,[$(_e,{name:"card_giftcard",size:"4rem"}),Q("div",di,ie(i.$t("wishes.noWishes")),1),Q("div",null,ie(i.$t("wishes.addFirstWish")),1)])):(B(),K("div",fi,[(B(!0),K(De,null,tt(re.value,a=>(B(),le(ut,{key:a.id,wish:a,"current-user-id":ke(v)?.id,onEdit:te,onDelete:xe,onToggleBought:fe,onToggleReceived:ne},null,8,["wish","current-user-id"]))),128))]))]),_:1}),$(qt,{name:"archive"},{default:Z(()=>[ke(y)?(B(),K("div",vi,[$(et,{size:"lg"})])):P.value.length===0?(B(),K("div",mi,[$(_e,{name:"archive",size:"4rem"}),Q("div",hi,ie(i.$t("wishes.noArchivedWishes")),1),Q("div",null,ie(i.$t("wishes.noArchivedWishesDesc")),1)])):(B(),K("div",gi,[(B(!0),K(De,null,tt(P.value,a=>(B(),le(ut,{key:a.id,wish:a,"current-user-id":ke(v)?.id,onToggleReceived:ne},null,8,["wish","current-user-id"]))),128))]))]),_:1})]),_:1},8,["modelValue"])],64)),$(Dt,{modelValue:X.value,"onUpdate:modelValue":o[8]||(o[8]=a=>X.value=a),onHide:ye},{default:Z(()=>[$(Et,{style:{width:"100%","max-width":"500px"}},{default:Z(()=>[$(ot,null,{default:Z(()=>[Q("div",pi,ie(ee.value?i.$t("wishes.editWish"):i.$t("wishes.addWish")),1)]),_:1}),$(ot,null,{default:Z(()=>[$(Tl,{onSubmit:de,class:"q-gutter-md"},{default:Z(()=>[$(lt,{modelValue:C.name,"onUpdate:modelValue":o[3]||(o[3]=a=>C.name=a),label:i.$t("wishes.form.name"),outlined:"",rules:[a=>!!a||i.$t("wishes.form.nameRequired")]},null,8,["modelValue","label","rules"]),$(lt,{modelValue:C.description,"onUpdate:modelValue":o[4]||(o[4]=a=>C.description=a),label:i.$t("wishes.form.description"),type:"textarea",outlined:"",rows:"3"},null,8,["modelValue","label"]),$(lt,{modelValue:C.url,"onUpdate:modelValue":o[5]||(o[5]=a=>C.url=a),label:i.$t("wishes.form.url"),outlined:"",type:"url"},null,8,["modelValue","label"]),$(Jl,{modelValue:C.visibility,"onUpdate:modelValue":o[6]||(o[6]=a=>C.visibility=a),label:i.$t("wishes.form.visibility"),outlined:"",options:ge,"option-value":"value","option-label":"label","emit-value":"","map-options":""},null,8,["modelValue","label"]),Q("div",Vi,[$(me,{label:i.$t("common.cancel"),color:"grey",flat:"",onClick:o[7]||(o[7]=a=>X.value=!1)},null,8,["label"]),$(me,{type:"submit",label:i.$t("common.save"),color:"primary",loading:ke(y)},null,8,["label","loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{Li as default};
