import{v as ge,A as z,W as pe,a8 as ye,Y as be,C as _e,r as G,x as P,b3 as ke,_ as we,b4 as Te,$ as Ce,b5 as xe,w as X,J as Z,M as ee,R as te,a9 as Se,y as ae,aG as Pe,z as Ne,V as Qe,a as qe,n as Ae,ae as Oe,p as T,f as s,o as r,h as y,at as A,t as b,l as c,k as I,e as o,c as O,s as Me,q as oe,av as Ee,au as De,u as Re,a3 as $e,aj as Le,ax as je,ak as M,aF as Be,aB as He}from"./index-CIQSULin.js";import{a as U,Q as Ve}from"./QTabs-rrcC-xP7.js";import{Q as ze,a as W,b as F}from"./QItem-Ds_X-V0y.js";import{Q as Ie}from"./QBadge-DSrSMh2j.js";import{v as Ue,a as ne,e as We,p as se,b as Fe,c as Ge,d as Je,r as ie,s as Ye}from"./position-engine-CIWDeOqx.js";import{c as le}from"./selection-ymLpz77J.js";import{Q as Ke}from"./QList-Cm47OWvO.js";import{Q as Xe}from"./QPage-CH2oIMgT.js";import{u as Ze}from"./useNotifications-YOJ5Q0Yc.js";import{u as et}from"./vue-i18n.runtime-Bznxj9Cl.js";import"./QResizeObserver-DqjOLvBA.js";import"./rtl-DFPa-2ov.js";import"./use-quasar-BZvmzkiG.js";import"./notifications-store-BnEQgLnD.js";import"./supabase-HoY6IUWb.js";import"./auth-store-Dje8XKfF.js";const tt=ge({name:"QTooltip",inheritAttrs:!1,props:{...We,...be,...z,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{...z.transitionShow,default:"jump-down"},transitionHide:{...z.transitionHide,default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:ne},self:{type:String,default:"top middle",validator:ne},offset:{type:Array,default:()=>[14,14],validator:Ue},scrollTarget:ye,delay:{type:Number,default:0},hideDelay:{type:Number,default:0},persistent:Boolean},emits:[...pe],setup(t,{slots:u,emit:N,attrs:l}){let f,h;const _=_e(),{proxy:{$q:i}}=_,v=G(null),k=G(!1),E=P(()=>se(t.anchor,i.lang.rtl)),D=P(()=>se(t.self,i.lang.rtl)),R=P(()=>t.persistent!==!0),{registerTick:$,removeTick:L}=ke(),{registerTimeout:d}=we(),{transitionProps:Q,transitionStyle:j}=Te(t),{localScrollTarget:q,changeScrollEvent:B,unconfigureScrollTarget:H}=Fe(t,Y),{anchorEl:e,canShow:m,anchorEvents:a}=Ge({showing:k,configureAnchorEl:fe}),{show:w,hide:g}=Ce({showing:k,canShow:m,handleShow:ce,handleHide:ue,hideOnRouteChange:R,processOnMount:!0});Object.assign(a,{delayShow:de,delayHide:me});const{showPortal:C,hidePortal:x,renderPortal:re}=xe(_,v,ve,"tooltip");if(i.platform.is.mobile===!0){const n={anchorEl:e,innerRef:v,onClickOutside(p){return g(p),p.target.classList.contains("q-dialog__backdrop")&&Qe(p),!0}},V=P(()=>t.modelValue===null&&t.persistent!==!0&&k.value===!0);X(V,p=>{(p===!0?Je:ie)(n)}),Z(()=>{ie(n)})}function ce(n){C(),$(()=>{h=new MutationObserver(()=>S()),h.observe(v.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),S(),Y()}),f===void 0&&(f=X(()=>i.screen.width+"|"+i.screen.height+"|"+t.self+"|"+t.anchor+"|"+i.lang.rtl,S)),d(()=>{C(!0),N("show",n)},t.transitionDuration)}function ue(n){L(),x(),J(),d(()=>{x(!0),N("hide",n)},t.transitionDuration)}function J(){h!==void 0&&(h.disconnect(),h=void 0),f!==void 0&&(f(),f=void 0),H(),ee(a,"tooltipTemp")}function S(){Ye({targetEl:v.value,offset:t.offset,anchorEl:e.value,anchorOrigin:E.value,selfOrigin:D.value,maxHeight:t.maxHeight,maxWidth:t.maxWidth})}function de(n){if(i.platform.is.mobile===!0){le(),document.body.classList.add("non-selectable");const V=e.value,p=["touchmove","touchcancel","touchend","click"].map(K=>[V,K,"delayHide","passiveCapture"]);te(a,"tooltipTemp",p)}d(()=>{w(n)},t.delay)}function me(n){i.platform.is.mobile===!0&&(ee(a,"tooltipTemp"),le(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),d(()=>{g(n)},t.hideDelay)}function fe(){if(t.noParentEvent===!0||e.value===null)return;const n=i.platform.is.mobile===!0?[[e.value,"touchstart","delayShow","passive"]]:[[e.value,"mouseenter","delayShow","passive"],[e.value,"mouseleave","delayHide","passive"]];te(a,"anchor",n)}function Y(){if(e.value!==null||t.scrollTarget!==void 0){q.value=Se(e.value,t.scrollTarget);const n=t.noParentEvent===!0?S:g;B(q.value,n)}}function he(){return k.value===!0?ae("div",{...l,ref:v,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",l.class],style:[l.style,j.value],role:"tooltip"},Ne(u.default)):null}function ve(){return ae(Pe,Q.value,he)}return Z(J),Object.assign(_.proxy,{updatePosition:S}),re}}),at={class:"row items-center justify-between q-px-md q-pt-md"},ot={class:"text-h6"},nt={class:"q-px-md q-pt-sm"},st={class:"col q-pa-md"},it={key:0,class:"column items-center justify-center full-height"},lt={class:"q-mt-sm text-grey-6"},rt={key:1,class:"column items-center justify-center full-height"},ct={class:"text-body1 text-grey-6 q-mt-md"},ut={class:"column items-end"},dt={key:3,class:"q-pa-md text-center"},Nt=qe({__name:"NotificationsPage",setup(t){const{t:u}=et(),N=Re(),{notifications:l,unreadCount:f,hasUnread:h,isLoading:_,initialize:i,cleanup:v,markAsRead:k,markAllAsRead:E,handleNotificationClick:D,getNotificationIcon:R,getNotificationColor:$,fetchNotifications:L}=Ze(),d=G("all"),Q=P(()=>{switch(d.value){case"unread":return l.value.filter(e=>!e.is_read);case"read":return l.value.filter(e=>e.is_read);default:return l.value}}),j=()=>{switch(d.value){case"unread":return u("notifications.noUnread");case"read":return u("notifications.noRead");default:return u("notifications.noNotifications")}},q=e=>{if(!e)return"";const m=Date.now(),a=new Date(e).getTime(),w=m-a,g=Math.floor(w/(1e3*60)),C=Math.floor(w/(1e3*60*60)),x=Math.floor(w/(1e3*60*60*24));return g<1?u("notifications.justNow"):g<60?u("notifications.minutesAgo",{count:g}):C<24?u("notifications.hoursAgo",{count:C}):x<7?u("notifications.daysAgo",{count:x}):new Date(e).toLocaleDateString()},B=async e=>{const m=await D(e);await N.push(m)},H=async()=>{await L(l.value.length+20)};return Ae(()=>{i()}),Oe(()=>{v()}),(e,m)=>(r(),T(Xe,{class:"column"},{default:s(()=>[y("div",at,[y("div",ot,b(e.$t("notifications.receivedNotifications")),1),c(h)?(r(),T(I,{key:0,flat:"",dense:"",color:"primary",label:e.$t("notifications.markAllRead"),icon:"done_all",onClick:c(E)},null,8,["label","onClick"])):A("",!0)]),y("div",nt,[o(Ve,{modelValue:d.value,"onUpdate:modelValue":m[0]||(m[0]=a=>d.value=a),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"left","narrow-indicator":""},{default:s(()=>[o(U,{name:"all",label:e.$t("notifications.all"),badge:c(l).length||void 0},null,8,["label","badge"]),o(U,{name:"unread",label:e.$t("notifications.unread"),badge:c(f)||void 0},null,8,["label","badge"]),o(U,{name:"read",label:e.$t("notifications.read")},null,8,["label"])]),_:1},8,["modelValue"])]),y("div",st,[c(_)?(r(),O("div",it,[o(Me,{size:"md",color:"primary"}),y("div",lt,b(e.$t("notifications.loading")),1)])):Q.value.length===0?(r(),O("div",rt,[o(oe,{name:"notifications_none",size:"60px",color:"grey-4"}),y("div",ct,b(j()),1)])):(r(),T(Ke,{key:2,separator:"",bordered:"",class:"rounded-borders"},{default:s(()=>[(r(!0),O(De,null,Ee(Q.value,a=>$e((r(),T(ze,{key:a.id,clickable:"",class:Le({"bg-blue-1":!a.is_read}),onClick:()=>B(a)},{default:s(()=>[o(W,{avatar:""},{default:s(()=>[o(je,{color:c($)(a.type),"text-color":"white",icon:c(R)(a.type),size:"40px"},null,8,["color","icon"])]),_:2},1024),o(W,null,{default:s(()=>[o(F,{class:"text-weight-medium"},{default:s(()=>[M(b(a.title),1)]),_:2},1024),o(F,{caption:"",lines:"2",class:"q-mt-xs"},{default:s(()=>[M(b(a.body),1)]),_:2},1024),o(F,{caption:"",class:"text-grey-6 q-mt-xs"},{default:s(()=>[o(oe,{name:"schedule",size:"14px",class:"q-mr-xs"}),M(" "+b(q(a.created_at)),1)]),_:2},1024)]),_:2},1024),o(W,{side:"",top:""},{default:s(()=>[y("div",ut,[a.is_read?A("",!0):(r(),T(Ie,{key:0,color:"primary",rounded:"",class:"q-mb-sm"})),a.is_read?A("",!0):(r(),T(I,{key:1,flat:"",round:"",dense:"",icon:"done",size:"sm",color:"primary",onClick:Be(w=>c(k)(a.id),["stop"])},{default:s(()=>[o(tt,null,{default:s(()=>[M(b(e.$t("notifications.markAsRead")),1)]),_:1})]),_:2},1032,["onClick"]))])]),_:2},1024)]),_:2},1032,["class","onClick"])),[[He]])),128))]),_:1})),c(l).length>=20?(r(),O("div",dt,[o(I,{flat:"",color:"primary",label:e.$t("notifications.loadMore"),icon:"expand_more",onClick:H,loading:c(_)},null,8,["label","loading"])])):A("",!0)])]),_:1}))}});export{Nt as default};
