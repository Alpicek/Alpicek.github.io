import{a as T,u as ne,i as k,o,w as i,e as t,f as p,c as d,$ as A,a3 as O,t as l,_ as C,k as F,Q as _,r as Q,h as ie,g as R,j as J,a2 as N,a1 as z,aj as oe,ak as le}from"./index-Wt6DnGfT.js";import{a as K,Q as de,b as ue,d as W,c as ce}from"./QTabPanels-6eqJtDl8.js";import{Q as j,a as D}from"./QCard-e-hE1c2_.js";import{Q as me}from"./QInput-KCv4t_px.js";import{Q as fe,a as E,b as H}from"./QItem-B7-jgOCg.js";import{Q as pe}from"./QList-DcVJ7me-.js";import{Q as B}from"./QCardActions-DDpdxP54.js";import{_ as Y,Q as ve}from"./_plugin-vue_export-helper-CiTt8v3U.js";import{Q as ye}from"./QPage-BibazWmS.js";import{u as Z}from"./use-quasar-CEy2iTb0.js";import{u as he}from"./useAuth-CAJze-Et.js";import{u as ge}from"./useFriends-CINAwkc1.js";import{u as G}from"./vue-i18n.runtime-CgijP6w7.js";import"./focus-manager-BYMf-7Mt.js";import"./selection-DYhAz9K8.js";import"./use-dark-D84mCg8z.js";import"./use-prevent-scroll-xoE1t_k6.js";import"./supabase-BDcL2ig_.js";const _e=["src"],$e={key:1},qe={class:"text-h6 q-mt-md"},be={key:0,class:"text-subtitle2 text-grey-6"},ke={key:1,class:"text-body2 text-grey-7 q-mt-sm"},we=T({__name:"FriendCard",props:{friend:{}},emits:["remove"],setup(V,{emit:u}){const c=V,f=u,s=Z(),m=ne(),{t:q}=G(),b=r=>r.name&&r.surname?`${r.name} ${r.surname}`:r.username||r.email,h=r=>r.name&&r.surname?`${r.name.charAt(0)}${r.surname.charAt(0)}`:r.username?r.username.charAt(0).toUpperCase():r.email.charAt(0).toUpperCase(),S=(r,$)=>{const v=new Date(r),y=v.getDate(),g=v.getMonth()+1,w=v.getFullYear();return $?`${y}. ${g}. ${w}`:`${y}. ${g}.`},x=()=>{m.push(`/wishes/${c.friend.id}`)},I=()=>{s.dialog({title:q("friends.removeFriend"),message:`Opravdu chcete odebrat ${b(c.friend)} z přátel?`,cancel:!0,persistent:!0}).onOk(()=>{f("remove",c.friend.id)})};return(r,$)=>(o(),k(j,{class:"friend-card",style:{width:"100%","max-width":"300px"}},{default:i(()=>[t(D,{class:"text-center"},{default:i(()=>[t(O,{size:"80px",color:"primary","text-color":"white"},{default:i(()=>[r.friend.avatar_url?(o(),d("img",{key:0,src:r.friend.avatar_url},null,8,_e)):(o(),d("span",$e,l(h(r.friend)),1))]),_:1}),p("div",qe,l(b(r.friend)),1),r.friend.username?(o(),d("div",be,"@"+l(r.friend.username),1)):A("",!0),r.friend.date_of_birth?(o(),d("div",ke,[t(F,{name:"cake",size:"16px",class:"q-mr-xs"}),C(" "+l(S(r.friend.date_of_birth,r.friend.birth_year_visible)),1)])):A("",!0)]),_:1}),t(B,{align:"center"},{default:i(()=>[t(_,{color:"primary",flat:"",icon:"card_giftcard",label:r.$t("wishes.viewWishes"),onClick:x},null,8,["label"]),t(_,{color:"negative",flat:"",icon:"person_remove",onClick:I})]),_:1})]),_:1}))}}),Qe=Y(we,[["__scopeId","data-v-01d10fd5"]]),Ce=["src"],Fe={key:1},Re={class:"text-h6 q-mt-md"},Ae={key:0,class:"text-subtitle2 text-grey-6"},De={class:"text-body2 text-grey-7 q-mt-sm"},Ve=T({__name:"PendingRequestCard",props:{request:{}},emits:["accept","decline"],setup(V){const u=s=>s.name&&s.surname?`${s.name} ${s.surname}`:s.username||s.email,c=s=>s.name&&s.surname?`${s.name.charAt(0)}${s.surname.charAt(0)}`:s.username?s.username.charAt(0).toUpperCase():s.email.charAt(0).toUpperCase(),f=s=>{const m=new Date(s),b=Math.abs(new Date().getTime()-m.getTime()),h=Math.ceil(b/(1e3*60*60*24));return h===1?"Dnes":h===2?"Včera":h<7?`Před ${h} dny`:m.toLocaleDateString("cs-CZ")};return(s,m)=>(o(),k(j,{class:"pending-card",style:{width:"100%","max-width":"300px"}},{default:i(()=>[t(D,{class:"text-center"},{default:i(()=>[t(O,{size:"60px",color:"primary","text-color":"white"},{default:i(()=>[s.request.user.avatar_url?(o(),d("img",{key:0,src:s.request.user.avatar_url},null,8,Ce)):(o(),d("span",Fe,l(c(s.request.user)),1))]),_:1}),p("div",Re,l(u(s.request.user)),1),s.request.user.username?(o(),d("div",Ae," @"+l(s.request.user.username),1)):A("",!0),p("div",De,[t(F,{name:"schedule",size:"16px",class:"q-mr-xs"}),C(" "+l(f(s.request.created_at)),1)])]),_:1}),t(B,{align:"center"},{default:i(()=>[t(_,{color:"positive",flat:"",icon:"check",label:"Přijmout",onClick:m[0]||(m[0]=q=>s.$emit("accept",s.request.id))}),t(_,{color:"negative",flat:"",icon:"close",label:"Odmítnout",onClick:m[1]||(m[1]=q=>s.$emit("decline",s.request.id))})]),_:1})]),_:1}))}}),Se=Y(Ve,[["__scopeId","data-v-617f8372"]]),xe={class:"row justify-between items-center q-mb-md"},Ie={class:"text-h4"},Ue={key:0,class:"flex justify-center"},Pe={key:1,class:"text-center text-grey-6 q-py-lg"},Ne={class:"text-h6 q-mt-md"},ze={key:2,class:"row q-gutter-md"},Ee={key:0,class:"flex justify-center"},Te={key:1,class:"text-center text-grey-6 q-py-lg"},Oe={class:"text-h6 q-mt-md"},je={key:2,class:"row q-gutter-md"},Be={class:"text-h6"},Le={key:0,class:"q-mt-md"},Me={class:"text-subtitle2 q-mb-sm"},ut=T({__name:"FriendsPage",setup(V){const u=Z(),{t:c}=G(),{user:f}=he(),{friends:s,isLoading:m,sendFriendRequest:q,acceptFriendRequest:b,declineFriendRequest:h,fetchFriends:S,fetchPendingRequests:x,searchUsers:I,removeFriend:r}=ge(),$=Q("friends"),v=Q(!1),y=Q(""),g=Q([]),w=Q([]),X=e=>e.name&&e.surname?`${e.name} ${e.surname}`:e.username||e.email,ee=e=>e.name&&e.surname?`${e.name.charAt(0)}${e.surname.charAt(0)}`:e.username?e.username.charAt(0).toUpperCase():e.email.charAt(0).toUpperCase(),L=()=>{y.value="",g.value=[]},U=async()=>{if(y.value.trim().length<2){g.value=[];return}const e=await I(y.value);if(e.data){const a=s.value.map(n=>n.id);g.value=e.data.filter(n=>n.id!==f.value?.id&&!a.includes(n.id))}},M=async e=>{if(!f.value)return;const a=await q(e,f.value.id);a.error?u.notify({type:"negative",message:c("friends.sendRequestError")+": "+(a.error instanceof Error?a.error.message:JSON.stringify(a.error))}):(u.notify({type:"positive",message:c("friends.sendRequestSuccess")}),v.value=!1,L())},te=async e=>{const a=await b(e);a.error?u.notify({type:"negative",message:c("friends.acceptRequestError")+": "+(a.error instanceof Error?a.error.message:JSON.stringify(a.error))}):(u.notify({type:"positive",message:c("friends.acceptRequestSuccess")}),await P())},se=async e=>{const a=await h(e);a.error?u.notify({type:"negative",message:c("friends.declineRequestError")+": "+(a.error instanceof Error?a.error.message:JSON.stringify(a.error))}):(u.notify({type:"positive",message:c("friends.declineRequestSuccess")}),await P())},ae=async e=>{const a=await r(e);a.error?u.notify({type:"negative",message:"Chyba při odstraňování přítele: "+(a.error instanceof Error?a.error.message:JSON.stringify(a.error))}):u.notify({type:"positive",message:"Přítel odstraněn."})},P=async()=>{if(!f.value)return;const e=await x(f.value.id);e?.data&&(w.value=e.data)};return ie(async()=>{f.value&&(await S(f.value.id),await P())}),(e,a)=>(o(),k(ye,{class:"q-pa-md"},{default:i(()=>[p("div",xe,[p("div",Ie,l(e.$t("friends.title")),1),t(_,{color:"primary",icon:"person_add",label:e.$t("friends.addFriend"),onClick:a[0]||(a[0]=n=>v.value=!0)},null,8,["label"])]),t(de,{modelValue:$.value,"onUpdate:modelValue":a[1]||(a[1]=n=>$.value=n),class:"text-primary q-mb-md"},{default:i(()=>[t(K,{name:"friends",label:e.$t("friends.myFriends")},null,8,["label"]),t(K,{name:"pending",label:e.$t("friends.requests")},null,8,["label"])]),_:1},8,["modelValue"]),t(ue),t(ce,{modelValue:$.value,"onUpdate:modelValue":a[2]||(a[2]=n=>$.value=n),animated:""},{default:i(()=>[t(W,{name:"friends"},{default:i(()=>[R(m)?(o(),d("div",Ue,[t(J,{size:"lg"})])):R(s).length===0?(o(),d("div",Pe,[t(F,{name:"people",size:"4rem"}),p("div",Ne,l(e.$t("friends.noFriends")),1),p("div",null,l(e.$t("friends.addFirstFriend")),1)])):(o(),d("div",ze,[(o(!0),d(N,null,z(R(s),n=>(o(),k(Qe,{key:n.id,friend:n,onRemove:ae},null,8,["friend"]))),128))]))]),_:1}),t(W,{name:"pending"},{default:i(()=>[R(m)?(o(),d("div",Ee,[t(J,{size:"lg"})])):w.value.length===0?(o(),d("div",Te,[t(F,{name:"inbox",size:"4rem"}),p("div",Oe,l(e.$t("friends.noRequests")),1),p("div",null,l(e.$t("friends.noRequestsDescription")),1)])):(o(),d("div",je,[(o(!0),d(N,null,z(w.value,n=>(o(),k(Se,{key:n.id,request:n,onAccept:te,onDecline:se},null,8,["request"]))),128))]))]),_:1})]),_:1},8,["modelValue"]),t(ve,{modelValue:v.value,"onUpdate:modelValue":a[5]||(a[5]=n=>v.value=n),onHide:L},{default:i(()=>[t(j,{style:{width:"100%","max-width":"500px"}},{default:i(()=>[t(D,null,{default:i(()=>[p("div",Be,l(e.$t("friends.addFriend")),1)]),_:1}),t(D,null,{default:i(()=>[t(me,{modelValue:y.value,"onUpdate:modelValue":a[3]||(a[3]=n=>y.value=n),label:e.$t("friends.searchUsers"),outlined:"",placeholder:e.$t("friends.searchPlaceholder"),onInput:U,onKeyup:oe(U,["enter"])},{prepend:i(()=>[t(F,{name:"search"})]),append:i(()=>[t(_,{flat:"",round:"",icon:"search",onClick:U,disabled:y.value.length<2},null,8,["disabled"])]),_:1},8,["modelValue","label","placeholder"]),g.value.length>0?(o(),d("div",Le,[p("div",Me,l(e.$t("friends.searchResults"))+":",1),t(pe,null,{default:i(()=>[(o(!0),d(N,null,z(g.value,n=>(o(),k(fe,{key:n.id,clickable:"",onClick:re=>M(n.id)},{default:i(()=>[t(E,{avatar:""},{default:i(()=>[t(O,{color:"primary","text-color":"white"},{default:i(()=>[C(l(ee(n)),1)]),_:2},1024)]),_:2},1024),t(E,null,{default:i(()=>[t(H,null,{default:i(()=>[C(l(X(n)),1)]),_:2},1024),t(H,{caption:""},{default:i(()=>[C(l(n.username||n.email),1)]),_:2},1024)]),_:2},1024),t(E,{side:""},{default:i(()=>[t(_,{color:"primary",flat:"",round:"",icon:"person_add",onClick:le(re=>M(n.id),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})])):A("",!0)]),_:1}),t(B,{align:"right"},{default:i(()=>[t(_,{label:e.$t("common.cancel"),color:"grey",flat:"",onClick:a[4]||(a[4]=n=>v.value=!1)},null,8,["label"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{ut as default};
