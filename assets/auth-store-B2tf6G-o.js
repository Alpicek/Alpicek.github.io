import{bf as n}from"./index-DVxg6bki.js";import{supabase as o}from"./supabase-DHOxICEL.js";const i="darkovnicek_data_loaded",l=()=>{const e=s=>sessionStorage.getItem(`${i}_${s}`)==="true";return{isDataLoaded:e,markDataLoaded:s=>{sessionStorage.setItem(`${i}_${s}`,"true")},clearDataLoaded:s=>{s?sessionStorage.removeItem(`${i}_${s}`):(sessionStorage.removeItem(`${i}_friends`),sessionStorage.removeItem(`${i}_wishes`),sessionStorage.removeItem(`${i}_pendingRequests`),sessionStorage.removeItem(`${i}_groups`))},shouldShowLoading:s=>!e(s)}},c=n("auth",{state:()=>({user:null,profile:null,loading:!1}),getters:{isAuthenticated:e=>!!e.user,isLoading:e=>e.loading},actions:{async signUp(e,r,t){this.loading=!0;try{const{data:a,error:s}=await o.auth.signUp({email:e,password:r,options:{data:t}});if(s)throw s;return{data:a,error:null}}catch(a){return{data:null,error:a}}finally{this.loading=!1}},async signIn(e,r){this.loading=!0;try{const{data:t,error:a}=await o.auth.signInWithPassword({email:e,password:r});if(a)throw a;return t.user&&await this.fetchProfile(t.user.id),{data:t,error:null}}catch(t){return{data:null,error:t}}finally{this.loading=!1}},async signOut(){this.loading=!0;try{const{error:e}=await o.auth.signOut();if(e)throw e;this.user=null,this.profile=null;const{clearDataLoaded:r}=l();return r(),{error:null}}catch(e){return{error:e}}finally{this.loading=!1}},async fetchProfile(e){const{data:r,error:t}=await o.from("profiles").select("*").eq("id",e).single();if(t)throw t;return this.profile=r,r},async updateProfile(e){if(!this.user)throw new Error("No user authenticated");const{data:r,error:t}=await o.from("profiles").update(e).eq("id",this.user.id).select().single();if(t)throw t;return this.profile=r,r},async initializeAuth(){const{data:{session:e}}=await o.auth.getSession();e?.user&&(this.user=e.user,await this.fetchProfile(e.user.id)),o.auth.onAuthStateChange(async(r,t)=>{t?.user?(this.user=t.user,await this.fetchProfile(t.user.id)):(this.user=null,this.profile=null)})}}});export{l as a,c as u};
