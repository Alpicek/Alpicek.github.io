import{a as Z,r as p,v as ee,b as se,m as te,n as C,w as m,o as l,c as u,e as t,q as B,g as n,p as k,t as d,j as y,f as F,ax as ie,at as W,ak as re,aw as ae,Q as N,au as oe,av as le,i as q,aB as ne,aA as ue,k as de}from"./index-DcT2ux80.js";import{Q as me}from"./QSelect-Btdwv7B6.js";import{Q as ce}from"./QForm-CYsn5LZN.js";import{Q as ve}from"./QPage-BNSETTxJ.js";import{u as fe}from"./use-quasar-B4nle0bC.js";import{u as ge}from"./auth-store-BSTOyDR1.js";import{u as pe}from"./useWishes-88bA6nex.js";import{supabase as ye}from"./supabase-DkOw_aOL.js";import{W as he}from"./WishCard-mi9HezKW.js";import{u as be}from"./vue-i18n.runtime-EzKfoaH7.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QChip-DsLmkw4c.js";import"./QItem-DoA9z5g1.js";import"./format-BaFrxtoS.js";import"./position-engine-CNzjy2rL.js";import"./selection-kdsaOv7s.js";import"./rtl-DFPa-2ov.js";const _e={key:0,class:"flex justify-center"},$e={key:1,class:"text-center text-grey-6 q-py-lg"},ke={class:"text-h6 q-mt-md"},Fe={key:2},We={class:"row items-center justify-between q-mb-lg"},qe={class:"text-h4"},Ve={class:"row items-center q-gutter-lg"},Qe=["src"],Se={key:1},Ce={class:"friend-details"},Be={class:"text-h4"},Ne={key:0,class:"text-h6 text-grey-6 q-mt-xs"},Ae={key:1,class:"text-body1 text-grey-7 q-mt-md"},xe={class:"wishes-section"},De={class:"text-h5 q-mb-md"},Ee={key:0,class:"flex justify-center"},Pe={key:1,class:"text-center text-grey-6 q-py-lg"},Re={class:"text-h6 q-mt-md"},Ie={key:2,class:"row q-gutter-md"},Ue={class:"text-h6"},ze={key:0,class:"text-caption text-grey-6"},Oe={class:"row justify-end q-gutter-sm"},je=Z({__name:"FriendProfilePage",setup(Je){const c=fe(),{t:o}=be(),A=ue(),v=ge(),{fetchWishes:x,toggleBought:D,toggleReceived:E,createWish:P,updateWish:R,deleteWish:I}=pe(),w=p(!0),_=p(!1),i=p(null),$=p([]),U=ee(()=>A.params.id),b=e=>e.name&&e.surname?`${e.name} ${e.surname}`:e.username||e.email,z=e=>e.name&&e.surname?`${e.name.charAt(0)}${e.surname.charAt(0)}`:e.username?e.username.charAt(0).toUpperCase():e.email.charAt(0).toUpperCase(),O=(e,s)=>{const a=new Date(e),Q=a.getDate(),S=a.getMonth()+1,X=a.getFullYear();return s?`${Q}. ${S}. ${X}`:`${Q}. ${S}.`},j=async()=>{try{const{data:e,error:s}=await ye.from("profiles").select("*").eq("id",U.value).single();if(s)throw s;i.value=e}catch(e){console.error("Error loading friend profile:",e),i.value=null}finally{w.value=!1}},h=async()=>{if(!i.value)return;_.value=!0;const e=await x({userId:i.value.id,context:"all",isBackgroundRefresh:!0,forSelf:!1});e?.data&&($.value=e.data),_.value=!1},g=p(!1),f=p(null),r=se({name:"",description:"",url:"",visibility:"friends"}),J=[{label:o("wishes.form.visibilityPublic"),value:"public"},{label:o("wishes.form.visibilityFriends"),value:"friends"},{label:o("wishes.form.visibilityPrivate"),value:"private"}],L=()=>{i.value&&(g.value=!0)},V=()=>{r.name="",r.description="",r.url="",r.visibility="friends",f.value=null},T=async()=>{if(!v.user||!i.value)return;const e={name:r.name,...r.description&&{description:r.description},...r.url&&{url:r.url},visibility:r.visibility,created_for_user_id:i.value.id,created_by_user_id:v.user.id};let s;f.value?s=await R(f.value,e):s=await P(e),s.error?c.notify({type:"negative",message:o("wishes.saveError")+": "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):(c.notify({type:"positive",message:f.value?o("wishes.updateSuccess"):o("wishes.createSuccess")}),g.value=!1,V(),await h())},H=e=>{r.name=e.name,r.description=e.description||"",r.url=e.url||"",r.visibility=e.visibility,f.value=e.id,g.value=!0},M=async e=>{const s=await I(e);s.error?c.notify({type:"negative",message:o("wishes.deleteError")+": "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):(c.notify({type:"positive",message:o("wishes.deleteSuccess")}),await h())},Y=()=>{i.value&&c.dialog({title:o("friends.removeFriend"),message:o("friends.removeConfirm",{name:b(i.value)}),cancel:!0,persistent:!0}).onOk(()=>{c.notify({type:"info",message:o("friends.removeNotImplemented")})})},G=async e=>{if(!v.user)return;const s=await D(e,v.user.id);s.error?c.notify({type:"negative",message:o("wishes.toggleBoughtError")+": "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):await h()},K=async e=>{if(!v.user)return;const s=await E(e,v.user.id);s.error?c.notify({type:"negative",message:o("wishes.toggleReceivedError")+": "+(typeof s.error=="string"?s.error:JSON.stringify(s.error))}):(await h(),c.notify({type:"positive",message:o("wishes.toggleReceivedSuccess")}))};return te(async()=>{await j(),i.value&&await h()}),(e,s)=>(l(),C(ve,{class:"q-pa-md"},{default:m(()=>[w.value?(l(),u("div",_e,[t(B,{size:"lg"})])):i.value?(l(),u("div",Fe,[n("div",We,[t(y,{flat:"",round:"",icon:"arrow_back",color:"primary",onClick:s[1]||(s[1]=a=>e.$router.back())}),n("div",qe,d(e.$t("friends.friendProfile")),1),s[8]||(s[8]=n("div",null,null,-1))]),t(N,{class:"friend-profile-card q-mb-lg"},{default:m(()=>[t(F,null,{default:m(()=>[n("div",Ve,[t(ie,{size:"120px",color:"primary","text-color":"white"},{default:m(()=>[i.value.avatar_url?(l(),u("img",{key:0,src:i.value.avatar_url},null,8,Qe)):(l(),u("span",Se,d(z(i.value)),1))]),_:1}),n("div",Ce,[n("div",Be,d(b(i.value)),1),i.value.username?(l(),u("div",Ne," @"+d(i.value.username),1)):W("",!0),i.value.date_of_birth?(l(),u("div",Ae,[t(k,{name:"cake",size:"20px",class:"q-mr-xs"}),re(" "+d(O(i.value.date_of_birth,i.value.birth_year_visible??!1)),1)])):W("",!0)])])]),_:1}),t(ae,{align:"center",class:"q-gutter-md"},{default:m(()=>[t(y,{color:"primary",icon:"add_circle",label:e.$t("wishes.addForFriend"),onClick:L},null,8,["label"]),t(y,{color:"negative",outline:"",icon:"person_remove",label:e.$t("friends.removeFriend"),onClick:Y},null,8,["label"])]),_:1})]),_:1}),n("div",xe,[n("div",De,d(e.$t("friends.friendWishes",{name:b(i.value)})),1),_.value?(l(),u("div",Ee,[t(B,{size:"lg"})])):$.value.length===0?(l(),u("div",Pe,[t(k,{name:"card_giftcard",size:"4rem"}),n("div",Re,d(e.$t("wishes.noWishes")),1),n("div",null,d(e.$t("friends.friendHasNoWishes")),1)])):(l(),u("div",Ie,[(l(!0),u(oe,null,le($.value,a=>(l(),C(he,{key:a.id,wish:a,"current-user-id":de(v).user?.id,onEdit:H,onDelete:M,onToggleBought:G,onToggleReceived:K},null,8,["wish","current-user-id"]))),128))]))])])):(l(),u("div",$e,[t(k,{name:"person_off",size:"4rem"}),n("div",ke,d(e.$t("friends.friendNotFound")),1),n("div",null,d(e.$t("friends.friendNotFoundDesc")),1),t(y,{color:"primary",label:e.$t("common.back"),class:"q-mt-md",onClick:s[0]||(s[0]=a=>e.$router.back())},null,8,["label"])])),t(ne,{modelValue:g.value,"onUpdate:modelValue":s[7]||(s[7]=a=>g.value=a),onHide:V},{default:m(()=>[t(N,{style:{width:"100%","max-width":"500px"}},{default:m(()=>[t(F,null,{default:m(()=>[n("div",Ue,d(f.value?e.$t("wishes.editWish"):e.$t("wishes.addForFriend")),1),i.value?(l(),u("div",ze,d(f.value?e.$t("wishes.editingWish"):e.$t("wishes.addingForUser",{name:b(i.value)})),1)):W("",!0)]),_:1}),t(F,null,{default:m(()=>[t(ce,{onSubmit:T,class:"q-gutter-md"},{default:m(()=>[t(q,{modelValue:r.name,"onUpdate:modelValue":s[2]||(s[2]=a=>r.name=a),label:e.$t("wishes.form.name"),outlined:"",rules:[a=>!!a||e.$t("wishes.form.nameRequired")]},null,8,["modelValue","label","rules"]),t(q,{modelValue:r.description,"onUpdate:modelValue":s[3]||(s[3]=a=>r.description=a),label:e.$t("wishes.form.description"),type:"textarea",outlined:"",rows:"3"},null,8,["modelValue","label"]),t(q,{modelValue:r.url,"onUpdate:modelValue":s[4]||(s[4]=a=>r.url=a),label:e.$t("wishes.form.url"),outlined:"",type:"url"},null,8,["modelValue","label"]),t(me,{modelValue:r.visibility,"onUpdate:modelValue":s[5]||(s[5]=a=>r.visibility=a),label:e.$t("wishes.form.visibility"),outlined:"",options:J,"option-value":"value","option-label":"label","emit-value":"","map-options":""},null,8,["modelValue","label"]),n("div",Oe,[t(y,{label:e.$t("common.cancel"),color:"grey",flat:"",onClick:s[6]||(s[6]=a=>g.value=!1)},null,8,["label"]),t(y,{type:"submit",label:e.$t("common.save"),color:"primary",loading:w.value},null,8,["label","loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),ns=we(je,[["__scopeId","data-v-487bdf41"]]);export{ns as default};
