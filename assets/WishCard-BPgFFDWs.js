import{a as N}from"./QSelect-N7IH0-wA.js";import{y as K,L as Z,A as J,aD as X,a as ee,r as A,n as W,w as S,z as w,p as f,o as r,Q as te,ah as se,f as T,e as y,h as v,c as b,aq as c,t as E,k as C,aC as $,g as H,a4 as ie,aG as re,ar as V,as as j,at as oe}from"./index-DywPtqBD.js";import{u as ne}from"./use-quasar-Dhk6w8yX.js";import{u as ae}from"./useGroups-CM2tUhAj.js";import{u as le}from"./vue-i18n.runtime-DTWan08Y.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de=K({name:"QSlideTransition",props:{appear:Boolean,duration:{type:Number,default:300}},emits:["show","hide"],setup(_,{slots:z,emit:t}){let g=!1,B,n,i=null,h=null,l,I;function k(){B?.(),B=null,g=!1,i!==null&&(clearTimeout(i),i=null),h!==null&&(clearTimeout(h),h=null),n?.removeEventListener("transitionend",l),l=null}function L(s,u,m){u!==void 0&&(s.style.height=`${u}px`),s.style.transition=`height ${_.duration}ms cubic-bezier(.25, .8, .50, 1)`,g=!0,B=m}function U(s,u){s.style.overflowY=null,s.style.height=null,s.style.transition=null,k(),u!==I&&t(u)}function G(s,u){let m=0;n=s,g===!0?(k(),m=s.offsetHeight===s.scrollHeight?0:void 0):(I="hide",s.style.overflowY="hidden"),L(s,m,u),i=setTimeout(()=>{i=null,s.style.height=`${s.scrollHeight}px`,l=d=>{h=null,(Object(d)!==d||d.target===s)&&U(s,"show")},s.addEventListener("transitionend",l),h=setTimeout(l,_.duration*1.1)},100)}function Q(s,u){let m;n=s,g===!0?k():(I="show",s.style.overflowY="hidden",m=s.scrollHeight),L(s,m,u),i=setTimeout(()=>{i=null,s.style.height=0,l=d=>{h=null,(Object(d)!==d||d.target===s)&&U(s,"hide")},s.addEventListener("transitionend",l),h=setTimeout(l,_.duration*1.1)},100)}return Z(()=>{g===!0&&k()}),()=>J(X,{css:!1,appear:_.appear,onEnter:G,onLeave:Q},z.default)}}),ce={class:"row items-center justify-between"},he={class:"text-h6 wish-title"},me={class:"row items-center q-gutter-xs"},pe={key:0,class:"text-body2 text-grey-7 q-mt-xs preview-text"},we={key:0,class:"row q-gutter-xs q-mb-md items-center"},fe={key:1,class:"wish-description q-mb-md"},ve={class:"text-body2 text-grey-7"},ge={key:2,class:"wish-url q-mb-md"},ye={class:"wish-meta"},be={class:"text-caption text-grey-6"},_e={key:0},ke=ee({__name:"WishCard",props:{wish:{},currentUserId:{},expanded:{type:Boolean},highlight:{type:Boolean},refreshKey:{}},emits:["edit","delete","toggleBought","toggleReceived"],setup(_,{emit:z}){const t=_,g=z,B=ne(),{t:n}=le(),i=A(!1),h=()=>{typeof t.expanded=="boolean"&&(i.value=t.expanded)};W(h),S(()=>t.expanded,()=>h());const l=()=>{i.value=!i.value},I=w(()=>{switch(t.wish.visibility){case"public":return"green";case"friends":return"blue";case"private":return"grey";default:return"grey"}}),k=w(()=>{switch(t.wish.visibility){case"public":return n("wishes.visibilityPublic");case"friends":return O.value?n("wishes.form.visibilityFriendsGroups"):n("wishes.visibilityFriends");case"private":return n("wishes.visibilityPrivate");default:return n("common.unknown")}}),L=w(()=>t.wish.created_by_user_id!==t.wish.created_for_user_id&&t.currentUserId!==t.wish.created_for_user_id),U=()=>{const e=t.wish.created_by_user;return e.name&&e.surname?`${e.name} ${e.surname}`:e.name?e.name:e.username?e.username:n("common.unknown")},G=w(()=>t.currentUserId===t.wish.created_by_user_id),Q=w(()=>t.currentUserId===t.wish.created_by_user_id),s=w(()=>t.currentUserId!==t.wish.created_for_user_id&&t.currentUserId!==void 0),u=w(()=>t.currentUserId===t.wish.created_for_user_id&&t.currentUserId!==void 0),m=w(()=>t.currentUserId===t.wish.created_by_user_id),{groups:d,fetchGroups:x,fetchWishRules:M}=ae(),q=A([]),D=A([]),O=w(()=>q.value.length>0||D.value.length>0),F=e=>{const a=d.value||[];return e.map(o=>a.find(p=>p.id===o)?.name).filter(o=>!!o)},R=async()=>{if(!m.value||t.wish.visibility!=="friends")return;(!d.value||d.value.length===0)&&await x();const e=await M(t.wish.id);if(!e.error&&e.data){const a=e.data.filter(p=>p.rule_type==="include").map(p=>p.group_id),o=e.data.filter(p=>p.rule_type==="exclude").map(p=>p.group_id);q.value=F(a),D.value=F(o)}};S(()=>i.value,e=>{e&&R()}),S(()=>t.refreshKey,()=>{i.value&&R()}),W(()=>{i.value&&R()});const P=e=>new Date(e).toLocaleDateString("cs-CZ"),Y=()=>{B.dialog({title:n("wishes.deleteWish"),message:n("wishes.deleteConfirm"),cancel:!0,persistent:!0}).onOk(()=>{g("delete",t.wish.id)})};return(e,a)=>(r(),f(te,{class:se(["wish-card self-start",{"wish-highlight":e.highlight}]),onClick:l},{default:T(()=>[y(H,{class:"wish-card-header"},{default:T(()=>[v("div",ce,[v("div",he,E(e.wish.name),1),v("div",me,[e.wish.is_bought?(r(),f(N,{key:0,color:"green","text-color":"white",label:e.$t("wishes.bought"),size:"sm"},null,8,["label"])):c("",!0),e.wish.is_received?(r(),f(N,{key:1,color:"purple","text-color":"white",label:e.$t("wishes.received"),size:"sm"},null,8,["label"])):c("",!0),y(C,{flat:"",round:"",dense:"",icon:i.value?"expand_less":"expand_more",onClick:$(l,["stop"])},null,8,["icon"])])]),!i.value&&e.wish.description?(r(),b("div",pe,E(e.wish.description),1)):c("",!0)]),_:1}),y(de,null,{default:T(()=>[ie(v("div",null,[y(H,{class:"wish-card-details"},{default:T(()=>[m.value?(r(),b("div",we,[y(N,{color:I.value,"text-color":"white",label:k.value,size:"sm"},null,8,["color","label"]),(r(!0),b(V,null,j(q.value,o=>(r(),f(N,{key:`inc-${o}`,color:"green","text-color":"white",label:o,size:"sm"},null,8,["label"]))),128)),(r(!0),b(V,null,j(D.value,o=>(r(),f(N,{key:`exc-${o}`,color:"red","text-color":"white",label:o,size:"sm"},null,8,["label"]))),128))])):c("",!0),e.wish.description?(r(),b("div",fe,[v("div",ve,E(e.wish.description),1)])):c("",!0),e.wish.url?(r(),b("div",ge,[y(C,{flat:"",color:"primary",href:e.wish.url,target:"_blank",icon:"open_in_new",label:e.$t("wishes.openLink"),size:"sm",onClick:a[0]||(a[0]=$(()=>{},["stop"]))},null,8,["href","label"])])):c("",!0),v("div",ye,[v("div",be,[L.value?(r(),b("div",_e,E(e.$t("wishes.createdBy",{name:U()})),1)):c("",!0),v("div",null,E(e.wish.created_at?P(e.wish.created_at):"N/A"),1)])])]),_:1}),y(oe,{align:"right"},{default:T(()=>[s.value?(r(),f(C,{key:0,color:e.wish.is_bought?"grey":"green",icon:e.wish.is_bought?"shopping_cart":"add_shopping_cart",label:e.wish.is_bought?e.$t("wishes.markAsNotBought"):e.$t("wishes.markAsBought"),flat:"",onClick:a[1]||(a[1]=$(o=>e.$emit("toggleBought",e.wish.id),["stop"]))},null,8,["color","icon","label"])):c("",!0),u.value?(r(),f(C,{key:1,color:e.wish.is_received?"orange":"purple",icon:e.wish.is_received?"undo":"check_circle",label:e.wish.is_received?e.$t("wishes.markAsNotReceived"):e.$t("wishes.markAsReceived"),flat:"",onClick:a[2]||(a[2]=$(o=>e.$emit("toggleReceived",e.wish.id),["stop"]))},null,8,["color","icon","label"])):c("",!0),G.value?(r(),f(C,{key:2,color:"primary",icon:"edit",flat:"",onClick:a[3]||(a[3]=$(o=>e.$emit("edit",e.wish),["stop"]))})):c("",!0),Q.value?(r(),f(C,{key:3,color:"negative",icon:"delete",flat:"",onClick:$(Y,["stop"])})):c("",!0)]),_:1})],512),[[re,i.value]])]),_:1})]),_:1},8,["class"]))}}),Ee=ue(ke,[["__scopeId","data-v-e318d0d5"]]);export{Ee as W};
