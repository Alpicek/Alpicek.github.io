import{a as te,r as h,z as A,b as ie,n as re,p as ae,f as c,o as l,c as d,e as t,s as R,h as n,q as k,t as u,k as p,g as W,au as oe,aq as q,x as le,at as ne,Q as D,ar as de,as as ue,j as F,aA as ce,az as me,u as fe,l as ve}from"./index-DywPtqBD.js";import{Q as ge}from"./QSelect-N7IH0-wA.js";import{Q as he}from"./QForm-Wlgf5_Ag.js";import{Q as pe}from"./QPage-ByQ-y1Qk.js";import{u as ye}from"./use-quasar-Dhk6w8yX.js";import{u as be}from"./auth-store-CFwI7z_J.js";import{u as _e}from"./useWishes-Czx3UWYD.js";import{supabase as we}from"./supabase-bByfhSrO.js";import{W as $e}from"./WishCard-BPgFFDWs.js";import{u as ke}from"./vue-i18n.runtime-DTWan08Y.js";import{_ as We}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QItem-vYT0oGEd.js";import"./format-D1-ZXYq9.js";import"./position-engine-Bcn4MC3v.js";import"./selection-BlIRqF8l.js";import"./rtl-DFPa-2ov.js";import"./useGroups-CM2tUhAj.js";const qe={key:0,class:"flex justify-center"},Fe={key:1,class:"text-center text-grey-6 q-py-lg"},Ve={class:"text-h6 q-mt-md"},Qe={key:2},Se={class:"row items-center justify-between q-mb-lg"},xe={class:"text-h4"},Ce={class:"row items-center q-gutter-lg"},Be=["src"],Ne={key:1},Ae={class:"friend-details"},Re={class:"text-h4"},De={key:0,class:"text-h6 text-grey-6 q-mt-xs"},Ee={key:1,class:"text-body1 text-grey-7 q-mt-md"},Pe={class:"wishes-section"},Ie={class:"text-h5 q-mb-md"},ze={key:0,class:"flex justify-center"},Ue={key:1,class:"text-center text-grey-6 q-py-lg"},Oe={class:"text-h6 q-mt-md"},je={key:2,class:"masonry"},Je={class:"text-h6"},Le={key:0,class:"text-caption text-grey-6"},Te={class:"row justify-end q-gutter-sm"},He=te({__name:"FriendProfilePage",setup(Me){const m=ye(),{t:o}=ke(),V=me(),Q=fe(),f=be(),{fetchWishes:E,toggleBought:P,toggleReceived:I,createWish:z,updateWish:U,deleteWish:O}=_e(),_=h(!0),w=h(!1),i=h(null),$=h([]),j=A(()=>V.params.id),S=A(()=>V.query.highlight||""),b=e=>e.name&&e.surname?`${e.name} ${e.surname}`:e.username||e.email,J=e=>e.name&&e.surname?`${e.name.charAt(0)}${e.surname.charAt(0)}`:e.username?e.username.charAt(0).toUpperCase():e.email.charAt(0).toUpperCase(),L=(e,s)=>{const a=new Date(e),B=a.getDate(),N=a.getMonth()+1,se=a.getFullYear();return s?`${B}. ${N}. ${se}`:`${B}. ${N}.`},T=async()=>{try{const{data:e,error:s}=await we.from("profiles").select("*").eq("id",j.value).single();if(s)throw s;i.value=e}catch(e){console.error("Error loading friend profile:",e),i.value=null}finally{_.value=!1}},y=async()=>{if(!i.value)return;w.value=!0;const e=await E({userId:i.value.id,context:"all",isBackgroundRefresh:!0,forSelf:!1});e?.data&&($.value=e.data),w.value=!1},g=h(!1),v=h(null),r=ie({name:"",description:"",url:"",visibility:"friends"}),H=[{label:o("wishes.form.visibilityPublic"),value:"public"},{label:o("wishes.form.visibilityFriends"),value:"friends"},{label:o("wishes.form.visibilityPrivate"),value:"private"}],M=()=>{i.value&&(g.value=!0)},x=()=>{r.name="",r.description="",r.url="",r.visibility="friends",v.value=null},Y=async()=>{if(!f.user||!i.value)return;const e={name:r.name,...r.description&&{description:r.description},...r.url&&{url:r.url},visibility:r.visibility,created_for_user_id:i.value.id,created_by_user_id:f.user.id};let s;v.value?s=await U(v.value,e):s=await z(e),s.error?m.notify({type:"negative",message:o("wishes.saveError")+": "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):(m.notify({type:"positive",message:v.value?o("wishes.updateSuccess"):o("wishes.createSuccess")}),g.value=!1,x(),await y())},G=e=>{r.name=e.name,r.description=e.description||"",r.url=e.url||"",r.visibility=e.visibility,v.value=e.id,g.value=!0},K=async e=>{const s=await O(e);s.error?m.notify({type:"negative",message:o("wishes.deleteError")+": "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):(m.notify({type:"positive",message:o("wishes.deleteSuccess")}),await y())},X=()=>{i.value&&m.dialog({title:o("friends.removeFriend"),message:o("friends.removeConfirm",{name:b(i.value)}),cancel:!0,persistent:!0}).onOk(()=>{m.notify({type:"info",message:o("friends.removeNotImplemented")})})},Z=async e=>{if(!f.user)return;const s=await P(e,f.user.id);s.error?m.notify({type:"negative",message:o("wishes.toggleBoughtError")+": "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):await y()},ee=async e=>{if(!f.user)return;const s=await I(e,f.user.id);s.error?m.notify({type:"negative",message:o("wishes.toggleReceivedError")+": "+(typeof s.error=="string"?s.error:JSON.stringify(s.error))}):(await y(),m.notify({type:"positive",message:o("wishes.toggleReceivedSuccess")}))},C=()=>{window.history.length>1?Q.back():Q.push("/app/friends")};return re(async()=>{await T(),i.value&&await y()}),(e,s)=>(l(),ae(pe,{class:"q-pa-md"},{default:c(()=>[_.value?(l(),d("div",qe,[t(R,{size:"lg"})])):i.value?(l(),d("div",Qe,[n("div",Se,[t(p,{flat:"",round:"",icon:"arrow_back",color:"primary",onClick:C}),n("div",xe,u(e.$t("friends.friendProfile")),1),s[6]||(s[6]=n("div",null,null,-1))]),t(D,{class:"friend-profile-card q-mb-lg"},{default:c(()=>[t(W,null,{default:c(()=>[n("div",Ce,[t(oe,{size:"120px",color:"primary","text-color":"white"},{default:c(()=>[i.value.avatar_url?(l(),d("img",{key:0,src:i.value.avatar_url},null,8,Be)):(l(),d("span",Ne,u(J(i.value)),1))]),_:1}),n("div",Ae,[n("div",Re,u(b(i.value)),1),i.value.username?(l(),d("div",De," @"+u(i.value.username),1)):q("",!0),i.value.date_of_birth?(l(),d("div",Ee,[t(k,{name:"cake",size:"20px",class:"q-mr-xs"}),le(" "+u(L(i.value.date_of_birth,i.value.birth_year_visible??!1)),1)])):q("",!0)])])]),_:1}),t(ne,{align:"center",class:"q-gutter-md"},{default:c(()=>[t(p,{color:"primary",icon:"add_circle",label:e.$t("wishes.addForFriend"),onClick:M},null,8,["label"]),t(p,{color:"negative",outline:"",icon:"person_remove",label:e.$t("friends.removeFriend"),onClick:X},null,8,["label"])]),_:1})]),_:1}),n("div",Pe,[n("div",Ie,u(e.$t("friends.friendWishes",{name:b(i.value)})),1),w.value?(l(),d("div",ze,[t(R,{size:"lg"})])):$.value.length===0?(l(),d("div",Ue,[t(k,{name:"card_giftcard",size:"4rem"}),n("div",Oe,u(e.$t("wishes.noWishes")),1),n("div",null,u(e.$t("friends.friendHasNoWishes")),1)])):(l(),d("div",je,[(l(!0),d(de,null,ue($.value,a=>(l(),d("div",{key:a.id,class:"masonry-item"},[t($e,{wish:a,"current-user-id":ve(f).user?.id,expanded:a.id===S.value,highlight:a.id===S.value,onEdit:G,onDelete:K,onToggleBought:Z,onToggleReceived:ee},null,8,["wish","current-user-id","expanded","highlight"])]))),128))]))])])):(l(),d("div",Fe,[t(k,{name:"person_off",size:"4rem"}),n("div",Ve,u(e.$t("friends.friendNotFound")),1),n("div",null,u(e.$t("friends.friendNotFoundDesc")),1),t(p,{color:"primary",label:e.$t("common.back"),class:"q-mt-md",onClick:C},null,8,["label"])])),t(ce,{modelValue:g.value,"onUpdate:modelValue":s[5]||(s[5]=a=>g.value=a),onHide:x},{default:c(()=>[t(D,{style:{width:"100%","max-width":"500px"}},{default:c(()=>[t(W,null,{default:c(()=>[n("div",Je,u(v.value?e.$t("wishes.editWish"):e.$t("wishes.addForFriend")),1),i.value?(l(),d("div",Le,u(v.value?e.$t("wishes.editingWish"):e.$t("wishes.addingForUser",{name:b(i.value)})),1)):q("",!0)]),_:1}),t(W,null,{default:c(()=>[t(he,{onSubmit:Y,class:"q-gutter-md"},{default:c(()=>[t(F,{modelValue:r.name,"onUpdate:modelValue":s[0]||(s[0]=a=>r.name=a),label:e.$t("wishes.form.name"),outlined:"",rules:[a=>!!a||e.$t("wishes.form.nameRequired")]},null,8,["modelValue","label","rules"]),t(F,{modelValue:r.description,"onUpdate:modelValue":s[1]||(s[1]=a=>r.description=a),label:e.$t("wishes.form.description"),type:"textarea",outlined:"",rows:"3"},null,8,["modelValue","label"]),t(F,{modelValue:r.url,"onUpdate:modelValue":s[2]||(s[2]=a=>r.url=a),label:e.$t("wishes.form.url"),outlined:"",type:"url"},null,8,["modelValue","label"]),t(ge,{modelValue:r.visibility,"onUpdate:modelValue":s[3]||(s[3]=a=>r.visibility=a),label:e.$t("wishes.form.visibility"),outlined:"",options:H,"option-value":"value","option-label":"label","emit-value":"","map-options":""},null,8,["modelValue","label"]),n("div",Te,[t(p,{label:e.$t("common.cancel"),color:"grey",flat:"",onClick:s[4]||(s[4]=a=>g.value=!1)},null,8,["label"]),t(p,{type:"submit",label:e.$t("common.save"),color:"primary",loading:_.value},null,8,["label","loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),ms=We(He,[["__scopeId","data-v-d4fe989c"]]);export{ms as default};
