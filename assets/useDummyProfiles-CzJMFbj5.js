import{supabase as i}from"./supabase-bByfhSrO.js";import{r as y}from"./index-DywPtqBD.js";const h=()=>{const t=y(!1),u=async(o,e)=>{t.value=!0;try{const r=e.email||`dummy-${crypto.randomUUID().slice(0,8)}@dummy.local`,{data:a,error:n}=await i.from("profiles").insert({id:crypto.randomUUID(),email:r,name:e.name,surname:e.surname||null,username:e.username||null,date_of_birth:e.date_of_birth||null,birth_year_visible:e.birth_year_visible??!1,is_dummy:!0}).select().single();if(n||!a)throw n||new Error("Failed to create dummy profile");const{error:s}=await i.from("dummy_profile_managers").insert({dummy_profile_id:a.id,manager_user_id:o});if(s)throw await i.from("profiles").delete().eq("id",a.id),s;const{error:m}=await i.from("friendships").insert({user_id:o,friend_id:a.id,status:"accepted"});if(m)throw await i.from("profiles").delete().eq("id",a.id),m;return{data:a,error:null}}catch(r){return console.error("Error creating dummy profile:",r),{data:null,error:r}}finally{t.value=!1}},d=async o=>{t.value=!0;try{const{data:e,error:r}=await i.from("dummy_profile_managers").select(`
          *,
          profiles!dummy_profile_managers_dummy_profile_id_fkey (*)
        `).eq("manager_user_id",o);if(r)throw r;return{data:e?.map(n=>n.profiles).filter(Boolean)||[],error:null}}catch(e){return console.error("Error fetching managed dummy profiles:",e),{data:null,error:e}}finally{t.value=!1}},f=async(o,e)=>{t.value=!0;try{const{data:r,error:a}=await i.from("profiles").update(e).eq("id",o).eq("is_dummy",!0).select().single();if(a)throw a;return{data:r,error:null}}catch(r){return console.error("Error updating dummy profile:",r),{data:null,error:r}}finally{t.value=!1}},c=async(o,e)=>{t.value=!0;try{const{data:r}=await i.from("dummy_profile_managers").select("id").eq("dummy_profile_id",o).eq("manager_user_id",e).single();if(!r)throw new Error("You do not have permission to delete this dummy profile");const{error:a}=await i.from("profiles").delete().eq("id",o).eq("is_dummy",!0);if(a)throw a;return{error:null}}catch(r){return console.error("Error deleting dummy profile:",r),{error:r}}finally{t.value=!1}},l=async(o,e)=>{try{const{data:r}=await i.from("dummy_profile_managers").select("id").eq("dummy_profile_id",o).eq("manager_user_id",e).single();return!!r}catch{return!1}};return{isLoading:t,createDummyProfile:u,fetchManagedDummyProfiles:d,updateDummyProfile:f,deleteDummyProfile:c,canManageDummyProfile:l,suggestDummyProfileAsFriend:async(o,e,r)=>{t.value=!0;try{if(!await l(o,r))throw new Error("You do not have permission to suggest this dummy profile");const{data:n,error:s}=await i.from("friendships").insert({user_id:o,friend_id:e,status:"pending"}).select().single();if(s)throw s;return{data:n,error:null}}catch(a){return console.error("Error suggesting dummy profile as friend:",a),{data:null,error:a}}finally{t.value=!1}}}};export{h as u};
