import{a as y}from"./QSelect-DxzLhrlU.js";import{a as J,r as N,q as z,w as A,z as u,s as c,o as t,Q as X,ak as Y,g as b,e as p,i as G,f as h,c as w,at as n,t as _,l as f,aC as g,a7 as ee,aD as se,F as L,A as U,av as te,m as ie}from"./index-CzEHk4FJ.js";import{Q as re}from"./QSlideTransition-CuHHXKmI.js";import{u as oe}from"./use-quasar-jdesDfeO.js";import{u as ne}from"./useGroups-C__TII0R.js";import{supabase as ae}from"./supabase-RdUxExGH.js";import{u as le}from"./vue-i18n.runtime-zO4z2J8f.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";function ce(m){if(!m)return null;let o=m.trim();/^https?:\/\//i.test(o)||(o="https://"+o);try{const v=new URL(o).hostname.toLowerCase().replace(/^www\./,""),k=v.split(".");return k.length>=2?k.slice(-2).join("."):v}catch{return null}}function de(){async function m(o,s="_blank"){if(!o)return;const v=ae.rpc("track_link_click",{target_url:o});try{s==="_blank"?window.open(o,"_blank","noopener"):window.location.href=o}catch{}try{await v}catch{}}return{trackClickAndOpen:m,extractBaseDomain:ce}}const he={class:"row items-center justify-between"},pe={class:"text-h6 wish-title"},we={class:"row items-center q-gutter-xs"},me={key:0,class:"text-body2 text-grey-7 q-mt-xs preview-text"},ve={key:0,class:"row q-gutter-xs q-mb-md items-center"},fe={key:1,class:"wish-description q-mb-md"},ge={class:"text-body2 text-grey-7"},ye={key:2,class:"wish-url q-mb-md"},be={class:"wish-meta"},_e={class:"text-caption text-grey-6"},ke={key:0},Ce=J({__name:"WishCard",props:{wish:{},currentUserId:{},expanded:{type:Boolean},highlight:{type:Boolean},refreshKey:{}},emits:["edit","delete","toggleBought","toggleReceived"],setup(m,{emit:o}){const s=m,v=o,k=oe(),{t:d}=le(),{trackClickAndOpen:E}=de(),a=N(!1),D=()=>{typeof s.expanded=="boolean"&&(a.value=s.expanded)};z(D),A(()=>s.expanded,()=>D());const Q=()=>{a.value=!a.value},S=u(()=>{switch(s.wish.visibility){case"public":return"green";case"friends":return"blue";case"private":return"grey";default:return"grey"}}),W=u(()=>{switch(s.wish.visibility){case"public":return d("wishes.visibilityPublic");case"friends":return K.value?d("wishes.form.visibilityFriendsGroups"):d("wishes.visibilityFriends");case"private":return d("wishes.visibilityPrivate");default:return d("common.unknown")}}),F=u(()=>s.wish.created_by_user_id!==s.wish.created_for_user_id&&s.currentUserId!==s.wish.created_for_user_id),T=()=>{const e=s.wish.created_by_user;return e.name&&e.surname?`${e.name} ${e.surname}`:e.name?e.name:e.username?e.username:d("common.unknown")},V=u(()=>s.currentUserId===s.wish.created_by_user_id),M=u(()=>s.currentUserId===s.wish.created_by_user_id),O=u(()=>s.currentUserId!==s.wish.created_for_user_id&&s.currentUserId!==void 0),P=u(()=>s.currentUserId===s.wish.created_for_user_id&&s.currentUserId!==void 0),R=u(()=>s.currentUserId===s.wish.created_by_user_id),{groups:C,fetchGroups:j,fetchWishRules:x}=ne(),$=N([]),B=N([]),K=u(()=>$.value.length>0||B.value.length>0),q=e=>{const r=C.value||[];return e.map(i=>r.find(l=>l.id===i)?.name).filter(i=>!!i)},I=async()=>{if(!R.value||s.wish.visibility!=="friends")return;(!C.value||C.value.length===0)&&await j();const e=await x(s.wish.id);if(!e.error&&e.data){const r=e.data.filter(l=>l.rule_type==="include").map(l=>l.group_id),i=e.data.filter(l=>l.rule_type==="exclude").map(l=>l.group_id);$.value=q(r),B.value=q(i)}};A(()=>a.value,e=>{e&&I()}),A(()=>s.refreshKey,()=>{a.value&&I()}),z(()=>{a.value&&I()});const Z=e=>new Date(e).toLocaleDateString("cs-CZ"),H=()=>{k.dialog({title:d("wishes.deleteWish"),message:d("wishes.deleteConfirm"),cancel:!0,persistent:!0}).onOk(()=>{v("delete",s.wish.id)})};return(e,r)=>(t(),c(X,{class:Y(["wish-card self-start",{"wish-highlight":e.highlight}]),onClick:Q},{default:b(()=>[p(G,{class:"wish-card-header"},{default:b(()=>[h("div",he,[h("div",pe,_(e.wish.name),1),h("div",we,[e.wish.is_bought?(t(),c(y,{key:0,color:"green","text-color":"white",label:e.$t("wishes.bought"),size:"sm"},null,8,["label"])):n("",!0),e.wish.is_received?(t(),c(y,{key:1,color:"purple","text-color":"white",label:e.$t("wishes.received"),size:"sm"},null,8,["label"])):n("",!0),p(f,{flat:"",round:"",dense:"",icon:a.value?"expand_less":"expand_more",onClick:g(Q,["stop"])},null,8,["icon"])])]),!a.value&&e.wish.description?(t(),w("div",me,_(e.wish.description),1)):n("",!0)]),_:1}),p(re,null,{default:b(()=>[ee(h("div",null,[p(G,{class:"wish-card-details"},{default:b(()=>[R.value?(t(),w("div",ve,[p(y,{color:S.value,"text-color":"white",label:W.value,size:"sm"},null,8,["color","label"]),(t(!0),w(L,null,U($.value,i=>(t(),c(y,{key:`inc-${i}`,color:"green","text-color":"white",label:i,size:"sm"},null,8,["label"]))),128)),(t(!0),w(L,null,U(B.value,i=>(t(),c(y,{key:`exc-${i}`,color:"red","text-color":"white",label:i,size:"sm"},null,8,["label"]))),128))])):n("",!0),e.wish.description?(t(),w("div",fe,[h("div",ge,_(e.wish.description),1)])):n("",!0),e.wish.url?(t(),w("div",ye,[p(f,{flat:"",color:"primary",icon:"open_in_new",label:e.$t("wishes.openLink"),size:"sm",onClick:r[0]||(r[0]=g(i=>ie(E)(e.wish.url),["stop"]))},null,8,["label"])])):n("",!0),h("div",be,[h("div",_e,[F.value?(t(),w("div",ke,_(e.$t("wishes.createdBy",{name:T()})),1)):n("",!0),h("div",null,_(e.wish.created_at?Z(e.wish.created_at):"N/A"),1)])])]),_:1}),p(te,{align:"right"},{default:b(()=>[O.value?(t(),c(f,{key:0,color:e.wish.is_bought?"grey":"green",icon:e.wish.is_bought?"shopping_cart":"add_shopping_cart",label:e.wish.is_bought?e.$t("wishes.markAsNotBought"):e.$t("wishes.markAsBought"),flat:"",onClick:r[1]||(r[1]=g(i=>e.$emit("toggleBought",e.wish.id),["stop"]))},null,8,["color","icon","label"])):n("",!0),P.value?(t(),c(f,{key:1,color:e.wish.is_received?"orange":"purple",icon:e.wish.is_received?"undo":"check_circle",label:e.wish.is_received?e.$t("wishes.markAsNotReceived"):e.$t("wishes.markAsReceived"),flat:"",onClick:r[2]||(r[2]=g(i=>e.$emit("toggleReceived",e.wish.id),["stop"]))},null,8,["color","icon","label"])):n("",!0),V.value?(t(),c(f,{key:2,color:"primary",icon:"edit",flat:"",onClick:r[3]||(r[3]=g(i=>e.$emit("edit",e.wish),["stop"]))})):n("",!0),M.value?(t(),c(f,{key:3,color:"negative",icon:"delete",flat:"",onClick:g(H,["stop"])})):n("",!0)]),_:1})],512),[[se,a.value]])]),_:1})]),_:1},8,["class"]))}}),qe=ue(Ce,[["__scopeId","data-v-3ee15e29"]]);export{qe as W};
