import{E as ge,I as B,a3 as pe,ag as ye,a5 as be,K as _e,r as K,C as P,bd as ke,a7 as we,aO as Te,a8 as Ce,be as Se,w as X,S as Y,V as ee,Z as te,ah as xe,G as ae,aK as Pe,H as Ne,a2 as Qe,a as qe,u as Ae,x as Oe,am as Ee,y as T,h as s,o as r,g as y,ax as A,t as b,q as c,p as I,f as o,e as O,A as De,z as oe,D as Me,ab as He,ao as Le,ay as Re,v as E,aP as $e,F as je,j as Ve,aD as ze}from"./index-DAJwJefL.js";import{a as U,Q as Be}from"./QTabs-BCYOsE7G.js";import{Q as Ie,a as W,b as F}from"./QItem-CUYqEEm-.js";import{Q as Ue}from"./QBadge-0NOA8KjT.js";import{v as We,a as ne,e as Fe,p as se,b as Ke,c as Ge,d as Ze,r as ie,s as Je}from"./position-engine-DLzP0rHL.js";import{c as le}from"./selection-kbekTKEE.js";import{Q as Xe}from"./QList-DEJqbsUR.js";import{Q as Ye}from"./QPage-CFkC8b5M.js";import{u as et}from"./useNotifications-CYzCxrMu.js";import"./QResizeObserver-BB1nRIh9.js";import"./rtl-DFPa-2ov.js";import"./supabase-C5qut0hh.js";import"./auth-store-DgD84Utc.js";import"./notifications-store-C4Q4kOj5.js";const tt=ge({name:"QTooltip",inheritAttrs:!1,props:{...Fe,...be,...B,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{...B.transitionShow,default:"jump-down"},transitionHide:{...B.transitionHide,default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:ne},self:{type:String,default:"top middle",validator:ne},offset:{type:Array,default:()=>[14,14],validator:We},scrollTarget:ye,delay:{type:Number,default:0},hideDelay:{type:Number,default:0},persistent:Boolean},emits:[...pe],setup(t,{slots:u,emit:N,attrs:l}){let f,h;const _=_e(),{proxy:{$q:i}}=_,v=K(null),k=K(!1),D=P(()=>se(t.anchor,i.lang.rtl)),M=P(()=>se(t.self,i.lang.rtl)),H=P(()=>t.persistent!==!0),{registerTick:L,removeTick:R}=ke(),{registerTimeout:d}=we(),{transitionProps:Q,transitionStyle:$}=Te(t),{localScrollTarget:q,changeScrollEvent:j,unconfigureScrollTarget:V}=Ke(t,Z),{anchorEl:e,canShow:m,anchorEvents:a}=Ge({showing:k,configureAnchorEl:fe}),{show:w,hide:g}=Ce({showing:k,canShow:m,handleShow:ce,handleHide:ue,hideOnRouteChange:H,processOnMount:!0});Object.assign(a,{delayShow:de,delayHide:me});const{showPortal:C,hidePortal:S,renderPortal:re}=Se(_,v,ve,"tooltip");if(i.platform.is.mobile===!0){const n={anchorEl:e,innerRef:v,onClickOutside(p){return g(p),p.target.classList.contains("q-dialog__backdrop")&&Qe(p),!0}},z=P(()=>t.modelValue===null&&t.persistent!==!0&&k.value===!0);X(z,p=>{(p===!0?Ze:ie)(n)}),Y(()=>{ie(n)})}function ce(n){C(),L(()=>{h=new MutationObserver(()=>x()),h.observe(v.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),x(),Z()}),f===void 0&&(f=X(()=>i.screen.width+"|"+i.screen.height+"|"+t.self+"|"+t.anchor+"|"+i.lang.rtl,x)),d(()=>{C(!0),N("show",n)},t.transitionDuration)}function ue(n){R(),S(),G(),d(()=>{S(!0),N("hide",n)},t.transitionDuration)}function G(){h!==void 0&&(h.disconnect(),h=void 0),f!==void 0&&(f(),f=void 0),V(),ee(a,"tooltipTemp")}function x(){Je({targetEl:v.value,offset:t.offset,anchorEl:e.value,anchorOrigin:D.value,selfOrigin:M.value,maxHeight:t.maxHeight,maxWidth:t.maxWidth})}function de(n){if(i.platform.is.mobile===!0){le(),document.body.classList.add("non-selectable");const z=e.value,p=["touchmove","touchcancel","touchend","click"].map(J=>[z,J,"delayHide","passiveCapture"]);te(a,"tooltipTemp",p)}d(()=>{w(n)},t.delay)}function me(n){i.platform.is.mobile===!0&&(ee(a,"tooltipTemp"),le(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),d(()=>{g(n)},t.hideDelay)}function fe(){if(t.noParentEvent===!0||e.value===null)return;const n=i.platform.is.mobile===!0?[[e.value,"touchstart","delayShow","passive"]]:[[e.value,"mouseenter","delayShow","passive"],[e.value,"mouseleave","delayHide","passive"]];te(a,"anchor",n)}function Z(){if(e.value!==null||t.scrollTarget!==void 0){q.value=xe(e.value,t.scrollTarget);const n=t.noParentEvent===!0?x:g;j(q.value,n)}}function he(){return k.value===!0?ae("div",{...l,ref:v,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",l.class],style:[l.style,$.value],role:"tooltip"},Ne(u.default)):null}function ve(){return ae(Pe,Q.value,he)}return Y(G),Object.assign(_.proxy,{updatePosition:x}),re}}),at={class:"row items-center justify-between q-px-md q-pt-md"},ot={class:"text-h6"},nt={class:"q-px-md q-pt-sm"},st={class:"col q-pa-md"},it={key:0,class:"column items-center justify-center full-height"},lt={class:"q-mt-sm text-grey-6"},rt={key:1,class:"column items-center justify-center full-height"},ct={class:"text-body1 text-grey-6 q-mt-md"},ut={class:"column items-end"},dt={key:3,class:"q-pa-md text-center"},xt=qe({__name:"NotificationsPage",setup(t){const{t:u}=Ae(),N=Ve(),{notifications:l,unreadCount:f,hasUnread:h,isLoading:_,initialize:i,cleanup:v,markAsRead:k,markAllAsRead:D,handleNotificationClick:M,getNotificationIcon:H,getNotificationColor:L,fetchNotifications:R}=et(),d=K("all"),Q=P(()=>{switch(d.value){case"unread":return l.value.filter(e=>!e.is_read);case"read":return l.value.filter(e=>e.is_read);default:return l.value}}),$=()=>{switch(d.value){case"unread":return u("notifications.noUnread");case"read":return u("notifications.noRead");default:return u("notifications.noNotifications")}},q=e=>{if(!e)return"";const m=Date.now(),a=new Date(e).getTime(),w=m-a,g=Math.floor(w/(1e3*60)),C=Math.floor(w/(1e3*60*60)),S=Math.floor(w/(1e3*60*60*24));return g<1?u("notifications.justNow"):g<60?u("notifications.minutesAgo",{count:g}):C<24?u("notifications.hoursAgo",{count:C}):S<7?u("notifications.daysAgo",{count:S}):new Date(e).toLocaleDateString()},j=async e=>{const m=await M(e);await N.push(m)},V=async()=>{await R(l.value.length+20)};return Oe(()=>{i()}),Ee(()=>{v()}),(e,m)=>(r(),T(Ye,{class:"column"},{default:s(()=>[y("div",at,[y("div",ot,b(e.$t("notifications.receivedNotifications")),1),c(h)?(r(),T(I,{key:0,flat:"",dense:"",color:"primary",label:e.$t("notifications.markAllRead"),icon:"done_all",onClick:c(D)},null,8,["label","onClick"])):A("",!0)]),y("div",nt,[o(Be,{modelValue:d.value,"onUpdate:modelValue":m[0]||(m[0]=a=>d.value=a),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"left","narrow-indicator":""},{default:s(()=>[o(U,{name:"all",label:e.$t("notifications.all"),badge:c(l).length||void 0},null,8,["label","badge"]),o(U,{name:"unread",label:e.$t("notifications.unread"),badge:c(f)||void 0},null,8,["label","badge"]),o(U,{name:"read",label:e.$t("notifications.read")},null,8,["label"])]),_:1},8,["modelValue"])]),y("div",st,[c(_)?(r(),O("div",it,[o(De,{size:"md",color:"primary"}),y("div",lt,b(e.$t("notifications.loading")),1)])):Q.value.length===0?(r(),O("div",rt,[o(oe,{name:"notifications_none",size:"60px",color:"grey-4"}),y("div",ct,b($()),1)])):(r(),T(Xe,{key:2,separator:"",bordered:"",class:"rounded-borders"},{default:s(()=>[(r(!0),O(je,null,Me(Q.value,a=>He((r(),T(Ie,{key:a.id,clickable:"",class:Le({"bg-blue-1":!a.is_read}),onClick:()=>j(a)},{default:s(()=>[o(W,{avatar:""},{default:s(()=>[o(Re,{color:c(L)(a.type),"text-color":"white",icon:c(H)(a.type),size:"40px"},null,8,["color","icon"])]),_:2},1024),o(W,null,{default:s(()=>[o(F,{class:"text-weight-medium"},{default:s(()=>[E(b(a.title),1)]),_:2},1024),o(F,{caption:"",lines:"2",class:"q-mt-xs"},{default:s(()=>[E(b(a.body),1)]),_:2},1024),o(F,{caption:"",class:"text-grey-6 q-mt-xs"},{default:s(()=>[o(oe,{name:"schedule",size:"14px",class:"q-mr-xs"}),E(" "+b(q(a.created_at)),1)]),_:2},1024)]),_:2},1024),o(W,{side:"",top:""},{default:s(()=>[y("div",ut,[a.is_read?A("",!0):(r(),T(Ue,{key:0,color:"primary",rounded:"",class:"q-mb-sm"})),a.is_read?A("",!0):(r(),T(I,{key:1,flat:"",round:"",dense:"",icon:"done",size:"sm",color:"primary",onClick:$e(w=>c(k)(a.id),["stop"])},{default:s(()=>[o(tt,null,{default:s(()=>[E(b(e.$t("notifications.markAsRead")),1)]),_:1})]),_:2},1032,["onClick"]))])]),_:2},1024)]),_:2},1032,["class","onClick"])),[[ze]])),128))]),_:1})),c(l).length>=20?(r(),O("div",dt,[o(I,{flat:"",color:"primary",label:e.$t("notifications.loadMore"),icon:"expand_more",onClick:V,loading:c(_)},null,8,["label","loading"])])):A("",!0)])]),_:1}))}});export{xt as default};
