import{a as H,n as T,c as Q,o as c,e,p as q,at as S,Q as E,f as s,g as $,h as m,t as d,l as u,x as B,aw as de,k as P,r as U,z as fe,i as W,aF as X,j as k,m as j,av as ce,au as ve,q as ye,aD as Z,aK as pe,aL as be,b as ge,ax as _e}from"./index-BvPAJXmU.js";import{Q as Y}from"./QForm-5zLvsNWP.js";import{Q as he}from"./QPage-XL8xunfv.js";import{u as ee}from"./use-quasar-MoTg3-uY.js";import{u as le}from"./auth-store-DVlIzTHH.js";import{a as O,Q as $e}from"./QSelect-GrY4hBVk.js";import{u as Pe,Q as Ve}from"./usePushNotifications-DweFXVvx.js";import{u as G}from"./vue-i18n.runtime-CKJdtZaM.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{Q as we,a as ke,b as x}from"./QItem-BP2_2EVS.js";import{supabase as C}from"./supabase-C3UXsoxn.js";import{u as qe}from"./useFriends-D8JlGubC.js";import"./format-CRhKiJrs.js";import"./position-engine-BfhsqVu3.js";import"./selection-BTMiLQL1.js";import"./rtl-DFPa-2ov.js";const Se={class:"q-pa-md"},Ce={class:"text-h6 q-mb-md"},Ue={class:"q-mb-md"},De={key:0,class:"q-mb-md"},Qe={key:1,class:"q-mb-md"},Ee={class:"text-h6 q-mb-md"},Fe={class:"text-body2 text-grey-6"},Ne=H({__name:"NotificationSettings",setup(V){const{t:g}=G(),r=Pe();T(async()=>{await r.initialize()});const p=()=>{switch(r.permission.value){case"granted":return"positive";case"denied":return"negative";default:return"warning"}},i=()=>{switch(r.permission.value){case"granted":return"check_circle";case"denied":return"block";default:return"help"}},D=()=>{switch(r.permission.value){case"granted":return g("notifications.permissionGranted");case"denied":return g("notifications.permissionDenied");default:return g("notifications.permissionDefault")}},F=async()=>{try{await r.requestPermission()}catch{}},b=async()=>{try{await r.subscribe()}catch{}},f=async()=>{try{await r.unsubscribe()}catch{}};return(n,y)=>(c(),Q("div",Se,[e(E,{class:"q-mb-md"},{default:s(()=>[e($,null,{default:s(()=>[m("div",Ce,d(n.$t("notifications.title")),1),m("div",Ue,[e(O,{color:u(r).isSupported.value?"positive":"negative","text-color":"white",icon:u(r).isSupported.value?"check_circle":"error"},{default:s(()=>[B(d(u(r).isSupported.value?n.$t("notifications.supported"):n.$t("notifications.notSupported")),1)]),_:1},8,["color","icon"])]),u(r).isSupported.value?(c(),Q("div",De,[e(O,{color:p(),"text-color":"white",icon:i()},{default:s(()=>[B(d(D()),1)]),_:1},8,["color","icon"])])):S("",!0),u(r).isSupported.value?(c(),Q("div",Qe,[e(O,{color:u(r).isSubscribed.value?"positive":"grey","text-color":"white",icon:u(r).isSubscribed.value?"notifications_active":"notifications_off"},{default:s(()=>[B(d(u(r).isSubscribed.value?n.$t("notifications.subscribed"):n.$t("notifications.notSubscribed")),1)]),_:1},8,["color","icon"])])):S("",!0)]),_:1}),u(r).isSupported.value?(c(),q(de,{key:0,align:"around"},{default:s(()=>[u(r).needsPermission?(c(),q(P,{key:0,color:"primary",icon:"notifications",label:n.$t("notifications.requestPermission"),onClick:F,loading:u(r).isLoading.value},null,8,["label","loading"])):S("",!0),u(r).canSubscribe&&!u(r).isSubscribed.value?(c(),q(P,{key:1,color:"positive",icon:"notifications_active",label:n.$t("notifications.subscribe"),onClick:b,loading:u(r).isLoading.value},null,8,["label","loading"])):S("",!0),u(r).isSubscribed?(c(),q(P,{key:2,color:"negative",icon:"notifications_off",label:n.$t("notifications.unsubscribe"),onClick:f,loading:u(r).isLoading.value},null,8,["label","loading"])):S("",!0)]),_:1})):S("",!0)]),_:1}),u(r).isSubscribed?(c(),q(E,{key:0},{default:s(()=>[e($,null,{default:s(()=>[m("div",Ee,d(n.$t("notifications.history")),1),m("div",Fe,d(n.$t("notifications.historyEmpty")),1)]),_:1})]),_:1})):S("",!0)]))}}),Ae=te(Ne,[["__scopeId","data-v-9ba282eb"]]),Be=()=>{const V=U(!1),g=async(b,f)=>{V.value=!0;try{const n=f.email||`dummy-${crypto.randomUUID().slice(0,8)}@dummy.local`,{data:y,error:o}=await C.from("profiles").insert({id:crypto.randomUUID(),email:n,name:f.name,surname:f.surname||null,username:f.username||null,date_of_birth:f.date_of_birth||null,birth_year_visible:f.birth_year_visible??!1,is_dummy:!0}).select().single();if(o||!y)throw o||new Error("Failed to create dummy profile");const{error:v}=await C.from("dummy_profile_managers").insert({dummy_profile_id:y.id,manager_user_id:b});if(v)throw await C.from("profiles").delete().eq("id",y.id),v;const{error:_}=await C.from("friendships").insert({user_id:b,friend_id:y.id,status:"accepted"});if(_)throw await C.from("profiles").delete().eq("id",y.id),_;return{data:y,error:null}}catch(n){return console.error("Error creating dummy profile:",n),{data:null,error:n}}finally{V.value=!1}},r=async b=>{V.value=!0;try{const{data:f,error:n}=await C.from("dummy_profile_managers").select(`
          *,
          profiles!dummy_profile_managers_dummy_profile_id_fkey (*)
        `).eq("manager_user_id",b);if(n)throw n;return{data:f?.map(o=>o.profiles).filter(Boolean)||[],error:null}}catch(f){return console.error("Error fetching managed dummy profiles:",f),{data:null,error:f}}finally{V.value=!1}},p=async(b,f)=>{V.value=!0;try{const{data:n,error:y}=await C.from("profiles").update(f).eq("id",b).eq("is_dummy",!0).select().single();if(y)throw y;return{data:n,error:null}}catch(n){return console.error("Error updating dummy profile:",n),{data:null,error:n}}finally{V.value=!1}},i=async(b,f)=>{V.value=!0;try{const{data:n}=await C.from("dummy_profile_managers").select("id").eq("dummy_profile_id",b).eq("manager_user_id",f).single();if(!n)throw new Error("You do not have permission to delete this dummy profile");const{error:y}=await C.from("profiles").delete().eq("id",b).eq("is_dummy",!0);if(y)throw y;return{error:null}}catch(n){return console.error("Error deleting dummy profile:",n),{error:n}}finally{V.value=!1}},D=async(b,f)=>{try{const{data:n}=await C.from("dummy_profile_managers").select("id").eq("dummy_profile_id",b).eq("manager_user_id",f).single();return!!n}catch{return!1}};return{isLoading:V,createDummyProfile:g,fetchManagedDummyProfiles:r,updateDummyProfile:p,deleteDummyProfile:i,canManageDummyProfile:D,suggestDummyProfileAsFriend:async(b,f,n)=>{V.value=!0;try{if(!await D(b,n))throw new Error("You do not have permission to suggest this dummy profile");const{data:o,error:v}=await C.from("friendships").insert({user_id:b,friend_id:f,status:"pending"}).select().single();if(v)throw v;return{data:o,error:null}}catch(y){return console.error("Error suggesting dummy profile as friend:",y),{data:null,error:y}}finally{V.value=!1}}}},Le={class:"text-h6 q-mb-md"},Me={class:"text-body2 text-grey-7"},Ie={class:"text-subtitle1 q-mb-md"},ze={class:"row q-gutter-sm"},Oe={class:"text-subtitle1 q-mb-md"},je={class:"q-gutter-md"},Ye={class:"col"},He={class:"text-subtitle2"},Te={key:0,class:"text-caption text-grey-7"},Ge={key:1,class:"text-caption text-grey-7"},Re={key:2,class:"text-caption text-grey-7"},Ke={class:"col-auto"},Je={class:"text-center text-grey-7 q-py-lg"},We={class:"text-h6"},Xe={class:"row q-gutter-sm justify-end"},Ze={class:"text-h6"},xe={class:"row q-gutter-sm justify-end q-mt-md"},el=H({__name:"DummyProfileManager",setup(V){const g=ee(),{t:r}=G(),p=le(),i=fe(()=>p.user),{isLoading:D,createDummyProfile:F,fetchManagedDummyProfiles:b,updateDummyProfile:f,deleteDummyProfile:n,suggestDummyProfileAsFriend:y}=Be(),{fetchEligibleUsersForDummySuggestion:o}=qe(),v=U(!1),_=U(!1),A=U(!1),L=U([]),h=U(null),M=U(null),R=U([]),N=U(null),z=U(!1),w=U({name:"",surname:"",username:"",email:"",date_of_birth:"",birth_year_visible:!1}),ae=()=>{w.value={name:"",surname:"",username:"",email:"",date_of_birth:"",birth_year_visible:!1}},K=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),re=t=>new Date(t).toLocaleDateString(),I=async()=>{if(!i.value?.id)return;const{data:t}=await b(i.value.id);t&&(L.value=t)},ie=async()=>{if(!i.value?.id)return;const{data:t,error:a}=await F(i.value.id,w.value);if(a){g.notify({color:"negative",message:r("dummyProfiles.errors.createFailed"),icon:"error"});return}t&&(g.notify({color:"positive",message:r("dummyProfiles.messages.created"),icon:"check"}),ae(),v.value=!1,await I())},oe=t=>{h.value={...t},_.value=!0},se=async()=>{if(!h.value)return;const{data:t,error:a}=await f(h.value.id,h.value);if(a){g.notify({color:"negative",message:r("dummyProfiles.errors.updateFailed"),icon:"error"});return}t&&(g.notify({color:"positive",message:r("dummyProfiles.messages.updated"),icon:"check"}),_.value=!1,await I())},ne=t=>{g.dialog({title:r("dummyProfiles.confirmDelete.title"),message:r("dummyProfiles.confirmDelete.message",{name:t.name}),cancel:!0,persistent:!0}).onOk(()=>{(async()=>{if(!i.value?.id)return;const{error:a}=await n(t.id,i.value.id);if(a){g.notify({color:"negative",message:r("dummyProfiles.errors.deleteFailed"),icon:"error"});return}g.notify({color:"positive",message:r("dummyProfiles.messages.deleted"),icon:"check"}),await I()})()})},ue=async t=>{if(M.value=t,z.value=!0,A.value=!0,i.value?.id){const{data:a}=await o(t.id,i.value.id);a&&(R.value=a)}z.value=!1},me=async()=>{if(!i.value?.id||!M.value||!N.value)return;const{error:t}=await y(M.value.id,N.value,i.value.id);if(t){g.notify({color:"negative",message:r("dummyProfiles.errors.suggestionFailed"),icon:"error"});return}g.notify({color:"positive",message:r("dummyProfiles.messages.suggested"),icon:"check"}),A.value=!1,N.value=null,M.value=null};return T(()=>{I()}),(t,a)=>(c(),q(E,{class:"dummy-profile-manager"},{default:s(()=>[e($,null,{default:s(()=>[m("div",Le,d(t.$t("dummyProfiles.title")),1),m("p",Me,d(t.$t("dummyProfiles.description")),1)]),_:1}),e(W),v.value?(c(),q($,{key:0},{default:s(()=>[m("div",Ie,d(t.$t("dummyProfiles.createNew")),1),e(Y,{onSubmit:X(ie,["prevent"]),class:"q-gutter-md"},{default:s(()=>[e(k,{modelValue:w.value.name,"onUpdate:modelValue":a[0]||(a[0]=l=>w.value.name=l),label:t.$t("dummyProfiles.form.name"),filled:"",rules:[l=>!!l||t.$t("validation.required")],required:""},null,8,["modelValue","label","rules"]),e(k,{modelValue:w.value.surname,"onUpdate:modelValue":a[1]||(a[1]=l=>w.value.surname=l),label:t.$t("dummyProfiles.form.surname"),filled:""},null,8,["modelValue","label"]),e(k,{modelValue:w.value.username,"onUpdate:modelValue":a[2]||(a[2]=l=>w.value.username=l),label:t.$t("dummyProfiles.form.username"),filled:"",hint:t.$t("dummyProfiles.form.usernameHint")},null,8,["modelValue","label","hint"]),e(k,{modelValue:w.value.email,"onUpdate:modelValue":a[3]||(a[3]=l=>w.value.email=l),label:t.$t("dummyProfiles.form.email"),type:"email",filled:"",hint:t.$t("dummyProfiles.form.emailHint"),rules:[l=>!l||K(l)||t.$t("validation.invalidEmail")]},null,8,["modelValue","label","hint","rules"]),e(k,{modelValue:w.value.date_of_birth,"onUpdate:modelValue":a[4]||(a[4]=l=>w.value.date_of_birth=l),label:t.$t("dummyProfiles.form.dateOfBirth"),type:"date",filled:""},null,8,["modelValue","label"]),e(j,{modelValue:w.value.birth_year_visible,"onUpdate:modelValue":a[5]||(a[5]=l=>w.value.birth_year_visible=l),label:t.$t("dummyProfiles.form.birthYearVisible")},null,8,["modelValue","label"]),m("div",ze,[e(P,{type:"submit",color:"primary",label:t.$t("common.create"),loading:u(D)},null,8,["label","loading"]),e(P,{flat:"",label:t.$t("common.cancel"),onClick:a[6]||(a[6]=l=>v.value=!1)},null,8,["label"])])]),_:1})]),_:1})):(c(),q($,{key:1},{default:s(()=>[e(P,{color:"primary",label:t.$t("dummyProfiles.createNew"),icon:"add",onClick:a[7]||(a[7]=l=>v.value=!0)},null,8,["label"])]),_:1})),L.value.length>0?(c(),q(W,{key:2})):S("",!0),L.value.length>0?(c(),q($,{key:3},{default:s(()=>[m("div",Oe,d(t.$t("dummyProfiles.yourProfiles")),1),m("div",je,[(c(!0),Q(ve,null,ce(L.value,l=>(c(),q(E,{key:l.id,flat:"",bordered:"",class:"dummy-profile-item"},{default:s(()=>[e($,{class:"row items-center"},{default:s(()=>[m("div",Ye,[m("div",He,d(l.name)+" "+d(l.surname),1),l.username?(c(),Q("div",Te," @"+d(l.username),1)):S("",!0),l.email&&!l.email.includes("@dummy.local")?(c(),Q("div",Ge,d(l.email),1)):S("",!0),l.date_of_birth?(c(),Q("div",Re,d(re(l.date_of_birth)),1)):S("",!0)]),m("div",Ke,[e(Ve,{flat:""},{default:s(()=>[e(P,{flat:"",icon:"edit",size:"sm",title:t.$t("common.edit"),onClick:J=>oe(l)},null,8,["title","onClick"]),e(P,{flat:"",icon:"share",size:"sm",title:t.$t("dummyProfiles.suggestAsFriend"),onClick:J=>ue(l)},null,8,["title","onClick"]),e(P,{flat:"",icon:"delete",size:"sm",color:"negative",title:t.$t("common.delete"),onClick:J=>ne(l)},null,8,["title","onClick"])]),_:2},1024)])]),_:2},1024)]),_:2},1024))),128))])]),_:1})):v.value?S("",!0):(c(),q($,{key:4},{default:s(()=>[m("div",Je,[e(ye,{name:"person_add_disabled",size:"3rem",class:"q-mb-md"}),m("div",null,d(t.$t("dummyProfiles.noProfiles")),1)])]),_:1})),e(Z,{modelValue:_.value,"onUpdate:modelValue":a[15]||(a[15]=l=>_.value=l),persistent:""},{default:s(()=>[e(E,{style:{width:"400px"}},{default:s(()=>[e($,null,{default:s(()=>[m("div",We,d(t.$t("dummyProfiles.editProfile")),1)]),_:1}),h.value?(c(),q($,{key:0},{default:s(()=>[e(Y,{onSubmit:X(se,["prevent"]),class:"q-gutter-md"},{default:s(()=>[e(k,{modelValue:h.value.name,"onUpdate:modelValue":a[8]||(a[8]=l=>h.value.name=l),label:t.$t("dummyProfiles.form.name"),filled:"",rules:[l=>!!l||t.$t("validation.required")],required:""},null,8,["modelValue","label","rules"]),e(k,{modelValue:h.value.surname,"onUpdate:modelValue":a[9]||(a[9]=l=>h.value.surname=l),label:t.$t("dummyProfiles.form.surname"),filled:""},null,8,["modelValue","label"]),e(k,{modelValue:h.value.username,"onUpdate:modelValue":a[10]||(a[10]=l=>h.value.username=l),label:t.$t("dummyProfiles.form.username"),filled:""},null,8,["modelValue","label"]),e(k,{modelValue:h.value.email,"onUpdate:modelValue":a[11]||(a[11]=l=>h.value.email=l),label:t.$t("dummyProfiles.form.email"),type:"email",filled:"",hint:t.$t("dummyProfiles.form.emailHint"),rules:[l=>!l||K(l)||t.$t("validation.invalidEmail")]},null,8,["modelValue","label","hint","rules"]),e(k,{modelValue:h.value.date_of_birth,"onUpdate:modelValue":a[12]||(a[12]=l=>h.value.date_of_birth=l),label:t.$t("dummyProfiles.form.dateOfBirth"),type:"date",filled:""},null,8,["modelValue","label"]),e(j,{modelValue:h.value.birth_year_visible,"onUpdate:modelValue":a[13]||(a[13]=l=>h.value.birth_year_visible=l),label:t.$t("dummyProfiles.form.birthYearVisible")},null,8,["modelValue","label"]),m("div",Xe,[e(P,{flat:"",label:t.$t("common.cancel"),onClick:a[14]||(a[14]=l=>_.value=!1)},null,8,["label"]),e(P,{type:"submit",color:"primary",label:t.$t("common.save"),loading:u(D)},null,8,["label","loading"])])]),_:1})]),_:1})):S("",!0)]),_:1})]),_:1},8,["modelValue"]),e(Z,{modelValue:A.value,"onUpdate:modelValue":a[18]||(a[18]=l=>A.value=l),persistent:""},{default:s(()=>[e(E,{style:{width:"400px"}},{default:s(()=>[e($,null,{default:s(()=>[m("div",Ze,d(t.$t("dummyProfiles.suggestProfile")),1)]),_:1}),e($,null,{default:s(()=>[e($e,{modelValue:N.value,"onUpdate:modelValue":a[16]||(a[16]=l=>N.value=l),options:R.value,label:t.$t("dummyProfiles.selectFriend"),"option-label":"name","option-value":"id",filled:"","emit-value":"","map-options":"",loading:z.value},{option:s(l=>[e(we,pe(be(l.itemProps)),{default:s(()=>[e(ke,null,{default:s(()=>[e(x,null,{default:s(()=>[B(d(l.opt.name)+" "+d(l.opt.surname),1)]),_:2},1024),e(x,{caption:""},{default:s(()=>[B(d(l.opt.email),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","label","loading"]),m("div",xe,[e(P,{flat:"",label:t.$t("common.cancel"),onClick:a[17]||(a[17]=l=>A.value=!1)},null,8,["label"]),e(P,{color:"primary",label:t.$t("dummyProfiles.sendSuggestion"),loading:u(D),disable:!N.value,onClick:me},null,8,["label","loading","disable"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),ll=te(el,[["__scopeId","data-v-13d2436e"]]),tl={class:"text-h4 q-mb-md"},al={class:"row justify-center"},rl={class:"col-12 col-md-6"},il=["src"],ol={key:1},sl={class:"text-h5 q-mt-md"},nl={key:0,class:"text-subtitle1 text-grey-6"},ul={class:"text-body2 text-grey-7"},ml={class:"row justify-end q-gutter-sm"},dl={class:"text-h6 q-mb-md"},fl={class:"q-mt-md"},Ul=H({__name:"ProfilePage",setup(V){const g=ee(),{t:r}=G(),p=le(),i=ge({name:"",surname:"",username:"",date_of_birth:"",birth_year_visible:!1}),D=o=>o?o.name&&o.surname?`${o.name} ${o.surname}`:o.username||o.email:"",F=o=>o?o.name&&o.surname?`${o.name.charAt(0)}${o.surname.charAt(0)}`:o.username?o.username.charAt(0).toUpperCase():o.email.charAt(0).toUpperCase():"",b=o=>i.username?!0:!!o||r("profile.validationError"),f=o=>i.name&&i.surname?!0:!!o||r("profile.validationError"),n=()=>{p.profile&&(i.name=p.profile.name||"",i.surname=p.profile.surname||"",i.username=p.profile.username||"",i.date_of_birth=p.profile.date_of_birth||"",i.birth_year_visible=p.profile.birth_year_visible??!1)},y=async()=>{if(!i.username&&(!i.name||!i.surname)){g.notify({type:"negative",message:r("profile.validationError")});return}const o={name:i.name||null,surname:i.surname||null,username:i.username||null,date_of_birth:i.date_of_birth||null,birth_year_visible:i.birth_year_visible};await p.updateProfile(o)?g.notify({type:"positive",message:r("profile.updateSuccess")}):g.notify({type:"negative",message:r("profile.updateError")})};return T(()=>{n()}),(o,v)=>(c(),q(he,{class:"q-pa-md"},{default:s(()=>[m("div",tl,d(o.$t("profile.title")),1),m("div",al,[m("div",rl,[e(E,null,{default:s(()=>[e($,{class:"text-center"},{default:s(()=>[e(_e,{size:"100px",color:"primary","text-color":"white"},{default:s(()=>[u(p).profile?.avatar_url?(c(),Q("img",{key:0,src:u(p).profile.avatar_url},null,8,il)):(c(),Q("span",ol,d(F(u(p).profile)),1))]),_:1}),m("div",sl,d(D(u(p).profile)),1),u(p).profile?.username?(c(),Q("div",nl," @"+d(u(p).profile.username),1)):S("",!0),m("div",ul,d(u(p).profile?.email),1)]),_:1}),e($,null,{default:s(()=>[e(Y,{onSubmit:y,class:"q-gutter-md"},{default:s(()=>[e(k,{modelValue:i.name,"onUpdate:modelValue":v[0]||(v[0]=_=>i.name=_),label:o.$t("common.name"),outlined:"",rules:[b]},null,8,["modelValue","label","rules"]),e(k,{modelValue:i.surname,"onUpdate:modelValue":v[1]||(v[1]=_=>i.surname=_),label:o.$t("common.surname"),outlined:"",rules:[b]},null,8,["modelValue","label","rules"]),e(k,{modelValue:i.username,"onUpdate:modelValue":v[2]||(v[2]=_=>i.username=_),label:o.$t("common.username"),outlined:"",rules:[f]},null,8,["modelValue","label","rules"]),e(k,{modelValue:i.date_of_birth,"onUpdate:modelValue":v[3]||(v[3]=_=>i.date_of_birth=_),label:o.$t("profile.dateOfBirth"),type:"date",outlined:""},null,8,["modelValue","label"]),e(j,{modelValue:i.birth_year_visible,"onUpdate:modelValue":v[4]||(v[4]=_=>i.birth_year_visible=_),label:o.$t("profile.showBirthYear")},null,8,["modelValue","label"]),m("div",ml,[e(P,{label:o.$t("common.cancel"),color:"grey",flat:"",onClick:n},null,8,["label"]),e(P,{type:"submit",label:o.$t("common.save"),color:"primary",loading:u(p).isLoading},null,8,["label","loading"])])]),_:1})]),_:1})]),_:1}),e(E,{class:"q-mt-md"},{default:s(()=>[e($,null,{default:s(()=>[m("div",dl,d(o.$t("notifications.title")),1),e(Ae)]),_:1})]),_:1}),m("div",fl,[e(ll)])])])]),_:1}))}});export{Ul as default};
