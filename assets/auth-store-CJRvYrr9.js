import{aN as n}from"./index-Pn9jnbFE.js";import{supabase as i}from"./supabase-0ODH-3DI.js";const o="darkovnicek_data_loaded",l=()=>{const e=a=>sessionStorage.getItem(`${o}_${a}`)==="true";return{isDataLoaded:e,markDataLoaded:a=>{sessionStorage.setItem(`${o}_${a}`,"true")},clearDataLoaded:a=>{a?sessionStorage.removeItem(`${o}_${a}`):(sessionStorage.removeItem(`${o}_friends`),sessionStorage.removeItem(`${o}_wishes`),sessionStorage.removeItem(`${o}_pendingRequests`))},shouldShowLoading:a=>!e(a)}},c=n("auth",{state:()=>({user:null,profile:null,loading:!1}),getters:{isAuthenticated:e=>!!e.user,isLoading:e=>e.loading},actions:{async signUp(e,r,t){this.loading=!0;try{const{data:s,error:a}=await i.auth.signUp({email:e,password:r,options:{data:t}});if(a)throw a;return{data:s,error:null}}catch(s){return{data:null,error:s}}finally{this.loading=!1}},async signIn(e,r){this.loading=!0;try{const{data:t,error:s}=await i.auth.signInWithPassword({email:e,password:r});if(s)throw s;return t.user&&await this.fetchProfile(t.user.id),{data:t,error:null}}catch(t){return{data:null,error:t}}finally{this.loading=!1}},async signOut(){this.loading=!0;try{const{error:e}=await i.auth.signOut();if(e)throw e;this.user=null,this.profile=null;const{clearDataLoaded:r}=l();return r(),{error:null}}catch(e){return{error:e}}finally{this.loading=!1}},async fetchProfile(e){const{data:r,error:t}=await i.from("profiles").select("*").eq("id",e).single();if(t)throw t;return this.profile=r,r},async updateProfile(e){if(!this.user)throw new Error("No user authenticated");const{data:r,error:t}=await i.from("profiles").update(e).eq("id",this.user.id).select().single();if(t)throw t;return this.profile=r,r},async initializeAuth(){const{data:{session:e}}=await i.auth.getSession();e?.user&&(this.user=e.user,await this.fetchProfile(e.user.id)),i.auth.onAuthStateChange(async(r,t)=>{t?.user?(this.user=t.user,await this.fetchProfile(t.user.id)):(this.user=null,this.profile=null)})}}});export{l as a,c as u};
