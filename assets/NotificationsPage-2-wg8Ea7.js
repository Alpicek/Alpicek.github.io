import{B as ge,E as V,$ as pe,ac as ye,a1 as be,H as _e,r as G,z as P,b5 as ke,a3 as we,b6 as Te,a4 as Ce,b7 as Se,w as Y,O as Z,S as ee,W as te,ad as xe,C as ae,aF as Pe,D as Ne,_ as Qe,a as qe,q as Ae,ai as Oe,s as T,g as s,o as r,f as y,at as A,t as b,m as c,l as I,e as o,c as O,x as Ee,v as oe,A as Me,a7 as De,ak as $e,au as He,p as E,aC as Le,F as Re,u as Be,ay as je}from"./index-CzEHk4FJ.js";import{a as U,Q as ze}from"./QTabs-hMbSUOU_.js";import{Q as Ve,a as W,b as F}from"./QItem-atIWw8xQ.js";import{Q as Ie}from"./QBadge-B8zPsIYt.js";import{v as Ue,a as ne,e as We,p as se,b as Fe,c as Ge,d as Je,r as ie,s as Ke}from"./position-engine-BZGJ-mmQ.js";import{c as le}from"./selection-DmknuNDx.js";import{Q as Xe}from"./QList-CCrgn17T.js";import{Q as Ye}from"./QPage-GP0CvhFB.js";import{u as Ze}from"./useNotifications-CdC-KbCd.js";import{u as et}from"./vue-i18n.runtime-zO4z2J8f.js";import"./QResizeObserver-BXHMh2fz.js";import"./rtl-DFPa-2ov.js";import"./notifications-store-oCaARvkS.js";import"./supabase-RdUxExGH.js";import"./auth-store-B9ZbRhc6.js";const tt=ge({name:"QTooltip",inheritAttrs:!1,props:{...We,...be,...V,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{...V.transitionShow,default:"jump-down"},transitionHide:{...V.transitionHide,default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:ne},self:{type:String,default:"top middle",validator:ne},offset:{type:Array,default:()=>[14,14],validator:Ue},scrollTarget:ye,delay:{type:Number,default:0},hideDelay:{type:Number,default:0},persistent:Boolean},emits:[...pe],setup(t,{slots:u,emit:N,attrs:l}){let f,h;const _=_e(),{proxy:{$q:i}}=_,v=G(null),k=G(!1),M=P(()=>se(t.anchor,i.lang.rtl)),D=P(()=>se(t.self,i.lang.rtl)),$=P(()=>t.persistent!==!0),{registerTick:H,removeTick:L}=ke(),{registerTimeout:d}=we(),{transitionProps:Q,transitionStyle:R}=Te(t),{localScrollTarget:q,changeScrollEvent:B,unconfigureScrollTarget:j}=Fe(t,K),{anchorEl:e,canShow:m,anchorEvents:a}=Ge({showing:k,configureAnchorEl:fe}),{show:w,hide:g}=Ce({showing:k,canShow:m,handleShow:ce,handleHide:ue,hideOnRouteChange:$,processOnMount:!0});Object.assign(a,{delayShow:de,delayHide:me});const{showPortal:C,hidePortal:S,renderPortal:re}=Se(_,v,ve,"tooltip");if(i.platform.is.mobile===!0){const n={anchorEl:e,innerRef:v,onClickOutside(p){return g(p),p.target.classList.contains("q-dialog__backdrop")&&Qe(p),!0}},z=P(()=>t.modelValue===null&&t.persistent!==!0&&k.value===!0);Y(z,p=>{(p===!0?Je:ie)(n)}),Z(()=>{ie(n)})}function ce(n){C(),H(()=>{h=new MutationObserver(()=>x()),h.observe(v.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),x(),K()}),f===void 0&&(f=Y(()=>i.screen.width+"|"+i.screen.height+"|"+t.self+"|"+t.anchor+"|"+i.lang.rtl,x)),d(()=>{C(!0),N("show",n)},t.transitionDuration)}function ue(n){L(),S(),J(),d(()=>{S(!0),N("hide",n)},t.transitionDuration)}function J(){h!==void 0&&(h.disconnect(),h=void 0),f!==void 0&&(f(),f=void 0),j(),ee(a,"tooltipTemp")}function x(){Ke({targetEl:v.value,offset:t.offset,anchorEl:e.value,anchorOrigin:M.value,selfOrigin:D.value,maxHeight:t.maxHeight,maxWidth:t.maxWidth})}function de(n){if(i.platform.is.mobile===!0){le(),document.body.classList.add("non-selectable");const z=e.value,p=["touchmove","touchcancel","touchend","click"].map(X=>[z,X,"delayHide","passiveCapture"]);te(a,"tooltipTemp",p)}d(()=>{w(n)},t.delay)}function me(n){i.platform.is.mobile===!0&&(ee(a,"tooltipTemp"),le(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),d(()=>{g(n)},t.hideDelay)}function fe(){if(t.noParentEvent===!0||e.value===null)return;const n=i.platform.is.mobile===!0?[[e.value,"touchstart","delayShow","passive"]]:[[e.value,"mouseenter","delayShow","passive"],[e.value,"mouseleave","delayHide","passive"]];te(a,"anchor",n)}function K(){if(e.value!==null||t.scrollTarget!==void 0){q.value=xe(e.value,t.scrollTarget);const n=t.noParentEvent===!0?x:g;B(q.value,n)}}function he(){return k.value===!0?ae("div",{...l,ref:v,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",l.class],style:[l.style,R.value],role:"tooltip"},Ne(u.default)):null}function ve(){return ae(Pe,Q.value,he)}return Z(J),Object.assign(_.proxy,{updatePosition:x}),re}}),at={class:"row items-center justify-between q-px-md q-pt-md"},ot={class:"text-h6"},nt={class:"q-px-md q-pt-sm"},st={class:"col q-pa-md"},it={key:0,class:"column items-center justify-center full-height"},lt={class:"q-mt-sm text-grey-6"},rt={key:1,class:"column items-center justify-center full-height"},ct={class:"text-body1 text-grey-6 q-mt-md"},ut={class:"column items-end"},dt={key:3,class:"q-pa-md text-center"},Pt=qe({__name:"NotificationsPage",setup(t){const{t:u}=et(),N=Be(),{notifications:l,unreadCount:f,hasUnread:h,isLoading:_,initialize:i,cleanup:v,markAsRead:k,markAllAsRead:M,handleNotificationClick:D,getNotificationIcon:$,getNotificationColor:H,fetchNotifications:L}=Ze(),d=G("all"),Q=P(()=>{switch(d.value){case"unread":return l.value.filter(e=>!e.is_read);case"read":return l.value.filter(e=>e.is_read);default:return l.value}}),R=()=>{switch(d.value){case"unread":return u("notifications.noUnread");case"read":return u("notifications.noRead");default:return u("notifications.noNotifications")}},q=e=>{if(!e)return"";const m=Date.now(),a=new Date(e).getTime(),w=m-a,g=Math.floor(w/(1e3*60)),C=Math.floor(w/(1e3*60*60)),S=Math.floor(w/(1e3*60*60*24));return g<1?u("notifications.justNow"):g<60?u("notifications.minutesAgo",{count:g}):C<24?u("notifications.hoursAgo",{count:C}):S<7?u("notifications.daysAgo",{count:S}):new Date(e).toLocaleDateString()},B=async e=>{const m=await D(e);await N.push(m)},j=async()=>{await L(l.value.length+20)};return Ae(()=>{i()}),Oe(()=>{v()}),(e,m)=>(r(),T(Ye,{class:"column"},{default:s(()=>[y("div",at,[y("div",ot,b(e.$t("notifications.receivedNotifications")),1),c(h)?(r(),T(I,{key:0,flat:"",dense:"",color:"primary",label:e.$t("notifications.markAllRead"),icon:"done_all",onClick:c(M)},null,8,["label","onClick"])):A("",!0)]),y("div",nt,[o(ze,{modelValue:d.value,"onUpdate:modelValue":m[0]||(m[0]=a=>d.value=a),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"left","narrow-indicator":""},{default:s(()=>[o(U,{name:"all",label:e.$t("notifications.all"),badge:c(l).length||void 0},null,8,["label","badge"]),o(U,{name:"unread",label:e.$t("notifications.unread"),badge:c(f)||void 0},null,8,["label","badge"]),o(U,{name:"read",label:e.$t("notifications.read")},null,8,["label"])]),_:1},8,["modelValue"])]),y("div",st,[c(_)?(r(),O("div",it,[o(Ee,{size:"md",color:"primary"}),y("div",lt,b(e.$t("notifications.loading")),1)])):Q.value.length===0?(r(),O("div",rt,[o(oe,{name:"notifications_none",size:"60px",color:"grey-4"}),y("div",ct,b(R()),1)])):(r(),T(Xe,{key:2,separator:"",bordered:"",class:"rounded-borders"},{default:s(()=>[(r(!0),O(Re,null,Me(Q.value,a=>De((r(),T(Ve,{key:a.id,clickable:"",class:$e({"bg-blue-1":!a.is_read}),onClick:()=>B(a)},{default:s(()=>[o(W,{avatar:""},{default:s(()=>[o(He,{color:c(H)(a.type),"text-color":"white",icon:c($)(a.type),size:"40px"},null,8,["color","icon"])]),_:2},1024),o(W,null,{default:s(()=>[o(F,{class:"text-weight-medium"},{default:s(()=>[E(b(a.title),1)]),_:2},1024),o(F,{caption:"",lines:"2",class:"q-mt-xs"},{default:s(()=>[E(b(a.body),1)]),_:2},1024),o(F,{caption:"",class:"text-grey-6 q-mt-xs"},{default:s(()=>[o(oe,{name:"schedule",size:"14px",class:"q-mr-xs"}),E(" "+b(q(a.created_at)),1)]),_:2},1024)]),_:2},1024),o(W,{side:"",top:""},{default:s(()=>[y("div",ut,[a.is_read?A("",!0):(r(),T(Ie,{key:0,color:"primary",rounded:"",class:"q-mb-sm"})),a.is_read?A("",!0):(r(),T(I,{key:1,flat:"",round:"",dense:"",icon:"done",size:"sm",color:"primary",onClick:Le(w=>c(k)(a.id),["stop"])},{default:s(()=>[o(tt,null,{default:s(()=>[E(b(e.$t("notifications.markAsRead")),1)]),_:1})]),_:2},1032,["onClick"]))])]),_:2},1024)]),_:2},1032,["class","onClick"])),[[je]])),128))]),_:1})),c(l).length>=20?(r(),O("div",dt,[o(I,{flat:"",color:"primary",label:e.$t("notifications.loadMore"),icon:"expand_more",onClick:j,loading:c(_)},null,8,["label","loading"])])):A("",!0)])]),_:1}))}});export{Pt as default};
