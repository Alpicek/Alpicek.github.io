import{l as rt,a4 as nl,s as st,a5 as ul,m as h,R as ol,a6 as rl,n as I,j as qe,a7 as sl,N as _e,I as cl,r as M,x as ge,O as me,a8 as dl,a9 as fl,aa as vl,ab as ml,C as Ft,ac as De,ad as hl,L as Ge,ae as gl,af as yl,y as Fe,Y as Sl,X as wl,a as xt,i as ae,o as F,w as te,e as B,f as j,t as ne,$ as de,c as Y,Q as he,b as bl,h as pl,ag as Vl,W as Cl,g as ke,k as et,a2 as Le,a1 as tt}from"./index-v3dJaZ__.js";import{r as ut,a as _t,Q as kl,b as _l,d as qt,c as ql}from"./QTabPanels-BcHkYdl7.js";import{Q as Et,a as ot}from"./QCard-DrepD2Zh.js";import{u as Ot,a as ct,b as Tt,c as Mt,d as Al,e as Il,f as At,g as Rl,Q as lt}from"./QInput-Dh94ShZM.js";import{u as zl,a as $l}from"./use-dark-DTQKqGAg.js";import{a as Bl,b as Fl,Q as xl}from"./QItem-BDA4BMIc.js";import{n as It,Q as El}from"./format-CYUzvhie.js";import{Q as Dt,_ as Ol}from"./_plugin-vue_export-helper-BQNK_z4Q.js";import{Q as Tl}from"./QForm-CXSIY0Ol.js";import{Q as Ml}from"./QPage-BLObdsd1.js";import{u as Dl}from"./useWishes-BKl66mn0.js";import{u as Ll}from"./auth-store-CNvokGra.js";import{u as Lt}from"./use-quasar-BZCkzfFx.js";import{supabase as Rt}from"./supabase-CI4kAcGq.js";import{Q as Wl}from"./QCardActions-D6RI1XRp.js";import{u as Wt}from"./vue-i18n.runtime-CRONN3rO.js";import"./focus-manager-DoxIdHOn.js";import"./selection-DGVMR2Dj.js";import"./use-prevent-scroll-D_Baba9B.js";const Hl=rt({name:"QField",inheritAttrs:!1,props:{...ct,tag:{type:String,default:"label"}},emits:Ot,setup(){return Tt(Mt({tagProp:!0}))}}),Pl={xs:8,sm:10,md:14,lg:20,xl:24},je=rt({name:"QChip",props:{...zl,...nl,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(e,{slots:v,emit:a}){const{proxy:{$q:g}}=st(),f=$l(e,g),u=ul(e,Pl),V=h(()=>e.selected===!0||e.icon!==void 0),y=h(()=>e.selected===!0?e.iconSelected||g.iconSet.chip.selected:e.icon),w=h(()=>e.iconRemove||g.iconSet.chip.remove),O=h(()=>e.disable===!1&&(e.clickable===!0||e.selected!==null)),m=h(()=>{const n=e.outline===!0&&e.color||e.textColor;return"q-chip row inline no-wrap items-center"+(e.outline===!1&&e.color!==void 0?` bg-${e.color}`:"")+(n?` text-${n} q-chip--colored`:"")+(e.disable===!0?" disabled":"")+(e.dense===!0?" q-chip--dense":"")+(e.outline===!0?" q-chip--outline":"")+(e.selected===!0?" q-chip--selected":"")+(O.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(e.square===!0?" q-chip--square":"")+(f.value===!0?" q-chip--dark q-dark":"")}),C=h(()=>{const n=e.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:e.tabindex||0},W={...n,role:"button","aria-hidden":"false","aria-label":e.removeAriaLabel||g.lang.label.remove};return{chip:n,remove:W}});function k(n){n.keyCode===13&&q(n)}function q(n){e.disable||(a("update:selected",!e.selected),a("click",n))}function $(n){(n.keyCode===void 0||n.keyCode===13)&&(_e(n),e.disable===!1&&(a("update:modelValue",!1),a("remove")))}function K(){const n=[];O.value===!0&&n.push(I("div",{class:"q-focus-helper"})),V.value===!0&&n.push(I(qe,{class:"q-chip__icon q-chip__icon--left",name:y.value}));const W=e.label!==void 0?[I("div",{class:"ellipsis"},[e.label])]:void 0;return n.push(I("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},sl(v.default,W))),e.iconRight&&n.push(I(qe,{class:"q-chip__icon q-chip__icon--right",name:e.iconRight})),e.removable===!0&&n.push(I(qe,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:w.value,...C.value.remove,onClick:$,onKeyup:$})),n}return()=>{if(e.modelValue===!1)return;const n={class:m.value,style:u.value};return O.value===!0&&Object.assign(n,C.value.chip,{onClick:q,onKeyup:k}),ol("div",n,K(),"ripple",e.ripple!==!1&&e.disable!==!0,()=>[[rl,e.ripple]])}}}),oe=1e3,Ul=["start","center","end","start-force","center-force","end-force"],Ht=Array.prototype.filter,Ql=window.getComputedStyle(document.body).overflowAnchor===void 0?cl:function(e,v){e!==null&&(e._qOverflowAnimationFrame!==void 0&&cancelAnimationFrame(e._qOverflowAnimationFrame),e._qOverflowAnimationFrame=requestAnimationFrame(()=>{if(e===null)return;e._qOverflowAnimationFrame=void 0;const a=e.children||[];Ht.call(a,f=>f.dataset&&f.dataset.qVsAnchor!==void 0).forEach(f=>{delete f.dataset.qVsAnchor});const g=a[v];g?.dataset&&(g.dataset.qVsAnchor="")}))};function xe(e,v){return e+v}function it(e,v,a,g,f,u,V,y){const w=e===window?document.scrollingElement||document.documentElement:e,O=f===!0?"offsetWidth":"offsetHeight",m={scrollStart:0,scrollViewSize:-V-y,scrollMaxSize:0,offsetStart:-V,offsetEnd:-y};if(f===!0?(e===window?(m.scrollStart=window.pageXOffset||window.scrollX||document.body.scrollLeft||0,m.scrollViewSize+=document.documentElement.clientWidth):(m.scrollStart=w.scrollLeft,m.scrollViewSize+=w.clientWidth),m.scrollMaxSize=w.scrollWidth,u===!0&&(m.scrollStart=(ut===!0?m.scrollMaxSize-m.scrollViewSize:0)-m.scrollStart)):(e===window?(m.scrollStart=window.pageYOffset||window.scrollY||document.body.scrollTop||0,m.scrollViewSize+=document.documentElement.clientHeight):(m.scrollStart=w.scrollTop,m.scrollViewSize+=w.clientHeight),m.scrollMaxSize=w.scrollHeight),a!==null)for(let C=a.previousElementSibling;C!==null;C=C.previousElementSibling)C.classList.contains("q-virtual-scroll--skip")===!1&&(m.offsetStart+=C[O]);if(g!==null)for(let C=g.nextElementSibling;C!==null;C=C.nextElementSibling)C.classList.contains("q-virtual-scroll--skip")===!1&&(m.offsetEnd+=C[O]);if(v!==e){const C=w.getBoundingClientRect(),k=v.getBoundingClientRect();f===!0?(m.offsetStart+=k.left-C.left,m.offsetEnd-=k.width):(m.offsetStart+=k.top-C.top,m.offsetEnd-=k.height),e!==window&&(m.offsetStart+=m.scrollStart),m.offsetEnd+=m.scrollMaxSize-m.offsetStart}return m}function zt(e,v,a,g){v==="end"&&(v=(e===window?document.body:e)[a===!0?"scrollWidth":"scrollHeight"]),e===window?a===!0?(g===!0&&(v=(ut===!0?document.body.scrollWidth-document.documentElement.clientWidth:0)-v),window.scrollTo(v,window.pageYOffset||window.scrollY||document.body.scrollTop||0)):window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,v):a===!0?(g===!0&&(v=(ut===!0?e.scrollWidth-e.offsetWidth:0)-v),e.scrollLeft=v):e.scrollTop=v}function We(e,v,a,g){if(a>=g)return 0;const f=v.length,u=Math.floor(a/oe),V=Math.floor((g-1)/oe)+1;let y=e.slice(u,V).reduce(xe,0);return a%oe!==0&&(y-=v.slice(u*oe,a).reduce(xe,0)),g%oe!==0&&g!==f&&(y-=v.slice(g,V*oe).reduce(xe,0)),y}const Nl={virtualScrollSliceSize:{type:[Number,String],default:10},virtualScrollSliceRatioBefore:{type:[Number,String],default:1},virtualScrollSliceRatioAfter:{type:[Number,String],default:1},virtualScrollItemSize:{type:[Number,String],default:24},virtualScrollStickySizeStart:{type:[Number,String],default:0},virtualScrollStickySizeEnd:{type:[Number,String],default:0},tableColspan:[Number,String]},$t={virtualScrollHorizontal:Boolean,onVirtualScroll:Function,...Nl};function jl({virtualScrollLength:e,getVirtualScrollTarget:v,getVirtualScrollEl:a,virtualScrollItemSizeComputed:g}){const f=st(),{props:u,emit:V,proxy:y}=f,{$q:w}=y;let O,m,C,k=[],q;const $=M(0),K=M(0),n=M({}),W=M(null),Z=M(null),T=M(null),R=M({from:0,to:0}),ce=h(()=>u.tableColspan!==void 0?u.tableColspan:100);g===void 0&&(g=h(()=>u.virtualScrollItemSize));const L=h(()=>g.value+";"+u.virtualScrollHorizontal),G=h(()=>L.value+";"+u.virtualScrollSliceRatioBefore+";"+u.virtualScrollSliceRatioAfter);ge(G,()=>{ie()}),ge(L,J);function J(){fe(m,!0)}function le(l){fe(l===void 0?m:l)}function Q(l,o){const b=v();if(b==null||b.nodeType===8)return;const z=it(b,a(),W.value,Z.value,u.virtualScrollHorizontal,w.lang.rtl,u.virtualScrollStickySizeStart,u.virtualScrollStickySizeEnd);C!==z.scrollViewSize&&ie(z.scrollViewSize),_(b,z,Math.min(e.value-1,Math.max(0,parseInt(l,10)||0)),0,Ul.indexOf(o)!==-1?o:m!==-1&&l>m?"end":"start")}function ue(){const l=v();if(l==null||l.nodeType===8)return;const o=it(l,a(),W.value,Z.value,u.virtualScrollHorizontal,w.lang.rtl,u.virtualScrollStickySizeStart,u.virtualScrollStickySizeEnd),b=e.value-1,z=o.scrollMaxSize-o.offsetStart-o.offsetEnd-K.value;if(O===o.scrollStart)return;if(o.scrollMaxSize<=0){_(l,o,0,0);return}C!==o.scrollViewSize&&ie(o.scrollViewSize),ye(R.value.from);const D=Math.floor(o.scrollMaxSize-Math.max(o.scrollViewSize,o.offsetEnd)-Math.min(q[b],o.scrollViewSize/2));if(D>0&&Math.ceil(o.scrollStart)>=D){_(l,o,b,o.scrollMaxSize-o.offsetEnd-k.reduce(xe,0));return}let A=0,S=o.scrollStart-o.offsetStart,H=S;if(S<=z&&S+o.scrollViewSize>=$.value)S-=$.value,A=R.value.from,H=S;else for(let i=0;S>=k[i]&&A<b;i++)S-=k[i],A+=oe;for(;S>0&&A<b;)S-=q[A],S>-o.scrollViewSize?(A++,H=S):H=q[A]+S;_(l,o,A,H)}function _(l,o,b,z,D){const A=typeof D=="string"&&D.indexOf("-force")!==-1,S=A===!0?D.replace("-force",""):D,H=S!==void 0?S:"start";let i=Math.max(0,b-n.value[H]),r=i+n.value.total;r>e.value&&(r=e.value,i=Math.max(0,r-n.value.total)),O=o.scrollStart;const s=i!==R.value.from||r!==R.value.to;if(s===!1&&S===void 0){ve(b);return}const{activeElement:P}=document,N=T.value;s===!0&&N!==null&&N!==P&&N.contains(P)===!0&&(N.addEventListener("focusout",Se),setTimeout(()=>{N?.removeEventListener("focusout",Se)})),Ql(N,b-i);const He=S!==void 0?q.slice(i,b).reduce(xe,0):0;if(s===!0){const be=r>=R.value.from&&i<=R.value.to?R.value.to:r;R.value={from:i,to:be},$.value=We(k,q,0,i),K.value=We(k,q,r,e.value),requestAnimationFrame(()=>{R.value.to!==r&&O===o.scrollStart&&(R.value={from:R.value.from,to:r},K.value=We(k,q,r,e.value))})}requestAnimationFrame(()=>{if(O!==o.scrollStart)return;s===!0&&ye(i);const be=q.slice(i,b).reduce(xe,0),pe=be+o.offsetStart+$.value,Pe=pe+q[b];let Oe=pe+z;if(S!==void 0){const Ke=be-He,Te=o.scrollStart+Ke;Oe=A!==!0&&Te<pe&&Pe<Te+o.scrollViewSize?Te:S==="end"?Pe-o.scrollViewSize:pe-(S==="start"?0:Math.round((o.scrollViewSize-q[b])/2))}O=Oe,zt(l,Oe,u.virtualScrollHorizontal,w.lang.rtl),ve(b)})}function ye(l){const o=T.value;if(o){const b=Ht.call(o.children,i=>i.classList&&i.classList.contains("q-virtual-scroll--skip")===!1),z=b.length,D=u.virtualScrollHorizontal===!0?i=>i.getBoundingClientRect().width:i=>i.offsetHeight;let A=l,S,H;for(let i=0;i<z;){for(S=D(b[i]),i++;i<z&&b[i].classList.contains("q-virtual-scroll--with-prev")===!0;)S+=D(b[i]),i++;H=S-q[A],H!==0&&(q[A]+=H,k[Math.floor(A/oe)]+=H),A++}}}function Se(){T.value?.focus()}function fe(l,o){const b=1*g.value;(o===!0||Array.isArray(q)===!1)&&(q=[]);const z=q.length;q.length=e.value;for(let A=e.value-1;A>=z;A--)q[A]=b;const D=Math.floor((e.value-1)/oe);k=[];for(let A=0;A<=D;A++){let S=0;const H=Math.min((A+1)*oe,e.value);for(let i=A*oe;i<H;i++)S+=q[i];k.push(S)}m=-1,O=void 0,$.value=We(k,q,0,R.value.from),K.value=We(k,q,R.value.to,e.value),l>=0?(ye(R.value.from),me(()=>{Q(l)})):re()}function ie(l){if(l===void 0&&typeof window<"u"){const S=v();S!=null&&S.nodeType!==8&&(l=it(S,a(),W.value,Z.value,u.virtualScrollHorizontal,w.lang.rtl,u.virtualScrollStickySizeStart,u.virtualScrollStickySizeEnd).scrollViewSize)}C=l;const o=parseFloat(u.virtualScrollSliceRatioBefore)||0,b=parseFloat(u.virtualScrollSliceRatioAfter)||0,z=1+o+b,D=l===void 0||l<=0?1:Math.ceil(l/g.value),A=Math.max(1,D,Math.ceil((u.virtualScrollSliceSize>0?u.virtualScrollSliceSize:10)/z));n.value={total:Math.ceil(A*z),start:Math.ceil(A*o),center:Math.ceil(A*(.5+o)),end:Math.ceil(A*(1+o)),view:D}}function Ee(l,o){const b=u.virtualScrollHorizontal===!0?"width":"height",z={["--q-virtual-scroll-item-"+b]:g.value+"px"};return[l==="tbody"?I(l,{class:"q-virtual-scroll__padding",key:"before",ref:W},[I("tr",[I("td",{style:{[b]:`${$.value}px`,...z},colspan:ce.value})])]):I(l,{class:"q-virtual-scroll__padding",key:"before",ref:W,style:{[b]:`${$.value}px`,...z}}),I(l,{class:"q-virtual-scroll__content",key:"content",ref:T,tabindex:-1},o.flat()),l==="tbody"?I(l,{class:"q-virtual-scroll__padding",key:"after",ref:Z},[I("tr",[I("td",{style:{[b]:`${K.value}px`,...z},colspan:ce.value})])]):I(l,{class:"q-virtual-scroll__padding",key:"after",ref:Z,style:{[b]:`${K.value}px`,...z}})]}function ve(l){m!==l&&(u.onVirtualScroll!==void 0&&V("virtualScroll",{index:l,from:R.value.from,to:R.value.to-1,direction:l<m?"decrease":"increase",ref:y}),m=l)}ie();const re=dl(ue,w.platform.is.ios===!0?120:35);fl(()=>{ie()});let we=!1;return vl(()=>{we=!0}),ml(()=>{if(we!==!0)return;const l=v();O!==void 0&&l!==void 0&&l!==null&&l.nodeType!==8?zt(l,O,u.virtualScrollHorizontal,w.lang.rtl):Q(m)}),Ft(()=>{re.cancel()}),Object.assign(y,{scrollTo:Q,reset:J,refresh:le}),{virtualScrollSliceRange:R,virtualScrollSliceSizeComputed:n,setVirtualScrollSize:ie,onVirtualScrollEvt:re,localResetVirtualScroll:fe,padVirtualScroll:Ee,scrollTo:Q,reset:J,refresh:le}}const Bt=e=>["add","add-unique","toggle"].includes(e),Kl=".*+?^${}()|[]\\",Xl=Object.keys(ct);function at(e,v){if(typeof e=="function")return e;const a=e!==void 0?e:v;return g=>g!==null&&typeof g=="object"&&a in g?g[a]:g}const Yl=rt({name:"QSelect",inheritAttrs:!1,props:{...$t,...Al,...ct,modelValue:{required:!0},multiple:Boolean,displayValue:[String,Number],displayValueHtml:Boolean,dropdownIcon:String,options:{type:Array,default:()=>[]},optionValue:[Function,String],optionLabel:[Function,String],optionDisable:[Function,String],hideSelected:Boolean,hideDropdownIcon:Boolean,fillInput:Boolean,maxValues:[Number,String],optionsDense:Boolean,optionsDark:{type:Boolean,default:null},optionsSelectedClass:String,optionsHtml:Boolean,optionsCover:Boolean,menuShrink:Boolean,menuAnchor:String,menuSelf:String,menuOffset:Array,popupContentClass:String,popupContentStyle:[String,Array,Object],popupNoRouteDismiss:Boolean,useInput:Boolean,useChips:Boolean,newValueMode:{type:String,validator:Bt},mapOptions:Boolean,emitValue:Boolean,disableTabSelection:Boolean,inputDebounce:{type:[Number,String],default:500},inputClass:[Array,String,Object],inputStyle:[Array,String,Object],tabindex:{type:[String,Number],default:0},autocomplete:String,transitionShow:{},transitionHide:{},transitionDuration:{},behavior:{type:String,validator:e=>["default","menu","dialog"].includes(e),default:"default"},virtualScrollItemSize:$t.virtualScrollItemSize.type,onNewValue:Function,onFilter:Function},emits:[...Ot,"add","remove","inputValue","keyup","keypress","keydown","popupShow","popupHide","filterAbort"],setup(e,{slots:v,emit:a}){const{proxy:g}=st(),{$q:f}=g,u=M(!1),V=M(!1),y=M(-1),w=M(""),O=M(!1),m=M(!1);let C=null,k=null,q,$,K,n=null,W,Z,T,R;const ce=M(null),L=M(null),G=M(null),J=M(null),le=M(null),Q=Il(e),ue=Rl(bt),_=h(()=>Array.isArray(e.options)?e.options.length:0),ye=h(()=>e.virtualScrollItemSize===void 0?e.optionsDense===!0?24:48:e.virtualScrollItemSize),{virtualScrollSliceRange:Se,virtualScrollSliceSizeComputed:fe,localResetVirtualScroll:ie,padVirtualScroll:Ee,onVirtualScrollEvt:ve,scrollTo:re,setVirtualScrollSize:we}=jl({virtualScrollLength:_,getVirtualScrollTarget:Nt,getVirtualScrollEl:St,virtualScrollItemSizeComputed:ye}),l=Mt(),o=h(()=>{const t=e.mapOptions===!0&&e.multiple!==!0,c=e.modelValue!==void 0&&(e.modelValue!==null||t===!0)?e.multiple===!0&&Array.isArray(e.modelValue)?e.modelValue:[e.modelValue]:[];if(e.mapOptions===!0&&Array.isArray(e.options)===!0){const d=e.mapOptions===!0&&q!==void 0?q:[],p=c.map(E=>Qt(E,d));return e.modelValue===null&&t===!0?p.filter(E=>E!==null):p}return c}),b=h(()=>{const t={};return Xl.forEach(c=>{const d=e[c];d!==void 0&&(t[c]=d)}),t}),z=h(()=>e.optionsDark===null?l.isDark.value:e.optionsDark),D=h(()=>At(o.value)),A=h(()=>{let t="q-field__input q-placeholder col";return e.hideSelected===!0||o.value.length===0?[t,e.inputClass]:(t+=" q-field__input--padding",e.inputClass===void 0?t:[t,e.inputClass])}),S=h(()=>(e.virtualScrollHorizontal===!0?"q-virtual-scroll--horizontal":"")+(e.popupContentClass?" "+e.popupContentClass:"")),H=h(()=>_.value===0),i=h(()=>o.value.map(t=>ee.value(t)).join(", ")),r=h(()=>e.displayValue!==void 0?e.displayValue:i.value),s=h(()=>e.optionsHtml===!0?()=>!0:t=>t?.html===!0),P=h(()=>e.displayValueHtml===!0||e.displayValue===void 0&&(e.optionsHtml===!0||o.value.some(s.value))),N=h(()=>l.focused.value===!0?e.tabindex:-1),He=h(()=>{const t={tabindex:e.tabindex,role:"combobox","aria-label":e.label,"aria-readonly":e.readonly===!0?"true":"false","aria-autocomplete":e.useInput===!0?"list":"none","aria-expanded":u.value===!0?"true":"false","aria-controls":`${l.targetUid.value}_lb`};return y.value>=0&&(t["aria-activedescendant"]=`${l.targetUid.value}_${y.value}`),t}),be=h(()=>({id:`${l.targetUid.value}_lb`,role:"listbox","aria-multiselectable":e.multiple===!0?"true":"false"})),pe=h(()=>o.value.map((t,c)=>({index:c,opt:t,html:s.value(t),selected:!0,removeAtIndex:Ut,toggleOption:Ve,tabindex:N.value}))),Pe=h(()=>{if(_.value===0)return[];const{from:t,to:c}=Se.value;return e.options.slice(t,c).map((d,p)=>{const E=Ae.value(d)===!0,x=Ye(d)===!0,X=t+p,U={clickable:!0,active:x,activeClass:Te.value,manualFocus:!0,focused:!1,disable:E,tabindex:-1,dense:e.optionsDense,dark:z.value,role:"option","aria-selected":x===!0?"true":"false",id:`${l.targetUid.value}_${X}`,onClick:()=>{Ve(d)}};return E!==!0&&(y.value===X&&(U.focused=!0),f.platform.is.desktop===!0&&(U.onMousemove=()=>{u.value===!0&&Ie(X)})),{index:X,opt:d,html:s.value(d),label:ee.value(d),selected:U.active,focused:U.focused,toggleOption:Ve,setOptionIndex:Ie,itemProps:U}})}),Oe=h(()=>e.dropdownIcon!==void 0?e.dropdownIcon:f.iconSet.arrow.dropdown),Ke=h(()=>e.optionsCover===!1&&e.outlined!==!0&&e.standout!==!0&&e.borderless!==!0&&e.rounded!==!0),Te=h(()=>e.optionsSelectedClass!==void 0?e.optionsSelectedClass:e.color!==void 0?`text-${e.color}`:""),se=h(()=>at(e.optionValue,"value")),ee=h(()=>at(e.optionLabel,"label")),Ae=h(()=>at(e.optionDisable,"disable")),Ue=h(()=>o.value.map(se.value)),Pt=h(()=>{const t={onInput:bt,onChange:ue,onKeydown:yt,onKeyup:ht,onKeypress:gt,onFocus:vt,onClick(c){$===!0&&Fe(c)}};return t.onCompositionstart=t.onCompositionupdate=t.onCompositionend=ue,t});ge(o,t=>{q=t,e.useInput===!0&&e.fillInput===!0&&e.multiple!==!0&&l.innerLoading.value!==!0&&(V.value!==!0&&u.value!==!0||D.value!==!0)&&(K!==!0&&Be(),(V.value===!0||u.value===!0)&&Re(""))},{immediate:!0}),ge(()=>e.fillInput,Be),ge(u,Je),ge(_,al);function dt(t){return e.emitValue===!0?se.value(t):t}function Xe(t){if(t!==-1&&t<o.value.length)if(e.multiple===!0){const c=e.modelValue.slice();a("remove",{index:t,value:c.splice(t,1)[0]}),a("update:modelValue",c)}else a("update:modelValue",null)}function Ut(t){Xe(t),l.focus()}function ft(t,c){const d=dt(t);if(e.multiple!==!0){e.fillInput===!0&&Me(ee.value(t),!0,!0),a("update:modelValue",d);return}if(o.value.length===0){a("add",{index:0,value:d}),a("update:modelValue",e.multiple===!0?[d]:d);return}if(c===!0&&Ye(t)===!0||e.maxValues!==void 0&&e.modelValue.length>=e.maxValues)return;const p=e.modelValue.slice();a("add",{index:p.length,value:d}),p.push(d),a("update:modelValue",p)}function Ve(t,c){if(l.editable.value!==!0||t===void 0||Ae.value(t)===!0)return;const d=se.value(t);if(e.multiple!==!0){c!==!0&&(Me(e.fillInput===!0?ee.value(t):"",!0,!0),Ce()),L.value?.focus(),(o.value.length===0||De(se.value(o.value[0]),d)!==!0)&&a("update:modelValue",e.emitValue===!0?d:t);return}if(($!==!0||O.value===!0)&&l.focus(),vt(),o.value.length===0){const x=e.emitValue===!0?d:t;a("add",{index:0,value:x}),a("update:modelValue",e.multiple===!0?[x]:x);return}const p=e.modelValue.slice(),E=Ue.value.findIndex(x=>De(x,d));if(E!==-1)a("remove",{index:E,value:p.splice(E,1)[0]});else{if(e.maxValues!==void 0&&p.length>=e.maxValues)return;const x=e.emitValue===!0?d:t;a("add",{index:p.length,value:x}),p.push(x)}a("update:modelValue",p)}function Ie(t){if(f.platform.is.desktop!==!0)return;const c=t!==-1&&t<_.value?t:-1;y.value!==c&&(y.value=c)}function Qe(t=1,c){if(u.value===!0){let d=y.value;do d=It(d+t,-1,_.value-1);while(d!==-1&&d!==y.value&&Ae.value(e.options[d])===!0);y.value!==d&&(Ie(d),re(d),c!==!0&&e.useInput===!0&&e.fillInput===!0&&Ne(d>=0?ee.value(e.options[d]):W,!0))}}function Qt(t,c){const d=p=>De(se.value(p),t);return e.options.find(d)||c.find(d)||t}function Ye(t){const c=se.value(t);return Ue.value.find(d=>De(d,c))!==void 0}function vt(t){e.useInput===!0&&L.value!==null&&(t===void 0||L.value===t.target&&t.target.value===i.value)&&L.value.select()}function mt(t){Sl(t,27)===!0&&u.value===!0&&(Fe(t),Ce(),Be()),a("keyup",t)}function ht(t){const{value:c}=t.target;if(t.keyCode!==void 0){mt(t);return}if(t.target.value="",C!==null&&(clearTimeout(C),C=null),k!==null&&(clearTimeout(k),k=null),Be(),typeof c=="string"&&c.length!==0){const d=c.toLocaleLowerCase(),p=x=>{const X=e.options.find(U=>String(x.value(U)).toLocaleLowerCase()===d);return X===void 0?!1:(o.value.indexOf(X)===-1?Ve(X):Ce(),!0)},E=x=>{p(se)!==!0&&x!==!0&&p(ee)!==!0&&Re(c,!0,()=>E(!0))};E()}else l.clearValue(t)}function gt(t){a("keypress",t)}function yt(t){if(a("keydown",t),hl(t)===!0)return;const c=w.value.length!==0&&(e.newValueMode!==void 0||e.onNewValue!==void 0),d=t.shiftKey!==!0&&e.disableTabSelection!==!0&&e.multiple!==!0&&(y.value!==-1||c===!0);if(t.keyCode===27){Ge(t);return}if(t.keyCode===9&&d===!1){ze();return}if(t.target===void 0||t.target.id!==l.targetUid.value||l.editable.value!==!0)return;if(t.keyCode===40&&l.innerLoading.value!==!0&&u.value===!1){_e(t),$e();return}if(t.keyCode===8&&(e.useChips===!0||e.clearable===!0)&&e.hideSelected!==!0&&w.value.length===0){e.multiple===!0&&Array.isArray(e.modelValue)===!0?Xe(e.modelValue.length-1):e.multiple!==!0&&e.modelValue!==null&&a("update:modelValue",null);return}(t.keyCode===35||t.keyCode===36)&&(typeof w.value!="string"||w.value.length===0)&&(_e(t),y.value=-1,Qe(t.keyCode===36?1:-1,e.multiple)),(t.keyCode===33||t.keyCode===34)&&fe.value!==void 0&&(_e(t),y.value=Math.max(-1,Math.min(_.value,y.value+(t.keyCode===33?-1:1)*fe.value.view)),Qe(t.keyCode===33?1:-1,e.multiple)),(t.keyCode===38||t.keyCode===40)&&(_e(t),Qe(t.keyCode===38?-1:1,e.multiple));const p=_.value;if((T===void 0||R<Date.now())&&(T=""),p>0&&e.useInput!==!0&&t.key!==void 0&&t.key.length===1&&t.altKey===!1&&t.ctrlKey===!1&&t.metaKey===!1&&(t.keyCode!==32||T.length!==0)){u.value!==!0&&$e(t);const E=t.key.toLocaleLowerCase(),x=T.length===1&&T[0]===E;R=Date.now()+1500,x===!1&&(_e(t),T+=E);const X=new RegExp("^"+T.split("").map(Ze=>Kl.indexOf(Ze)!==-1?"\\"+Ze:Ze).join(".*"),"i");let U=y.value;if(x===!0||U<0||X.test(ee.value(e.options[U]))!==!0)do U=It(U+1,-1,p-1);while(U!==y.value&&(Ae.value(e.options[U])===!0||X.test(ee.value(e.options[U]))!==!0));y.value!==U&&me(()=>{Ie(U),re(U),U>=0&&e.useInput===!0&&e.fillInput===!0&&Ne(ee.value(e.options[U]),!0)});return}if(!(t.keyCode!==13&&(t.keyCode!==32||e.useInput===!0||T!=="")&&(t.keyCode!==9||d===!1))){if(t.keyCode!==9&&_e(t),y.value!==-1&&y.value<p){Ve(e.options[y.value]);return}if(c===!0){const E=(x,X)=>{if(X){if(Bt(X)!==!0)return}else X=e.newValueMode;if(Me("",e.multiple!==!0,!0),x==null)return;(X==="toggle"?Ve:ft)(x,X==="add-unique"),e.multiple!==!0&&(L.value?.focus(),Ce())};if(e.onNewValue!==void 0?a("newValue",w.value,E):E(w.value),e.multiple!==!0)return}u.value===!0?ze():l.innerLoading.value!==!0&&$e()}}function St(){return $===!0?le.value:G.value!==null&&G.value.contentEl!==null?G.value.contentEl:void 0}function Nt(){return St()}function jt(){return e.hideSelected===!0?[]:v["selected-item"]!==void 0?pe.value.map(t=>v["selected-item"](t)).slice():v.selected!==void 0?[].concat(v.selected()):e.useChips===!0?pe.value.map((t,c)=>I(je,{key:"option-"+c,removable:l.editable.value===!0&&Ae.value(t.opt)!==!0,dense:!0,textColor:e.color,tabindex:N.value,onRemove(){t.removeAtIndex(c)}},()=>I("span",{class:"ellipsis",[t.html===!0?"innerHTML":"textContent"]:ee.value(t.opt)}))):[I("span",{class:"ellipsis",[P.value===!0?"innerHTML":"textContent"]:r.value})]}function wt(){if(H.value===!0)return v["no-option"]!==void 0?v["no-option"]({inputValue:w.value}):void 0;const t=v.option!==void 0?v.option:d=>I(xl,{key:d.index,...d.itemProps},()=>I(Bl,()=>I(Fl,()=>I("span",{[d.html===!0?"innerHTML":"textContent"]:d.label}))));let c=Ee("div",Pe.value.map(t));return v["before-options"]!==void 0&&(c=v["before-options"]().concat(c)),wl(v["after-options"],c)}function Kt(t,c){const d=c===!0?{...He.value,...l.splitAttrs.attributes.value}:void 0,p={ref:c===!0?L:void 0,key:"i_t",class:A.value,style:e.inputStyle,value:w.value!==void 0?w.value:"",type:"search",...d,id:c===!0?l.targetUid.value:void 0,maxlength:e.maxlength,autocomplete:e.autocomplete,"data-autofocus":t===!0||e.autofocus===!0||void 0,disabled:e.disable===!0,readonly:e.readonly===!0,...Pt.value};return t!==!0&&$===!0&&(Array.isArray(p.class)===!0?p.class=[...p.class,"no-pointer-events"]:p.class+=" no-pointer-events"),I("input",p)}function bt(t){C!==null&&(clearTimeout(C),C=null),k!==null&&(clearTimeout(k),k=null),!(t&&t.target&&t.target.qComposing===!0)&&(Ne(t.target.value||""),K=!0,W=w.value,l.focused.value!==!0&&($!==!0||O.value===!0)&&l.focus(),e.onFilter!==void 0&&(C=setTimeout(()=>{C=null,Re(w.value)},e.inputDebounce)))}function Ne(t,c){w.value!==t&&(w.value=t,c===!0||e.inputDebounce===0||e.inputDebounce==="0"?a("inputValue",t):k=setTimeout(()=>{k=null,a("inputValue",t)},e.inputDebounce))}function Me(t,c,d){K=d!==!0,e.useInput===!0&&(Ne(t,!0),(c===!0||d!==!0)&&(W=t),c!==!0&&Re(t))}function Re(t,c,d){if(e.onFilter===void 0||c!==!0&&l.focused.value!==!0)return;l.innerLoading.value===!0?a("filterAbort"):(l.innerLoading.value=!0,m.value=!0),t!==""&&e.multiple!==!0&&o.value.length!==0&&K!==!0&&t===ee.value(o.value[0])&&(t="");const p=setTimeout(()=>{u.value===!0&&(u.value=!1)},10);n!==null&&clearTimeout(n),n=p,a("filter",t,(E,x)=>{(c===!0||l.focused.value===!0)&&n===p&&(clearTimeout(n),typeof E=="function"&&E(),m.value=!1,me(()=>{l.innerLoading.value=!1,l.editable.value===!0&&(c===!0?u.value===!0&&Ce():u.value===!0?Je(!0):u.value=!0),typeof x=="function"&&me(()=>{x(g)}),typeof d=="function"&&me(()=>{d(g)})}))},()=>{l.focused.value===!0&&n===p&&(clearTimeout(n),l.innerLoading.value=!1,m.value=!1),u.value===!0&&(u.value=!1)})}function Xt(){return I(El,{ref:G,class:S.value,style:e.popupContentStyle,modelValue:u.value,fit:e.menuShrink!==!0,cover:e.optionsCover===!0&&H.value!==!0&&e.useInput!==!0,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,dark:z.value,noParentEvent:!0,noRefocus:!0,noFocus:!0,noRouteDismiss:e.popupNoRouteDismiss,square:Ke.value,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,separateClosePopup:!0,...be.value,onScrollPassive:ve,onBeforeShow:Vt,onBeforeHide:Yt,onShow:Jt},wt)}function Yt(t){Ct(t),ze()}function Jt(){we()}function Zt(t){Fe(t),L.value?.focus(),O.value=!0,window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,0)}function Gt(t){Fe(t),me(()=>{O.value=!1})}function el(){const t=[I(Hl,{class:`col-auto ${l.fieldClass.value}`,...b.value,for:l.targetUid.value,dark:z.value,square:!0,loading:m.value,itemAligned:!1,filled:!0,stackLabel:w.value.length!==0,...l.splitAttrs.listeners.value,onFocus:Zt,onBlur:Gt},{...v,rawControl:()=>l.getControl(!0),before:void 0,after:void 0})];return u.value===!0&&t.push(I("div",{ref:le,class:S.value+" scroll",style:e.popupContentStyle,...be.value,onClick:Ge,onScrollPassive:ve},wt())),I(Dt,{ref:J,modelValue:V.value,position:e.useInput===!0?"top":void 0,transitionShow:Z,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,noRouteDismiss:e.popupNoRouteDismiss,onBeforeShow:Vt,onBeforeHide:tl,onHide:ll,onShow:il},()=>I("div",{class:"q-select__dialog"+(z.value===!0?" q-select__dialog--dark q-dark":"")+(O.value===!0?" q-select__dialog--focused":"")},t))}function tl(t){Ct(t),J.value!==null&&J.value.__updateRefocusTarget(l.rootRef.value.querySelector(".q-field__native > [tabindex]:last-child")),l.focused.value=!1}function ll(t){Ce(),l.focused.value===!1&&a("blur",t),Be()}function il(){const t=document.activeElement;(t===null||t.id!==l.targetUid.value)&&L.value!==null&&L.value!==t&&L.value.focus(),we()}function ze(){V.value!==!0&&(y.value=-1,u.value===!0&&(u.value=!1),l.focused.value===!1&&(n!==null&&(clearTimeout(n),n=null),l.innerLoading.value===!0&&(a("filterAbort"),l.innerLoading.value=!1,m.value=!1)))}function $e(t){l.editable.value===!0&&($===!0?(l.onControlFocusin(t),V.value=!0,me(()=>{l.focus()})):l.focus(),e.onFilter!==void 0?Re(w.value):(H.value!==!0||v["no-option"]!==void 0)&&(u.value=!0))}function Ce(){V.value=!1,ze()}function Be(){e.useInput===!0&&Me(e.multiple!==!0&&e.fillInput===!0&&o.value.length!==0&&ee.value(o.value[0])||"",!0,!0)}function Je(t){let c=-1;if(t===!0){if(o.value.length!==0){const d=se.value(o.value[0]);c=e.options.findIndex(p=>De(se.value(p),d))}ie(c)}Ie(c)}function al(t,c){u.value===!0&&l.innerLoading.value===!1&&(ie(-1,!0),me(()=>{u.value===!0&&l.innerLoading.value===!1&&(t>c?ie():Je(!0))}))}function pt(){V.value===!1&&G.value!==null&&G.value.updatePosition()}function Vt(t){t!==void 0&&Fe(t),a("popupShow",t),l.hasPopupOpen=!0,l.onControlFocusin(t)}function Ct(t){t!==void 0&&Fe(t),a("popupHide",t),l.hasPopupOpen=!1,l.onControlFocusout(t)}function kt(){$=f.platform.is.mobile!==!0&&e.behavior!=="dialog"?!1:e.behavior!=="menu"&&(e.useInput===!0?v["no-option"]!==void 0||e.onFilter!==void 0||H.value===!1:!0),Z=f.platform.is.ios===!0&&$===!0&&e.useInput===!0?"fade":e.transitionShow}return gl(kt),yl(pt),kt(),Ft(()=>{C!==null&&clearTimeout(C),k!==null&&clearTimeout(k)}),Object.assign(g,{showPopup:$e,hidePopup:Ce,removeAtIndex:Xe,add:ft,toggleOption:Ve,getOptionIndex:()=>y.value,setOptionIndex:Ie,moveOptionSelection:Qe,filter:Re,updateMenuPosition:pt,updateInputValue:Me,isOptionSelected:Ye,getEmittingOptionValue:dt,isOptionDisabled:(...t)=>Ae.value.apply(null,t)===!0,getOptionValue:(...t)=>se.value.apply(null,t),getOptionLabel:(...t)=>ee.value.apply(null,t)}),Object.assign(l,{innerValue:o,fieldClass:h(()=>`q-select q-field--auto-height q-select--with${e.useInput!==!0?"out":""}-input q-select--with${e.useChips!==!0?"out":""}-chips q-select--${e.multiple===!0?"multiple":"single"}`),inputRef:ce,targetRef:L,hasValue:D,showPopup:$e,floatingLabel:h(()=>e.hideSelected!==!0&&D.value===!0||typeof w.value=="number"||w.value.length!==0||At(e.displayValue)),getControlChild:()=>{if(l.editable.value!==!1&&(V.value===!0||H.value!==!0||v["no-option"]!==void 0))return $===!0?el():Xt();l.hasPopupOpen===!0&&(l.hasPopupOpen=!1)},controlEvents:{onFocusin(t){l.onControlFocusin(t)},onFocusout(t){l.onControlFocusout(t,()=>{Be(),ze()})},onClick(t){if(Ge(t),$!==!0&&u.value===!0){ze(),L.value?.focus();return}$e(t)}},getControl:t=>{const c=jt(),d=t===!0||V.value!==!0||$!==!0;if(e.useInput===!0)c.push(Kt(t,d));else if(l.editable.value===!0){const E=d===!0?He.value:void 0;c.push(I("input",{ref:d===!0?L:void 0,key:"d_t",class:"q-select__focus-target",id:d===!0?l.targetUid.value:void 0,value:r.value,readonly:!0,"data-autofocus":t===!0||e.autofocus===!0||void 0,...E,onKeydown:yt,onKeyup:mt,onKeypress:gt})),d===!0&&typeof e.autocomplete=="string"&&e.autocomplete.length!==0&&c.push(I("input",{class:"q-select__autocomplete-input",autocomplete:e.autocomplete,tabindex:-1,onKeyup:ht}))}if(Q.value!==void 0&&e.disable!==!0&&Ue.value.length!==0){const E=Ue.value.map(x=>I("option",{value:x,selected:!0}));c.push(I("select",{class:"hidden",name:Q.value,multiple:e.multiple},E))}const p=e.useInput===!0||d!==!0?void 0:l.splitAttrs.attributes.value;return I("div",{class:"q-field__native row items-center",...p,...l.splitAttrs.listeners.value},c)},getInnerAppend:()=>e.loading!==!0&&m.value!==!0&&e.hideDropdownIcon!==!0?[I(qe,{class:"q-select__dropdown-icon"+(u.value===!0?" rotate-180":""),name:Oe.value})]:null}),Tt(l)}}),Jl={class:"row items-center justify-between"},Zl={class:"text-h6 wish-title"},Gl={class:"row q-gutter-xs"},ei={class:"wish-description"},ti={key:0,class:"text-body2 text-grey-7"},li={class:"wish-url"},ii={class:"wish-meta"},ai={class:"text-caption text-grey-6"},ni={key:0},ui=xt({__name:"WishCard",props:{wish:{},currentUserId:{}},emits:["edit","delete","toggleBought","toggleReceived"],setup(e,{emit:v}){const a=e,g=v,f=Lt(),{t:u}=Wt(),V=h(()=>{switch(a.wish.visibility){case"public":return"green";case"friends":return"blue";case"private":return"grey";default:return"grey"}}),y=h(()=>{switch(a.wish.visibility){case"public":return u("wishes.visibilityPublic");case"friends":return u("wishes.visibilityFriends");case"private":return u("wishes.visibilityPrivate");default:return u("common.unknown")}}),w=h(()=>a.wish.created_by_user_id!==a.wish.created_for_user_id&&a.currentUserId!==a.wish.created_for_user_id),O=()=>{const n=a.wish.created_by_user;return n.name&&n.surname?`${n.name} ${n.surname}`:n.name?n.name:n.username?n.username:u("common.unknown")},m=h(()=>a.currentUserId===a.wish.created_by_user_id),C=h(()=>a.currentUserId===a.wish.created_by_user_id),k=h(()=>a.currentUserId!==a.wish.created_for_user_id&&a.currentUserId!==void 0),q=h(()=>a.currentUserId===a.wish.created_for_user_id&&a.currentUserId!==void 0),$=n=>new Date(n).toLocaleDateString("cs-CZ"),K=()=>{f.dialog({title:u("wishes.deleteWish"),message:u("wishes.deleteConfirm"),cancel:!0,persistent:!0}).onOk(()=>{g("delete",a.wish.id)})};return(n,W)=>(F(),ae(Et,{class:"wish-card"},{default:te(()=>[B(ot,{class:"wish-card-content"},{default:te(()=>[j("div",Jl,[j("div",Zl,ne(n.wish.name),1),j("div",Gl,[B(je,{color:V.value,"text-color":"white",label:y.value,size:"sm"},null,8,["color","label"]),n.wish.is_bought?(F(),ae(je,{key:0,color:"green","text-color":"white",label:n.$t("wishes.bought"),size:"sm"},null,8,["label"])):de("",!0),n.wish.is_received?(F(),ae(je,{key:1,color:"purple","text-color":"white",label:n.$t("wishes.received"),size:"sm"},null,8,["label"])):de("",!0)])]),j("div",ei,[n.wish.description?(F(),Y("div",ti,ne(n.wish.description),1)):de("",!0)]),j("div",li,[n.wish.url?(F(),ae(he,{key:0,flat:"",color:"primary",href:n.wish.url,target:"_blank",icon:"open_in_new",label:n.$t("wishes.openLink"),size:"sm"},null,8,["href","label"])):de("",!0)]),j("div",ii,[j("div",ai,[w.value?(F(),Y("div",ni,ne(n.$t("wishes.createdBy",{name:O()})),1)):de("",!0),j("div",null,ne($(n.wish.created_at)),1)])])]),_:1}),B(Wl,{align:"right"},{default:te(()=>[k.value?(F(),ae(he,{key:0,color:n.wish.is_bought?"grey":"green",icon:n.wish.is_bought?"shopping_cart":"add_shopping_cart",label:n.wish.is_bought?n.$t("wishes.markAsNotBought"):n.$t("wishes.markAsBought"),flat:"",onClick:W[0]||(W[0]=Z=>n.$emit("toggleBought",n.wish.id))},null,8,["color","icon","label"])):de("",!0),q.value?(F(),ae(he,{key:1,color:n.wish.is_received?"orange":"purple",icon:n.wish.is_received?"undo":"check_circle",label:n.wish.is_received?n.$t("wishes.markAsNotReceived"):n.$t("wishes.markAsReceived"),flat:"",onClick:W[1]||(W[1]=Z=>n.$emit("toggleReceived",n.wish.id))},null,8,["color","icon","label"])):de("",!0),m.value?(F(),ae(he,{key:2,color:"primary",icon:"edit",flat:"",onClick:W[2]||(W[2]=Z=>n.$emit("edit",n.wish))})):de("",!0),C.value?(F(),ae(he,{key:3,color:"negative",icon:"delete",flat:"",onClick:K})):de("",!0)]),_:1})]),_:1}))}}),nt=Ol(ui,[["__scopeId","data-v-eed62911"]]),oi={class:"row justify-between items-center q-mb-md"},ri={class:"text-h4"},si={key:0,class:"flex justify-center"},ci={key:1,class:"text-center text-grey-6 q-py-lg"},di={class:"text-h6 q-mt-md"},fi={key:2,class:"row q-gutter-md"},vi={key:0,class:"flex justify-center"},mi={key:1,class:"text-center text-grey-6 q-py-lg"},hi={class:"text-h6 q-mt-md"},gi={key:2,class:"row q-gutter-md"},yi={key:0,class:"flex justify-center"},Si={key:1,class:"text-center text-grey-6 q-py-lg"},wi={class:"text-h6 q-mt-md"},bi={key:2,class:"row q-gutter-md"},pi={class:"text-h6"},Vi={class:"row justify-end q-gutter-sm"},Hi=xt({__name:"WishesPage",setup(e){const v=Lt(),{t:a}=Wt(),g=Vl(),f=Ll(),u=h(()=>g.params.userId),V=h(()=>!!u.value),{isLoading:y,createWish:w,fetchWishes:O,fetchAllWishesForUser:m,fetchReceivedWishes:C,refreshWishes:k,refreshAllWishesForUser:q,refreshReceivedWishes:$,updateWish:K,deleteWish:n,toggleBought:W,toggleReceived:Z}=Dl(),T=M([]),R=M([]),ce=h(()=>V.value?R.value:T.value);let L=null;const G=M("my-wishes"),J=M(!1),le=M(null),Q=M([]),ue=M(""),_=bl({name:"",description:"",url:"",visibility:"friends"}),ye=[{label:a("wishes.form.visibilityPublic"),value:"public"},{label:a("wishes.form.visibilityFriends"),value:"friends"},{label:a("wishes.form.visibilityPrivate"),value:"private"}],Se=()=>{_.name="",_.description="",_.url="",_.visibility="friends",le.value=null},fe=async()=>{if(!f.user)return;const i=V.value?u.value:f.user.id;if(!i)return;const r={name:_.name,..._.description&&{description:_.description},..._.url&&{url:_.url},visibility:_.visibility,created_for_user_id:i,created_by_user_id:f.user.id};let s;if(le.value?s=await K(le.value,r):s=await w(r),s.error)v.notify({type:"negative",message:a("wishes.saveError")+": "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))});else if(v.notify({type:"positive",message:le.value?a("wishes.updateSuccess"):a("wishes.createSuccess")}),J.value=!1,Se(),V.value){const P=await q(u.value,!0);P?.data&&(R.value=P.data)}else{const P=await k(f.user.id);P?.data&&(T.value=P.data)}},ie=i=>{_.name=i.name,_.description=i.description||"",_.url=i.url||"",_.visibility=i.visibility,le.value=i.id,J.value=!0},Ee=async i=>{const r=await n(i);r.error?v.notify({type:"negative",message:a("wishes.deleteError")+": "+(r.error instanceof Error?r.error.message:JSON.stringify(r.error))}):v.notify({type:"positive",message:a("wishes.deleteSuccess")})},ve=async i=>{if(!f.user)return;const r=await W(i,f.user.id);if(r.error)v.notify({type:"negative",message:a("wishes.toggleBoughtError")+": "+(r.error instanceof Error?r.error.message:JSON.stringify(r.error))});else if(V.value){const s=await q(u.value);s?.data&&(R.value=s.data)}else{const s=await k(f.user.id);s?.data&&(T.value=s.data);const P=await $(f.user.id);P?.data&&(Q.value=P.data)}},re=async i=>{if(!f.user)return;const r=await Z(i,f.user.id);if(r.error)v.notify({type:"negative",message:a("wishes.toggleReceivedError")+": "+(typeof r.error=="string"?r.error:JSON.stringify(r.error))});else{if(V.value){const s=await q(u.value);s?.data&&(R.value=s.data)}else{const s=await k(f.user.id);s?.data&&(T.value=s.data);const P=await $(f.user.id);P?.data&&(Q.value=P.data)}v.notify({type:"positive",message:a("wishes.toggleReceivedSuccess")})}},we=async()=>{if(!f.user)return;const i=await C(f.user.id);i?.data&&(Q.value=i.data)},l=async i=>{try{const{data:r,error:s}=await Rt.from("profiles").select("name, username").eq("id",i).single();if(s)throw s;ue.value=r.name||r.username||"Unknown"}catch(r){console.error("Error fetching friend profile:",r),ue.value="Unknown"}};let o=null;const b=async()=>{console.log("Visibility change detected",document.hidden,"User ID:",f.user?.id),!document.hidden&&f.user&&(console.log("User returned to tab, refreshing data...",g.params.userId),await z(g.params.userId),D())};pl(async()=>{console.log("WishesPage mounted",f.user?.id,"Viewing User ID:",g.params.userId),f.user&&(await z(g.params.userId),D()),o=()=>{b().catch(i=>{console.error("Error handling visibility change:",i)})},document.addEventListener("visibilitychange",o)}),Cl(()=>{console.log("WishesPage unmounted"),o&&(document.removeEventListener("visibilitychange",o),o=null),H()}),ge(()=>g.params.userId,async(i,r)=>{i!==r&&(ue.value="",await z(i),D())},{immediate:!0}),ge(()=>f.user?.id,async i=>{i?(await z(g.params.userId),D()):H()});const z=async i=>{if(console.log("Loading wishes for context",i,"User ID:",f.user?.id),!!f.user)if(i){console.log("Loading wishes for friend",i),T.value=[],R.value=[],Q.value=[],ue.value="",await l(i);const r=await m(i,!0);r?.data&&(R.value=r.data)}else{console.log("Loading own wishes",f.user.id);const r=T.value.length>0;T.value=[],R.value=[],Q.value=[],ue.value="";const s=await O(f.user.id,r,"active");s?.data&&(T.value=s.data),await we()}},D=()=>{f.user&&(L&&L.unsubscribe(),L=Rt.channel("wishes_changes").on("postgres_changes",{event:"*",schema:"public",table:"wishes"},i=>{A(i)}).subscribe())},A=async i=>{if(!f.user)return;const{eventType:r,new:s,old:P}=i;if(r==="INSERT"&&s)V.value&&s.created_for_user_id===u.value?await S():!V.value&&s.created_for_user_id===f.user.id&&await S();else if(r==="UPDATE"&&s)if(!V.value&&s.created_for_user_id===f.user.id){await S();const N=await $(f.user.id);N?.data&&(Q.value=N.data)}else V.value&&s.created_for_user_id===u.value&&await S();else r==="DELETE"&&P&&(V.value?R.value=R.value.filter(N=>N.id!==P.id):(T.value=T.value.filter(N=>N.id!==P.id),Q.value=Q.value.filter(N=>N.id!==P.id)))},S=async()=>{if(f.user)if(V.value){const i=await q(u.value,!0);i?.data&&(R.value=i.data)}else{const i=await k(f.user.id);i?.data&&(T.value=i.data);const r=await $(f.user.id);r?.data&&(Q.value=r.data)}},H=()=>{L&&(L.unsubscribe(),L=null)};return(i,r)=>(F(),ae(Ml,{class:"q-pa-md"},{default:te(()=>[j("div",oi,[j("div",ri,ne(V.value?`${ue.value}'s ${i.$t("wishes.wishes")}`:i.$t("wishes.title")),1),B(he,{color:"primary",icon:"add",label:V.value?i.$t("wishes.addForFriend"):i.$t("wishes.add"),onClick:r[0]||(r[0]=s=>J.value=!0)},null,8,["label"])]),V.value?(F(),Y(Le,{key:1},[ke(y)?(F(),Y("div",yi,[B(et,{size:"lg"})])):ce.value.length===0?(F(),Y("div",Si,[B(qe,{name:"card_giftcard",size:"4rem"}),j("div",wi,ne(i.$t("wishes.noWishes")),1),j("div",null,ne(i.$t("wishes.friendHasNoWishes")),1)])):(F(),Y("div",bi,[(F(!0),Y(Le,null,tt(ce.value,s=>(F(),ae(nt,{key:s.id,wish:s,"current-user-id":ke(f).user?.id,onToggleBought:ve,onToggleReceived:re},null,8,["wish","current-user-id"]))),128))]))],64)):(F(),Y(Le,{key:0},[B(kl,{modelValue:G.value,"onUpdate:modelValue":r[1]||(r[1]=s=>G.value=s),class:"text-primary q-mb-md"},{default:te(()=>[B(_t,{name:"my-wishes",label:i.$t("wishes.myWishes")},null,8,["label"]),B(_t,{name:"archive",label:i.$t("wishes.archive")},null,8,["label"])]),_:1},8,["modelValue"]),B(_l),B(ql,{modelValue:G.value,"onUpdate:modelValue":r[2]||(r[2]=s=>G.value=s),animated:""},{default:te(()=>[B(qt,{name:"my-wishes"},{default:te(()=>[ke(y)?(F(),Y("div",si,[B(et,{size:"lg"})])):ce.value.length===0?(F(),Y("div",ci,[B(qe,{name:"card_giftcard",size:"4rem"}),j("div",di,ne(i.$t("wishes.noWishes")),1),j("div",null,ne(i.$t("wishes.addFirstWish")),1)])):(F(),Y("div",fi,[(F(!0),Y(Le,null,tt(ce.value,s=>(F(),ae(nt,{key:s.id,wish:s,"current-user-id":ke(f).user?.id,onEdit:ie,onDelete:Ee,onToggleBought:ve,onToggleReceived:re},null,8,["wish","current-user-id"]))),128))]))]),_:1}),B(qt,{name:"archive"},{default:te(()=>[ke(y)?(F(),Y("div",vi,[B(et,{size:"lg"})])):Q.value.length===0?(F(),Y("div",mi,[B(qe,{name:"archive",size:"4rem"}),j("div",hi,ne(i.$t("wishes.noArchivedWishes")),1),j("div",null,ne(i.$t("wishes.noArchivedWishesDesc")),1)])):(F(),Y("div",gi,[(F(!0),Y(Le,null,tt(Q.value,s=>(F(),ae(nt,{key:s.id,wish:s,"current-user-id":ke(f).user?.id,onToggleReceived:re},null,8,["wish","current-user-id"]))),128))]))]),_:1})]),_:1},8,["modelValue"])],64)),B(Dt,{modelValue:J.value,"onUpdate:modelValue":r[8]||(r[8]=s=>J.value=s),onHide:Se},{default:te(()=>[B(Et,{style:{width:"100%","max-width":"500px"}},{default:te(()=>[B(ot,null,{default:te(()=>[j("div",pi,ne(le.value?i.$t("wishes.editWish"):i.$t("wishes.addWish")),1)]),_:1}),B(ot,null,{default:te(()=>[B(Tl,{onSubmit:fe,class:"q-gutter-md"},{default:te(()=>[B(lt,{modelValue:_.name,"onUpdate:modelValue":r[3]||(r[3]=s=>_.name=s),label:i.$t("wishes.form.name"),outlined:"",rules:[s=>!!s||i.$t("wishes.form.nameRequired")]},null,8,["modelValue","label","rules"]),B(lt,{modelValue:_.description,"onUpdate:modelValue":r[4]||(r[4]=s=>_.description=s),label:i.$t("wishes.form.description"),type:"textarea",outlined:"",rows:"3"},null,8,["modelValue","label"]),B(lt,{modelValue:_.url,"onUpdate:modelValue":r[5]||(r[5]=s=>_.url=s),label:i.$t("wishes.form.url"),outlined:"",type:"url"},null,8,["modelValue","label"]),B(Yl,{modelValue:_.visibility,"onUpdate:modelValue":r[6]||(r[6]=s=>_.visibility=s),label:i.$t("wishes.form.visibility"),outlined:"",options:ye,"option-value":"value","option-label":"label","emit-value":"","map-options":""},null,8,["modelValue","label"]),j("div",Vi,[B(he,{label:i.$t("common.cancel"),color:"grey",flat:"",onClick:r[7]||(r[7]=s=>J.value=!1)},null,8,["label"]),B(he,{type:"submit",label:i.$t("common.save"),color:"primary",loading:ke(y)},null,8,["label","loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{Hi as default};
