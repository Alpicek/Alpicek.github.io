import{a as xe,u as Ve,C as g,r as h,b as Ce,x as Qe,y as N,h as m,o,e as l,f as a,A as te,g as r,z as O,t as u,p as f,ax as D,l as y,ay as De,v as A,az as ae,F as w,m as Ae,D as P,Q as z,q as T,aN as Be,ab as Ee,aF as ie,n as U,k as Ge,aE as Re,j as Ne,_ as Oe}from"./index-BR5I7U9B.js";import{a as Pe,Q as ze}from"./QSelect-CC7M6R9u.js";import{Q as Te}from"./QForm-DzuwJCeg.js";import{Q as Ue}from"./QPage-BhHXWAMh.js";import{C as je}from"./ClosePopup-ZLXO9D4Y.js";import{u as Ie}from"./auth-store-CLpI6O-q.js";import{u as Me}from"./useWishes-B7vuTOXU.js";import{supabase as Je}from"./supabase-C7Q3J7Aw.js";import{W as oe}from"./WishCard-BnhkT9mE.js";import{u as Le}from"./useGroups-BniwYyCy.js";import"./QItem-C5GHLq0T.js";import"./format-SQJMwOX7.js";import"./position-engine-ClI9_kBB.js";import"./selection-CVaP_A9r.js";import"./rtl-DFPa-2ov.js";import"./QSlideTransition-BeC8BwHB.js";import"./QBadge-DErxSnF2.js";import"./QTabs-ko1bx41e.js";import"./QResizeObserver-DZc6HSOo.js";const He={key:0,class:"flex justify-center"},Ye={key:1,class:"text-center text-grey-6 q-py-lg"},Ke={class:"text-h6 q-mt-md"},Xe={key:2},Ze={class:"row items-center justify-between q-mb-md"},es={class:"text-h4"},ss={class:"row items-center q-gutter-lg"},ts=["src"],as={key:1},is={class:"friend-details"},os={class:"text-h4"},rs={key:0,class:"text-h6 text-grey-6 q-mt-xs"},ls={key:1,class:"text-body1 text-grey-7 q-mt-md"},ns={class:"text-grey-7"},us={class:"text-subtitle2"},ds={class:"row q-col-gutter-sm"},ms={class:"wishes-section"},cs={class:"text-h5 q-my-md"},vs={key:0,class:"flex justify-center q-my-lg"},fs={key:0,class:"text-center text-grey-6 q-py-lg"},gs={class:"text-h6 q-mt-md"},ps={class:"q-mb-xl"},hs={class:"row items-center justify-between q-mb-sm"},ys={class:"text-subtitle1"},_s={class:"text-caption text-grey-6"},bs={key:0,class:"text-grey-6 text-caption q-py-sm"},ws={key:1,class:"masonry"},$s=["data-wish-id"],ks={class:"row items-center justify-between q-mb-sm"},Fs={class:"text-subtitle1"},Ws={class:"text-caption text-grey-6"},qs={key:0,class:"text-grey-6 text-caption q-py-sm"},Ss={key:1,class:"masonry"},xs=["data-wish-id"],Vs={class:"text-h6"},Cs={class:"text-h6"},Qs={key:0,class:"text-caption text-grey-6"},Ds={class:"row justify-end q-gutter-sm"},As=xe({__name:"FriendProfilePage",setup(Bs){const v=Ge(),{t:d}=Ve(),j=Re(),I=Ne(),p=Ie(),{groups:_,fetchGroups:M,addMemberToGroup:re,removeMemberFromGroup:J,fetchGroupMembers:q,membersByGroup:le}=Le(),ne=g(()=>_.value.length>0),{fetchWishes:ue,toggleBought:de,toggleReceived:me,createWish:ce,updateWish:ve,deleteWish:fe}=Me(),B=h(!0),E=h(!1),i=h(null),G=h([]),S=h(!1),x=h([]),ge=g(()=>G.value.filter(e=>e.created_by_user_id===i.value?.id)),pe=g(()=>G.value.filter(e=>e.created_by_user_id!==i.value?.id)),V=g(()=>[...ge.value].sort((e,s)=>new Date(e.created_at||0).getTime()-new Date(s.created_at||0).getTime())),C=g(()=>[...pe.value].sort((e,s)=>new Date(e.created_at||0).getTime()-new Date(s.created_at||0).getTime())),he=g(()=>j.params.id),Q=g(()=>j.query.highlight||""),F=e=>e.name&&e.surname?`${e.name} ${e.surname}`:e.username||e.email,ye=e=>e.name&&e.surname?`${e.name.charAt(0)}${e.surname.charAt(0)}`:e.username?e.username.charAt(0).toUpperCase():e.email.charAt(0).toUpperCase(),_e=(e,s)=>{const t=new Date(e),c=t.getDate(),k=t.getMonth()+1,Se=t.getFullYear();return s?`${c}. ${k}. ${Se}`:`${c}. ${k}.`},be=async()=>{try{const{data:e,error:s}=await Je.from("profiles_public").select("*").eq("id",he.value).single();if(s)throw s;i.value=e}catch(e){console.error("Error loading friend profile:",e),i.value=null}finally{B.value=!1}},W=async()=>{if(!i.value)return;E.value=!0;const e=await ue({userId:i.value.id,context:"all",isBackgroundRefresh:!0,forSelf:!1});e?.data&&(G.value=e.data),E.value=!1},$=h(!1),b=h(null),n=Ce({name:"",description:"",url:"",visibility:"friends"}),we=[{label:d("wishes.form.visibilityPublic"),value:"public"},{label:d("wishes.form.visibilityFriends"),value:"friends"},{label:d("wishes.form.visibilityPrivate"),value:"private"}],$e=()=>{i.value&&($.value=!0)},L=()=>{n.name="",n.description="",n.url="",n.visibility="friends",b.value=null},ke=async()=>{if(!p.user||!i.value)return;const e={name:n.name,...n.description&&{description:n.description},...n.url&&{url:n.url},visibility:n.visibility,created_for_user_id:i.value.id,created_by_user_id:p.user.id};let s;b.value?s=await ve(b.value,e):s=await ce(e),s.error?v.notify({type:"negative",message:d("wishes.saveError")+": "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):(v.notify({type:"positive",message:b.value?d("wishes.updateSuccess"):d("wishes.createSuccess")}),$.value=!1,L(),await W())},H=e=>{n.name=e.name,n.description=e.description||"",n.url=e.url||"",n.visibility=e.visibility,b.value=e.id,$.value=!0},Y=async e=>{const s=await fe(e);s.error?v.notify({type:"negative",message:d("wishes.deleteError")+": "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):(v.notify({type:"positive",message:d("wishes.deleteSuccess")}),await W())},Fe=()=>{i.value&&v.dialog({title:d("friends.removeFriend"),message:d("friends.removeConfirm",{name:F(i.value)}),cancel:!0,persistent:!0}).onOk(()=>{v.notify({type:"info",message:d("friends.removeNotImplemented")})})},K=async e=>{if(!p.user)return;const s=await de(e,p.user.id);s.error?v.notify({type:"negative",message:d("wishes.toggleBoughtError")+": "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):await W()},X=async e=>{if(!p.user)return;const s=await me(e,p.user.id);s.error?v.notify({type:"negative",message:d("wishes.toggleReceivedError")+": "+(typeof s.error=="string"?s.error:JSON.stringify(s.error))}):(await W(),v.notify({type:"positive",message:d("wishes.toggleReceivedSuccess")}))},Z=()=>{window.history.length>1?I.back():I.push("/app/friends")},R=g(()=>{if(!i.value)return new Set;const e=new Set;for(const s of _.value)(le.value[s.id]||[]).some(c=>c.user_id===i.value.id)&&e.add(s.id);return e}),ee=g(()=>Array.from(R.value).map(e=>{const s=_.value.find(t=>t.id===e);return{id:e,label:s?.name||e}})),se=async()=>{if(i.value){await M();for(const e of _.value)await q(e.id);x.value=Array.from(R.value),S.value=!0}},We=async e=>{if(!i.value)return;const{error:s}=await J(e,i.value.id);if(s){const t=s instanceof Error?s.message:typeof s=="string"?s:d("common.error");v.notify({type:"negative",message:t})}else await q(e),v.notify({type:"positive",message:d("groups.messages.memberRemoved")})},qe=async()=>{if(!i.value)return;const e=new Set(Array.from(R.value)),s=new Set(x.value);for(const t of s)if(!e.has(t)){const{error:c}=await re(t,i.value.id);if(c){const k=c instanceof Error?c.message:typeof c=="string"?c:d("common.error");v.notify({type:"negative",message:k})}}for(const t of e)if(!s.has(t)){const{error:c}=await J(t,i.value.id);if(c){const k=c instanceof Error?c.message:typeof c=="string"?c:d("common.error");v.notify({type:"negative",message:k})}}for(const t of _.value)await q(t.id);S.value=!1,v.notify({type:"positive",message:d("groups.messages.updated")})};return Qe(async()=>{await be(),i.value&&await W(),await M();for(const e of _.value)await q(e.id)}),(e,s)=>(o(),N(Ue,{class:"q-pa-md"},{default:m(()=>[B.value?(o(),l("div",He,[a(te,{size:"lg"})])):i.value?(o(),l("div",Xe,[r("div",Ze,[a(f,{flat:"",round:"",icon:"arrow_back",color:"primary",onClick:Z}),r("div",es,u(e.$t("friends.friendProfile")),1),s[8]||(s[8]=r("div",null,null,-1))]),a(z,{class:"friend-profile-card q-mb-lg"},{default:m(()=>[a(y,null,{default:m(()=>[r("div",ss,[a(De,{size:"120px",color:"primary","text-color":"white"},{default:m(()=>[i.value.avatar_url?(o(),l("img",{key:0,src:i.value.avatar_url},null,8,ts)):(o(),l("span",as,u(ye(i.value)),1))]),_:1}),r("div",is,[r("div",os,u(F(i.value)),1),i.value.username?(o(),l("div",rs," @"+u(i.value.username),1)):D("",!0),i.value.date_of_birth?(o(),l("div",ls,[a(O,{name:"cake",size:"20px",class:"q-mr-xs"}),A(" "+u(_e(i.value.date_of_birth,i.value.birth_year_visible??!1)),1)])):D("",!0)])])]),_:1}),a(ae,{align:"center",class:"q-gutter-md"},{default:m(()=>[a(f,{color:"primary",icon:"add_circle",label:e.$t("wishes.addForFriend"),onClick:$e},null,8,["label"]),a(f,{color:"negative",outline:"",icon:"person_remove",label:e.$t("friends.removeFriend"),onClick:Fe},null,8,["label"])]),_:1}),ne.value?(o(),l(w,{key:0},[a(Ae),ee.value.length===0?(o(),N(y,{key:0,class:"row items-center justify-between"},{default:m(()=>[r("div",ns,u(e.$t("groups.noMemberships")),1),a(f,{size:"sm",flat:"",icon:"group_add",label:e.$t("groups.manage"),onClick:se},null,8,["label"])]),_:1})):(o(),l(w,{key:1},[a(y,{class:"row items-center justify-between"},{default:m(()=>[r("div",us,u(e.$t("groups.memberships")),1),a(f,{size:"sm",flat:"",icon:"group_add",label:e.$t("groups.manage"),onClick:se},null,8,["label"])]),_:1}),a(y,null,{default:m(()=>[r("div",ds,[(o(!0),l(w,null,P(ee.value,t=>(o(),N(Pe,{key:t.id,color:"primary","text-color":"white",removable:"",onRemove:c=>We(t.id)},{default:m(()=>[A(u(t.label),1)]),_:2},1032,["onRemove"]))),128))])]),_:1})],64))],64)):D("",!0)]),_:1}),r("div",ms,[r("div",cs,u(e.$t("friends.friendWishes",{name:F(i.value)})),1),E.value?(o(),l("div",vs,[a(te,{size:"lg"})])):(o(),l(w,{key:1},[V.value.length===0&&C.value.length===0?(o(),l("div",fs,[a(O,{name:"card_giftcard",size:"4rem"}),r("div",gs,u(e.$t("wishes.noWishes")),1),r("div",null,u(e.$t("friends.friendHasNoWishes")),1)])):(o(),l(w,{key:1},[r("div",ps,[r("div",hs,[r("div",ys,[A(u(e.$t("wishes.friendOwnWishes"))+" ",1),r("span",_s,"("+u(V.value.length)+")",1)])]),V.value.length===0?(o(),l("div",bs,u(e.$t("wishes.noFriendOwnWishes")),1)):(o(),l("div",ws,[(o(!0),l(w,null,P(V.value,t=>(o(),l("div",{key:t.id,class:"masonry-item","data-wish-id":t.id},[a(oe,{wish:t,"current-user-id":T(p).user?.id,expanded:t.id===Q.value,highlight:t.id===Q.value,onEdit:H,onDelete:Y,onToggleBought:K,onToggleReceived:X},null,8,["wish","current-user-id","expanded","highlight"])],8,$s))),128))]))]),r("div",null,[r("div",ks,[r("div",Fs,[A(u(e.$t("wishes.friendSuggestedWishes"))+" ",1),r("span",Ws,"("+u(C.value.length)+")",1)])]),C.value.length===0?(o(),l("div",qs,u(e.$t("wishes.noFriendSuggestedWishes")),1)):(o(),l("div",Ss,[(o(!0),l(w,null,P(C.value,t=>(o(),l("div",{key:t.id,class:"masonry-item","data-wish-id":t.id},[a(oe,{wish:t,"current-user-id":T(p).user?.id,expanded:t.id===Q.value,highlight:t.id===Q.value,onEdit:H,onDelete:Y,onToggleBought:K,onToggleReceived:X},null,8,["wish","current-user-id","expanded","highlight"])],8,xs))),128))]))])],64))],64))])])):(o(),l("div",Ye,[a(O,{name:"person_off",size:"4rem"}),r("div",Ke,u(e.$t("friends.friendNotFound")),1),r("div",null,u(e.$t("friends.friendNotFoundDesc")),1),a(f,{color:"primary",label:e.$t("common.back"),class:"q-mt-md",onClick:Z},null,8,["label"])])),a(ie,{modelValue:S.value,"onUpdate:modelValue":s[1]||(s[1]=t=>S.value=t)},{default:m(()=>[a(z,{style:{width:"520px","max-width":"90vw"}},{default:m(()=>[a(y,null,{default:m(()=>[r("div",Vs,u(e.$t("groups.manageFor",{name:i.value?F(i.value):""})),1)]),_:1}),a(y,null,{default:m(()=>[a(Be,{modelValue:x.value,"onUpdate:modelValue":s[0]||(s[0]=t=>x.value=t),type:"checkbox",options:T(_).map(t=>({label:t.name,value:t.id}))},null,8,["modelValue","options"])]),_:1}),a(ae,{align:"right"},{default:m(()=>[Ee(a(f,{flat:"",label:e.$t("common.cancel")},null,8,["label"]),[[je]]),a(f,{color:"primary",label:e.$t("common.save"),onClick:qe},null,8,["label"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(ie,{modelValue:$.value,"onUpdate:modelValue":s[7]||(s[7]=t=>$.value=t),onHide:L},{default:m(()=>[a(z,{style:{width:"100%","max-width":"500px"}},{default:m(()=>[a(y,null,{default:m(()=>[r("div",Cs,u(b.value?e.$t("wishes.editWish"):e.$t("wishes.addForFriend")),1),i.value?(o(),l("div",Qs,u(b.value?e.$t("wishes.editingWish"):e.$t("wishes.addingForUser",{name:F(i.value)})),1)):D("",!0)]),_:1}),a(y,null,{default:m(()=>[a(Te,{onSubmit:ke,class:"q-gutter-md"},{default:m(()=>[a(U,{modelValue:n.name,"onUpdate:modelValue":s[2]||(s[2]=t=>n.name=t),label:e.$t("wishes.form.name"),outlined:"",rules:[t=>!!t||e.$t("wishes.form.nameRequired")]},null,8,["modelValue","label","rules"]),a(U,{modelValue:n.description,"onUpdate:modelValue":s[3]||(s[3]=t=>n.description=t),label:e.$t("wishes.form.description"),type:"textarea",outlined:"",rows:"3"},null,8,["modelValue","label"]),a(U,{modelValue:n.url,"onUpdate:modelValue":s[4]||(s[4]=t=>n.url=t),label:e.$t("wishes.form.url"),outlined:"",type:"url"},null,8,["modelValue","label"]),a(ze,{modelValue:n.visibility,"onUpdate:modelValue":s[5]||(s[5]=t=>n.visibility=t),label:e.$t("wishes.form.visibility"),outlined:"",options:we,"option-value":"value","option-label":"label","emit-value":"","map-options":""},null,8,["modelValue","label"]),r("div",Ds,[a(f,{label:e.$t("common.cancel"),color:"grey",flat:"",onClick:s[6]||(s[6]=t=>$.value=!1)},null,8,["label"]),a(f,{type:"submit",label:e.$t("common.save"),color:"primary",loading:B.value},null,8,["label","loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),et=Oe(As,[["__scopeId","data-v-fbf60012"]]);export{et as default};
