import{a as j,n as H,c as w,o as m,e,p as P,aq as V,Q as q,f as o,g,h as u,t as d,l as n,x as N,at as de,k as _,z as me,r as k,i as J,aC as W,j as h,m as M,as as fe,ar as ce,q as ve,aA as X,aK as be,aL as pe,b as ye,au as ge}from"./index-DywPtqBD.js";import{Q as O}from"./QForm-Wlgf5_Ag.js";import{Q as _e}from"./QPage-ByQ-y1Qk.js";import{u as x}from"./use-quasar-Dhk6w8yX.js";import{u as ee}from"./auth-store-CFwI7z_J.js";import{a as z,Q as $e}from"./QSelect-N7IH0-wA.js";import{u as he,Q as Pe}from"./usePushNotifications-HE8bcVDk.js";import{u as T}from"./vue-i18n.runtime-DTWan08Y.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{Q as Ve,a as ke,b as Z}from"./QItem-vYT0oGEd.js";import{u as we}from"./useDummyProfiles-CzJMFbj5.js";import{u as qe}from"./useFriends-BJDuLRcu.js";import"./supabase-bByfhSrO.js";import"./format-D1-ZXYq9.js";import"./position-engine-Bcn4MC3v.js";import"./selection-BlIRqF8l.js";import"./rtl-DFPa-2ov.js";const Se={class:"q-pa-md"},Ce={class:"text-h6 q-mb-md"},Ue={class:"q-mb-md"},Qe={key:0,class:"q-mb-md"},De={key:1,class:"q-mb-md"},Fe={class:"text-h6 q-mb-md"},Ne={class:"text-body2 text-grey-6"},Ee=j({__name:"NotificationSettings",setup(Y){const{t:c}=T(),i=he();H(async()=>{await i.initialize()});const f=()=>{switch(i.permission.value){case"granted":return"positive";case"denied":return"negative";default:return"warning"}},s=()=>{switch(i.permission.value){case"granted":return"check_circle";case"denied":return"block";default:return"help"}},S=()=>{switch(i.permission.value){case"granted":return c("notifications.permissionGranted");case"denied":return c("notifications.permissionDenied");default:return c("notifications.permissionDefault")}},Q=async()=>{try{await i.requestPermission()}catch{}},C=async()=>{try{await i.subscribe()}catch{}},D=async()=>{try{await i.unsubscribe()}catch{}};return(p,E)=>(m(),w("div",Se,[e(q,{class:"q-mb-md"},{default:o(()=>[e(g,null,{default:o(()=>[u("div",Ce,d(p.$t("notifications.title")),1),u("div",Ue,[e(z,{color:n(i).isSupported.value?"positive":"negative","text-color":"white",icon:n(i).isSupported.value?"check_circle":"error"},{default:o(()=>[N(d(n(i).isSupported.value?p.$t("notifications.supported"):p.$t("notifications.notSupported")),1)]),_:1},8,["color","icon"])]),n(i).isSupported.value?(m(),w("div",Qe,[e(z,{color:f(),"text-color":"white",icon:s()},{default:o(()=>[N(d(S()),1)]),_:1},8,["color","icon"])])):V("",!0),n(i).isSupported.value?(m(),w("div",De,[e(z,{color:n(i).isSubscribed.value?"positive":"grey","text-color":"white",icon:n(i).isSubscribed.value?"notifications_active":"notifications_off"},{default:o(()=>[N(d(n(i).isSubscribed.value?p.$t("notifications.subscribed"):p.$t("notifications.notSubscribed")),1)]),_:1},8,["color","icon"])])):V("",!0)]),_:1}),n(i).isSupported.value?(m(),P(de,{key:0,align:"around"},{default:o(()=>[n(i).needsPermission?(m(),P(_,{key:0,color:"primary",icon:"notifications",label:p.$t("notifications.requestPermission"),onClick:Q,loading:n(i).isLoading.value},null,8,["label","loading"])):V("",!0),n(i).canSubscribe&&!n(i).isSubscribed.value?(m(),P(_,{key:1,color:"positive",icon:"notifications_active",label:p.$t("notifications.subscribe"),onClick:C,loading:n(i).isLoading.value},null,8,["label","loading"])):V("",!0),n(i).isSubscribed?(m(),P(_,{key:2,color:"negative",icon:"notifications_off",label:p.$t("notifications.unsubscribe"),onClick:D,loading:n(i).isLoading.value},null,8,["label","loading"])):V("",!0)]),_:1})):V("",!0)]),_:1}),n(i).isSubscribed?(m(),P(q,{key:0},{default:o(()=>[e(g,null,{default:o(()=>[u("div",Fe,d(p.$t("notifications.history")),1),u("div",Ne,d(p.$t("notifications.historyEmpty")),1)]),_:1})]),_:1})):V("",!0)]))}}),Ae=le(Ee,[["__scopeId","data-v-9ba282eb"]]),Be={class:"text-h6 q-mb-md"},Ie={class:"text-body2 text-grey-7"},Le={class:"text-subtitle1 q-mb-md"},ze={class:"row q-gutter-sm"},Me={class:"text-subtitle1 q-mb-md"},Oe={class:"q-gutter-md"},je={class:"col"},He={class:"text-subtitle2"},Te={key:0,class:"text-caption text-grey-7"},Ye={key:1,class:"text-caption text-grey-7"},Ge={key:2,class:"text-caption text-grey-7"},Ke={class:"col-auto"},Re={class:"text-center text-grey-7 q-py-lg"},Je={class:"text-h6"},We={class:"row q-gutter-sm justify-end"},Xe={class:"text-h6"},Ze={class:"row q-gutter-sm justify-end q-mt-md"},xe=j({__name:"DummyProfileManager",setup(Y){const c=x(),{t:i}=T(),f=ee(),s=me(()=>f.user),{isLoading:S,createDummyProfile:Q,fetchManagedDummyProfiles:C,updateDummyProfile:D,deleteDummyProfile:p,suggestDummyProfileAsFriend:E}=we(),{fetchEligibleUsersForDummySuggestion:r}=qe(),v=k(!1),y=k(!1),F=k(!1),A=k([]),b=k(null),B=k(null),G=k([]),U=k(null),L=k(!1),$=k({name:"",surname:"",username:"",email:"",date_of_birth:"",birth_year_visible:!1}),te=()=>{$.value={name:"",surname:"",username:"",email:"",date_of_birth:"",birth_year_visible:!1}},K=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),ae=t=>new Date(t).toLocaleDateString(),I=async()=>{if(!s.value?.id)return;const{data:t}=await C(s.value.id);t&&(A.value=t)},ie=async()=>{if(!s.value?.id)return;const{data:t,error:a}=await Q(s.value.id,$.value);if(a){c.notify({color:"negative",message:i("dummyProfiles.errors.createFailed"),icon:"error"});return}t&&(c.notify({color:"positive",message:i("dummyProfiles.messages.created"),icon:"check"}),te(),v.value=!1,await I())},oe=t=>{b.value={...t},y.value=!0},se=async()=>{if(!b.value)return;const{data:t,error:a}=await D(b.value.id,b.value);if(a){c.notify({color:"negative",message:i("dummyProfiles.errors.updateFailed"),icon:"error"});return}t&&(c.notify({color:"positive",message:i("dummyProfiles.messages.updated"),icon:"check"}),y.value=!1,await I())},re=t=>{c.dialog({title:i("dummyProfiles.confirmDelete.title"),message:i("dummyProfiles.confirmDelete.message",{name:t.name}),cancel:!0,persistent:!0}).onOk(()=>{(async()=>{if(!s.value?.id)return;const{error:a}=await p(t.id,s.value.id);if(a){c.notify({color:"negative",message:i("dummyProfiles.errors.deleteFailed"),icon:"error"});return}c.notify({color:"positive",message:i("dummyProfiles.messages.deleted"),icon:"check"}),await I()})()})},ne=async t=>{if(B.value=t,L.value=!0,F.value=!0,s.value?.id){const{data:a}=await r(t.id,s.value.id);a&&(G.value=a)}L.value=!1},ue=async()=>{if(!s.value?.id||!B.value||!U.value)return;const{error:t}=await E(B.value.id,U.value,s.value.id);if(t){c.notify({color:"negative",message:i("dummyProfiles.errors.suggestionFailed"),icon:"error"});return}c.notify({color:"positive",message:i("dummyProfiles.messages.suggested"),icon:"check"}),F.value=!1,U.value=null,B.value=null};return H(()=>{I()}),(t,a)=>(m(),P(q,{class:"dummy-profile-manager"},{default:o(()=>[e(g,null,{default:o(()=>[u("div",Be,d(t.$t("dummyProfiles.title")),1),u("p",Ie,d(t.$t("dummyProfiles.description")),1)]),_:1}),e(J),v.value?(m(),P(g,{key:0},{default:o(()=>[u("div",Le,d(t.$t("dummyProfiles.createNew")),1),e(O,{onSubmit:W(ie,["prevent"]),class:"q-gutter-md"},{default:o(()=>[e(h,{modelValue:$.value.name,"onUpdate:modelValue":a[0]||(a[0]=l=>$.value.name=l),label:t.$t("dummyProfiles.form.name"),filled:"",rules:[l=>!!l||t.$t("validation.required")],required:""},null,8,["modelValue","label","rules"]),e(h,{modelValue:$.value.surname,"onUpdate:modelValue":a[1]||(a[1]=l=>$.value.surname=l),label:t.$t("dummyProfiles.form.surname"),filled:""},null,8,["modelValue","label"]),e(h,{modelValue:$.value.username,"onUpdate:modelValue":a[2]||(a[2]=l=>$.value.username=l),label:t.$t("dummyProfiles.form.username"),filled:"",hint:t.$t("dummyProfiles.form.usernameHint")},null,8,["modelValue","label","hint"]),e(h,{modelValue:$.value.email,"onUpdate:modelValue":a[3]||(a[3]=l=>$.value.email=l),label:t.$t("dummyProfiles.form.email"),type:"email",filled:"",hint:t.$t("dummyProfiles.form.emailHint"),rules:[l=>!l||K(l)||t.$t("validation.invalidEmail")]},null,8,["modelValue","label","hint","rules"]),e(h,{modelValue:$.value.date_of_birth,"onUpdate:modelValue":a[4]||(a[4]=l=>$.value.date_of_birth=l),label:t.$t("dummyProfiles.form.dateOfBirth"),type:"date",filled:""},null,8,["modelValue","label"]),e(M,{modelValue:$.value.birth_year_visible,"onUpdate:modelValue":a[5]||(a[5]=l=>$.value.birth_year_visible=l),label:t.$t("dummyProfiles.form.birthYearVisible")},null,8,["modelValue","label"]),u("div",ze,[e(_,{type:"submit",color:"primary",label:t.$t("common.create"),loading:n(S)},null,8,["label","loading"]),e(_,{flat:"",label:t.$t("common.cancel"),onClick:a[6]||(a[6]=l=>v.value=!1)},null,8,["label"])])]),_:1})]),_:1})):(m(),P(g,{key:1},{default:o(()=>[e(_,{color:"primary",label:t.$t("dummyProfiles.createNew"),icon:"add",onClick:a[7]||(a[7]=l=>v.value=!0)},null,8,["label"])]),_:1})),A.value.length>0?(m(),P(J,{key:2})):V("",!0),A.value.length>0?(m(),P(g,{key:3},{default:o(()=>[u("div",Me,d(t.$t("dummyProfiles.yourProfiles")),1),u("div",Oe,[(m(!0),w(ce,null,fe(A.value,l=>(m(),P(q,{key:l.id,flat:"",bordered:"",class:"dummy-profile-item"},{default:o(()=>[e(g,{class:"row items-center"},{default:o(()=>[u("div",je,[u("div",He,d(l.name)+" "+d(l.surname),1),l.username?(m(),w("div",Te," @"+d(l.username),1)):V("",!0),l.email&&!l.email.includes("@dummy.local")?(m(),w("div",Ye,d(l.email),1)):V("",!0),l.date_of_birth?(m(),w("div",Ge,d(ae(l.date_of_birth)),1)):V("",!0)]),u("div",Ke,[e(Pe,{flat:""},{default:o(()=>[e(_,{flat:"",icon:"edit",size:"sm",title:t.$t("common.edit"),onClick:R=>oe(l)},null,8,["title","onClick"]),e(_,{flat:"",icon:"share",size:"sm",title:t.$t("dummyProfiles.suggestAsFriend"),onClick:R=>ne(l)},null,8,["title","onClick"]),e(_,{flat:"",icon:"delete",size:"sm",color:"negative",title:t.$t("common.delete"),onClick:R=>re(l)},null,8,["title","onClick"])]),_:2},1024)])]),_:2},1024)]),_:2},1024))),128))])]),_:1})):v.value?V("",!0):(m(),P(g,{key:4},{default:o(()=>[u("div",Re,[e(ve,{name:"person_add_disabled",size:"3rem",class:"q-mb-md"}),u("div",null,d(t.$t("dummyProfiles.noProfiles")),1)])]),_:1})),e(X,{modelValue:y.value,"onUpdate:modelValue":a[15]||(a[15]=l=>y.value=l),persistent:""},{default:o(()=>[e(q,{style:{width:"400px"}},{default:o(()=>[e(g,null,{default:o(()=>[u("div",Je,d(t.$t("dummyProfiles.editProfile")),1)]),_:1}),b.value?(m(),P(g,{key:0},{default:o(()=>[e(O,{onSubmit:W(se,["prevent"]),class:"q-gutter-md"},{default:o(()=>[e(h,{modelValue:b.value.name,"onUpdate:modelValue":a[8]||(a[8]=l=>b.value.name=l),label:t.$t("dummyProfiles.form.name"),filled:"",rules:[l=>!!l||t.$t("validation.required")],required:""},null,8,["modelValue","label","rules"]),e(h,{modelValue:b.value.surname,"onUpdate:modelValue":a[9]||(a[9]=l=>b.value.surname=l),label:t.$t("dummyProfiles.form.surname"),filled:""},null,8,["modelValue","label"]),e(h,{modelValue:b.value.username,"onUpdate:modelValue":a[10]||(a[10]=l=>b.value.username=l),label:t.$t("dummyProfiles.form.username"),filled:""},null,8,["modelValue","label"]),e(h,{modelValue:b.value.email,"onUpdate:modelValue":a[11]||(a[11]=l=>b.value.email=l),label:t.$t("dummyProfiles.form.email"),type:"email",filled:"",hint:t.$t("dummyProfiles.form.emailHint"),rules:[l=>!l||K(l)||t.$t("validation.invalidEmail")]},null,8,["modelValue","label","hint","rules"]),e(h,{modelValue:b.value.date_of_birth,"onUpdate:modelValue":a[12]||(a[12]=l=>b.value.date_of_birth=l),label:t.$t("dummyProfiles.form.dateOfBirth"),type:"date",filled:""},null,8,["modelValue","label"]),e(M,{modelValue:b.value.birth_year_visible,"onUpdate:modelValue":a[13]||(a[13]=l=>b.value.birth_year_visible=l),label:t.$t("dummyProfiles.form.birthYearVisible")},null,8,["modelValue","label"]),u("div",We,[e(_,{flat:"",label:t.$t("common.cancel"),onClick:a[14]||(a[14]=l=>y.value=!1)},null,8,["label"]),e(_,{type:"submit",color:"primary",label:t.$t("common.save"),loading:n(S)},null,8,["label","loading"])])]),_:1})]),_:1})):V("",!0)]),_:1})]),_:1},8,["modelValue"]),e(X,{modelValue:F.value,"onUpdate:modelValue":a[18]||(a[18]=l=>F.value=l),persistent:""},{default:o(()=>[e(q,{style:{width:"400px"}},{default:o(()=>[e(g,null,{default:o(()=>[u("div",Xe,d(t.$t("dummyProfiles.suggestProfile")),1)]),_:1}),e(g,null,{default:o(()=>[e($e,{modelValue:U.value,"onUpdate:modelValue":a[16]||(a[16]=l=>U.value=l),options:G.value,label:t.$t("dummyProfiles.selectFriend"),"option-label":"name","option-value":"id",filled:"","emit-value":"","map-options":"",loading:L.value},{option:o(l=>[e(Ve,be(pe(l.itemProps)),{default:o(()=>[e(ke,null,{default:o(()=>[e(Z,null,{default:o(()=>[N(d(l.opt.name)+" "+d(l.opt.surname),1)]),_:2},1024),e(Z,{caption:""},{default:o(()=>[N(d(l.opt.email),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","label","loading"]),u("div",Ze,[e(_,{flat:"",label:t.$t("common.cancel"),onClick:a[17]||(a[17]=l=>F.value=!1)},null,8,["label"]),e(_,{color:"primary",label:t.$t("dummyProfiles.sendSuggestion"),loading:n(S),disable:!U.value,onClick:ue},null,8,["label","loading","disable"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),el=le(xe,[["__scopeId","data-v-13d2436e"]]),ll={class:"text-h4 q-mb-md"},tl={class:"row justify-center"},al={class:"col-12 col-md-6"},il=["src"],ol={key:1},sl={class:"text-h5 q-mt-md"},rl={key:0,class:"text-subtitle1 text-grey-6"},nl={class:"text-body2 text-grey-7"},ul={class:"row justify-end q-gutter-sm"},dl={class:"text-h6 q-mb-md"},ml={class:"q-mt-md"},Ul=j({__name:"ProfilePage",setup(Y){const c=x(),{t:i}=T(),f=ee(),s=ye({name:"",surname:"",username:"",date_of_birth:"",birth_year_visible:!1}),S=r=>r?r.name&&r.surname?`${r.name} ${r.surname}`:r.username||r.email:"",Q=r=>r?r.name&&r.surname?`${r.name.charAt(0)}${r.surname.charAt(0)}`:r.username?r.username.charAt(0).toUpperCase():r.email.charAt(0).toUpperCase():"",C=r=>s.username?!0:!!r||i("profile.validationError"),D=r=>s.name&&s.surname?!0:!!r||i("profile.validationError"),p=()=>{f.profile&&(s.name=f.profile.name||"",s.surname=f.profile.surname||"",s.username=f.profile.username||"",s.date_of_birth=f.profile.date_of_birth||"",s.birth_year_visible=f.profile.birth_year_visible??!1)},E=async()=>{if(!s.username&&(!s.name||!s.surname)){c.notify({type:"negative",message:i("profile.validationError")});return}const r={name:s.name||null,surname:s.surname||null,username:s.username||null,date_of_birth:s.date_of_birth||null,birth_year_visible:s.birth_year_visible};await f.updateProfile(r)?c.notify({type:"positive",message:i("profile.updateSuccess")}):c.notify({type:"negative",message:i("profile.updateError")})};return H(()=>{p()}),(r,v)=>(m(),P(_e,{class:"q-pa-md"},{default:o(()=>[u("div",ll,d(r.$t("profile.title")),1),u("div",tl,[u("div",al,[e(q,null,{default:o(()=>[e(g,{class:"text-center"},{default:o(()=>[e(ge,{size:"100px",color:"primary","text-color":"white"},{default:o(()=>[n(f).profile?.avatar_url?(m(),w("img",{key:0,src:n(f).profile.avatar_url},null,8,il)):(m(),w("span",ol,d(Q(n(f).profile)),1))]),_:1}),u("div",sl,d(S(n(f).profile)),1),n(f).profile?.username?(m(),w("div",rl," @"+d(n(f).profile.username),1)):V("",!0),u("div",nl,d(n(f).profile?.email),1)]),_:1}),e(g,null,{default:o(()=>[e(O,{onSubmit:E,class:"q-gutter-md"},{default:o(()=>[e(h,{modelValue:s.name,"onUpdate:modelValue":v[0]||(v[0]=y=>s.name=y),label:r.$t("common.name"),outlined:"",rules:[C]},null,8,["modelValue","label","rules"]),e(h,{modelValue:s.surname,"onUpdate:modelValue":v[1]||(v[1]=y=>s.surname=y),label:r.$t("common.surname"),outlined:"",rules:[C]},null,8,["modelValue","label","rules"]),e(h,{modelValue:s.username,"onUpdate:modelValue":v[2]||(v[2]=y=>s.username=y),label:r.$t("common.username"),outlined:"",rules:[D]},null,8,["modelValue","label","rules"]),e(h,{modelValue:s.date_of_birth,"onUpdate:modelValue":v[3]||(v[3]=y=>s.date_of_birth=y),label:r.$t("profile.dateOfBirth"),type:"date",outlined:""},null,8,["modelValue","label"]),e(M,{modelValue:s.birth_year_visible,"onUpdate:modelValue":v[4]||(v[4]=y=>s.birth_year_visible=y),label:r.$t("profile.showBirthYear")},null,8,["modelValue","label"]),u("div",ul,[e(_,{label:r.$t("common.cancel"),color:"grey",flat:"",onClick:p},null,8,["label"]),e(_,{type:"submit",label:r.$t("common.save"),color:"primary",loading:n(f).isLoading},null,8,["label","loading"])])]),_:1})]),_:1})]),_:1}),e(q,{class:"q-mt-md"},{default:o(()=>[e(g,null,{default:o(()=>[u("div",dl,d(r.$t("notifications.title")),1),e(Ae)]),_:1})]),_:1}),u("div",ml,[e(el)])])])]),_:1}))}});export{Ul as default};
