import{a as m,Q as x}from"./QCard-Byebvgyq.js";import{Q as w}from"./QSeparator-sfXeXTnE.js";import{a as T,r as v,b as N,i as D,w as c,o as q,f as d,e as t,c as R,a1 as A,t as u,g as F,Q as p,_ as S,j as V}from"./index-MmE2OoPn.js";import{Q as f}from"./QInput-Cpy9WV9V.js";import{Q as $}from"./QForm-jeooTY-u.js";import{Q as P}from"./QPage-CER6tfTV.js";import{u as W}from"./use-quasar-CdazeEAi.js";import{u as I}from"./usePushNotifications-c8sJjhLS.js";import{u as L}from"./auth-store-XB83oEbh.js";import{supabase as O}from"./supabase-DumeQkYe.js";import{N as j}from"./NotificationSettings-zcOsY2YC.js";import{u as J}from"./vue-i18n.runtime-s6xTsf43.js";import"./use-dark-CpKIw5E7.js";import"./focus-manager-B0Knlyhr.js";import"./QChip-DKCLvb4y.js";import"./QCardActions-CT0a0cBa.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const z={class:"q-pa-md",style:{"max-width":"600px",width:"100%"}},G={class:"text-h4 text-center q-mb-md"},H={class:"text-body1 text-center text-grey-6 q-mb-lg"},K={key:0},M={class:"text-h6 q-mb-md"},X={class:"q-gutter-md"},Y={class:"text-h6 q-mb-md"},Z={class:"text-h6 q-mb-md text-warning"},ii={class:"bg-warning text-dark q-pa-md rounded-borders"},hi=T({__name:"NotificationsPage",setup(ti){const b=W(),{t:e}=J(),a=I(),C=L(),s=v(!1),g=v(!1),l=N({title:"",body:"",url:""}),r=N({title:"",body:"",url:""}),Q=async()=>{if(a.isSubscribed.value){s.value=!0;try{const i=await a.getCurrentSubscription();if(!i)throw new Error("No subscription found");await a.sendNotification(i,{title:l.title,body:l.body,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",tag:"custom-notification",data:{type:"custom",url:l.url||"/",timestamp:Date.now()}}),l.title="",l.body="",l.url=""}catch(i){console.error("Error sending custom notification:",i)}finally{s.value=!1}}},B=async()=>{if(a.isSubscribed.value){s.value=!0;try{const i=await a.getCurrentSubscription();if(!i)throw new Error("No subscription found");await a.sendNotification(i,{title:e("notifications.wishNotificationTitle"),body:e("notifications.wishNotificationBody"),icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",tag:"new-wish",data:{type:"wish",url:"/wishes",timestamp:Date.now()},actions:[{action:"view",title:e("notifications.viewWishes")},{action:"dismiss",title:e("common.close")}]})}catch(i){console.error("Error sending wish notification:",i)}finally{s.value=!1}}},E=async()=>{if(a.isSubscribed.value){s.value=!0;try{const i=await a.getCurrentSubscription();if(!i)throw new Error("No subscription found");await a.sendNotification(i,{title:e("notifications.friendRequestTitle"),body:e("notifications.friendRequestBody"),icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",tag:"friend-request",data:{type:"friend-request",url:"/friends",timestamp:Date.now()},actions:[{action:"view",title:e("notifications.viewFriends")},{action:"dismiss",title:e("common.close")}]})}catch(i){console.error("Error sending friend request notification:",i)}finally{s.value=!1}}},k=async()=>{if(console.log("Notification permission:",Notification.permission),Notification.permission==="granted"&&new Notification("Test",{body:"Simple notification test"}),console.log("Sending birthday notification...",a),!!a.isSubscribed){s.value=!0;try{const i=await a.getCurrentSubscription();if(console.log("Subscription found:",i),!i)throw new Error("No subscription found");await a.sendNotification(i,{title:e("notifications.birthdayTitle"),body:e("notifications.birthdayBody"),icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",tag:"birthday",data:{type:"birthday",url:"/friends",timestamp:Date.now()},actions:[{action:"view",title:e("notifications.viewProfile")},{action:"dismiss",title:e("common.close")}]})}catch(i){console.error("Error sending birthday notification:",i)}finally{s.value=!1}}},U=async()=>{g.value=!0;try{const{data:i,error:n}=await O.from("push_subscriptions").select("subscription_data").eq("is_active",!0);if(n)throw n;if(!i||i.length===0){b.notify({type:"warning",message:e("notifications.noSubscriptions"),timeout:3e3});return}let o=0,h=0;for(const _ of i)try{const y={toJSON:()=>_.subscription_data};await a.sendNotification(y,{title:r.title,body:r.body,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",tag:"admin-broadcast",data:{type:"admin-broadcast",url:r.url||"/",timestamp:Date.now()}}),o++}catch(y){console.error("Error sending to subscription:",y),h++}b.notify({type:o>0?"positive":"negative",message:e("notifications.broadcastResult",{success:o,errors:h}),timeout:5e3}),o>0&&(r.title="",r.body="",r.url="")}catch(i){console.error("Error sending admin notification:",i),b.notify({type:"negative",message:e("notifications.broadcastError"),timeout:5e3})}finally{g.value=!1}};return(i,n)=>(q(),D(P,{class:"flex flex-center"},{default:c(()=>[d("div",z,[t(x,null,{default:c(()=>[t(m,null,{default:c(()=>[d("div",G,u(i.$t("notifications.title")),1),d("div",H,u(i.$t("notifications.pageDescription")),1)]),_:1}),t(m,null,{default:c(()=>[t(j)]),_:1}),F(C).user?.email==="pichalek@gmail.com"?(q(),R("div",K,[t(m,null,{default:c(()=>[t(w,{class:"q-mb-md"}),d("div",M,u(i.$t("notifications.quickActions")),1),d("div",X,[t(p,{color:"primary",icon:"card_giftcard",label:i.$t("notifications.notifyNewWish"),onClick:B,loading:s.value,class:"full-width"},null,8,["label","loading"]),t(p,{color:"secondary",icon:"group",label:i.$t("notifications.notifyFriendRequest"),onClick:E,loading:s.value,class:"full-width"},null,8,["label","loading"]),t(p,{color:"accent",icon:"celebration",label:i.$t("notifications.notifyBirthday"),onClick:k,loading:s.value,class:"full-width"},null,8,["label","loading"])])]),_:1}),t(m,null,{default:c(()=>[t(w,{class:"q-mb-md"}),d("div",Y,u(i.$t("notifications.customNotification")),1),t($,{onSubmit:Q,class:"q-gutter-md"},{default:c(()=>[t(f,{modelValue:l.title,"onUpdate:modelValue":n[0]||(n[0]=o=>l.title=o),label:i.$t("notifications.notificationTitle"),outlined:"",rules:[o=>!!o||i.$t("common.required")]},null,8,["modelValue","label","rules"]),t(f,{modelValue:l.body,"onUpdate:modelValue":n[1]||(n[1]=o=>l.body=o),label:i.$t("notifications.notificationBody"),outlined:"",type:"textarea",rows:"3",rules:[o=>!!o||i.$t("common.required")]},null,8,["modelValue","label","rules"]),t(f,{modelValue:l.url,"onUpdate:modelValue":n[2]||(n[2]=o=>l.url=o),label:i.$t("notifications.targetUrl"),outlined:"",placeholder:"/wishes",hint:"Optional URL to open when notification is clicked"},null,8,["modelValue","label"]),t(p,{type:"submit",color:"primary",icon:"send",label:i.$t("notifications.sendCustom"),loading:s.value,class:"full-width"},null,8,["label","loading"])]),_:1})]),_:1}),t(m,null,{default:c(()=>[t(w,{class:"q-mb-md"}),d("div",Z,[t(V,{name:"admin_panel_settings",class:"q-mr-sm"}),S(" "+u(i.$t("notifications.adminSection")),1)]),t($,{onSubmit:U,class:"q-gutter-md"},{default:c(()=>[t(f,{modelValue:r.title,"onUpdate:modelValue":n[3]||(n[3]=o=>r.title=o),label:i.$t("notifications.notificationTitle"),outlined:"",rules:[o=>!!o||i.$t("common.required")]},null,8,["modelValue","label","rules"]),t(f,{modelValue:r.body,"onUpdate:modelValue":n[4]||(n[4]=o=>r.body=o),label:i.$t("notifications.notificationBody"),outlined:"",type:"textarea",rows:"3",rules:[o=>!!o||i.$t("common.required")]},null,8,["modelValue","label","rules"]),t(f,{modelValue:r.url,"onUpdate:modelValue":n[5]||(n[5]=o=>r.url=o),label:i.$t("notifications.targetUrl"),outlined:"",placeholder:"/"},null,8,["modelValue","label"]),d("div",ii,[t(V,{name:"warning",class:"q-mr-sm"}),S(" "+u(i.$t("notifications.adminWarning")),1)]),t(p,{type:"submit",color:"warning",icon:"campaign",label:i.$t("notifications.sendToAll"),loading:g.value,class:"full-width"},null,8,["label","loading"])]),_:1})]),_:1})])):A("",!0)]),_:1})])]),_:1}))}});export{hi as default};
