import{E as G,a4 as J,a6 as O,K as j,C as B,G as W,H as X,a as Y,k as Z,u as ee,r as v,w as A,y as I,o as d,h as t,f as a,Q as ae,l as D,g as R,t as y,e as k,ax as z,n as te,aQ as ne,p as C,z as le,F as N,D as T,ay as se,v as $,aP as re,az as ie,aF as ue}from"./index-BR5I7U9B.js";import{Q as E,a as c,b as Q}from"./QItem-C5GHLq0T.js";import{Q as K}from"./QList-D9VkAbJk.js";const oe=["text","rect","circle","QBtn","QBadge","QChip","QToolbar","QCheckbox","QRadio","QToggle","QSlider","QRange","QInput","QAvatar"],de=["wave","pulse","pulse-x","pulse-y","fade","blink","none"],b=G({name:"QSkeleton",props:{...J,tag:{type:String,default:"div"},type:{type:String,validator:n=>oe.includes(n),default:"rect"},animation:{type:String,validator:n=>de.includes(n),default:"wave"},animationSpeed:{type:[String,Number],default:1500},square:Boolean,bordered:Boolean,size:String,width:String,height:String},setup(n,{slots:q}){const i=j(),g=O(n,i.proxy.$q),_=B(()=>{const u=n.size!==void 0?[n.size,n.size]:[n.width,n.height];return{"--q-skeleton-speed":`${n.animationSpeed}ms`,width:u[0],height:u[1]}}),p=B(()=>`q-skeleton q-skeleton--${g.value===!0?"dark":"light"} q-skeleton--type-${n.type}`+(n.animation!=="none"?` q-skeleton--anim q-skeleton--anim-${n.animation}`:"")+(n.square===!0?" q-skeleton--square":"")+(n.bordered===!0?" q-skeleton--bordered":""));return()=>W(n.tag,{class:p.value,style:_.value},X(q.default))}}),ce={class:"text-h6"},me={key:0,class:"q-mt-md"},he={key:1,class:"q-mt-md"},fe={class:"text-subtitle2 q-mb-sm"},_e=Y({__name:"AddFriendDialog",props:{modelValue:{type:Boolean},currentUser:{},existingFriendIds:{},searchUsersFn:{type:Function},sendFriendRequestFn:{type:Function}},emits:["update:modelValue","friend-request-sent"],setup(n,{emit:q}){const i=n,g=q,_=Z(),{t:p}=ee(),u=v(i.modelValue);A(()=>i.modelValue,e=>{u.value=e,e&&U()}),A(()=>u.value,e=>g("update:modelValue",e));const m=v(""),o=v([]),h=v(!1),f=v({});let F;const w=()=>{window.clearTimeout(F),F=window.setTimeout(()=>void L(),300)},L=async()=>{const e=m.value.trim();if(e.length<2){o.value=[];return}h.value=!0;try{const r=await i.searchUsersFn(e);if(r.data){const S=r.data.map(s=>({avatar_url:s.avatar_url??null,birth_year_visible:s.birth_year_visible??null,created_at:s.created_at??null,date_of_birth:s.date_of_birth??null,email:s.email,id:s.id,is_admin:s.is_admin??null,is_dummy:s.is_dummy??null,name:s.name??null,surname:s.surname??null,updated_at:s.updated_at??null,username:s.username??null})),M=i.currentUser?.id;o.value=S.filter(s=>s.id!==M&&!i.existingFriendIds.includes(s.id))}}finally{h.value=!1}},V=async e=>{if(i.currentUser&&!f.value[e]){f.value[e]=!0;try{const r=await i.sendFriendRequestFn(e,i.currentUser.id);r.error?_.notify({type:"negative",message:p("friends.sendRequestError")+": "+(r.error instanceof Error?r.error.message:JSON.stringify(r.error))}):(_.notify({type:"positive",message:p("friends.sendRequestSuccess")}),g("friend-request-sent",e),x())}finally{f.value[e]=!1}}},P=e=>e.name&&e.surname?`${e.name} ${e.surname}`:e.username||e.email,H=e=>e.name&&e.surname?`${e.name.charAt(0)}${e.surname.charAt(0)}`:e.username?e.username.charAt(0).toUpperCase():e.email.charAt(0).toUpperCase(),U=()=>{m.value="",o.value=[],h.value=!1,f.value={}},x=()=>u.value=!1;return(e,r)=>(d(),I(ue,{modelValue:u.value,"onUpdate:modelValue":r[1]||(r[1]=l=>u.value=l),onHide:U},{default:t(()=>[a(ae,{style:{width:"100%","max-width":"500px"}},{default:t(()=>[a(D,null,{default:t(()=>[R("div",ce,y(e.$t("friends.addFriend")),1)]),_:1}),a(D,null,{default:t(()=>[a(te,{modelValue:m.value,"onUpdate:modelValue":r[0]||(r[0]=l=>m.value=l),label:e.$t("friends.searchUsers"),outlined:"",placeholder:e.$t("friends.searchPlaceholder"),onInput:w,onKeyup:ne(w,["enter"])},{prepend:t(()=>[a(le,{name:"search"})]),append:t(()=>[a(C,{flat:"",round:"",icon:"search",onClick:w,disabled:m.value.length<2||h.value},null,8,["disabled"])]),_:1},8,["modelValue","label","placeholder"]),h.value&&o.value.length===0?(d(),k("div",me,[a(K,null,{default:t(()=>[(d(),k(N,null,T(3,l=>a(E,{key:l},{default:t(()=>[a(c,{avatar:""},{default:t(()=>[a(b,{type:"QAvatar"})]),_:1}),a(c,null,{default:t(()=>[a(Q,null,{default:t(()=>[a(b,{type:"text",width:"60%"})]),_:1}),a(Q,{caption:""},{default:t(()=>[a(b,{type:"text",width:"40%"})]),_:1})]),_:1}),a(c,{side:""},{default:t(()=>[a(b,{type:"QBtn"})]),_:1})]),_:2},1024)),64))]),_:1})])):z("",!0),o.value.length>0?(d(),k("div",he,[R("div",fe,y(e.$t("friends.searchResults")),1),a(K,null,{default:t(()=>[(d(!0),k(N,null,T(o.value,l=>(d(),I(E,{key:l.id,clickable:"",onClick:S=>V(l.id)},{default:t(()=>[a(c,{avatar:""},{default:t(()=>[a(se,{color:"primary","text-color":"white"},{default:t(()=>[$(y(H(l)),1)]),_:2},1024)]),_:2},1024),a(c,null,{default:t(()=>[a(Q,null,{default:t(()=>[$(y(P(l)),1)]),_:2},1024),a(Q,{caption:""},{default:t(()=>[$(y(l.username||(l.id===e.currentUser?.id?l.email:"")),1)]),_:2},1024)]),_:2},1024),a(c,{side:""},{default:t(()=>[a(C,{color:"primary",flat:"",round:"",icon:"person_add",loading:f.value[l.id]===!0,onClick:re(S=>V(l.id),["stop"])},null,8,["loading","onClick"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})])):z("",!0)]),_:1}),a(ie,{align:"right"},{default:t(()=>[a(C,{label:e.$t("common.cancel"),color:"grey",flat:"",onClick:x},null,8,["label"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});export{_e as default};
