import{aL as n}from"./index-v3dJaZ__.js";import{supabase as o}from"./supabase-CI4kAcGq.js";const i="darkovnicek_data_loaded",l=()=>{const e=s=>sessionStorage.getItem(`${i}_${s}`)==="true";return{isDataLoaded:e,markDataLoaded:s=>{sessionStorage.setItem(`${i}_${s}`,"true")},clearDataLoaded:s=>{s?sessionStorage.removeItem(`${i}_${s}`):(sessionStorage.removeItem(`${i}_friends`),sessionStorage.removeItem(`${i}_wishes`),sessionStorage.removeItem(`${i}_pendingRequests`))},shouldShowLoading:s=>!e(s)}},c=n("auth",{state:()=>({user:null,profile:null,loading:!1}),getters:{isAuthenticated:e=>!!e.user,isLoading:e=>e.loading},actions:{async signUp(e,t,r){this.loading=!0;try{const{data:a,error:s}=await o.auth.signUp({email:e,password:t,options:{data:r}});if(s)throw s;return{data:a,error:null}}catch(a){return console.error("Sign up error:",a),{data:null,error:a}}finally{this.loading=!1}},async signIn(e,t){this.loading=!0;try{const{data:r,error:a}=await o.auth.signInWithPassword({email:e,password:t});if(a)throw a;return r.user&&await this.fetchProfile(r.user.id),{data:r,error:null}}catch(r){return console.error("Sign in error:",r),{data:null,error:r}}finally{this.loading=!1}},async signOut(){this.loading=!0;try{const{error:e}=await o.auth.signOut();if(e)throw e;this.user=null,this.profile=null;const{clearDataLoaded:t}=l();return t(),{error:null}}catch(e){return console.error("Sign out error:",e),{error:e}}finally{this.loading=!1}},async fetchProfile(e){const{data:t,error:r}=await o.from("profiles").select("*").eq("id",e).single();if(r)throw r;return this.profile=t,t},async updateProfile(e){if(!this.user)throw new Error("No user authenticated");const{data:t,error:r}=await o.from("profiles").update(e).eq("id",this.user.id).select().single();if(r)throw r;return this.profile=t,t},async initializeAuth(){const{data:{session:e}}=await o.auth.getSession();e?.user&&(this.user=e.user,await this.fetchProfile(e.user.id)),o.auth.onAuthStateChange(async(t,r)=>{r?.user?(this.user=r.user,await this.fetchProfile(r.user.id)):(this.user=null,this.profile=null)})}}});export{l as a,c as u};
