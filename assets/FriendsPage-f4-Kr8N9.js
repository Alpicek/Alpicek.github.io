import{s as me,v as N,x as fe,af as ve,a as E,u as ge,n as p,o as i,Q as L,w as r,e as s,g as f,ao as T,c as d,t as u,an as V,f as D,ak as A,p as x,j as y,as as Q,aq as ee,r as w,m as H,E as ye,J as he,h as pe,k as S,q as G,ar as I,i as _e,av as be,au as qe,aw as $e}from"./index-CQR_bE8v.js";import{a as W,Q as ke,c as X,b as Ce}from"./QTabPanels-BZ65xwKW.js";import{Q as we,a as B,b as Y}from"./QItem-DFSnfN2Z.js";import{Q as Qe}from"./QList-C5_MnoGL.js";import{Q as Fe}from"./QPage-hsiTuEin.js";import{u as Re}from"./use-quasar-n8xqa7S3.js";import{u as Se}from"./auth-store-Brg5fDdc.js";import{u as Ae}from"./useFriends-CNLLFJGU.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as xe}from"./vue-i18n.runtime-Cy39-0Yi.js";import"./touch-CnV_mH0H.js";import"./rtl-DFPa-2ov.js";import"./selection-BTPEh2zl.js";import"./supabase-CU5Rm_jF.js";const Ve=["top","middle","bottom"],De=me({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:l=>Ve.includes(l)}},setup(l,{slots:m}){const c=N(()=>l.align!==void 0?{verticalAlign:l.align}:null),o=N(()=>{const g=l.outline===!0&&l.color||l.textColor;return`q-badge flex inline items-center no-wrap q-badge--${l.multiLine===!0?"multi":"single"}-line`+(l.outline===!0?" q-badge--outline":l.color!==void 0?` bg-${l.color}`:"")+(g!==void 0?` text-${g}`:"")+(l.floating===!0?" q-badge--floating":"")+(l.rounded===!0?" q-badge--rounded":"")+(l.transparent===!0?" q-badge--transparent":"")});return()=>fe("div",{class:o.value,style:c.value,role:"status","aria-label":l.label},ve(m.default,l.label!==void 0?[l.label]:[]))}}),Pe={class:"row items-center q-gutter-md"},Ie=["src"],Be={key:1},Ne={class:"friend-info flex-1"},Ee={class:"row items-center q-gutter-sm"},Le={class:"text-h6 friend-name"},Te={key:0,class:"text-subtitle2 text-grey-6"},ze=E({__name:"FriendCard",props:{friend:{},friendshipId:{}},setup(l){const m=l,c=ge(),o=()=>{c.push(`/friend/${m.friend.id}`)},g=t=>t.name&&t.surname?`${t.name} ${t.surname}`:t.username||t.email,b=t=>t.name&&t.surname?`${t.name.charAt(0)}${t.surname.charAt(0)}`:t.username?t.username.charAt(0).toUpperCase():t.email.charAt(0).toUpperCase();return(t,v)=>(i(),p(L,{class:"friend-card",onClick:o},{default:r(()=>[s(D,{class:"friend-card-content"},{default:r(()=>[f("div",Pe,[s(T,{size:"50px",color:"primary","text-color":"white"},{default:r(()=>[t.friend.avatar_url?(i(),d("img",{key:0,src:t.friend.avatar_url},null,8,Ie)):(i(),d("span",Be,u(b(t.friend)),1))]),_:1}),f("div",Ne,[f("div",Ee,[f("div",Le,u(g(t.friend)),1),t.friend.is_dummy?(i(),p(De,{key:0,color:"orange",label:t.$t("dummyProfiles.dummy"),rounded:""},null,8,["label"])):V("",!0)]),t.friend.username?(i(),d("div",Te," @"+u(t.friend.username),1)):V("",!0)])])]),_:1})]),_:1}))}}),Ue=te(ze,[["__scopeId","data-v-0e9a8a1e"]]),Oe=["src"],je={key:1},Je={class:"text-h6 q-mt-md"},Me={key:0,class:"text-subtitle2 text-grey-6"},Ke={class:"text-body2 text-grey-7 q-mt-sm"},Ze={class:"text-caption text-grey-6 q-mt-xs"},He=E({__name:"PendingRequestCard",props:{request:{}},emits:["accept","decline","cancel"],setup(l){const m=l,c=N(()=>m.request.type==="incoming"?m.request.user:m.request.friend),o=t=>t.name&&t.surname?`${t.name} ${t.surname}`:t.username||t.email,g=t=>t.name&&t.surname?`${t.name.charAt(0)}${t.surname.charAt(0)}`:t.username?t.username.charAt(0).toUpperCase():t.email.charAt(0).toUpperCase(),b=t=>{const v=new Date(t),F=Math.abs(new Date().getTime()-v.getTime()),h=Math.ceil(F/(1e3*60*60*24));return h===1?"Dnes":h===2?"Včera":h<7?`Před ${h} dny`:v.toLocaleDateString("cs-CZ")};return(t,v)=>(i(),p(L,{class:"pending-card",style:{width:"100%","max-width":"300px"}},{default:r(()=>[s(D,{class:"text-center"},{default:r(()=>[s(T,{size:"60px",color:"primary","text-color":"white"},{default:r(()=>[c.value.avatar_url?(i(),d("img",{key:0,src:c.value.avatar_url},null,8,Oe)):(i(),d("span",je,u(g(c.value)),1))]),_:1}),f("div",Je,u(o(c.value)),1),c.value.username?(i(),d("div",Me," @"+u(c.value.username),1)):V("",!0),f("div",Ke,[s(x,{name:"schedule",size:"16px",class:"q-mr-xs"}),A(" "+u(t.request.created_at?b(t.request.created_at):"N/A"),1)]),f("div",Ze,u(t.request.type==="incoming"?"Požadavek od uživatele":"Odeslaný požadavek"),1)]),_:1}),s(ee,{align:"center"},{default:r(()=>[t.request.type==="incoming"?(i(),d(Q,{key:0},[s(y,{color:"positive",flat:"",icon:"check",label:"Přijmout",onClick:v[0]||(v[0]=q=>t.$emit("accept",t.request.id))}),s(y,{color:"negative",flat:"",icon:"close",label:"Odmítnout",onClick:v[1]||(v[1]=q=>t.$emit("decline",t.request.id))})],64)):(i(),d(Q,{key:1},[s(y,{color:"grey",flat:"",icon:"schedule",label:"Čeká na odpověď",disabled:""}),s(y,{color:"negative",flat:"",icon:"close",label:"Zrušit",onClick:v[2]||(v[2]=q=>t.$emit("cancel",t.request.id))})],64))]),_:1})]),_:1}))}}),Ge=te(He,[["__scopeId","data-v-7b9f5f5e"]]),We={class:"row justify-between items-center q-mb-md"},Xe={class:"text-h4"},Ye={key:0,class:"flex justify-center"},et={key:1,class:"text-center text-grey-6 q-py-lg"},tt={class:"text-h6 q-mt-md"},at={key:2,class:"row q-gutter-md"},st={key:0,class:"flex justify-center"},nt={key:1,class:"text-center text-grey-6 q-py-lg"},rt={class:"text-h6 q-mt-md"},it={key:2,class:"row q-gutter-md"},lt={class:"text-h6"},ot={key:0,class:"q-mt-md"},dt={class:"text-subtitle2 q-mb-sm"},Ct=E({__name:"FriendsPage",setup(l){const m=Re(),{t:c}=xe(),o=Se(),{friends:g,friendships:b,isLoading:t,sendFriendRequest:v,acceptFriendRequest:q,declineFriendRequest:F,fetchFriends:h,fetchPendingRequests:ae,searchUsers:se,resetLoadingState:ne,subscribeToFriendships:z,subscribeToPendingRequests:U,unsubscribeFromFriendships:O}=Ae(),R=w("friends"),$=w(!1),_=w(""),k=w([]),C=w([]),re=e=>e.name&&e.surname?`${e.name} ${e.surname}`:e.username||e.email,ie=e=>e.name&&e.surname?`${e.name.charAt(0)}${e.surname.charAt(0)}`:e.username?e.username.charAt(0).toUpperCase():e.email.charAt(0).toUpperCase(),j=()=>{_.value="",k.value=[]},le=e=>o.user&&b.value.find(n=>n.user_id===o.user.id&&n.friend_id===e||n.friend_id===o.user.id&&n.user_id===e)?.id||"",P=async()=>{if(_.value.trim().length<2){k.value=[];return}const e=await se(_.value);if(e.data){const a=g.value.map(n=>n.id);k.value=e.data.filter(n=>n.id!==o.user?.id&&!a.includes(n.id))}},J=async e=>{if(!o.user)return;const a=await v(e,o.user.id);a.error?m.notify({type:"negative",message:c("friends.sendRequestError")+": "+(a.error instanceof Error?a.error.message:JSON.stringify(a.error))}):(m.notify({type:"positive",message:c("friends.sendRequestSuccess")}),$.value=!1,j())},oe=async e=>{if(!o.user)return;const a=await q(e,o.user.id);a.error?m.notify({type:"negative",message:c("friends.acceptRequestError")+": "+(a.error instanceof Error?a.error.message:JSON.stringify(a.error))}):m.notify({type:"positive",message:c("friends.acceptRequestSuccess")})},de=async e=>{const a=await F(e);a.error?m.notify({type:"negative",message:c("friends.declineRequestError")+": "+(a.error instanceof Error?a.error.message:JSON.stringify(a.error))}):m.notify({type:"positive",message:c("friends.declineRequestSuccess")})},ue=async e=>{const a=await F(e);a.error?m.notify({type:"negative",message:"Chyba při rušení požadavku: "+(a.error instanceof Error?a.error.message:JSON.stringify(a.error))}):m.notify({type:"positive",message:"Požadavek byl zrušen."})},M=async()=>{if(!o.user)return;const e=await ae(o.user.id);e?.data&&(C.value=e.data)},K=async e=>{if(!e)return;const a=g.value.length>0;await h(e.id,a),await M(),z(e.id),U(e.id,n=>{C.value=n})};H(async()=>{o.user&&await K(o.user)}),ye(()=>o.user,async(e,a)=>{e&&!a?await K(e):e&&a&&e.id!==a.id&&(O(),await h(e.id,!0),await M(),z(e.id),U(e.id,n=>{C.value=n}))});const Z=()=>{!document.hidden&&o.user&&t.value&&ne(o.user.id)};return H(()=>{document.addEventListener("visibilitychange",Z)}),he(()=>{document.removeEventListener("visibilitychange",Z),O()}),(e,a)=>(i(),p(Fe,{class:"q-pa-md"},{default:r(()=>[f("div",We,[f("div",Xe,u(e.$t("friends.title")),1),s(y,{color:"primary",icon:"person_add",label:e.$t("friends.addFriend"),onClick:a[0]||(a[0]=n=>$.value=!0)},null,8,["label"])]),s(ke,{modelValue:R.value,"onUpdate:modelValue":a[1]||(a[1]=n=>R.value=n),class:"text-primary q-mb-md"},{default:r(()=>[s(W,{name:"friends",label:e.$t("friends.myFriends")},null,8,["label"]),s(W,{name:"pending",label:e.$t("friends.requests")},null,8,["label"])]),_:1},8,["modelValue"]),s(pe),s(Ce,{modelValue:R.value,"onUpdate:modelValue":a[2]||(a[2]=n=>R.value=n),animated:""},{default:r(()=>[s(X,{name:"friends"},{default:r(()=>[S(t)?(i(),d("div",Ye,[s(G,{size:"lg"})])):S(g).length===0?(i(),d("div",et,[s(x,{name:"people",size:"4rem"}),f("div",tt,u(e.$t("friends.noFriends")),1),f("div",null,u(e.$t("friends.addFirstFriend")),1)])):(i(),d("div",at,[(i(!0),d(Q,null,I(S(g),n=>(i(),p(Ue,{key:n.id,friend:n,"friendship-id":le(n.id)},null,8,["friend","friendship-id"]))),128))]))]),_:1}),s(X,{name:"pending"},{default:r(()=>[S(t)?(i(),d("div",st,[s(G,{size:"lg"})])):C.value.length===0?(i(),d("div",nt,[s(x,{name:"inbox",size:"4rem"}),f("div",rt,u(e.$t("friends.noRequests")),1),f("div",null,u(e.$t("friends.noRequestsDescription")),1)])):(i(),d("div",it,[(i(!0),d(Q,null,I(C.value,n=>(i(),p(Ge,{key:n.id,request:n,onAccept:oe,onDecline:de,onCancel:ue},null,8,["request"]))),128))]))]),_:1})]),_:1},8,["modelValue"]),s(qe,{modelValue:$.value,"onUpdate:modelValue":a[5]||(a[5]=n=>$.value=n),onHide:j},{default:r(()=>[s(L,{style:{width:"100%","max-width":"500px"}},{default:r(()=>[s(D,null,{default:r(()=>[f("div",lt,u(e.$t("friends.addFriend")),1)]),_:1}),s(D,null,{default:r(()=>[s(_e,{modelValue:_.value,"onUpdate:modelValue":a[3]||(a[3]=n=>_.value=n),label:e.$t("friends.searchUsers"),outlined:"",placeholder:e.$t("friends.searchPlaceholder"),onInput:P,onKeyup:be(P,["enter"])},{prepend:r(()=>[s(x,{name:"search"})]),append:r(()=>[s(y,{flat:"",round:"",icon:"search",onClick:P,disabled:_.value.length<2},null,8,["disabled"])]),_:1},8,["modelValue","label","placeholder"]),k.value.length>0?(i(),d("div",ot,[f("div",dt,u(e.$t("friends.searchResults"))+":",1),s(Qe,null,{default:r(()=>[(i(!0),d(Q,null,I(k.value,n=>(i(),p(we,{key:n.id,clickable:"",onClick:ce=>J(n.id)},{default:r(()=>[s(B,{avatar:""},{default:r(()=>[s(T,{color:"primary","text-color":"white"},{default:r(()=>[A(u(ie(n)),1)]),_:2},1024)]),_:2},1024),s(B,null,{default:r(()=>[s(Y,null,{default:r(()=>[A(u(re(n)),1)]),_:2},1024),s(Y,{caption:""},{default:r(()=>[A(u(n.username||n.email),1)]),_:2},1024)]),_:2},1024),s(B,{side:""},{default:r(()=>[s(y,{color:"primary",flat:"",round:"",icon:"person_add",onClick:$e(ce=>J(n.id),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})])):V("",!0)]),_:1}),s(ee,{align:"right"},{default:r(()=>[s(y,{label:e.$t("common.cancel"),color:"grey",flat:"",onClick:a[4]||(a[4]=n=>$.value=!1)},null,8,["label"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{Ct as default};
