import{a as E,u as ce,n as h,o as i,Q as T,w as r,e as a,g as c,ax as z,c as o,t as l,at as S,f as P,v as me,ak as V,p as D,j as v,au as w,aw as Y,r as C,m as Z,E as fe,J as pe,h as ve,k as A,q as H,av as I,i as ye,aC as he,aB as ge,aD as _e}from"./index-DsP-nMLo.js";import{a as G,Q as $e}from"./QTabs-DaUEGq_e.js";import{a as W,Q as qe}from"./QTabPanels-CxWymmZi.js";import{Q as be,a as N,b as X}from"./QItem-BoJwHhdH.js";import{Q as ke}from"./QList-CXe_4pD4.js";import{Q as Ce}from"./QPage-BjfGDhL-.js";import{u as we}from"./use-quasar-8KxiYwhJ.js";import{u as Qe}from"./auth-store-Bf3hSUlm.js";import{u as Fe}from"./useFriends-C-C2Ceu2.js";import{Q as Re}from"./QBadge-BxR2nfqv.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Ae}from"./vue-i18n.runtime-B326ilhY.js";import"./QResizeObserver-0SPLo5D2.js";import"./rtl-DFPa-2ov.js";import"./touch-BjYP5sR0.js";import"./selection-C6vwuMfh.js";import"./supabase-DBrb1RXq.js";const Ve={class:"row items-center q-gutter-md"},De=["src"],Se={key:1},Pe={class:"friend-info flex-1"},xe={class:"row items-center q-gutter-sm"},Ie={class:"text-h6 friend-name"},Ne={key:0,class:"text-subtitle2 text-grey-6"},Ee=E({__name:"FriendCard",props:{friend:{},friendshipId:{}},setup(Q){const m=Q,u=ce(),d=()=>{u.push(`/friend/${m.friend.id}`)},p=t=>t.name&&t.surname?`${t.name} ${t.surname}`:t.username||t.email,_=t=>t.name&&t.surname?`${t.name.charAt(0)}${t.surname.charAt(0)}`:t.username?t.username.charAt(0).toUpperCase():t.email.charAt(0).toUpperCase();return(t,f)=>(i(),h(T,{class:"friend-card",onClick:d},{default:r(()=>[a(P,{class:"friend-card-content"},{default:r(()=>[c("div",Ve,[a(z,{size:"50px",color:"primary","text-color":"white"},{default:r(()=>[t.friend.avatar_url?(i(),o("img",{key:0,src:t.friend.avatar_url},null,8,De)):(i(),o("span",Se,l(_(t.friend)),1))]),_:1}),c("div",Pe,[c("div",xe,[c("div",Ie,l(p(t.friend)),1),t.friend.is_dummy?(i(),h(Re,{key:0,color:"orange",label:t.$t("dummyProfiles.dummy"),rounded:""},null,8,["label"])):S("",!0)]),t.friend.username?(i(),o("div",Ne," @"+l(t.friend.username),1)):S("",!0)])])]),_:1})]),_:1}))}}),Te=ee(Ee,[["__scopeId","data-v-0e9a8a1e"]]),ze=["src"],Be={key:1},Le={class:"text-h6 q-mt-md"},Ue={key:0,class:"text-subtitle2 text-grey-6"},Oe={class:"text-body2 text-grey-7 q-mt-sm"},je={class:"text-caption text-grey-6 q-mt-xs"},Je=E({__name:"PendingRequestCard",props:{request:{}},emits:["accept","decline","cancel"],setup(Q){const m=Q,u=me(()=>m.request.type==="incoming"?m.request.user:m.request.friend),d=t=>t.name&&t.surname?`${t.name} ${t.surname}`:t.username||t.email,p=t=>t.name&&t.surname?`${t.name.charAt(0)}${t.surname.charAt(0)}`:t.username?t.username.charAt(0).toUpperCase():t.email.charAt(0).toUpperCase(),_=t=>{const f=new Date(t),F=Math.abs(new Date().getTime()-f.getTime()),y=Math.ceil(F/(1e3*60*60*24));return y===1?"Dnes":y===2?"Včera":y<7?`Před ${y} dny`:f.toLocaleDateString("cs-CZ")};return(t,f)=>(i(),h(T,{class:"pending-card",style:{width:"100%","max-width":"300px"}},{default:r(()=>[a(P,{class:"text-center"},{default:r(()=>[a(z,{size:"60px",color:"primary","text-color":"white"},{default:r(()=>[u.value.avatar_url?(i(),o("img",{key:0,src:u.value.avatar_url},null,8,ze)):(i(),o("span",Be,l(p(u.value)),1))]),_:1}),c("div",Le,l(d(u.value)),1),u.value.username?(i(),o("div",Ue," @"+l(u.value.username),1)):S("",!0),c("div",Oe,[a(D,{name:"schedule",size:"16px",class:"q-mr-xs"}),V(" "+l(t.request.created_at?_(t.request.created_at):"N/A"),1)]),c("div",je,l(t.request.type==="incoming"?"Požadavek od uživatele":"Odeslaný požadavek"),1)]),_:1}),a(Y,{align:"center"},{default:r(()=>[t.request.type==="incoming"?(i(),o(w,{key:0},[a(v,{color:"positive",flat:"",icon:"check",label:"Přijmout",onClick:f[0]||(f[0]=$=>t.$emit("accept",t.request.id))}),a(v,{color:"negative",flat:"",icon:"close",label:"Odmítnout",onClick:f[1]||(f[1]=$=>t.$emit("decline",t.request.id))})],64)):(i(),o(w,{key:1},[a(v,{color:"grey",flat:"",icon:"schedule",label:"Čeká na odpověď",disabled:""}),a(v,{color:"negative",flat:"",icon:"close",label:"Zrušit",onClick:f[2]||(f[2]=$=>t.$emit("cancel",t.request.id))})],64))]),_:1})]),_:1}))}}),Me=ee(Je,[["__scopeId","data-v-7b9f5f5e"]]),Ke={class:"row justify-between items-center q-mb-md"},Ze={class:"text-h4"},He={key:0,class:"flex justify-center"},Ge={key:1,class:"text-center text-grey-6 q-py-lg"},We={class:"text-h6 q-mt-md"},Xe={key:2,class:"row q-gutter-md"},Ye={key:0,class:"flex justify-center"},et={key:1,class:"text-center text-grey-6 q-py-lg"},tt={class:"text-h6 q-mt-md"},st={key:2,class:"row q-gutter-md"},at={class:"text-h6"},nt={key:0,class:"q-mt-md"},rt={class:"text-subtitle2 q-mb-sm"},kt=E({__name:"FriendsPage",setup(Q){const m=we(),{t:u}=Ae(),d=Qe(),{friends:p,friendships:_,isLoading:t,sendFriendRequest:f,acceptFriendRequest:$,declineFriendRequest:F,fetchFriends:y,fetchPendingRequests:te,searchUsers:se,resetLoadingState:ae,subscribeToFriendships:B,subscribeToPendingRequests:L,unsubscribeFromFriendships:U}=Fe(),R=C("friends"),q=C(!1),g=C(""),b=C([]),k=C([]),ne=e=>e.name&&e.surname?`${e.name} ${e.surname}`:e.username||e.email,re=e=>e.name&&e.surname?`${e.name.charAt(0)}${e.surname.charAt(0)}`:e.username?e.username.charAt(0).toUpperCase():e.email.charAt(0).toUpperCase(),O=()=>{g.value="",b.value=[]},ie=e=>d.user&&_.value.find(n=>n.user_id===d.user.id&&n.friend_id===e||n.friend_id===d.user.id&&n.user_id===e)?.id||"",x=async()=>{if(g.value.trim().length<2){b.value=[];return}const e=await se(g.value);if(e.data){const s=p.value.map(n=>n.id);b.value=e.data.filter(n=>n.id!==d.user?.id&&!s.includes(n.id))}},j=async e=>{if(!d.user)return;const s=await f(e,d.user.id);s.error?m.notify({type:"negative",message:u("friends.sendRequestError")+": "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):(m.notify({type:"positive",message:u("friends.sendRequestSuccess")}),q.value=!1,O())},de=async e=>{if(!d.user)return;const s=await $(e,d.user.id);s.error?m.notify({type:"negative",message:u("friends.acceptRequestError")+": "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):m.notify({type:"positive",message:u("friends.acceptRequestSuccess")})},oe=async e=>{const s=await F(e);s.error?m.notify({type:"negative",message:u("friends.declineRequestError")+": "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):m.notify({type:"positive",message:u("friends.declineRequestSuccess")})},le=async e=>{const s=await F(e);s.error?m.notify({type:"negative",message:"Chyba při rušení požadavku: "+(s.error instanceof Error?s.error.message:JSON.stringify(s.error))}):m.notify({type:"positive",message:"Požadavek byl zrušen."})},J=async()=>{if(!d.user)return;const e=await te(d.user.id);e?.data&&(k.value=e.data)},M=async e=>{if(!e)return;const s=p.value.length>0;await y(e.id,s),await J(),B(e.id),L(e.id,n=>{k.value=n})};Z(async()=>{d.user&&await M(d.user)}),fe(()=>d.user,async(e,s)=>{e&&!s?await M(e):e&&s&&e.id!==s.id&&(U(),await y(e.id,!0),await J(),B(e.id),L(e.id,n=>{k.value=n}))});const K=()=>{!document.hidden&&d.user&&t.value&&ae(d.user.id)};return Z(()=>{document.addEventListener("visibilitychange",K)}),pe(()=>{document.removeEventListener("visibilitychange",K),U()}),(e,s)=>(i(),h(Ce,{class:"q-pa-md"},{default:r(()=>[c("div",Ke,[c("div",Ze,l(e.$t("friends.title")),1),a(v,{color:"primary",icon:"person_add",label:e.$t("friends.addFriend"),onClick:s[0]||(s[0]=n=>q.value=!0)},null,8,["label"])]),a($e,{modelValue:R.value,"onUpdate:modelValue":s[1]||(s[1]=n=>R.value=n),class:"text-primary q-mb-md"},{default:r(()=>[a(G,{name:"friends",label:e.$t("friends.myFriends")},null,8,["label"]),a(G,{name:"pending",label:e.$t("friends.requests")},null,8,["label"])]),_:1},8,["modelValue"]),a(ve),a(qe,{modelValue:R.value,"onUpdate:modelValue":s[2]||(s[2]=n=>R.value=n),animated:""},{default:r(()=>[a(W,{name:"friends"},{default:r(()=>[A(t)?(i(),o("div",He,[a(H,{size:"lg"})])):A(p).length===0?(i(),o("div",Ge,[a(D,{name:"people",size:"4rem"}),c("div",We,l(e.$t("friends.noFriends")),1),c("div",null,l(e.$t("friends.addFirstFriend")),1)])):(i(),o("div",Xe,[(i(!0),o(w,null,I(A(p),n=>(i(),h(Te,{key:n.id,friend:n,"friendship-id":ie(n.id)},null,8,["friend","friendship-id"]))),128))]))]),_:1}),a(W,{name:"pending"},{default:r(()=>[A(t)?(i(),o("div",Ye,[a(H,{size:"lg"})])):k.value.length===0?(i(),o("div",et,[a(D,{name:"inbox",size:"4rem"}),c("div",tt,l(e.$t("friends.noRequests")),1),c("div",null,l(e.$t("friends.noRequestsDescription")),1)])):(i(),o("div",st,[(i(!0),o(w,null,I(k.value,n=>(i(),h(Me,{key:n.id,request:n,onAccept:de,onDecline:oe,onCancel:le},null,8,["request"]))),128))]))]),_:1})]),_:1},8,["modelValue"]),a(ge,{modelValue:q.value,"onUpdate:modelValue":s[5]||(s[5]=n=>q.value=n),onHide:O},{default:r(()=>[a(T,{style:{width:"100%","max-width":"500px"}},{default:r(()=>[a(P,null,{default:r(()=>[c("div",at,l(e.$t("friends.addFriend")),1)]),_:1}),a(P,null,{default:r(()=>[a(ye,{modelValue:g.value,"onUpdate:modelValue":s[3]||(s[3]=n=>g.value=n),label:e.$t("friends.searchUsers"),outlined:"",placeholder:e.$t("friends.searchPlaceholder"),onInput:x,onKeyup:he(x,["enter"])},{prepend:r(()=>[a(D,{name:"search"})]),append:r(()=>[a(v,{flat:"",round:"",icon:"search",onClick:x,disabled:g.value.length<2},null,8,["disabled"])]),_:1},8,["modelValue","label","placeholder"]),b.value.length>0?(i(),o("div",nt,[c("div",rt,l(e.$t("friends.searchResults"))+":",1),a(ke,null,{default:r(()=>[(i(!0),o(w,null,I(b.value,n=>(i(),h(be,{key:n.id,clickable:"",onClick:ue=>j(n.id)},{default:r(()=>[a(N,{avatar:""},{default:r(()=>[a(z,{color:"primary","text-color":"white"},{default:r(()=>[V(l(re(n)),1)]),_:2},1024)]),_:2},1024),a(N,null,{default:r(()=>[a(X,null,{default:r(()=>[V(l(ne(n)),1)]),_:2},1024),a(X,{caption:""},{default:r(()=>[V(l(n.username||n.email),1)]),_:2},1024)]),_:2},1024),a(N,{side:""},{default:r(()=>[a(v,{color:"primary",flat:"",round:"",icon:"person_add",onClick:_e(ue=>j(n.id),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})])):S("",!0)]),_:1}),a(Y,{align:"right"},{default:r(()=>[a(v,{label:e.$t("common.cancel"),color:"grey",flat:"",onClick:s[4]||(s[4]=n=>q.value=!1)},null,8,["label"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{kt as default};
